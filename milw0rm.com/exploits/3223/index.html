<html><head><title>CVSTrac 2.0.0 Post-Attack Database Resurrection DoS Exploit</title></head><pre>##
##  cvstrack-resurrect.pl -- CVSTrac Post-Attack Database Resurrection
##  Copyright (c) 2007 Ralf S. Engelschall &lt;rse@engelschall.com&gt;
##

use DBI;           # requires OpenPKG perl-dbi
use DBD::SQLite;   # requires OpenPKG perl-dbi, perl-dbi::with_dbd_sqlite=yes
use DBIx::Simple;  # requires OpenPKG perl-dbix
use Date::Format;  # requires OpenPKG perl-time

my $db_file = $ARGV[0];

my $db = DBIx::Simple-&gt;connect(
   &quot;dbi:SQLite:dbname=$db_file&quot;, &quot;&quot;, &quot;&quot;,
   { RaiseError =&gt; 0, AutoCommit =&gt; 0 }
);

my $eow = q{\x00\s.,:;?!)&quot;'};

sub fixup {
   my ($data) = @_;
   if ($$data =~ m:/[^$eow]*/[^$eow]*'[^$eow]+:s) {
       $$data =~ s:(/[^$eow]*/[^$eow]*)('[^$eow]+):$1 $2:sg;
       return 1;
   }
   return 0;
}

foreach my $rec ($db-&gt;query(&quot;SELECT name, invtime, text FROM wiki&quot;)-&gt;hashes()) {
   if (&amp;fixup(\$rec-&gt;{&quot;text&quot;})) {
       printf(&quot;++ adjusting Wiki page \&quot;%s\&quot; as of %s\n&quot;,
           $rec-&gt;{&quot;name&quot;}, time2str(&quot;%Y-%m-%d %H:%M:%S&quot;, -$rec-&gt;{&quot;invtime&quot;}));
       $db-&gt;query(&quot;UPDATE wiki SET text = ? WHERE name = ? AND invtime = ?&quot;,
           $rec-&gt;{&quot;text&quot;}, $rec-&gt;{&quot;name&quot;}, $rec-&gt;{&quot;invtime&quot;});
   }
}
foreach my $rec ($db-&gt;query(&quot;SELECT tn, description, remarks FROM ticket&quot;)-&gt;hashes()) {
   if (&amp;fixup(\$rec-&gt;{&quot;description&quot;}) or &amp;fixup(\$rec-&gt;{&quot;remarks&quot;})) {
       printf(&quot;++ adjusting ticket #%d\n&quot;,
           $rec-&gt;{&quot;tn&quot;});
       $db-&gt;query(&quot;UPDATE ticket SET description = ?, remarks = ? WHERE tn = ?&quot;,
           $rec-&gt;{&quot;description&quot;}, $rec-&gt;{&quot;remarks&quot;}, $rec-&gt;{&quot;tn&quot;});
   }
}
foreach my $rec ($db-&gt;query(&quot;SELECT tn, chngtime, oldval, newval FROM tktchng&quot;)-&gt;hashes()) {
   if (&amp;fixup(\$rec-&gt;{&quot;oldval&quot;}) or &amp;fixup(\$rec-&gt;{&quot;newval&quot;})) {
       printf(&quot;++ adjusting ticket [%d] change as of %s\n&quot;,
           $rec-&gt;{&quot;tn&quot;}, time2str(&quot;%Y-%m-%d %H:%M:%S&quot;, $rec-&gt;{&quot;chngtime&quot;}));
       $db-&gt;query(&quot;UPDATE tktchng SET oldval = ?, newval = ? WHERE tn = ? AND chngtime = ?&quot;,
           $rec-&gt;{&quot;oldval&quot;}, $rec-&gt;{&quot;newval&quot;}, $rec-&gt;{&quot;tn&quot;}, $rec-&gt;{&quot;chngtime&quot;});
   }
}
foreach my $rec ($db-&gt;query(&quot;SELECT cn, message FROM chng&quot;)-&gt;hashes()) {
   if (&amp;fixup(\$rec-&gt;{&quot;message&quot;})) {
       printf(&quot;++ adjusting change [%d]\n&quot;,
           $rec-&gt;{&quot;cn&quot;});
       $db-&gt;query(&quot;UPDATE chng SET message = ? WHERE cn = ?&quot;,
           $rec-&gt;{&quot;message&quot;}, $rec-&gt;{&quot;cn&quot;});
   }
}

$db-&gt;commit();
$db-&gt;disconnect();

# milw0rm.com [2007-01-29]</pre></html>